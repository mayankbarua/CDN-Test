!function(NetBrain){var consts=NetBrain.ns("NetworkOS.Const.UIFramework");consts.UrlTemplate={Desktop:"desktop.html",Map:"map.html?t={tenantId}&d={domainId}&id={id}",MapRBA:"map.html?t={tenantId}&d={domainId}&id={id}&rba={rba}",Dashboard:"dashboard.html",InventoryReport:"inventoryreport.html#/",ApplicationFlowManage:"applicationFlowManager.html",ApplicationManager:"applicationManager.html",Parser:"parser.html#{catId}/{id}",DataViewManager:"dataviewMgr.html",DataViewTemplate:"dataviewtemplate.html",DashboardManager:"dashboardMgr.html",ApiStubManager:"apiServiceStubMgr.html",VisualSpaceManager:"visualspaceMgr.html",ApiMapLink:"apiMapLink.html",EventConsole:"eventconsole.html",RunBook:"runBook.html",ChangeMgmtTplEditor:"changeMgmtTplEditor.html",QappEditorNew:"qappEditor.html?id={id}&isDomainCheck=false",QappEditor:"qappEditor.html?c={categoryId}&id={id}&isDomainCheck=false",QappGroupEditorNew:"qappGroup.html?id={id}&isDomainCheck=false",QappGroupEditor:"qappGroup.html?c={categoryId}&id={id}&isDomainCheck=false",QappSamplePicture:"qappSamplePicture.html?qappName={qappName}",DomainAdmin:"domainAdmin.html#/domainAdmin/{domainId}",TenantAdmin:"admin.html#/tenantAdmin/{tenantId}",SystemAdmin:"admin.html#/systemAdmin",VariableMapping:"VariableMapping.html",OneIpTable:"oneIpTable.html",EndSystem:"endSystem.html",ChangeAnalysisReport:"caReport.html#/",SPOG:"spog.html",GoldenBaselineManager:"goldenBaselineManager.html"};consts.DocumentTitle="NetBrain IE";consts.DocumentTitleTemplate={Map:"{mapName} - "+consts.DocumentTitle,Dashboard:"{dashboardName} - "+consts.DocumentTitle};consts.Events={UpdateNavigationStatus:"nbUIFramework::UpdateNavigationStatus",ShowMainContentArea:"ShowMainContentArea",ActiveNavMenu:"ActiveNavMenu"};consts.MainContent={Desktop:"desktop",Map:"map"}}(NetBrain);!function(){angular.module("nbApp",["nb.uiframework"]);angular.module("nb.uiframework",["nb.framework","nb.common","nb.ng","nb.networkos","nb.netbrain","nb.application","nb.deviceDetail","nb.path","nb.topo","nb.collaboration","nb.runbook","nb.changemanagement","nb.sdn","nb.machineLearning","nb.tsca","nb.ansible","ngRoute","angular-md5","ui.bootstrap","ui.slider","angularFileUpload","ngGrid","angularSpectrumColorpicker","dialogService","ui.ace","textAngular","resizeModule","ui.tree","ngTable","ui.keypress","ui.router","ct.ui.router.extras.sticky","ngAnimate","ngSanitize","checklist-model","ivh.treeview","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.autoResize","ui.grid.infiniteScroll","ui.grid.edit","ui.grid.cellNav","ui.grid.treeView","ui.grid.edit","ui.grid.grouping","ngStorage","nb.ticket"])}(NetBrain);!function(){var uiframework=angular.module("nb.uiframework");uiframework.config(["ivhTreeviewOptionsProvider",function(ivhTreeviewOptionsProvider){ivhTreeviewOptionsProvider.set({defaultSelectedState:!1,validate:!0,childrenAttribute:"items",idAttribute:"ID",labelAttribute:"Name",twistieCollapsedTpl:"<collapsed-twist></collapsed-twist>",twistieExpandedTpl:"<open-twist></open-twist>",twistieLeafTpl:""})}]);uiframework.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("nb.ng.oauthHttpIntercepterSrvc")}]);uiframework.run(["$rootScope","$q","$http","nb.ng.httpAuthSrvc","nb.common.nbAlertSrvc",function($rootScope,$q,$http,httpAuthSrvc,nbAlertSrvc){httpAuthSrvc.initSetTenantDomain();$rootScope.mainTimeoutWatcher=$rootScope.$on(systemEvent.mainSessionTimeout,(function(event,isForcedLogout){event.stopPropagation();$rootScope.mainTimeoutWatcher();nbAlertSrvc.notification({windowClass:"session-expired-message",message:"Your session has been ended. Please log in again. "}).then((function(){window.onbeforeunload=null;httpAuthSrvc.setLoginRedirectUrl(window.location.href);httpAuthSrvc.forceLogout("mainUI");httpAuthSrvc.reSignin("mainUI")}))}));window.duringUnitTesting||$q.when(httpAuthSrvc.isNeedResignin("mainUI")).then((function(){httpAuthSrvc.forceLogout("mainUI");httpAuthSrvc.setLoginRedirectUrl(window.location.href);httpAuthSrvc.reSignin()}),(function(){$(".app-loading-mask").remove()}))}])}(NetBrain);!function(NetBrain){var uiframework=angular.module("nb.uiframework");var AppSubGroups=NetBrain.NetworkOS.Const.AppSubGroups;uiframework.run(["$rootScope","$q","$uibModal","osApp","nb.uiframework.urlStateMgr","nb.ng.permissionSrvc","nb.ng.licenseSrvc","nb.admin.httpChangeMgmtSettingSrvc","nb.common.nbAlertSrvc",function($rootScope,$q,$uibModal,osAppProvider,urlStateMgr,permissionSrvc,licenseSrvc,httpChangeMgmtSettingSrvc,nbAlertSrvc){regBuiltInApp(101,"Site","app_nb_site",100,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"site");return!0}),"Browse network devices by site hierarchy.",AppSubGroups.NETWORK_RESOURCES);regBuiltInApp(108,"Network","app_nb_resource_browser",101,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"sdn");return!0}),"Browse existing sdn or create new ones.",AppSubGroups.NETWORK_RESOURCES);regBuiltInApp(102,"Device Group","app_nb_devicegroup",102,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"deviceGroup");return!0}),"Browse and manage device groups.",AppSubGroups.NETWORK_RESOURCES);var aamApp=regBuiltInApp(113,"Application Manager","app_nb_aam",108,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.ApplicationManager,NetBrain.NG.Const.PageType.ApplicationManager,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.ApplicationManager,blank?"_blank":null)}));return!0}),"Browse and manage applications.",AppSubGroups.NETWORK_RESOURCES);aamApp.isFullPage=!0;aamApp.hasPermissionCheckCallBack=function(){var deferred=$q.defer();licenseSrvc.getLicenseFromLocalStorage().then((function(){licenseSrvc.isModuleLicenseValid(NetBrain.NG.Const.LicenseModuleType.AAM)?deferred.resolve():deferred.reject()}),(function(){deferred.reject()}));return deferred.promise};regBuiltInApp(105,"Inventory Report","app_nb_inventoryreport",210,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.InventoryReport,NetBrain.NG.Const.PageType.InventoryReport,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.InventoryReport,blank?"_blank":null)}));return!0}),"Browse network inventories, or customize your own reports.",AppSubGroups.NETWORK_RESOURCES).isFullPage=!0;var spogApp=regBuiltInApp(200,"Single Pane of Glass URL","icon_nb_single_pane_of_glass",200,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.SPOG,NetBrain.NG.Const.PageType.SPOG,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.SPOG,blank?"_blank":null)}));return!0}),"Define Single Pane of Glass URL.",AppSubGroups.DYNAMIC_MAP);spogApp.isFullPage=!0;spogApp.hasPermissionCheckCallBack=function(){var deferred=$q.defer();permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.ManageSPOGURL)?deferred.resolve():deferred.reject();return deferred.promise};regBuiltInApp(202,"Data View Template Manager","app_nb_dataviewtemplate",201,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.DataViewTemplate,NetBrain.NG.Const.PageType.DataViewTemplate,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.DataViewTemplate,blank?"_blank":null)}));return!0}),"Create and manage Data View Templates.",AppSubGroups.DYNAMIC_MAP).isFullPage=!0;regBuiltInApp(201,"Static Data View Manager","app_nb_data_view_manager",202,(function(blank){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.DataViewManager;urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.DataViewManager,DataViewTreeType.GlobalDataView,(function(){urlStateMgr.openNewTab(url,blank?"_blank":null)}));return!0}),"Browse and manage static Data Views.",AppSubGroups.DYNAMIC_MAP).isFullPage=!0;var mapLayoutApp=regBuiltInApp(209,"Map Layout Manager","app_nb_layout_style_manager",209,(function(blank){urlStateMgr.switchTabOrOpenNewTab("MapLayoutManager","MapLayoutManager",(function(){urlStateMgr.openNewTab("maplayoutMgr.html",blank?"_blank":null)}));return!0}),"Browse and manage global Map Layouts.",AppSubGroups.DYNAMIC_MAP);mapLayoutApp.isFullPage=!0;mapLayoutApp.hasPermissionCheckCallBack=function(){var deferred=$q.defer();permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.mapLayoutManagement);deferred.resolve();return deferred.promise};regBuiltInAppWithFeature(107,"Runbook Template","app_nb_runbook",103,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"runbook");return!0}),"Browse existing runbook templates or create new ones.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.RunbookTemplate.name);regBuiltInAppWithFeature(110,"Runbook Action Manager","app_nb_action",104,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"action");return!0}),"Browse existing runbook actions or create new ones.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.RunbookActionManager.name);regBuiltInAppWithFeature(112,"Context Action Manager","app_nb_context_manager",105,(function(){$uibModal.open({templateUrl:"modules/nbSDN/views/mapActionMgrDialog.html",controller:"nb.sdn.mapActionMgrDialogCtrl",windowClass:"mapActionMgrModal",backdrop:"static",resolve:{resolveData:{multipleSelect:!1,actionRow:{}}}});return!0}),"Browse existing context actions or create new ones.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.ContextActionManager.name);regBuiltInApp(210,"Network Change","app_nb_change_mgnt",107,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"change-mgnt");return!0}),"Browse existing actions or create new ones.",AppSubGroups.AUTOMATION).hasPermissionCheckCallBack=function(){var deferred=$q.defer();if(!permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.viewNetworkChange)){deferred.reject();return deferred.promise}licenseSrvc.getLicenseFromLocalStorage().then((function(){licenseSrvc.isModuleLicenseNotDisabled(NetBrain.NG.Const.LicenseModuleType.ChangeMgmt)?httpChangeMgmtSettingSrvc.getChangeMgmtSetting().then((function(setting){setting&&!0===setting.enable?deferred.resolve():deferred.reject()}),(function(){deferred.reject()})):deferred.reject()}),(function(){deferred.reject()}));return deferred.promise};regBuiltInAppWithFeature(103,"Qapp Center","app_nb_qapp",110,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"qapps");return!0}),"Browse and manage Qapps.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.Qapp.name);regBuiltInAppWithFeature(106,"Gapp Center","app_nb_gapp",111,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"gapp");return!0}),"Browse and manage Gapps.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.Gapp.name);regBuiltInApp(104,"Parser Library","app_nb_parserlibrary",205,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"qapps",2);return!0}),"Browse and manage parsers.",AppSubGroups.AUTOMATION);var appVariableMapping=regBuiltInApp(208,"Variable Mapping","app_nb_variable_mapping",208,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.VariableMapping,NetBrain.NG.Const.PageType.VariableMapping,(function(){appVariableMapping.hasPermissionCheckCallBack().then((function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.VariableMapping,blank?"_blank":null)}),(function(){nbAlertSrvc.error("You don't have the privilege to do this action, and please delete this shortcut.")}))}));return!0}),"Manage Variable Mapping.",AppSubGroups.AUTOMATION);appVariableMapping.isFullPage=!0;appVariableMapping.hasPermissionCheckCallBack=function(){var deferred=$q.defer();permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.variableMappingManagement)?deferred.resolve():deferred.reject();return deferred.promise};regBuiltInApp(206,"Golden Baseline Manager","app_nb_golden_baseline",206,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.GoldenBaselineManager,NetBrain.NG.Const.PageType.GoldenBaselineManager,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.GoldenBaselineManager,blank?"_blank":null)}));return!0}),"Golden Baseline.",AppSubGroups.AUTOMATION).isFullPage=!0;(automationApp=regBuiltInAppWithFeature(207,"System Automation Manager","app_nb_automation_manager",212,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.ApiStubManager,NetBrain.NG.Const.PageType.ApiStubManager,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.ApiStubManager,blank?"_blank":null)}));return!0}),"Define and manage tasks triggered by integrated third-party systems via API services for diagnosis.",AppSubGroups.AUTOMATION,NetBrain.NG.Const.nbFeatures.SystemAutomationManager.name)).isFullPage=!0;automationApp.hasPermissionCheckCallBack=function(){var deferred=$q.defer();licenseSrvc.getLicenseFromLocalStorage().then((function(){licenseSrvc.isModuleLicenseValid(NetBrain.NG.Const.LicenseModuleType.Automation)?deferred.resolve():deferred.reject()}),(function(){deferred.reject()}));return deferred.promise};regBuiltInApp(1,"Files","app_nb_logo",1,(function(){$rootScope.$emit(NetBrain.NetworkOS.Events.APP_CLICKED,"myfiles");return!0}),"Browse and organize your files.",AppSubGroups.OTHERS);var automationApp;(automationApp=regBuiltInAppWithFeature(204,"Dashboard Widget & Template","app_nb_dashboardmanager",204,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.DashboardManager,NetBrain.NG.Const.PageType.DashboardManager,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.DashboardManager,blank?"_blank":null)}));return!0}),"Manage dashboard templates and widgets.",AppSubGroups.OTHERS,NetBrain.NG.Const.nbFeatures.Dashboard.name)).isFullPage=!0;regBuiltInApp(211,"One IP Table","app_nb_oneip_table",213,(function(){$rootScope.$broadcast(viewFrameEvent.toggleTopPanel,"oneIpTable");return!0}),"One-IP Table.",AppSubGroups.OTHERS).isFullPage=!0;regBuiltInApp(205,"Task Manager","app_nb_task_manager",225,(function(blank){$uibModal.open({templateUrl:"modules/nbTaskManager/views/taskManager.html",controller:"nb.taskmanager.taskManagerCtrl",windowClass:"task-manager-popup",backdrop:"static"});return!0}),"Browse running backend tasks and end processes.",AppSubGroups.OTHERS).isFullPage=!0;regBuiltInApp(230,"Private CLI Settings","app_nb_smart_cli",230,(function(blank){$uibModal.open({templateUrl:"modules/nbAdmin/views/domain/start/privateLiveAccessSettings/tuneLiveAccessPrivateAppDialog.html",controller:"nb.admin.tuneLiveAccessPrivateAppDialogCtrl",windowClass:"tune-live-access-private-app-dialog-popup",backdrop:"static"});return!0}),"Tune Private CLI Settings.",AppSubGroups.OTHERS).isFullPage=!0;regBuiltInApp(229,"Change Analysis Report","app_nb_ca_report",229,(function(blank){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.ChangeAnalysisReport,NetBrain.NG.Const.PageType.ChangeAnalysisReport,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.ChangeAnalysisReport,blank?"_blank":null)}));return!0}),"Browse Change Analysis.",AppSubGroups.OTHERS).isFullPage=!0;function regBuiltInApp(id,name,icon,sort,openCallback,title,subGroupId){var app2=function(id,name,icon,sort,openCallback,title){var app1=new NetBrain.NetworkOS.Model.AppTypeDefinition;app1.id=id;app1.name=name;app1.icon=icon;app1.sort=sort;app1.openCallBack=openCallback;app1.title=title;return app1}(id,name,icon,sort,openCallback,title);app2.groupId=NetBrain.NetworkOS.Const.AppGroups.SYSTEM_APP;app2.subGroupId=subGroupId;osAppProvider.registerApp(app2);return app2}function regBuiltInAppWithFeature(id,name,icon,sort,openCallback,title,subGroupId,featureName){var app2=regBuiltInApp(id,name,icon,sort,openCallback,title,subGroupId);app2.featureName=featureName;return app2}}]);uiframework.run(["$rootScope","osApp","$q",function($rootScope,osAppProvider,$q){$rootScope.$on(systemEvent.changedDomain,(function(){osAppProvider.reloadDomain($q)}))}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr",function($rootScope,osAppProvider,urlStateMgr){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=301;app.name="New Map";app.icon="app_nb_map_new";app.sort=301;app.openCallBack=function(){urlStateMgr.openMap({isCreateNew:!0,target:"_blank"})};app.title="Create a new map.";app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr",function($rootScope,osAppProvider,urlStateMgr){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=302;app.name="New Dashboard";app.icon="app_nb_dashboard_new";app.sort=302;app.openCallBack=function(){urlStateMgr.openDashboard({target:"_blank"})};app.title="Create a new dashboard.";app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;app.featureName=NetBrain.NG.Const.nbFeatures.Dashboard.name;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr","nb.ng.utilitySrvc",function($rootScope,osAppProvider,urlStateMgr,utilitySrvc){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=303;app.name="New Runbook";app.icon="app_nb_runbook_new";app.sort=303;app.openCallBack=function(blank){localStorage.setItem("newRunbook","1");localStorage.removeItem("parent_id");urlStateMgr.openRunBook({isCreateNew:!0,rbType:NetBrain.ns("RunBookBase").TypeEnum.Runbook,target:blank?"_blank":"_self"})};app.title="Create a new runbook.";app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;app.featureName=NetBrain.NG.Const.nbFeatures.Runbook.name;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr",function($rootScope,osAppProvider,urlStateMgr){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=304;app.name="New Qapp";app.icon="app_nb_qapp_new";app.sort=304;app.isFullPage=!0;app.openCallBack=function(){urlStateMgr.openQapp({isCreateNew:!0,target:"_blank"})};app.title="Create a new Qapp.";app.featureName=NetBrain.NG.Const.nbFeatures.Qapp.name;app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr",function($rootScope,osAppProvider,urlStateMgr){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=306;app.name="New Parser";app.icon="app_nb_parser_new";app.sort=306;app.openCallBack=function(){var pName=nbPLM.nbParserMgr.getNextParserName("Parser");var parserInfo={type:"parser",name:pName+"*",oriName:pName,id:NgUtil.getGUID(),catId:"xxxx",accessType:"",opType:0};nbPLM.nbParserMgr.addParserInfo(parserInfo);var url=StringUtil.format(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Parser,parserInfo);urlStateMgr.switchTabOrOpenNewTab(url,NetBrain.NG.Const.PageType.Parser,(function(){urlStateMgr.openNewTab(url,"_blank")}));return!0};app.title="Create a new parser.";app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","osApp","nb.uiframework.urlStateMgr",function($rootScope,osAppProvider,urlStateMgr){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=308;app.name="New Gapp";app.icon="app_nb_gapp_new";app.sort=307;app.isFullPage=!0;app.openCallBack=function(){urlStateMgr.openQappGroup({isCreateNew:!0,target:"_blank"})};app.title="Create a new Gapp.";app.featureName=NetBrain.NG.Const.nbFeatures.Gapp.name;app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;osAppProvider.registerApp(app)}]);uiframework.run(["$rootScope","$q","osApp","nb.uiframework.urlStateMgr","nb.ng.licenseSrvc","nb.ng.permissionSrvc","nb.admin.httpChangeMgmtSettingSrvc","nb.common.nbAlertSrvc",function($rootScope,$q,osAppProvider,urlStateMgr,licenseSrvc,permissionSrvc,httpChangeMgmtSettingSrvc,nbAlertSrvc){var app=new NetBrain.NetworkOS.Model.AppTypeDefinition;app.id=307;app.name="New Network Change";app.icon="app_nb_change_mgnt_new";app.sort=308;app.hasPermissionCheckCallBack=function(){var deferred=$q.defer();if(!permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.createNetworkChange)){deferred.reject();return deferred.promise}licenseSrvc.getLicenseFromLocalStorage().then((function(){licenseSrvc.isModuleLicenseValid(NetBrain.NG.Const.LicenseModuleType.ChangeMgmt)?httpChangeMgmtSettingSrvc.getChangeMgmtSetting().then((function(setting){setting&&!0===setting.enable?deferred.resolve():deferred.reject()}),(function(){deferred.reject()})):deferred.reject()}),(function(){deferred.reject()}));return deferred.promise};app.openCallBack=function(blank){permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.createNetworkChange)&&httpChangeMgmtSettingSrvc.getChangeMgmtSetting().then((function(setting){if(!1===setting.enable)return nbAlertSrvc.warnning("Network Change function has been disabled, please contact your NetBrain administrator for details.");urlStateMgr.openRunBook({isCreateNew:!0,rbType:NetBrain.ns("RunBookBase").TypeEnum.ChangeMgmt,target:blank?"_blank":"_self"})}))};app.title="Create a new Network Change.";app.groupId=NetBrain.NetworkOS.Const.AppGroups.MAIN_APP;osAppProvider.registerApp(app)}]);uiframework.run(["$q","osFs","nb.uiframework.urlStateMgr","nb.ng.utilitySrvc","nb.dashboard.baseSrvc",function($q,osFsProvider,urlStateMgr,utilitySrvc,dashboardBaseSrvc){!function(){var fileType=new NetBrain.NetworkOS.Model.FileTypeDefinition;fileType.name="Dashboard";fileType.type=21;fileType.icon="icon_nb_dashboard";fileType.dblClickAction=new NetBrain.NetworkOS.Model.FileAction;fileType.dblClickAction.callback=function(file){return urlStateMgr.openDashboard({id:file.originalId,target:"_blank"}).then((function(){return!0}))};fileType.dblClickAction.checkFileExists=!0;fileType.actions=[createOpenAction()];utilitySrvc.getLocalStorage("allowShare")&&fileType.actions.push(function(){var action=new NetBrain.NetworkOS.Model.FileAction("Share",20,!0,(function(files){var promiseList=[];var dataList=[];_.each(_.isArray(files)?files:[files],(function(file){dataList.push({id:file.originalId,name:file.name})}));promiseList.push(dashboardBaseSrvc.dashboardShareDialog(dataList).then((function(msg){return"success"===msg}),(function(){})));return $q.all(promiseList)}));action.checkDomain=!0;action.checkFileExists=!0;return action}());osFsProvider.registerFileTypeDefinition(fileType)}();return;function createOpenAction(){var action=new NetBrain.NetworkOS.Model.FileAction("Open",-1,!1,(function(files){var promiseList=[];_.each(_.isArray(files)?files:[files],(function(file){promiseList.push(urlStateMgr.openDashboard({id:file.originalId,target:"_blank"}).then((function(msg){return"success"===msg})))}));return $q.all(promiseList)}));action.checkDomain=!0;action.checkFileExists=!0;return action}}])}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").service("nb.uiframework.urlStateMgr",urlStateMgr);urlStateMgr.$inject=["$rootScope","$log","$window","$interval","$location","$timeout","$document","$q","nb.ng.utilitySrvc","nb.ng.httpAuthSrvc","nb.ng.sessionSrvc","nb.ng.multiTabEventSrvc","nb.ng.permissionSrvc","nb.common.nbAlertSrvc"];function urlStateMgr($rootScope,$log,$window,$interval,$location,$timeout,$document,$q,utilitySrvc,httpAuthSrvc,sessionSrvc,multiTabEventSrvc,permissionSrvc,nbAlertSrvc){var OPEN_NEW_TAB_EVENT="OPEN_NEW_TAB";var urlTemplates=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate;var wrapAsAsync=utilitySrvc.wrapAsAsync;this.openMap=wrapAsAsync(openMap);this.openQapp=wrapAsAsync((function(options){var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];var isCreateNew=!1;if(!options.id){options.id=NgUtil.getGUID();isCreateNew=!0}var id=options.id;var categoryId=options.categoryId;options.isWidget&&utilitySrvc.setLocalStorage(options.id,"isWidget");var urlOption={tenantId:tenantId,domainId:domainId,id:id};var urlTemp=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.QappEditorNew;if(categoryId){urlOption.categoryId=categoryId;urlTemp=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.QappEditor}var url=StringUtil.format(urlTemp,urlOption);if(isCreateNew){url+="&isCreateNew="+isCreateNew;options.target="isCreateNew"+id}return switchTabOrOpenNewTab(url,NetBrain.NG.Const.PageType.QappEditor,(function(){return openNewTab(url)}))}));this.openQappGroup=wrapAsAsync((function(options){var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];var isCreateNew=!1;if(!options.id){options.id=NgUtil.getGUID();isCreateNew=!0}var id=options.id;var categoryId=options.categoryId;options.isWidget&&utilitySrvc.setLocalStorage(options.id,"isWidget");var urlOption={tenantId:tenantId,domainId:domainId,id:id};var urlTemp=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.QappGroupEditorNew;if(categoryId){urlOption.categoryId=categoryId;urlTemp=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.QappGroupEditor}var url=StringUtil.format(urlTemp,urlOption);options.accessType&&(url+="&accessType="+options.accessType);if(isCreateNew){url+="&isCreateNew="+isCreateNew;options.target="isCreateNew"+id}return switchTabOrOpenNewTab(url,NetBrain.NG.Const.PageType.QappGroup,(function(){return openNewTab(url,options.target)}))}));this.openDashboard=wrapAsAsync((function(options){var tenantId=httpAuthSrvc.getSelectedTenantId(),domainId=httpAuthSrvc.getSelectedDomainIds()[0],newOptions=angular.extend({t:tenantId,d:domainId},options);if(!newOptions.id){utilitySrvc.setLocalStorage("isNewDashboard",!0);newOptions.id=NgUtil.getGUID()}var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Dashboard+"?"+$.param(newOptions);return switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.Dashboard+newOptions.id,NetBrain.NG.Const.PageType.Dashboard,(function(){return openNewTab(url,newOptions.target)}))}));this.openNewTab=wrapAsAsync(openNewTab);this.redirectTo=redirectTo;this.getUrlParams=function(urlTemplate,url){url||(url=$location.absUrl());urlTemplate=urlTemplate.replace(/\//g,"\\/").replace(/\./g,"\\.").replace(/\?/g,"\\?");var urlParams={};var arr=[];var templateParams=urlTemplate.match(/\{[^{}]*?\}/g);for(var i=0;i<templateParams.length;i++){var field=templateParams[i].replace("{","").replace("}","");urlTemplate=urlTemplate.replace("{"+field+"}","([^\\/]*)");urlParams[field]=null;arr.push(field)}var groups=new RegExp(urlTemplate,"g").exec(url);if(0===arr.length||!groups||arr.length+1!==groups.length)return urlParams;for(var ii=0;ii<arr.length;ii++)urlParams[arr[ii]]=groups[ii+1];return urlParams};this.getUrlMap=function(url){url||(url=$location.absUrl());return new URI(url).search(!0)};this.redirectToDesktop=function(){return redirectTo(urlTemplates.Desktop)};this.openRunBook=wrapAsAsync(openRunBook);this.openAlogAndDataView=wrapAsAsync((function(options){NetBrain.Map&&NetBrain.Map.currentActiveMap&&options.id===NetBrain.Map.currentActiveMap.getDocId()&&$rootScope.$emit("GEventOpenDetailPanelFormAlert",options);openRunBook(options)}));this.openChangeMgmtTplEditor=wrapAsAsync((function(options){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.ChangeMgmtTplEditor+"?"+$.param(options);return switchTabOrOpenNewTab(options.id,NetBrain.NG.Const.PageType.ChangeMgmtTplEditor,(function(){return openNewTab(url,options.target)}))}));this.openVariableMapping=wrapAsAsync((function(options){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.VariableMapping+"?"+$.param(options);return switchTabOrOpenNewTab(options.id,NetBrain.NG.Const.PageType.VariableMapping,(function(){return openNewTab(url,options.target)}))}));this.openOneIpTable=wrapAsAsync((function(options){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.OneIpTable+"?"+$.param(options);return switchTabOrOpenNewTab(options.id,NetBrain.NG.Const.PageType.OneIpTable,(function(){return openNewTab(url,options.target)}))}));this.setPageSession=sessionSrvc.setPageSession;this.getPageSession=sessionSrvc.getPageSession;this.clearPageSession=sessionSrvc.clearPageSession;this.getPageSessionIfOpend=sessionSrvc.getPageSessionIfOpend;this.getAllCurrentPages=function(){var pages=sessionSrvc.getAllCurrentPages();return _.filter(pages,(function(page){return page.Type!==NetBrain.NG.Const.PageType.Desktop||page.Type===NetBrain.NG.Const.PageType.Desktop&&void 0!==page.Options&&page.Options.subType!==NetBrain.NG.Const.PageType.Desktop}))};this.hasPageOpend=sessionSrvc.hasPageOpend;this.switchBrowserTab=function(identity,type,page,extData){NetBrain.Page.Identity===identity&&NetBrain.Page.Type===type||multiTabEventSrvc.trigger(MultiTabEvent.switchTab,{identity:identity,type:type,page:page,extData:extData})};this.switchTabOrOpenNewTab=switchTabOrOpenNewTab;this.getPageUrl=function(){return(new URI).resource().replace(/^(\/+)/gi,"")};$rootScope.$on(OPEN_NEW_TAB_EVENT,(function(event,url,target){void 0!==target&&null!=target||(target="_self");var link=angular.element('<a href="'+url+'" rel="noreferrer" target="'+target+'"></a>');angular.element(document.body).append(link);$timeout((function(){link[0].click();link.remove()}))}));function openMap(options){var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];var mapType=options.mapType||NetBrain.Map.Const.MapType.general;if(!options.id||options.isNewMap){options.id||(options.id=NgUtil.getGUID());utilitySrvc.setLocalStorage("CreateMap"+options.id,options.title?{title:options.title}:{})}if(options.openEmptyMap){options.id=options.emptyMapId;utilitySrvc.setLocalStorage("CreateMap"+options.id,options.title?{title:options.title}:{})}var id=options.id;var actionKey=options.urlKey;var activePageId=options.activePageId;var isWidget=options.isWidget;var fromMapId=options.fromMapId;var fromMapType=options.fromMapType;isWidget&&utilitySrvc.setLocalStorage(options.id,"isWidget");var url=StringUtil.format(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Map,{tenantId:tenantId,domainId:domainId,id:id});if(null!=options.rba){url=url+"&rba="+options.rba;options.rbNodeId&&(url=url+"&rbNodeId="+options.rbNodeId);options.selectAlogId&&(url=url+"&selectAlogId="+options.selectAlogId)}if(options.openDataElementDetailPane){url=url+"&devId="+options.devId;options.uId&&(url=url+"&uId="+options.uId)}if("ScheduleDVT"===options.alertType){url=url+"&alertType="+options.alertType;options.alertKey&&(url=url+"&alertKey="+options.alertKey);options.dvtId&&(url=url+"&dvtId="+options.dvtId);options.openDefaultRunbookFromAlert&&(url=url+"&openDefaultRunbookFromAlert="+options.openDefaultRunbookFromAlert)}options.defaultSelectedDataViewGroupId&&(url=url+"&dsdvg="+options.defaultSelectedDataViewGroupId);options.defaultSelectedDataViewTemplateId&&(url=url+"&dsdvt="+options.defaultSelectedDataViewTemplateId);mapType&&mapType!==NetBrain.Map.Const.MapType.general&&(url+="&maptype="+mapType);actionKey&&(url+="&actionKey="+actionKey);activePageId&&(url+="&activePageId="+activePageId);fromMapId&&(url+="&fromMapId="+fromMapId);fromMapType&&(url+="&fromMapType="+fromMapType);return switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.Map+id,NetBrain.NG.Const.PageType.Map,(function(){if(NetBrain.Page.Type===NetBrain.NG.Const.PageType.Desktop&&null==NetBrain.Map.currentActiveMap){$rootScope.$emit("NewMap",null,options);return!0}if(void 0===NetBrain.Map||void 0===NetBrain.Map.currentActiveMap||NetBrain.Map.currentActiveMap.getDocId()!==id){if(options.createRunbook){url+="&createRunbook="+options.createRunbook+"&rbType="+options.rbType;options.rbtId&&(url+="&rbtId="+options.rbtId)}options.openDataElementDetailPane&&(url+="&openDataElementDetailPane="+options.openDataElementDetailPane);return openNewTab(url,options.target)}$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-map");return!0}))}function openRunBook(options){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.RunBook+"?"+$.param(options);if(!options.rbType||options.rbType!==NetBrain.ns("RunBookBase").TypeEnum.ChangeMgmt||permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.viewNetworkChange)){NetBrain.Map&&NetBrain.Map.currentActiveMap&&options.id===NetBrain.Map.currentActiveMap.getDocId()&&$rootScope.$emit(RunBookEvent.SHOW_RUNBOOK_DETAIL_BY_ID,options.rba,options.rbNodeId,options.selectAlogId);NetBrain.Map&&NetBrain.Map.currentActiveMap&&NetBrain.Map.currentActiveMap.getDocId()&&(options.id=options.id||NetBrain.Map.currentActiveMap.getDocId());if(!0===options.edit_runbook)return switchTabOrOpenNewTab(options.id,NetBrain.NG.Const.PageType.RunBook,(function(){return openNewTab(url,options.target)}));if(options.id&&!options.rba){$rootScope.$emit(RunBookEvent.CREATE_RBA,void 0,void 0,options);$rootScope.$emit(MapTabEvent.OPEN_FROM_OUTSIDE,"RunBook")}options.rba||(options.createRunbook=!0);openMap(options)}else nbAlertSrvc.warning("You don't have the privilege to open it. Please contact your NetBrain administrator for details.")}function openNewTab(url,target){void 0!==target&&null!=target||(target="_blank");if("_self"===target.toLowerCase()&&NetBrain.Page&&NetBrain.Page.LeaveCallback&&"function"==typeof NetBrain.Page.LeaveCallback){var promise=NetBrain.Page.LeaveCallback();promise&&"function"==typeof promise.then?promise.then((function(){emit()})):emit()}else emit();function emit(){$rootScope.$emit(OPEN_NEW_TAB_EVENT,url,target)}return!0}function redirectTo(url){return $window.location.href=url||NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Desktop}function switchTabOrOpenNewTab(identity,type,fallback,extData){var result=$q.defer();result.resolve(fallback());return result.promise}}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").service("nb.uiframework.initDataSrvc",initDataSrvc);initDataSrvc.$inject=["$q","$log","$timeout","nb.ng.httpAuthSrvc","nb.netbrain.signalrHubSrvc","nb.systemmodel.httpDeviceTypeSrvc","nb.systemmodel.httpDeviceSchemaSrvc","nb.systemmodel.deviceSchemaMgrSrvc","nb.topo.httpMediaTypesSrvc","nb.ng.systemSrvc"];function initDataSrvc($q,$log,$timeout,httpAuthSrvc,signalrHubSrvc,httpDeviceTypeSrvc,httpDeviceSchemaSrvc,deviceSchemaMgrSrvc,httpMediaTypesSrvc,systemSrvc){var initDataConfig=[{name:"VersionInfo",initFn:systemSrvc.getVersionInfo.bind(systemSrvc),initData:null,resolveHandler:function(versionObj){NetBrain.VersionObj=versionObj}},{name:"AllBaseData",initFn:httpDeviceTypeSrvc.getAllBaseData.bind(httpDeviceTypeSrvc),initData:null},{name:"AllMediaTypes",initFn:httpMediaTypesSrvc.getAllMediaTypes.bind(httpMediaTypesSrvc),initData:null,resolveHandler:function(jsList){if(jsList.length>0)try{NetBrain.Map.gMediaTypeMgr.setMediaList(jsList)}catch(ex){$log.error(ex)}}},{name:"AllData",initFn:function(){var promises=[];_.each(initDataConfig,(function(config){config.name!==this.name&&promises.push(srvc[config.successPromiseKey])}),this);return $q.all(promises).then((function(values){return _.all(values)?$q.resolve(!0):$q.reject(values)}))}}];var srvc={initTenantData:function(deferred){deferred&&_.isFunction(deferred.resolve)&&srvc.isAllDataInitedPromise.then((function(){deferred.resolve()}),(function(reason){deferred.reject(reason)}))}};!function initAll(){if(dataSrc=httpAuthSrvc.getDataSrc(),dataSrc.TenantGuid&&dataSrc.DomainGuid&&dataSrc.DomainGuid.length>0&&function(tenantId,domainId){var tenants=httpAuthSrvc.getTenantDomain();var foundSelectedDomain=!1;if(tenants&&tenants.obj&&tenants.obj.length>0)for(var i=0;i<tenants.obj.length;i++)if(tenants.obj[i].ID===tenantId&&tenants.obj[i].domains){for(var j=0;j<tenants.obj[i].domains.length;j++)if(tenants.obj[i].domains[j].guid===domainId){foundSelectedDomain=!0;break}if(foundSelectedDomain)break}return foundSelectedDomain}(dataSrc.TenantGuid,dataSrc.DomainGuid[0])){go.licenseKey="73f047e0b11c28c702d90776423d6bf919a17564cf841ba30b0414f6ec0d3d06329fe82804d2dc9382a81bfe137dc389d8c03c20c349563de730d4db4ae083aab73221e5120b1089f45626969eff2bf1ae6a61f497e571a288288de0fbabc29c54f7f3d557ca09";_.each(initDataConfig,init);srvc.isAllDataInitedPromise.then((function(){signalrHubSrvc.start()}),(function(values){$log.error("initData:",values);signalrHubSrvc.start()}))}else $timeout(initAll,100);var dataSrc}();return srvc;function init(config){!function(config){config.key=(fieldName=config.name,"is"+fieldName+"Inited");var fieldName;config.promiseKey=config.key+"Promise";config.finallyKey=config.key+"Finally";config.successKey=config.key+"Success";config.successPromiseKey=config.successKey+"Promise"}(config);!function(config){var promise=srvc[config.promiseKey]=config.initFn(config.initData);srvc[config.successPromiseKey]=promise.then((function(){return srvc[config.successKey]=!0}),(function(){return srvc[config.successKey]=!1})).finally((function(){srvc[config.finallyKey]=!0}));promise.then(config.resolveHandler)}(config)}}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").service("nb.uiframework.mainUISrvc",mainUISrvc);mainUISrvc.$inject=["$rootScope"];function mainUISrvc($rootScope){this.maximizeMainUI=function(source){var event=NetBrain.Page.MainUIMaximum?viewFrameEvent.Minimize:viewFrameEvent.Maximize;$rootScope.$emit(event,source)};this.isDesktop=function(){return NetBrain.Page.Type===NetBrain.NG.Const.PageType.Desktop};this.isDashboard=function(){return NetBrain.Page.Type===NetBrain.NG.Const.PageType.Dashboard};this.hasMap=function(){return null!=NetBrain.Map.currentActiveMap&&void 0!==NetBrain.Map.currentActiveMap};window.windowIsHidden=!1;var hiddenProperty="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null;var visibilityChangeEvent=hiddenProperty.replace(/hidden/i,"visibilitychange");document.addEventListener(visibilityChangeEvent,(function(){document[hiddenProperty]?window.windowIsHidden=!0:window.windowIsHidden=!1}))}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").factory("nb.uiframework.httpLicenseDetailSrvc",HttpLicenseDetailSrvc);HttpLicenseDetailSrvc.$inject=["nb.ng.nbHttp"];function HttpLicenseDetailSrvc(nbHttp){return{getLicenseDetail:function(tenantId,domainId){return nbHttp.post("system/domain/licenseDetails",{tenantId:"",domainId:""})},getLicenseDetailResult:function(tenantId,domainId){return nbHttp.post("system/domain/licenseDetailsResult",{tenantId:"",domainId:""})}}}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").controller("nb.uiframework.headerCtrl",headerCtrl);headerCtrl.$inject=["$scope","$location","$q","$log","$parse","$rootScope","$uibModal","$state","$stateParams","$window","$timeout","$interval","$templateRequest","$templateCache","limitToFilter","$filter","nb.ng.httpAuthSrvc","nb.qmap.httpMapSrvc","nb.ng.httpUserConfSrvc","nb.ng.httpUserSystemConfSrvc","nb.ng.utilitySrvc","nb.systemmodel.systemVendorModelMgr","nb.admin.httpDomainAdminSrvc","nb.admin.httpTenantAdminSrvc","nb.ng.userSrvc","nb.admin.httpSystemAdminSrvc","nb.eventconsole.eventConsoleModelSrvc","nb.eventconsole.eventBubbleService","nb.eventconsole.eventConsoleOperateService","dialogService","nb.common.nbAlertSrvc","nb.collaboration.collaborationGridSrvc","nb.admin.httpDomainAdminNewSrvc","nb.admin.domainAdminMgr","nb.ng.tenantSessionSrvc","nb.ng.systemSrvc","nb.systemmodel.httpDeviceTypeSrvc","nb.qmap.mapManagerSrvc","nb.uiframework.initDataSrvc","nb.uiframework.urlStateMgr","nb.ng.licenseSrvc","nb.admin.httpSystemAdminNewSrvc","nb.networkos.shareSrvc","nb.ng.multiTabEventSrvc","nb.common.cacheSrvc","nb.ng.nbReloginSrvc","nb.ng.permissionSrvc","nb.dashboard.baseSrvc","nb.admin.httpChangeMgmtSettingSrvc","nb.ng.httpUserRegistrationSrvc","nb.datamodel.httpDeviceGroupSrvc","nb.runbook.httpRunBookSrvc","nb.ng.serviceMonitorSrvc","nb.ticket.ticketDialogSrvc","nb.ticket.consts"];function headerCtrl($scope,$location,$q,$log,$parse,$rootScope,$uibModal,$state,$stateParams,$window,$timeout,$interval,$templateRequest,$templateCache,limitToFilter,$filter,httpAuthSrvc,httpMapSrvc,httpUserConfSrvc,httpUserSystemConfSrvc,utilitySrvc,systemVendorModelMgr,httpDomainAdminSrvc,httpTenantAdminSrvc,userSrvc,httpSystemAdminSrvc,eventConsoleModelSrvc,eventBubbleService,eventConsoleOperateService,dialogService,nbAlertSrvc,collaborationGridSrvc,httpDomainAdminNewSrvc,domainAdminMgr,tenantSessionSrvc,systemSrvc,httpDeviceTypeSrvc,mapManagerSrvc,initDataSrvc,urlStateMgr,licenseSrvc,httpSystemAdminNewSrvc,shareSrvc,multiTabEventSrvc,cacheSrvc,nbReloginSrvc,permissionSrvc,dashboardSrvc,httpChangeMgmtSettingSrvc,httpUserRegistrationSrvc,httpDeviceGroupSrvc,httpRunBookSrvc,serviceMonitorSrvc,ticketDialogSrvc,ticketConst){multiTabEventSrvc.on(MultiTabEvent.tabLogOut,(function(){httpAuthSrvc.forceLogout("mainUI");httpAuthSrvc.reSignin()}));$scope.UsageHealthTab={Usage:0,Helath:1};$scope.customerSince="";$scope.usageHealthTabIndex=$scope.UsageHealthTab.Usage;$scope.changeUsageHealthTab=function(tabIndex){$scope.usageHealthTabIndex=tabIndex};$scope.goRedirect=function(index,treeId){if(0!=$scope.domainSummary.isDomainAdmin){var url=StringUtil.format(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.DomainAdmin,{domainId:$scope.selected_domain[0].guid});url=url+"?type="+index+"&treeid="+treeId;urlStateMgr.switchTabOrOpenNewTab(url,NetBrain.NG.Const.PageType.DomainAdmin,(function(){urlStateMgr.openNewTab(url,"_blank")}))}};$scope.headerUrl=function(){return $location.path().indexOf("/domainAdmin")>-1?"modules/nbAdmin/views/domainAdminHeader.html":"modules/nbUIFramework/views/mainHeader.html"};$scope.initUserMenu=function(){$scope.userAccountDropDown=[{name:"User Profile",action:"userProfile()"},{name:"Log Out",action:"logout()"}];$scope.helpLinkDropDown=[{name:"Help",action:"help()"},{name:"Contact NetBrain",action:"askNetbrain()"},{name:"Support",action:"support()"},{name:"About NetBrain",action:"about()"}]};var preference=function(){return $uibModal.open({templateUrl:"views/userPreferenceModal.html",controller:"nb.netbrain.userPreferenceCtrl",windowClass:"user-preference-modal",backdrop:"static",resolve:{scope:function(){return"mainUI"}}})};var servicemonitor=function(){serviceMonitorSrvc.openServiceMonitorWithMainUIUser()};$scope.OpenServiceMonitor=function(){serviceMonitorSrvc.openServiceMonitorWithMainUIUser()};var help=function(){utilitySrvc.openTarget(NetBrain.NG.HelpLink.HelpIndex)};var askNetbrain=function(){ticketDialogSrvc.submitTicketModal(ticketConst.EnumTicketType.GenericIssue)};var support=function(){utilitySrvc.openTarget(NetBrain.NG.HelpLink.Support)};var about=function(){$uibModal.open({templateUrl:"modules/nbCommon/views/about.html",controller:"nb.common.aboutCtrl",backdrop:"static",windowClass:"about-netbrain",keyboard:!0,resolve:{}})};var domainAdmin=function(){httpAuthSrvc.setDomainMgtIds();var url=StringUtil.format(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.DomainAdmin,{domainId:$scope.selected_domain[0].guid});urlStateMgr.switchTabOrOpenNewTab(url,NetBrain.NG.Const.PageType.DomainAdmin,(function(){urlStateMgr.openNewTab(url,"_blank")}))};var changePassword=function(){$log.info("changePassword() is triggered!");httpSystemAdminSrvc.getPasswordPolicy().then((function(passwordPolicy){$scope.passwordPolicy=passwordPolicy;$scope.passwordModal=$uibModal.open({templateUrl:"modules/nbNG/views/userPasswordModalDialog.html",controller:"nb.ng.userPasswordDialogCtrl",windowClass:"userPasswordDialog",backdrop:"static",resolve:{resolveData:function(){return{isLoginUser:!0,passwordPolicy:angular.copy($scope.passwordPolicy)}}}})}))};var goAdminPage=function(){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.SystemAdmin,NetBrain.NG.Const.PageType.SystemAdmin,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.SystemAdmin)}),NetBrain.NG.Const.PageType.SystemAdmin)};var userProfile=function(){httpUserRegistrationSrvc.getUserProfile().then((function(result){result.success?$scope.passwordModal=$uibModal.open({templateUrl:"modules/nbAdmin/views/system/userProfileModalDialog.html",controller:"nb.admin.userProfileDialogCtrl",windowClass:"userProfileDialog",backdrop:"static",resolve:{userData:function(){return result.userProfile}}}):nbAlertSrvc.error({message:result.reasons.join()})}),(function(errorResp){nbAlertSrvc.error({message:errorResp})}))};var _logout=function(){httpAuthSrvc.logout().then((function(){multiTabEventSrvc.trigger(MultiTabEvent.tabLogOut);httpAuthSrvc.reSignin()}),(function(reason){$log.error(reason)}));utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,[])};var logout=function(){if(mapManagerSrvc.isModifyDoc()){var mapName=NetBrain.Map.currentActiveMap.getTitle();var op={message:StringUtil.format(NetBrain.Map.Message.LeaveMapUnSaved,{mapname:mapName}),title:"Warning",iconType:NB_ICON_WARNING,buttons:[{id:NB_CONFIRM_YES,label:"Save"},{id:NB_CONFIRM_NO,label:"Don't Save"}]};nbAlertSrvc.confirm(op).then((function(){mapManagerSrvc.saveMap().then((function(){_logout()}))}),(function(btn){if(btn){$rootScope.$emit("canRedClose",!0);_logout()}}))}else _logout()};$scope.buttonClick=function(someStringValue){$parse(someStringValue)({about:about,changePassword:changePassword,domainAdmin:domainAdmin,goAdminPage:goAdminPage,help:help,logout:logout,preference:preference,servicemonitor:servicemonitor,support:support,userProfile:userProfile,askNetbrain:askNetbrain})};$scope.openTenantPopout=function(){if(!0!==$scope.tenantPopoutModalLock){$scope.tenants=httpAuthSrvc.getTenantDomain();if($scope.tenants){var availableTenantIds=$scope.tenants.obj.map((function(tenant){return tenant.ID}));var lsPromises=[httpDomainAdminSrvc.canUserEditDomainByTenantIds(userSrvc.getUserID(),availableTenantIds),httpDomainAdminSrvc.canUserAddDomainByTenantIds(userSrvc.getUserID(),availableTenantIds)];$q.all(lsPromises).then((function(re){$scope.tenantPopoutModalLock=!0;var dictCanUserEditDomainInTenant=re[0];var dictCanUserAddDomainInTenant=re[1];var nodeLength=0;$scope.domainSummary&&$scope.domainSummary.nodeSizeSummary&&(nodeLength=($scope.domainSummary.nodeSizeSummary.takenCnt||0).toString().length-3);$uibModal.open({templateUrl:"views/TenantPopout.html",controller:"nb.netbrain.tenantPopoutCtrl",windowClass:"tenant-popout disabled-draggable x"+nodeLength,scope:$scope,backdrop:"static",keyboard:!1,resolve:{args:function(){return{initObject:$scope.tenants,dict_canUserEditDomainInTenant:dictCanUserEditDomainInTenant,dict_canUserAddDomainInTenant:dictCanUserAddDomainInTenant,disableCancleButton:$scope.disableCancleButton}}}}).result.then((function(applyObj){$scope.tenantPopoutModalLock=!1;if(null!=applyObj){$scope.selected_tenant=applyObj[0];$scope.selected_domain=[applyObj[1]];var changeInfo={bChangedTenant:$scope.selected_tenant.ID!==httpAuthSrvc.getSelectedTenantId(),bOnlyChangedDomin:httpAuthSrvc.getSelectedDomainIds().length>0&&$scope.selected_domain[0].guid!==httpAuthSrvc.getSelectedDomainIds()[0]};httpAuthSrvc.setSelectedTenantId($scope.selected_tenant.ID);httpAuthSrvc.setSelectedDomainIds([$scope.selected_domain[0].guid]);$scope.checkDomainPermissions(!0);if(changeInfo.bChangedTenant&&(mapManagerSrvc.isModifyDoc()||mapManagerSrvc.isNewDoc())){$scope.confirmSaveMap_model=$uibModal.open({templateUrl:"views/confirmSaveMaps.html",controller:"nb.netbrain.confirmSaveMapsCtrl",backdrop:!1,size:"sm"});$scope.confirmSaveMap_model.result.then((function(){mapManagerSrvc.saveMap();$scope.doChange(changeInfo)}),(function(){$scope.doChange(changeInfo)}))}else $scope.doChange(changeInfo)}}),(function(){$scope.tenantPopoutModalLock=!1;$scope.selected_domain=httpAuthSrvc.getSelectedDomains()||[];null!=$scope.selected_domain&&0!==$scope.selected_domain.length||httpAuthSrvc.logout("main").then((function(){httpAuthSrvc.reSignin("main")}))}))}))}}};$scope.doChange=function(changeInfo){httpUserSystemConfSrvc.upInsertUserSystemConf(userSrvc.getUserID(),{selectedTenantGuid:httpAuthSrvc.getSelectedTenantId(),selectedDomainGuids:httpAuthSrvc.getSelectedDomainIds()});changeInfo.bChangedTenant?$rootScope.$emit(systemEvent.changedTenant):changeInfo.bOnlyChangedDomin&&$rootScope.$emit(systemEvent.changedDomain)};$scope.onCreateNewDomain=function(modalDialog){if(!0!==$scope.tenantPopoutModalLock){$scope.tenantPopoutModalLock=!0;$scope.tenants=httpAuthSrvc.getTenantDomain();var availableTenantIds=$scope.tenants.obj.map((function(tenant){return tenant.ID}));httpDomainAdminSrvc.canUserAddDomainByTenantIds(userSrvc.getUserID(),availableTenantIds).then((function(result){var dictCanUserAddDomainInTenant=result;var availableTenantsCanCreateDomainInside=[];$scope.tenants.obj.forEach((function(tenant){dictCanUserAddDomainInTenant[tenant.ID]&&availableTenantsCanCreateDomainInside.push(angular.copy(tenant))}));$uibModal.open({templateUrl:"modules/nbAdmin/views/domain/domainCreationPopup.html",controller:"nb.admin.domainCreationPopupCtrl",windowClass:"domainCreationPopup",backdrop:"static",keyboard:!1,resolve:{args:function(){return{selectedTenant:$scope.selected_tenant_last,availableTenants:availableTenantsCanCreateDomainInside,modalDialog:modalDialog}}}}).result.then((function(){$scope.tenantPopoutModalLock=!1;$scope.checkDomainPermissions(!0)}),(function(){_logout()}))}))}};$scope.checkDomainPermissions=function(forceUpdate){$scope.domainPermObj=domainAdminMgr.getDomainPermissions();!1!==$scope.domainPermObj.permCheckIsDone&&!0!==forceUpdate||function(){var deferred=$q.defer();var userID=userSrvc.getUserID();httpDomainAdminNewSrvc.getDomainPermissionListByUserId(userID).then((function(permissionListRet){if(null!=permissionListRet&&void 0!==permissionListRet.allowedPermissions){var domainAllowedPerms=permissionListRet.allowedPermissions;domainAdminMgr.setDomainPermissions(domainAllowedPerms);$log.debug("initCtrl - httpDomainAdminNewSrvc.getDomainPermissionListByUserId(): - $scope.safeApply()")}else domainAdminMgr.setDomainPermissions([]);deferred.resolve()}),(function(reason){deferred.reject(reason)}));deferred.promise}()};var toDo=function(){collaborationGridSrvc.isHaveNotRead().then((function(res){$scope.collaboration.showRedDotFlag=res}));ngHub.getInstance().subBusinessId("Collaboration","")};$scope.domainSummaryOpen=function(open){open&&initDomainSummary(httpAuthSrvc.getSelectedTenantId(),httpAuthSrvc.getSelectedDomainIds()[0])};var systemEventChangedDomain=$rootScope.$on(systemEvent.changedDomain,(function(event,newTenant,lsSelectedDomains){newTenant&&($scope.selected_tenant=newTenant);$scope.setCollaborationRedDot(!1);if(lsSelectedDomains){$scope.selected_domain=lsSelectedDomains;$scope.checkDomainPermissions(!0)}$scope.checkNewAlert();$interval(toDo,1e4,1);!$scope.selected_tenant||!lsSelectedDomains||lsSelectedDomains.length<=0?$scope.openTenantPopout():initDomainSummary($scope.selected_tenant.ID,lsSelectedDomains[0].guid)}));var systemEventInitHeader=$rootScope.$on(systemEvent.initHeader,(function(event,args){if(args&&args.newTenant&&args.lsSelectedDomains){initDomainSummary(args.newTenant.ID,args.lsSelectedDomains.guid)}}));var systemRelogin=$rootScope.$on(UserEvent.RELOGIN,(function(){var map=mapManagerSrvc.getActiveMap();map&&httpMapSrvc.getMapInfoByKey(map.getDocId()).then((function(data){data&&data.editor&&map.setEditRight(data.editor.opUser,data.editor.opUserId)}))}));var systemEventChangedTenant=$rootScope.$on(systemEvent.changedTenant,(function(){httpAuthSrvc.refreshPermission()}));$scope.$on("$destroy",(function(){systemEventChangedTenant();systemEventChangedDomain();systemEventInitHeader();systemRelogin()}));var deviceIconWidthMap={};deviceIconWidthMap["00000000-0000-0000-0000-000000000042"]=42;deviceIconWidthMap["00000000-0000-0000-0000-00000000002e"]=50;deviceIconWidthMap["00000000-0000-0000-0000-00000000001f"]=50;deviceIconWidthMap["00000000-0000-0000-0000-000000000029"]=36;deviceIconWidthMap["00000000-0000-0000-0000-000000000062"]=38;deviceIconWidthMap["00000000-0000-0000-0000-000000000047"]=38;deviceIconWidthMap["00000000-0000-0000-0000-000000000095"]=42;$scope.getDeviceIconWidth=function(){return 30};var refreshDomainSummaryCallback;!function(){var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];refreshDomainSummaryCallback=ngHub.getInstance().registerEvent("RefreshDomainSummary",(function(){initDomainSummary(tenantId,domainId)}));ngHub.getInstance().subBusinessId("RefreshDomainSummary",httpAuthSrvc.getSelectedDomainIds()[0])}();function initDomainSummary(tenantId,domainId){setTimeout((function(){$("#domainSummary").bind("click",(function(){return!1}));var displayNames={0:"Maps",1:"Dynamic Data Views",2:"Runbook Templates",3:"Network Changes",4:"Applications",5:"Dashboards",6:"Qapps",7:"Gapps"};var displayIcons={0:"usagehealth_map_16",1:"usagehealth_dataview16",2:"usagehealth_runbook_16",3:"usagehealth_networkchange_16",4:"usagehealth_application_16",5:"usagehealth_dashboard_16",6:"usagehealth_qapp_16",7:"usagehealth_gapp_16"};cacheSrvc.initCacheConfig();systemSrvc.getDomainSummary(tenantId,domainId).then((function(data){var deviceTotal=_.reduce(data.deviceTypeSummary,(function(memo,entity){return memo+entity.count}),0);if(data.licenseInfo&&data.licenseInfo.customerSince){var dtCustomerSince=new Date(data.licenseInfo.customerSince);$scope.customerSince=("0"+(dtCustomerSince.getMonth()+1)).slice(-2)+"/"+("0"+dtCustomerSince.getDate()).slice(-2)+"/"+dtCustomerSince.getFullYear()}$scope.domainSummary={deviceTypeSummary:{total:deviceTotal,deviceTypes:data.deviceTypeSummary},userSummary:{userCount:data.userSummary.userCount},nodeSizeSummary:{total:data.nodeSizeSummary.domainNodes,legacyCnt:data.nodeSizeSummary.legacyCnt+data.nodeSizeSummary.lwapUsed,takenCnt:data.nodeSizeSummary.totalUsedNode,usedDeviceRatio:data.nodeSizeSummary.usedDeviceRatio,exceedNodeCount:data.nodeSizeSummary.exceedNodeCount,type:data.nodeSizeSummary.type,fontSytle:data.nodeSizeSummary.type},totalSeatLicenese:data.licenseInfo?data.licenseInfo.modules.Essential.currentTerm.seatSize:0,totalUsersInSystem:data.onlineUserCount,allDeviceCount:data.allDeviceCount,systemFileInfo:data.systemFileInfo,dyanmicDataViewTemplates:data.systemSummary.dynamicDataViewTemplateCount,goldenBaselineVariable:data.systemSummary.goldenBaselineVariableCount,goldenBaselineVariable_Devices:data.systemSummary.goldenBaselineDeviceCount,goldenPath:data.systemSummary.goldenPathSetCount,goldenPathAppliaction:data.systemSummary.goldenPathApplicationCount,qappGappCount:data.systemSummary.qappQappCount,KeyMetric:data.keyMetrics,domainHealth:data.domainHealth,site:data.site,isDomainAdmin:data.isDomainAdmin,sdnInfo:data.sdn};_.each($scope.domainSummary.systemFileInfo,(function(item){item.icon=displayIcons[item.type];item.name=displayNames[item.type]}));_.each(["MongoDBSize","MongoDBSizeLastWeek","ESIndexSize","ESIndexSizeLastWeek"],(function(key){$scope.domainSummary.KeyMetric[key]=$scope.domainSummary.KeyMetric[key]<0?"--":Utility.bytesToHuman($scope.domainSummary.KeyMetric[key])}));_.each(["ConnectedServer","DisconnectedServer","Connections","DataTask","UserTask","ESIndexSizeLastWeek"],(function(key){$scope.domainSummary.KeyMetric[key]=$scope.domainSummary.KeyMetric[key]<0?"--":$scope.domainSummary.KeyMetric[key]}));if(0==parseInt($scope.domainSummary.domainHealth.DiscoveredDevices)){$scope.domainSummary.discovery_snmp_rate=0;$scope.domainSummary.missed_devices_rate=0}else{$scope.domainSummary.discovery_snmp_rate=(100*parseInt($scope.domainSummary.domainHealth.DiscoveredBySNMP)/parseInt($scope.domainSummary.domainHealth.DiscoveredDevices)).toFixed(2);$scope.domainSummary.missed_devices_rate=(100*parseInt($scope.domainSummary.domainHealth.MissedDevices)/parseInt($scope.domainSummary.domainHealth.DiscoveredDevices)).toFixed(2)}0==parseInt($scope.domainSummary.site.total)?$scope.domainSummary.site_rate=0:$scope.domainSummary.site_rate=(100*parseInt($scope.domainSummary.site.unassigned)/parseInt($scope.domainSummary.site.total)).toFixed(2);0==parseInt($scope.domainSummary.domainHealth.bmTotal)?$scope.domainSummary.bm_rate=0:$scope.domainSummary.bm_rate=(100*parseInt($scope.domainSummary.domainHealth.bmSuccess)/parseInt($scope.domainSummary.domainHealth.bmTotal)).toFixed(2)}),(function(){}))}),1e3)}$scope.openSdnDetailModal=function(_tabType,isSdn){return $uibModal.open({templateUrl:"modules/nbSDN/views/nbSdnLicenseDetailModalDirective.html",controller:"nb.sdn.licenseDetailModalCtrl",controllerAs:"vm",backdrop:"static",windowClass:"sdn-license-detail-modal",keyboard:!0,resolve:{tabType:function(){return _tabType||"port"},sdnLicense:function(){return isSdn?$scope.domainSummary.sdnLicense:$scope.domainSummary.nonSdnLicense},title:function(){return isSdn?"License Node Detail of SDN Node":"License Node Detail of Host Virtualization"}}})};$scope.parseSdnLicense=function(domainSummary,isSdn){var license={};var sdnFeature=(domainSummary.licenseInfo&&domainSummary.licenseInfo.modules||{}).SDN;license.enabled=null!=sdnFeature&&null!=sdnFeature.currentTerm&&(0==sdnFeature.currentTerm.isDisabled||sdnFeature.currentTerm.isGracePeriodExpired);return license=_.extend(license,{SDNLicenseSummaryInfo:isSdn?domainSummary.SDNLicenseSummaryInfo:domainSummary.hostVirtualizationSummaryInfo||[]})};$scope.onEventConsole=function(){var url=NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.EventConsole;urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.EventConsole,NetBrain.NG.Const.PageType.EventConsole,(function(){urlStateMgr.openNewTab(url,"_blank")}));$scope.eventBubble.dropDownOpenedFlag=!1};$scope.eventBubbleStopPropagation=function(event){event.stopPropagation()};$scope.eventBubble={showRedDotFlag:!1,dropDownOpenedFlag:!1,data:[]};$scope.toggleTipDropDown=function(){$scope.eventBubble.showRedDotFlag=!1;$scope.eventBubble.dropDownOpenedFlag?eventBubbleService.getEventBubbleInfo().then((function(res){angular.isArray(res.content)?$scope.eventBubble.data=res.content:$scope.eventBubble.data=[]})):$scope.eventBubble.data=[]};$scope.eventTipStopPropagation=function($event){$event.stopPropagation()};$scope.toggleAlertCollapse=function($event,model){model.showCollapseFlag=!model.showCollapseFlag;model.showContextMenuFlag=!1;$event.stopPropagation()};$scope.isInfoEvent=function(event){return!!event&&event.level===eventConsoleModelSrvc.EventLevel.Info};$scope.isWarningEvent=function(event){return!!event&&event.level===eventConsoleModelSrvc.EventLevel.Warning};$scope.isErrorEvent=function(event){return!!event&&event.level===eventConsoleModelSrvc.EventLevel.Error};$scope.showTipContextMenu=function($event,model){model.showContextMenuFlag=!0;$event.stopPropagation()};$scope.eventOperate=function($event,type,model){eventConsoleOperateService.operate(type,model);$event.stopPropagation()};$scope.viewCLICommand=function(model){eventConsoleOperateService.viewCLICommands(model);$scope.eventBubble.dropDownOpenedFlag=!1};$scope.openMap=function(model){eventConsoleOperateService.openMapFromAlert(model);$scope.eventBubble.dropDownOpenedFlag=!1};$scope.setEventTipRedDot=function(value){$scope.eventBubble.showRedDotFlag=value};$scope.setCollaborationRedDot=function(value){$scope.collaboration.showRedDotFlag=value};$scope.checkNewAlert=function(){eventBubbleService.checkNewAlert().then((function(data){data&&0!==data?$scope.setEventTipRedDot(!0):$scope.setEventTipRedDot(!1)}))};var eventForceLogoutCallback,eventremovePermissionCallback,eventLicenseUnbindCallback,eventAlertRefreshCallback,eventAlertClearCallback,eventTenantDomainDeleteCallback;$rootScope.$on(hubSrvcEvent.ngHubStarted,(function(){if(window.ngHub){eventForceLogoutCallback=ngHub.getInstance().registerEvent(hubSystemEvent.forceLogoutEvent,(function(data){var msgForRelogin=data&&data.forceoutReason?data.forceoutReason:"Your session has been ended by your NetBrain administrator. Please log in again.";nbReloginSrvc.reLogin("mainUI",msgForRelogin).then((function(response){null!=response&&ngHub.getInstance().setToken(httpAuthSrvc.getAccessToken("mainUI"))}))}));eventremovePermissionCallback=ngHub.getInstance().registerEvent(hubSystemEvent.removePermissionEvent,(function(data){httpAuthSrvc.forceLogout("mainUI");var dialogWarning={windowClass:"session-expired-message",message:data&&data.forceoutReason?data.forceoutReason:"Your permissions have be removed."};nbAlertSrvc.error({message:dialogWarning.message}).then((function(){httpAuthSrvc.reSignin()}))}));eventLicenseUnbindCallback=ngHub.getInstance().registerEvent(hubSystemEvent.licenseUnbindEvent,(function(){httpAuthSrvc.forceLogout("mainUI");nbAlertSrvc.notification({windowClass:"session-expired-message",message:"The product license has been deactivated by your NetBrain administrator. You will be automatically logged out."}).then((function(){httpAuthSrvc.reSignin()}))}));eventAlertRefreshCallback=ngHub.getInstance().registerEvent("EventTipRefresh",(function(data){if(angular.isArray(data)){var domainId=httpAuthSrvc.getSelectedDomainIds()[0];data.indexOf(domainId)>-1&&$scope.setEventTipRedDot(!0)}}));eventAlertClearCallback=ngHub.getInstance().registerEvent("EventTipClear",(function(data){data&&data===httpAuthSrvc.getSelectedDomainIds()[0]&&$scope.setEventTipRedDot(!1)}));eventTenantDomainDeleteCallback=ngHub.getInstance().registerEvent(hubSystemEvent.tenantDomainDeleteEvent,(function(data){httpAuthSrvc.forceLogout("mainUI");var dialogWarning={windowClass:"session-expired-message",message:data&&data.forceoutReason?data.forceoutReason:"Your current selection of Tenant and Domain is invalid."};urlStateMgr.clearPageSession();nbAlertSrvc.warning({message:dialogWarning.message}).then((function(){httpAuthSrvc.reSignin()}))}))}}));$rootScope.isUserDeleted=!1;$rootScope.$on(systemEvent.userDeleted,(function(){if(!$rootScope.isUserDeleted){$rootScope.isUserDeleted=!0;nbAlertSrvc.notification({windowClass:"session-expired-message",message:"Your NetBrain account has been deleted! Please contact your NetBrain administrator for details."}).then((function(){$rootScope.isUserDeleted=!1;_logout()}))}}));$scope.$on("$destroy",(function(){ngHub.getInstance().unRegisterEvent(hubSystemEvent.forceLogoutEvent,eventForceLogoutCallback);ngHub.getInstance().unRegisterEvent(hubSystemEvent.removePermissionEvent,eventremovePermissionCallback);ngHub.getInstance().unRegisterEvent(hubSystemEvent.licenseUnbindEvent,eventLicenseUnbindCallback);ngHub.getInstance().unRegisterEvent(hubSystemEvent.tenantDomainDeleteEvent,eventTenantDomainDeleteCallback);ngHub.getInstance().unRegisterEvent("EventTipRefresh",eventAlertRefreshCallback);ngHub.getInstance().unRegisterEvent("EventTipClear",eventAlertClearCallback);$("#domainSummary").unbind("click");refreshDomainSummaryCallback&&ngHub.getInstance().unRegisterEvent("RefreshDomainSummary",refreshDomainSummaryCallback)}));$rootScope.$on(systemEvent.databaseError,(function(){$("div.database-error-message").length<=0&&nbAlertSrvc.error({windowClass:"session-expired-message database-error-message",message:"An error occurred due to database issue! Please contact your NetBrain administrator for details."}).then((function(){_logout()}))}));$scope.collaboration={sharing:[],requestsAndTransfers:[],dropDownOpendFlagCollaboration:!1,sharingCount:0,requestsAndTransfersCount:0,showRedDotFlag:!1};$scope.ChangeManagementType=NetBrain.Map.Const.CollaborationFilterType.ChangeManagement;var getCollaboration=ngHub.getInstance().registerEvent("Collaboration",(function(data){data&&httpAuthSrvc.getSelectedTenantId()===data.tenantId&&httpAuthSrvc.getSelectedDomains()[0].guid===data.domainId&&!0===data.show&&$timeout((function(){$scope.collaboration.showRedDotFlag=!0}));if(data&&httpAuthSrvc.getSelectedTenantId()===data.tenantId&&httpAuthSrvc.getSelectedDomains()[0].guid===data.domainId&&data.userId===userSrvc.getUserID())if("dashboard"===data.type)$rootScope.$broadcast("setEditRightFromTransfer",data.mapId);else{if((map=mapManagerSrvc.getActiveMap())&&map.getDocId()===data.mapId&&data.userId===userSrvc.getUserID())if(map.getMapType()===NetBrain.Map.Const.MapType.siteMap||map.getMapType()===NetBrain.Map.Const.MapType.deviceGroupMap)if(map.getMapType()===NetBrain.Map.Const.MapType.deviceGroupMap)httpDeviceGroupSrvc.getDeviceGroupByGuid_no_devices(map.getDocId()).then((function(res){if(2===res.Type){map.setEditRight(data.userName,data.userId);map.isTempEditRight=!0}else map.setEditRight(data.userName,data.userId)}));else{map.setEditRight(data.userName,data.userId);map.isTempEditRight=!0}else map.setEditRight(data.userName,data.userId)}var map=mapManagerSrvc.getActiveMap();data.mapId&&map&&data.mapId===map.getDocId()&&data.editorName&&data.editorId&&map.setEditRight(data.editorName,data.editorId)}));$scope.$on("$destroy",(function(){ngHub.getInstance().unRegisterEvent("Collaboration",getCollaboration);ngHub.getInstance().unsubBusinessId("Collaboration",userSrvc.getUserID())}));$scope.notification={getShareText:function(fromUserName,mapListLength,content){return fromUserName+" has shared "+mapListLength+" "+content+(mapListLength>1?"s":"")+" with you."},getRequestText:function(fromUserName,content){return fromUserName+" has requested the editing rights of "+content+" from you."},getTransferText:function(fromUserName,content){return fromUserName+" has transferred the editing rights of "+content+" to you."},getDenyText:function(fromUserName,content){return fromUserName+" has denied your request for the editing rights of "+content+"."},getForceGetText:function(fromUserName,content){return fromUserName+" has taken over your editing rights of "+content+"."},getForceDeleteText:function(fromUserName,content){return fromUserName+" has deleted "+content+" that you own."}};$scope.setting=[{type:"map",icon:"icon-map",open:function(options){urlStateMgr.openMap(options)},getTitle:function(fromUserName,mapListLength,mapName,type){return 1===type?$scope.notification.getShareText(fromUserName,mapListLength,"map"):2===type?$scope.notification.getRequestText(fromUserName,'map "'+mapName+'"'):3===type?$scope.notification.getTransferText(fromUserName,'map "'+mapName+'"'):4===type?$scope.notification.getDenyText(fromUserName,'map "'+mapName+'"'):5===type?$scope.notification.getForceGetText(fromUserName,'map "'+mapName+'"'):6===type?$scope.notification.getForceDeleteText(fromUserName,'map "'+mapName+'"'):""},getName:function(mapList){return mapList?1===mapList.length?mapList[0].mapName||"map name is empty":mapList.length>1?mapList.length+" maps":"":"map name is empty"}},{type:"dashboard",icon:"icon_nb_dashboard",open:function(options){urlStateMgr.openDashboard(options)},getTitle:function(fromUserName,mapListLength,mapName,type){return 1===type?$scope.notification.getShareText(fromUserName,mapListLength,"dashboard"):2===type?$scope.notification.getRequestText(fromUserName,'dashboard "'+mapName+'"'):3===type?$scope.notification.getTransferText(fromUserName,'dashboard "'+mapName+'"'):4===type?$scope.notification.getDenyText(fromUserName,'dashboard "'+mapName+'"'):""},getName:function(mapList){return mapList?1===mapList.length?mapList[0].mapName||"dashboard name is empty":mapList.length>1?mapList.length+" dashboards":"dashboard name is empty":"dashboard name is empty"}}];$scope.toggleCollaborationDropDown=function(){$scope.dropDownOpendFlagCollaboration=!$scope.dropDownOpendFlagCollaboration;$scope.dropDownOpendFlagCollaboration&&collaborationGridSrvc.getCollaborationHistory().then((function(res){httpSystemAdminSrvc.getAllDisplayUsersOnDomain().then((function(objList){var ii=0;for(ii=0;ii<res.length;ii++){res[ii].showTransferLink=!1;res[ii].fromUserName=fixUserName(res[ii].fromUserId,res[ii].fromUserName,objList)||"somebody";res[ii].receiveUserName=fixUserName(res[ii].receiveUserId,res[ii].receiveUserName,objList);if(res[ii].filteType===NetBrain.Map.Const.CollaborationFilterType.Map){res[ii].title=$scope.setting[0].getTitle(res[ii].fromUserName,res[ii].mapList.length,res[ii].mapList[0].mapName,res[ii].type);res[ii].name=$scope.setting[0].getName(res[ii].mapList);res[ii].icon=$scope.setting[0].icon}else if(res[ii].filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard){res[ii].title=$scope.setting[1].getTitle(res[ii].fromUserName,res[ii].mapList.length,res[ii].mapList[0].mapName,res[ii].type);res[ii].name=$scope.setting[1].getName(res[ii].mapList);res[ii].icon=$scope.setting[1].icon}else if(res[ii].filteType===NetBrain.Map.Const.CollaborationFilterType.Note){res[ii].title=res[ii].message;res[ii].icon=$scope.setting[0].icon;res[ii].name=$scope.setting[0].getName(res[ii].mapList)}else if(res[ii].filteType===NetBrain.Map.Const.CollaborationFilterType.RunBook){res[ii].title=res[ii].subject;res[ii].name=$scope.setting[0].getName(res[ii].mapList);res[ii].icon=$scope.setting[0].icon}else if(res[ii].filteType===NetBrain.Map.Const.CollaborationFilterType.ChangeManagement){res[ii].title=res[ii].subject;res[ii].name=res[ii].runbookName;res[ii].icon="icon_nb_network_change_12 "}if(2===res[ii].type){res[ii].denyButtonEnabled=!0;res[ii].acceptButtonEnabled=!0}if(res[ii].message){var dom=document.createElement("div");dom.innerText=res[ii].message.replace(/\n/g,"");dom.style.width="330px";dom.style.lineHeight="17px";dom.style.visibility=!1;document.body.appendChild(dom);if(dom.clientHeight>17){res[ii].showmore=!0;res[ii].isOverFlow=!0}document.body.removeChild(dom)}}$scope.collaboration=res;$(".notification-menu .info").scrollTop(0);toDo()}))}))};$scope.notificationLinkClick=function(event,model){model.filteType===NetBrain.Map.Const.CollaborationFilterType.Map?$scope.mapNameClick(event,model):model.filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard?$scope.mapNameClick(event,model):model.filteType===NetBrain.Map.Const.CollaborationFilterType.Note?$scope.openRunBook(model):model.filteType===NetBrain.Map.Const.CollaborationFilterType.RunBook?$scope.openRunBook(model):model.filteType===NetBrain.Map.Const.CollaborationFilterType.ChangeManagement&&$scope.openChangeManagement(model)};$scope.showMoreLess=function(event,model){$(event.target).closest(".right-panel").find(".notification-body").removeClass("showMore").addClass("showLess");model.showmore=!model.showmore;event.stopPropagation()};$scope.getIcon=function(model){return model.filteType===NetBrain.Map.Const.CollaborationFilterType.Note?"icon_nb_note_reminder_16":model.filteType===NetBrain.Map.Const.CollaborationFilterType.ChangeManagement?"network_change_notification":1===model.type?"share-16":[2,3,4].indexOf(model.type)>-1?"icon_nb_edit_right":""};$scope.transferMouseEnter=function($event,model){model.showTransferLink=!model.showTransferLink;$event.stopPropagation()};$scope.transferMouseLeave=function($event,model){model.showTransferLink=!model.showTransferLink;$event.stopPropagation()};function fixUserName(userId,userName,userList){var user=_.find(userList,(function(person){return userId===person.userId||userName===person.userName}));return user?user.userName:userName}$scope.accept=function($event,model){model.acceptButtonEnabled=!1;try{if(model.filteType===NetBrain.Map.Const.CollaborationFilterType.Map)return $scope.transferClick($event,model).finally((function(){model.acceptButtonEnabled=!0}));if(model.filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard)return $scope.transferClickForDashboard($event,model).finally((function(){model.acceptButtonEnabled=!0}))}catch(e){console.error(e);model.acceptButtonEnabled=!0}};$scope.transferClick=function($event,model){var errorMsg="But failed to send email, please contact your NetBrain administrator to double check email setting.";var noEditRight="Failed to accept editing rights request because you don't have the editing rights of "+model.mapList[0].mapName+".";var option={MapList:[{MapId:model.mapList[0].mapId,MapName:model.mapList[0].mapName}],ReceiveUserName:model.fromUserName,Message:model.message,ReceiveUserId:model.fromUserId,ReceiveUserEmail:model.fromUserEmail,FilteType:NetBrain.Map.Const.CollaborationFilterType.Map,ID:model.id};var successMsg='The editing rights of map "'+model.mapList[0].mapName+'" has been transferred to '+model.fromUserName;var map=mapManagerSrvc.getActiveMap();option.URL=getMapUrl(model.mapList[0].mapId,model.filteType);$event.stopPropagation();if(map&&map.getDocId()===model.mapList[0].mapId){return mapManagerSrvc.transferMapEditRight(option,"This map hasn't been saved yet. Do you want to save before transferring edit right to other people?").then((function(data){map.isTempEditRight=!1;model.haveProcessed=!0;$rootScope.$emit("releaseTempEditRight");denySameMapRequest();showMsgByReturnVal(data,successMsg,successMsg+".<br/>"+errorMsg,noEditRight)}))}return collaborationGridSrvc.transferMap(model).then((function(res){if(res!==NetBrain.Map.Const.EditRightResult.failed){denySameMapRequest();model.haveProcessed=!0;if(map&&map.getDocId()===model.mapList[0].mapId){map.isTempEditRight=!1;map.setEditRight(model.fromUserName,model.fromUserId)}showMsgByReturnVal(res,successMsg,successMsg+".<br/>"+errorMsg,noEditRight)}else nbAlertSrvc.alert("Error happend when transfering the editing rights!")}));function denySameMapRequest(){var sameMapRequests=_.filter($scope.collaboration.requestsAndTransfers,(function(item){return!!item.mapList&&(!item.haveProcessed&&(item.type===model.type&&(item.mapList[0].mapId===model.mapList[0].mapId&&item.fromUserId!==model.fromUserId)))}));_.each(sameMapRequests,(function(itemRequest){var option2={MapList:[{MapId:itemRequest.mapList[0].mapId,MapName:itemRequest.mapList[0].mapName}],ReceiveUserName:itemRequest.fromUserName,ReceiveUserEmail:itemRequest.fromUserEmail,Message:itemRequest.message,ReceiveUserId:itemRequest.fromUserId,FilteType:NetBrain.Map.Const.CollaborationFilterType.Map,Url:getMapUrl(itemRequest.mapList[0].mapId,itemRequest.filteType),ID:itemRequest.id};mapManagerSrvc.denyMapEditRight(option2).then((function(){}))}))}};$scope.ignore=function(id){collaborationGridSrvc.remove(id).then((function(){$scope.collaboration.notes=_.filter($scope.collaboration.notes,(function(note){return note.id!==id}))}))};$scope.openRunBook=function(model){var mapId=/"mapId":"([^"]*)"/gi.exec(model.extraData)[1];var runbookId=/"runbookId":"([^"]*)"/gi.exec(model.extraData)[1];var nodeIdExec=/"runbookNodeId":"([^"]*)"/gi.exec(model.extraData);openRunBook(mapId,runbookId,null,nodeIdExec&&nodeIdExec.length>1?nodeIdExec[1]:null,null)};$scope.openChangeManagement=function(model){var mapId=utilitySrvc.getQueryString("id",model.url);var runbookId=utilitySrvc.getQueryString("rba",model.url);httpMapSrvc.isMapExist(mapId).then((function(isExist){isExist?openRunBook(mapId,runbookId,null,null,NetBrain.ns("RunBookBase").TypeEnum.ChangeMgmt):httpRunBookSrvc.getValidMapId(runbookId).then((function(mId){""!==mId&&mId!==mapId?openRunBook(mId,runbookId,null,null,NetBrain.ns("RunBookBase").TypeEnum.ChangeMgmt):function(runbookId){var emptyMapId=NgUtil.getGUID();httpRunBookSrvc.resetRunbookMapId(runbookId,emptyMapId).then((function(){urlStateMgr.openRunBook({isCreateNew:!0,rbType:NetBrain.ns("RunBookBase").TypeEnum.ChangeMgmt,rba:runbookId,openEmptyMap:!0,emptyMapId:emptyMapId})}))}(runbookId)}))}))};$scope.transferClickForDashboard=function($event,model){var noEditRight="Failed to accept editing rights request because you don't have the editing rights of "+model.mapList[0].mapName+".";var option={MapList:[{MapId:model.mapList[0].mapId,MapName:model.mapList[0].mapName}],ReceiveUserName:model.fromUserName,Message:model.message,ReceiveUserId:model.fromUserId,ReceiveUserEmail:model.fromUserEmail,FilteType:model.filteType,Url:getMapUrl(model.mapList[0].mapId,model.filteType),ID:model.id};$event.stopPropagation();var successMsg='The editing rights of dashboard "'+model.mapList[0].mapName+'" has been transferred to '+model.fromUserName;return dashboardSrvc.accept(option).then((function(res){if(res!==NetBrain.Map.Const.EditRightResult.failed){if(res===NetBrain.Map.Const.EditRightResult.success||res===NetBrain.Map.Const.EditRightResult.successButEmailFailed){model.haveProcessed=!0;$rootScope.$broadcast("acceptEditRightRequest",model.mapList[0].mapId)}showMsgByReturnValForDashboard(res,successMsg,successMsg+".<br/>But failed to send email, please contact your NetBrain administrator to double check email setting.",noEditRight)}else nbAlertSrvc.alert("Error happend when transfering the editing rights!")}))};function openRunBook(mapId,runbookId,mapType,runbookNodeId,rbType){var op={id:mapId,rba:runbookId,rbNodeId:runbookNodeId,target:mapId,mapType:mapType,rbType:rbType};urlStateMgr.openRunBook(op)}function showMsgByReturnVal(result,successMsg,failedMsg,noEditRightMsg){result===NetBrain.Map.Const.EditRightResult.success?(msg=successMsg,new MapTip({wrapper:"body"}).show({message:msg})):result===NetBrain.Map.Const.EditRightResult.successButEmailFailed?nbAlertSrvc.warning(failedMsg):result===NetBrain.Map.Const.EditRightResult.noEditRight&&nbAlertSrvc.warning(noEditRightMsg);var msg}function showMsgByReturnValForDashboard(result,successMsg,failedMsg,noEditRightMsg){result===NetBrain.Map.Const.EditRightResult.success?new nbDashboard.DashboardTip({wrapper:$(".dashboard-base")}).show({type:"success",message:successMsg}):result===NetBrain.Map.Const.EditRightResult.successButEmailFailed?nbAlertSrvc.warning(failedMsg):result===NetBrain.Map.Const.EditRightResult.noEditRight&&nbAlertSrvc.warning(noEditRightMsg)}function getMapUrl(mapId,filteType){var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];var href=/^http.*\//.exec(document.location.href)[0];var localHref="";if(filteType===NetBrain.Map.Const.CollaborationFilterType.Map)localHref=StringUtil.format(href+NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Map,{tenantId:tenantId,domainId:domainId,id:mapId});else if(filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard){var options={t:tenantId,d:domainId,id:mapId};localHref=href+NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Dashboard+"?"+$.param(options)}return localHref}$scope.denyClick=function($event,model){try{model.denyButtonEnabled=!1;var name=model.filteType===NetBrain.Map.Const.CollaborationFilterType.Map?"map":"dashboard";var successMsg="You had denied the request of editing rights of "+name+' "'+model.mapList[0].mapName+'".';var noEditRight="Failed to deny editing rights request because you don't have the editing rights of "+model.mapList[0].mapName+".";var option={MapList:[{MapId:model.mapList[0].mapId,MapName:model.mapList[0].mapName}],ReceiveUserName:model.fromUserName,ReceiveUserEmail:model.fromUserEmail,fromUserEmail:model.receiveUserEmail,Message:model.message,ReceiveUserId:model.fromUserId,FilteType:model.filteType,Url:getMapUrl(model.mapList[0].mapId,model.filteType),ID:model.id};var promise=$q.resolve();var showMsg2=showMsgByReturnVal;if(model.filteType===NetBrain.Map.Const.CollaborationFilterType.Map)promise=mapManagerSrvc.denyMapEditRight(option);else if(model.filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard){promise=dashboardSrvc.deny(option);showMsg2=showMsgByReturnValForDashboard}promise.then((function(result){if(result){result!==NetBrain.Map.Const.EditRightResult.success&&result!==NetBrain.Map.Const.EditRightResult.successButEmailFailed||(model.haveProcessed=!0);showMsg2(result,successMsg,successMsg+"<br/>But failed to send email, please contact your NetBrain administrator to double check email setting.",noEditRight)}})).finally((function(){model.denyButtonEnabled=!0}));$event.stopPropagation()}catch(e){console.error(e);model.denyButtonEnabled=!0}};$scope.mapNameClick=function($event,model){var shareMaps=[];shareMaps=model.mapList;var open=function(model2,options){model2.filteType===NetBrain.Map.Const.CollaborationFilterType.Map?$scope.setting[0].open(options):model2.filteType===NetBrain.Map.Const.CollaborationFilterType.Dashboard&&$scope.setting[1].open(options)};!function(){if(1===shareMaps.length){var options={id:shareMaps[0].mapId,file:null};var rbaId=utilitySrvc.getQueryString("rba",model.url);if(rbaId){rbaId.length>36&&(rbaId=rbaId.substring(0,36));options.rba=rbaId}open(model,options)}else!function callOpenMap(model2,index){if(shareMaps.length<=index)return;var options={id:shareMaps[index].mapId,file:null};$timeout((function(){open(model2,options)}),500).then((function(){callOpenMap(model2,index+=1)}))}(model,0)}();$scope.collaboration.dropDownOpendFlagCollaboration=!1};$scope.allRequestAndTransfersClick=function(){$rootScope.$emit("requestAndTransfersClick");urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.Collaboration,NetBrain.NG.Const.PageType.Collaboration,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Collaboration)}))};$scope.allSharingClick=function(){$rootScope.$emit("sharingClick");urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.Collaboration,NetBrain.NG.Const.PageType.Collaboration,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Collaboration)}))};var licenseExpired=function(license){$rootScope.$emit(licenseEvent.licenseInvalid,license);nbAlertSrvc.error({message:"Failed to log in NetBrain Integrated Edition since the license is expired or not started. Please log in system management page to manage your license."}).then((function(){httpAuthSrvc.logout().then((function(){httpAuthSrvc.reSignin()}),(function(reason){$log.error(reason)}));utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,[])}))};$rootScope.$on(systemEvent.changedDomain,(function(){licenseSrvc.getLicense(!1).then((function(resultLicense){resultLicense&&!resultLicense.isError&&resultLicense.isActivate&&resultLicense.isEssentialLicenseExpired&&licenseExpired(resultLicense)}))}));var licenseEnabled=$rootScope.$on(licenseEvent.licenseActivated,(function(event,resultLicense){null!=resultLicense&&!1===_.isEmpty(resultLicense)&&(resultLicense.isValid||licenseExpired(resultLicense))}));$scope.$on("$destroy",licenseEnabled);$scope.initCMSetting=function(){httpChangeMgmtSettingSrvc.getChangeMgmtSetting().then((function(cmSetting){utilitySrvc.setLocalStorage("changeManageSetting",cmSetting);$rootScope.$emit(adminEvent.onCMSetting,cmSetting)}),(function(){}))};var changedDomain=$rootScope.$on(systemEvent.changedDomain,(function(){$timeout((function(){$scope.initCMSetting()}),200)}));$scope.$on("$destroy",changedDomain);$scope.pathModel={};$scope.setAsPathButtonClick=function(){$scope.pathModel.isShowPathSearch=!$scope.pathModel.isShowPathSearch};$rootScope.$on(systemEvent.changedTenant,(function(){$scope.userAccountDropDown=_.filter($scope.userAccountDropDown,(function(item){return"System Management"!==item.name}));(permissionSrvc.isTenantAdminRole()||permissionSrvc.hasSystemManagementPermission()||permissionSrvc.hasUserManagePermission())&&$scope.userAccountDropDown.splice(1,0,{name:"System Management",action:"goAdminPage()"})}));$rootScope.$on("nbSearch.setAsPathButtonClick",(function(){$scope.pathModel.isShowPathSearch=!0}));$scope.$on("path-add-to-search-bar",(function(){$scope.pathModel.isShowPathSearch=!0}));!function(){cacheSrvc.resetFreshFlags();$scope.initUserMenu();var deferred=$q.defer();httpAuthSrvc.recoverDataFromBackend().then((function(){var jsDataSystemConf=httpAuthSrvc.getCurrentUserSystemConf();jsDataSystemConf||($scope.disableCancleButton=!0);jsDataSystemConf&&null!=jsDataSystemConf.maxIdleTimeout&&0!==jsDataSystemConf.maxIdleTimeout&&(NetBrain.NG.ConfigSettings.IDLE_TIMEOUT=jsDataSystemConf.maxIdleTimeout);var confSelectedTenantGuid=jsDataSystemConf&&jsDataSystemConf.selectedTenantGuid||"";var confSelectedDomainGuids=jsDataSystemConf&&jsDataSystemConf.selectedDomainGuids||[];var tenants=httpAuthSrvc.getTenantDomain();var tenantIdForSeat="";var checkTenantHandler;var foundSelectedDomain=!1;if(tenants.obj&&tenants.obj.length>0)for(var i=0;i<tenants.obj.length;i++)if(tenants.obj[i].ID===confSelectedTenantGuid&&tenants.obj[i].domains){for(var j=0;j<tenants.obj[i].domains.length;j++)if(tenants.obj[i].domains[j].guid===confSelectedDomainGuids[0]){foundSelectedDomain=!0;break}if(!0===foundSelectedDomain)break}if(tenants.obj&&tenants.obj.length>0)for(var i2=0;i2<tenants.obj.length&&!(tenants.obj[i2].domains&&tenants.obj[i2].domains.length>=1);i2++);httpAuthSrvc.clearRedirectSessionStorage();if(httpAuthSrvc.getSelectedTenantId()&&0!==httpAuthSrvc.getSelectedDomainIds().length){tenantIdForSeat=httpAuthSrvc.getSelectedTenantId();checkTenantHandler=function(){var tId=httpAuthSrvc.getSelectedTenantId();var dIds=httpAuthSrvc.getSelectedDomainIds();httpAuthSrvc.setSelectedTenantId(tId);httpAuthSrvc.setSelectedDomainIds(dIds);$rootScope.$emit(systemEvent.changedTenant,{selectedTenantGuid:tId,selectedDomainGuids:dIds[0]});var t=httpAuthSrvc.getSelectedTenant();var d=httpAuthSrvc.getSelectedDomains();$rootScope.$emit(systemEvent.changedDomain,t,d)}}else if(foundSelectedDomain){tenantIdForSeat=confSelectedTenantGuid;checkTenantHandler=function(){httpAuthSrvc.setSelectedTenantId(confSelectedTenantGuid);httpAuthSrvc.setSelectedDomainIds(confSelectedDomainGuids);httpAuthSrvc.initSetTenantDomain();$rootScope.$emit(systemEvent.changedTenant,{selectedTenantGuid:confSelectedTenantGuid,selectedDomainGuids:confSelectedDomainGuids[0]});var t=httpAuthSrvc.getSelectedTenant();var d=httpAuthSrvc.getSelectedDomains();$rootScope.$emit(systemEvent.changedDomain,t,d)}}else if(tenants.obj&&tenants.obj.length>0&&1===tenants.obj.length&&tenants.obj[0].domains&&1===tenants.obj[0].domains.length){tenantIdForSeat=tenants.obj[0].ID;checkTenantHandler=function(){httpUserSystemConfSrvc.upInsertUserSystemConf(userSrvc.getUserID(),{selectedTenantGuid:tenants.obj[0].ID,selectedDomainGuids:[tenants.obj[0].domains[0].guid]});httpAuthSrvc.setSelectedTenantId(tenants.obj[0].ID);httpAuthSrvc.setSelectedDomainIds([tenants.obj[0].domains[0].guid]);httpAuthSrvc.initSetTenantDomain();$rootScope.$emit(systemEvent.changedTenant,{selectedTenantGuid:tenants.obj[0].ID,selectedDomainGuids:[tenants.obj[0].domains[0].guid]});var t=httpAuthSrvc.getSelectedTenant();var d=httpAuthSrvc.getSelectedDomains();$rootScope.$emit(systemEvent.changedDomain,t,d)}}else checkTenantHandler=function(){$scope.tenantPopoutModalLock||$scope.openTenantPopout()};if(""!==tenantIdForSeat){if(!0===tenantSessionSrvc.getTenantSeatAvailable()){checkTenantHandler.call(this);$scope.selected_tenant=httpAuthSrvc.getSelectedTenant()||"";$scope.selected_domain=httpAuthSrvc.getSelectedDomains()||[];$scope.checkDomainPermissions(!0);$scope.checkNewAlert()}else nbAlertSrvc.notification({message:"All the seat licenses of this tenant have been occupied by other users. Please contact your NetBrain administrator for details."}).then((function(){$scope.openTenantPopout()}))}else{_.isFunction(checkTenantHandler)&&checkTenantHandler.call(this);$scope.selected_tenant=httpAuthSrvc.getSelectedTenant()||"";$scope.selected_domain=httpAuthSrvc.getSelectedDomains()||[];$scope.checkDomainPermissions(!0);$scope.checkNewAlert()}if(userSrvc.getCanResetPassword()){var index=$scope.userAccountDropDown.length-1;$scope.userAccountDropDown.splice(index,0,{name:"Change Password",action:"changePassword()"})}$scope.userName=userSrvc.getUserName();$scope.mainHeaderUserTitle=userSrvc.getUserNameTitle();$scope.userId=userSrvc.getUserID()}),(function(){httpAuthSrvc.logout("main").then((function(){httpAuthSrvc.reSignin("main")}))}));deferred.promise}();var licenseAutoRefreshInterval=$interval((function(){licenseSrvc.getInformationNoUpdateSession(!1)}),36e5);$scope.$on("$destroy",(function(){licenseAutoRefreshInterval&&$interval.cancel(licenseAutoRefreshInterval)}))}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").controller("nb.uiframework.mainUIWapperCtrl",mainUIWapperCtrl);mainUIWapperCtrl.$inject=["$rootScope","$scope","$timeout","nb.ng.sessionSrvc"];function mainUIWapperCtrl($rootScope,$scope,$timeout,sessionSrvc){var scope=$scope;scope.currentArea=NetBrain.NetworkOS.Const.UIFramework.MainContent.Desktop;scope.hasMap=!1;scope.mainUiSettings={customizeNavigations:[{key:"desktop",hide:!0},{key:"site",hide:!1},{key:"pathBrowser",hide:!1},{key:"runbook",hide:!1},{key:"change-mgnt",hide:!1},{key:"sdn",hide:!1}]};$rootScope.$on(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,(function(event,type){switch(type){case"floating-desktop":scope.currentArea=NetBrain.NetworkOS.Const.UIFramework.MainContent.Desktop;NetBrain.Map.currentActiveMap?sessionSrvc.setPageSession(NetBrain.NG.Const.PageType.Desktop,"Desktop",NetBrain.NG.Const.PageType.Desktop,{subType:NetBrain.NG.Const.PageType.Desktop,keepalived:!0}):sessionSrvc.setPageSession(NetBrain.NG.Const.PageType.Desktop,"Desktop",NetBrain.NG.Const.PageType.Desktop,{subType:NetBrain.NG.Const.PageType.Desktop,keepalived:!1});break;case"floating-map":scope.currentArea=NetBrain.NetworkOS.Const.UIFramework.MainContent.Map;var mapName="MapName";var subIdentity="";if(NetBrain.Map.currentActiveMap){mapName=NetBrain.Map.currentActiveMap.getTitle();subIdentity=NetBrain.NG.Const.PageType.Map+NetBrain.Map.currentActiveMap.getDocId()}NetBrain.Map.currentActiveMap&&NetBrain.Map.currentActiveMap.isTempEditRight,sessionSrvc.setPageSession(NetBrain.NG.Const.PageType.Desktop,mapName,NetBrain.NG.Const.PageType.Desktop,{subType:NetBrain.NG.Const.PageType.Map,subIdentity:subIdentity,keepalived:!0})}$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ActiveNavMenu,type)}));$rootScope.$on("NewMap",(function(event,callback,data){NetBrain.Map.MapArgs=data;$timeout((function(){scope.hasMap=!0}));$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,{key:"floating-map",hide:!1});$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,{key:"floating-desktop",hide:!1});$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-map",data);$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ActiveNavMenu,"floating-map");callback&&"function"==typeof callback&&callback()}));$rootScope.$on("CloseMap",(function(){scope.hasMap=!1;NetBrain.Page.MainUIMaximum&&$rootScope.$emit(viewFrameEvent.Minimize,"desktop");$rootScope.$emit(NetBrain.Map.Event.CloseMapOndesktop,NetBrain.Map.currentActiveMap);$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,{key:"floating-map",hide:!0});$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,{key:"floating-desktop",hide:!0});$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-desktop");sessionSrvc.setPageSession(NetBrain.NG.Const.PageType.Desktop,"Desktop",NetBrain.NG.Const.PageType.Desktop,{subType:NetBrain.NG.Const.PageType.Desktop})}));$rootScope.$on("SaveAsMapForDesktop",(function(event,map){scope.hasMap=!1;var mapId=map.getDocId();$timeout((function(){scope.hasMap=!0;var mapArgs={id:mapId};NetBrain.Map.MapArgs=mapArgs}),300)}));$rootScope.$on("releaseTempEditRight",(function(){var mapName="MapName";var subIdentity="";if(NetBrain.Map.currentActiveMap){mapName=NetBrain.Map.currentActiveMap.getTitle();subIdentity=NetBrain.NG.Const.PageType.Map+NetBrain.Map.currentActiveMap.getDocId()}sessionSrvc.setPageSession(NetBrain.NG.Const.PageType.Desktop,mapName,NetBrain.NG.Const.PageType.Desktop,{subType:NetBrain.NG.Const.PageType.Map,subIdentity:subIdentity,keepalived:!0})}))}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").controller("nb.uiframework.nbLicenseDetailsController",LicenseDetailsController);LicenseDetailsController.$inject=["$scope","$rootScope","$timeout","$log","$uibModal","$uibModalInstance","nb.sdn.httpSdnSrvc","nb.uiframework.mainUISrvc","nb.ng.httpAuthSrvc","nb.common.nbAlertSrvc","nb.ng.utilitySrvc","nb.uiframework.urlStateMgr","md5","nb.systemmodel.deviceTypeMgrSrvc","nb.admin.httpTenantAdminSrvc","nb.uiframework.httpLicenseDetailSrvc","$filter","$q","dialogService","nb.ng.userSrvc"];function LicenseDetailsController($scope,$rootScope,$timeout,$log,$uibModal,$uibModalInstance,httpSdnSrvc,mainUISrvc,httpAuthSrvc,nbAlertSrvc,utilitySrvc,urlStateMgr,md5,deviceTypeMgrSrvc,httpTenantAdminSrvc,httpLicenseDetailSrvc,$filter,$q,dialogService,userSrvc){httpAuthSrvc.getSelectedTenantId();httpAuthSrvc.getSelectedDomainIds()[0];httpAuthSrvc.getSelectedTenant().name;var domainName=httpAuthSrvc.getSelectedDomains()[0].name;$scope.totalType=0;$scope.dommainName=domainName;$scope.licenseGridList={};$scope.totalRatio=0;$scope.convertParserTimeList=function(rawTime){var revisedDate="";if(rawTime){var time=new Date(rawTime);revisedDate=moment.utc(time).local().format("MM/DD/YYYY hh:mm:ss A")}return revisedDate};$scope.htmlLWAPTipTemplate='<div style="display:block;width:400px;"><label>LWAP devices include devices such as Aruba AP, etc.</label></div>';$scope.gridOptionsSingleLicense={enableHeaderDropdown:!1,enableRowActionMenu:!1,enableRowContextMenu:!1,enableRowHeaderSelection:!1,enableHeaderBar:!1,headerBarBtnsOnRight:[],headerBarBtnsOnLeft:!1,columnDefs:[{field:"name",displayName:"Instance Name",width:"23%",sort:{priority:0,direction:"asc"},cellTemplate:'<span class="single_propoty">{{row.entity.name? row.entity.name : ""}}</span>'},{field:"lastUpdateStatus",displayName:"Last Update Status",width:"15%",cellTemplate:'<span class="single_propoty" ng-class="{license_success: row.entity.lastUpdateStatus==0, license_alert: row.entity.lastUpdateStatus==1}">{{row.entity.lastUpdateStatus === 0? "Succeeded" : "Failed"}}</span>'},{field:"foundData",displayName:"Licenses Found",width:"12%",cellTemplate:'<span class="single_propoty" ng-class="{ license_alert: row.entity.needNode >0}">{{row.entity.foundData}}</span>'},{field:"usedNode",displayName:"Node Licenses Used",width:"18%",cellTemplate:'<span class="single_propoty">{{row.entity.usedNode}}</span>'},{field:"needNode",displayName:"Node Licenses Needed",width:"19%",cellTemplate:'<span class="single_propoty" ng-class="{ license_alert: row.entity.needNode >0}">{{row.entity.needNode}}</span>'},{field:"updateTime",displayName:"Last Update Time",cellTemplate:'<span class="single_propoty">{{row.entity.updateTime? grid.appScope.convertParserTimeList(row.entity.updateTime) : ""}}</span>'}],onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.infiniteScroll&&$scope.gridApi.infiniteScroll.resetScroll(!1,!0)}};$scope.initData=function(){$scope.licenseGridList={};var tenantId=httpAuthSrvc.getSelectedTenantId();var domainId=httpAuthSrvc.getSelectedDomainIds()[0];httpLicenseDetailSrvc.getLicenseDetail(tenantId,domainId).then((function(result){if(result){$scope.licenseObject=result;$scope.totalRatio=$scope.licenseObject.nodeSizeSummary.usedDeviceRatio;$scope.licenseObject.sdn&&$scope.licenseObject.sdn.length>0&&$scope.licenseObject.sdn.forEach((function(singleLicense){var tempGrid=angular.copy($scope.gridOptionsSingleLicense);tempGrid.data=singleLicense.instance;tempGrid.columnDefs[2].displayName=singleLicense.unit+" Found("+singleLicense.totalFoundData+")";tempGrid.columnDefs[3].displayName="Node Licenses Used("+singleLicense.totalUsedNode+")";tempGrid.columnDefs[4].displayName="Node Licenses Needed("+singleLicense.totalNeedNode+")";$scope.licenseGridList[singleLicense.name]=tempGrid}))}}),(function(error){nbAlertSrvc.warning(error.ResultDesc)}))};$scope.initData();$scope.onCancel=function(){$uibModalInstance.dismiss()}}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").directive("nbTopNavigationBarDirective",TopNavigationBarDirective);TopNavigationBarDirective.$inject=["$uibModal","nb.uiframework.urlStateMgr","nb.common.nbAlertSrvc","nb.networkos.myFilesSrvc","nb.ng.licenseSrvc","nb.ng.featureSrvc","nb.ng.permissionSrvc"];function TopNavigationBarDirective($uibModal,urlStateMgr,nbAlertSrvc,myFilesSrvc,licenseSrvc,featureSrvc,permissionSrvc){var service={scope:{customizeNavigations:"="},replace:!0,restrict:"EA",templateUrl:"modules/nbUIFramework/views/nbTopNavigationBarDirective.html",link:function(){},controller:controller};controller.$inject=["$scope","$rootScope","$document","osApp","nb.admin.httpChangeMgmtSettingSrvc","$timeout","$q"];function controller($scope,$rootScope,$document,osAppProvider,httpChangeMgmtSettingSrvc,$timeout,$q){var self=$scope;var systemNavigations=[{key:"myfiles",hide:!1,class:"menu-myfiles",order:30,title:"Browse personal or shared files",featureName:NetBrain.NG.Const.nbFeatures.Files.name,callback:function(){showRelatedTopPanel("myfiles")}},{key:"site",hide:!0,class:"menu-site",order:40,title:"Browse sites",featureName:NetBrain.NG.Const.nbFeatures.Site.name,callback:function(){showRelatedTopPanel("site")}},{key:"sdn",hide:!0,class:"menu-sdn",order:45,title:"Network",featureName:NetBrain.NG.Const.nbFeatures.Site.name,callback:function(){showRelatedTopPanel("sdn")}},{key:"pathBrowser",hide:!0,class:"menu-path",order:50,title:"Manage saved paths",featureName:NetBrain.NG.Const.nbFeatures.PathBrowser.name,callback:function(){showRelatedTopPanel("pathBrowser")}},{key:"runbook",hide:!0,class:"menu-runbook",order:100,title:"Browse runbook templates",featureName:NetBrain.NG.Const.nbFeatures.RunbookTemplate.name,callback:function(){showRelatedTopPanel("runbook")}},{key:"createRunbookPanel",hide:!0,class:"menu-runbook",order:101,title:"Browse runbook templates",featureName:NetBrain.NG.Const.nbFeatures.RunbookTemplate.name,callback:function(){showRelatedTopPanel("createRunbookPanel")}},{key:"change-mgnt",hide:!1,class:"menu-change-mgnt",order:105,title:"Browse Network Changes",callback:function(){showRelatedTopPanel("change-mgnt",!0)},hasPermissionCheckCallBack:function(){var deferred=$q.defer();if(!permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.viewNetworkChange)){deferred.reject();return deferred.promise}licenseSrvc.getLicenseFromLocalStorage().then((function(){licenseSrvc.isModuleLicenseNotDisabled(NetBrain.NG.Const.LicenseModuleType.ChangeMgmt)?httpChangeMgmtSettingSrvc.getChangeMgmtSetting().then((function(setting){setting&&!0===setting.enable?deferred.resolve():deferred.reject()})):deferred.reject()}));return deferred.promise}},{key:"desktop",hide:!1,class:"menu-desktop",order:999991,callback:function(){urlStateMgr.switchTabOrOpenNewTab(NetBrain.NG.Const.PageType.Desktop,NetBrain.NG.Const.PageType.Desktop,(function(){urlStateMgr.openNewTab(NetBrain.NetworkOS.Const.UIFramework.UrlTemplate.Desktop)}),NetBrain.NG.Const.PageType.Desktop)}},{key:"search",hide:!0,class:"menu-searchResult",order:999992,callback:function(){showSearchPanel()}},{key:"floating-menu-divider",type:"floating",hide:!1,class:"menu-divider-css",order:999993,callback:function(){}},{key:"floating-desktop",type:"floating",hide:!0,class:"floating-desktop highlight-bottom-border",order:999994,title:"Desktop",callback:function(){showRelatedTopPanel(void 0,void 0);showFloatingPanel("floating-desktop")}},{key:"floating-map",type:"floating",hide:!0,class:"floating-map highlight-bottom-border",order:999995,title:"Map",callback:function(){showRelatedTopPanel(void 0,void 0);showFloatingPanel("floating-map")}},{key:"action-manager",hide:!0,class:"menu-action",order:999996,title:"Action Manager",callback:function(){showRelatedTopPanel("actionManager")}}];var bindNavs=[];var cancelUpdateNavigateStatus=$rootScope.$on(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,(function(event,navigation){var target=_.find(self.navigations,(function(nav){return nav.key===navigation.key}));target&&_.extend(target,navigation)}));self.$on("$destroy",(function(){cancelUpdateNavigateStatus()}));self.showMoreBtnsPanel=!1;self.activeItem=void 0;self.activeFloatingItem=void 0;self.toggleMoreBtns=function(){$rootScope.$emit(viewFrameEvent.toggleTopPanel,void 0);self.activeItem=void 0;self.showMoreBtnsPanel=!self.showMoreBtnsPanel;self.showMoreBtnsPanel&&getAppNewItems()};self.showSearchPanel=showSearchPanel;self.showRelatedTopPanel=showRelatedTopPanel;self.showFloatingPanel=showFloatingPanel;self.showInDesktop=function(app){myFilesSrvc.showInDesktop(app).then((function(){}));event.stopPropagation();event.preventDefault()};self.isActive=function(nav){return"floating"===nav.type?self.activeFloatingItem===nav.key:self.activeItem===nav.key};function docHandler(event){0===angular.element(event.target).closest(".new-content-container").length&&self.showMoreBtnsPanel&&(self.showMoreBtnsPanel=!1)}var closePanelWatcher=$rootScope.$on(viewFrameEvent.closePanel,(function(event,data){void 0!==data&&(self.activeItem=void 0)}));var showPanelWatcher=$rootScope.$on(NetBrain.NetworkOS.Events.APP_CLICKED,(function(event,type,data){self.showRelatedTopPanel(type,data)}));$document.on("click",docHandler);self.$on("$destroy",(function(){closePanelWatcher();showPanelWatcher();$document.off(docHandler)}));$rootScope.$on(NetBrain.NetworkOS.Const.UIFramework.Events.ActiveNavMenu,(function(event,type){var nav=_.find(self.navigations,(function(nav2){return nav2.key===type}));void 0!==nav&&"floating"===nav.type?self.activeFloatingItem=type:self.activeItem=type}));function reloadTaskbar(){bindNavs=angular.copy(function(customizeNavigations){var navigations=Object.create(null);_.each(systemNavigations,(function(nav){navigations[nav.key]=nav}));_.each(customizeNavigations,(function(nav){var systemDef=navigations[nav.key];systemDef?navigations[nav.key]=_.extend({},systemDef,nav):console.error("there is not exist:",nav.key)}));navigations=_.values(navigations);return _.sortBy(navigations,"order")}(self.customizeNavigations));var promiseArray=[];_.each(bindNavs,(function(app){var q=featureSrvc.featureCheck(app.featureName).then((function(){if(_.isFunction(app.hasPermissionCheckCallBack)){var p=app.hasPermissionCheckCallBack().then((function(){}),(function(){app.hide=!0}));promiseArray.push(p)}}),(function(){app.hide=!0}));promiseArray.push(q)}));return $q.all(promiseArray)}var changedDomain=$rootScope.$on(systemEvent.changedDomain,(function(){getAppNewItems();reloadTaskbar().then((function(){self.navigations=bindNavs}))}));self.$on("$destroy",(function(){changedDomain()}));function showRelatedTopPanel(type,data){$rootScope.$emit(viewFrameEvent.toggleTopPanel,type,data);self.activeItem===type?self.activeItem=void 0:self.activeItem=type}function showFloatingPanel(type,data){$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,type,data);self.activeFloatingItem=type}function getAppNewItems(){osAppProvider.reloadDomain($q,NetBrain.NetworkOS.Const.AppGroups.MAIN_APP).then((function(){var allApps=angular.copy(osAppProvider.getApps());var apps=_.where(allApps,{groupId:NetBrain.NetworkOS.Const.AppGroups.MAIN_APP,isDisplay:!0});_.sortBy(apps,"sort");self.AppNewItems=apps}))}self.openApp=function(app,event){if(void 0!==app&&0===angular.element(event.target).closest(".icon_nb_app_pin").length&&angular.isFunction(app.openCallBack)){self.showMoreBtnsPanel=!0;app.openCallBack(!0)}};self.getIcon=function(app){return app.icon};function showSearchPanel(){$rootScope.$emit(viewFrameEvent.toggleTopPanel,"searchResultShow",null,!1)}}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopDashboardPanelDirective",TopDashboardPanelDirective);TopDashboardPanelDirective.$inject=[];function TopDashboardPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopDashboardPanelDirective.html"};controller.$inject=["$scope","$rootScope"];function controller($scope,$rootScope){var self=$scope;self.showTopDashboardPanel=!1;self.isPanelPinned=!1;self.closeDashboardPanel=function(byClick){self.showTopDashboardPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinDashboardPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned")}};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type){if("dashboard"===type){self.showTopDashboardPanel=!0;event.stopPropagation()}else self.isPanelPinned&&void 0===type||self.closeDashboardPanel()}));self.$on("$destroy",(function(){togglePanelWatcher()}))}return service}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").directive("nbTopStencilPanelDirective",nbTopStencilPanelDirective);nbTopStencilPanelDirective.$inject=[];function nbTopStencilPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopStencilPanelDirective.html"};controller.$inject=["$scope","$rootScope"];function controller($scope,$rootScope){var self=$scope;self.showTopStencilPanel=!1;self.isPanelPinned=!1;self.closeStencilPanel=function(byClick){self.showTopStencilPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned","stencil")}"byClick"===byClick&&$rootScope.$emit("clickMapStencilCloseButton",600)};self.pinPathPanel=function(){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","stencil")};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type){if("stencil"!==type||self.showTopStencilPanel)"stencil"===type||self.closeStencilPanel("byClick");else{self.showTopStencilPanel=!0;event.stopPropagation();self.pinPathPanel()}}));var toggleFloatingPanelWatcher=$rootScope.$on(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,(function(event,type){"floating-map"!==type&&self.closeStencilPanel()}));self.$on("$destroy",(function(){togglePanelWatcher();toggleFloatingPanelWatcher()}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopPathPanelDirective",TopPathPanelDirective);TopPathPanelDirective.$inject=[];function TopPathPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopPathPanelDirective.html"};controller.$inject=["$scope","$rootScope","nb.ticket.consts"];function controller($scope,$rootScope,ticketConsts){var self=$scope;self.showTopPathPanel=!1;self.isPanelPinned=!1;self.ticketConsts=ticketConsts;self.closePathBrowser=function(byClick){if(self.showPathResult){self.showPathBrowser=!1;self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.closePanel,byClick)}else self.closePathPanel(byClick)};self.closePathPanel=function(byClick){self.showTopPathPanel=!1;self.showPathBrowser=!1;self.showPathResult=!1;self.pathData=null;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinPathPanel=function(from){self.isFromCalc="fromCalc"===from;self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","path")};self.refreshPathPanel=function(){self.showPathResult=!1;$rootScope.$emit(pathBrowerEvent.refreshPathBrowerPane)};var changeLoadBalanceWatcher=$rootScope.$on("change-lb-from-map",(function(event,data){self.showTopPathPanel&&$rootScope.$broadcast("update-path-result-view",data)}));var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,data){var isMatchType="pathBrowser"===type||"pathResult"===type;if(data&&data.isFromDiaramPath){self.showTopPathPanel=!0;self.showPathBrowser=!1;self.showPathResult=!0;self.isFromCalc=!0;self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","path");$rootScope.$broadcast("updateHopListEvent",data.pathData,data.selectHopInfo)}else if(isMatchType)if(self.showTopPathPanel&&!data&&self.showPathBrowser)self.closePathPanel();else{self.showTopPathPanel=!0;self.showPathBrowser="pathBrowser"===type;self.showPathResult="pathResult"===type;self.taskId=data&&data.taskId||"";event.stopPropagation();if("pathBrowser"===type&&!data){self.isFromCalc=!1;$rootScope.$emit("pathInitDataEvent")}if("pathResult"===type){self.isFromCalc=!0;self.isPanelPinned=!0;$rootScope.$broadcast("pathInitPathResultData")}self.pathData=data?data.selectedPath:null}else self.isPanelPinned&&void 0===type||self.closePathPanel()}));$rootScope.$on("close-path-panel",(function(){self.closePathPanel()}));self.$on("$destroy",(function(){togglePanelWatcher();changeLoadBalanceWatcher()}));$rootScope.$on(systemEvent.changedDomain,(function(){self.closePathPanel("byClick")}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopSitesPanelDirective",TopSitesPanelDirective);TopSitesPanelDirective.$inject=[];function TopSitesPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopSitesPanelDirective.html"};controller.$inject=["$scope","$rootScope","$window","$timeout"];function controller($scope,$rootScope,$window,$timeout){var self=$scope;angular.element($window).on("resize",(function(){$scope.callResize=!0}));self.callGridResize=function(){if($scope.callResize){var hideEle=$(".device-browser-right-panel > .ng-hide ");if(hideEle.length>0){hideEle.removeClass("ng-hide");angular.element($window).resize();$scope.callResize=!1}}};self.showTopDevicesPanel=!1;self.isPanelPinned=!1;self.deviceBrowserPanel={siteTitle:"Site"};self.browser={toolTip:self.deviceBrowserPanel.siteTitle};self.closeDevicePanel=function(byClick,type){self.showTopDevicesPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}if(self.isFromSearch&&!type){self.isFromSearch=!1;$rootScope.$emit(viewFrameEvent.toggleTopPanel,"searchResultShow",null,!0)}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinDevicePanel=function(){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","devices")};self.init=function(){if(self.isTriggerToggleTopPanelEvent){self.searchData&&$rootScope.$emit("searchSite",{id:self.searchData.id});self.isTriggerToggleTopPanelEvent=!1}};self.setDeviceGroupTreeData=function(args){self.deviceGroupTreeData=args};self.getDeviceGroupTreeData=function(){return self.deviceGroupTreeData};self.isFromSearch=!1;var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,data){if(!self.isCloseing)if("site"!==type||self.showTopDevicesPanel){if(!self.isPanelPinned||void 0!==type){if(data&&data.alwaysShow)return;self.isCloseing=!0;$timeout((function(){self.closeDevicePanel(void 0,type);self.isCloseing=!1}),200)}}else{self.searchData=data;self.showTopDevicesPanel=!0;self.isTriggerToggleTopPanelEvent=!0;data&&data.isFromSearch&&(self.isFromSearch=data&&data.isFromSearch);$timeout((function(){if(self.searchData&&self.searchData.catalog){self.browser.toolTip=self.deviceBrowserPanel.siteTitle;$rootScope.$emit("searchSite",{id:self.searchData.id})}}),500);event.stopPropagation()}}));var onSelectNode=$rootScope.$on(deviceBrowserEvent.siteNodeSelected,(function(event,siteNode){var node=siteNode.selectedNode;if(node){self.deviceBrowserPanel.siteTitle=self.getBrowserPath(node);self.browser.toolTip=self.deviceBrowserPanel.siteTitle}}));self.getBrowserPath=function(){return"Site"};self.refreshDeviceBrowser=function(){self.$broadcast(viewFrameEvent.refreshDeviceBrowser)};var devicesDeleted=$rootScope.$on(deviceBrowserEvent.deviceDeleted,(function(){self.$broadcast(viewFrameEvent.refreshDeviceBrowser)}));var systemEventChangedDomain=$rootScope.$on(systemEvent.changedDomain,(function(event,selectedTenant,lsSelectedDomains){self.$broadcast(viewFrameEvent.refreshDeviceBrowser,selectedTenant,lsSelectedDomains)}));self.$on("$destroy",(function(){togglePanelWatcher();onSelectNode();devicesDeleted();systemEventChangedDomain()}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopQappsPanelDirective",TopQappsPanelDirective);TopQappsPanelDirective.$inject=[];function TopQappsPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopQappsPanelDirective.html"};controller.$inject=["$scope","$rootScope","$timeout"];function controller($scope,$rootScope,$timeout){var self=$scope;function initPanelTitle(){self.qappsPanel={curIndex:1,title:"All Qapps",title2:"All Parsers",dic:{id:"",nodeArr:[]},dic2:{id:"",nodeArr:[]},isQapp:!0,qappInfo:{active:!0},parserInfo:{active:!1}}}initPanelTitle();self.preview={};self.topPanelOptions={};self.$on(viewFrameEvent.previewRefresh,(function(e,title,type,data){if(!data.bNoForce||self.preview.title){self.preview.title=title;self.preview.type=type;self.$broadcast("refreshPreview",type,data)}}));self.showTopQappsPanel=!1;self.isPanelPinned=!1;self.onSelctQappDic=function(id){self.$broadcast("EV_SELECTQAPPDIC",id)};self.onSelctParserDic=function(id){self.$broadcast("EV_SELECTPARSERDIC",id)};self.onClickTab=function(tabName){"parser"===tabName&&self.$broadcast("QappNavClickTab",tabName)};self.closeQappPanel=function(byClick){self.showTopQappsPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}initPanelTitle();$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinQappPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned")}};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,options){if("qapps"===type){self.showTopQappsPanel=!0;if(options){angular.isObject(options)&&(self.topPanelOptions=options);$timeout((function(){self.qappsPanel.isQapp=!1;self.qappsPanel.curIndex=2;self.qappsPanel.qappInfo.active=!1;self.qappsPanel.parserInfo.active=!0;self.onClickTab("parser")}))}event&&event.stopPropagation&&event.stopPropagation()}else self.isPanelPinned&&void 0===type||self.closeQappPanel()}));self.$on("$destroy",(function(){togglePanelWatcher()}));$rootScope.$on(systemEvent.changedTenant,(function(){self.showTopQappsPanel&&self.$broadcast("changedTenantOrDomain")}));self.$on("$destroy",(function(){togglePanelWatcher()}))}return service}}();!function(){angular.module("nb.uiframework").directive("nbTopQappGroupPanelDirective",TopQappGroupPanelDirective);TopQappGroupPanelDirective.$inject=[];function TopQappGroupPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopQappGroupPanelDirective.html"};controller.$inject=["$scope","$rootScope","$timeout"];function controller($scope,$rootScope,$timeout){var self=$scope;function initPanelTitle(){self.ctrlPanel={curIndex:1,title:"All Gapp",dic:{id:"",nodeArr:[]},status:{tree:0}}}initPanelTitle();self.preview={};self.$on(viewFrameEvent.previewRefresh,(function(e,title,type,data){if(!data.bNoForce||self.preview.title){self.preview.title=title;self.preview.type=type;self.$broadcast("refreshPreview",type,data)}}));self.showTopQappsPanel=!1;self.isPanelPinned=!1;self.onSelctQappDic=function(id){self.$broadcast("EV_SELECTQAPPDIC",id)};self.onSelectDic=function(id){self.ctrlPanel.dic.id=id};self.onSelctParserDic=function(id){self.$broadcast("EV_SELECTPARSERDIC",id)};self.onClickTab=function(tabName){"parser"===tabName&&self.$broadcast("QappNavClickTab",tabName)};self.closeQappPanel=function(byClick){self.showTopQappsPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}initPanelTitle();$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinQappPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned")}};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,options){if("gapp"===type){self.showTopQappsPanel=!0;self.qappOptions=options;event.stopPropagation()}else self.isPanelPinned&&void 0===type||self.closeQappPanel()}));self.$on("$destroy",(function(){togglePanelWatcher()}));$rootScope.$on(systemEvent.changedTenant,(function(){self.showTopQappsPanel&&self.$broadcast("changedTenantOrDomain")}));self.$on("$destroy",(function(){togglePanelWatcher()}))}return service}}();!function(NetBrain){angular.module("nb.uiframework").directive("nbTopSearchPanelDirective",TopSearchPanelDirective);TopSearchPanelDirective.$inject=["nb.search.searchMgr","nb.search.httpGlobalSearchSrvc","nb.search.httpAdvancedSearchSrvc","nb.search.semanticSearchService"];function TopSearchPanelDirective(searchMgr,httpGlobalSearchSrvc,httpAdvancedSearchSrvc,semanticSearchService){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopSearchPanelDirective.html"};controller.$inject=["$scope","$timeout","$rootScope","$q"];function controller($scope,$timeout,$rootScope,$q){var self=$scope;self.isExtendedSearch=!1;self.defaultSearchResultClicked=function(){if(self.isExtendedSearch){self.totalDevResultsCount=null;self.isExtendedSearch=!1;$rootScope.$emit("extendedSearch",{isExtendedSearch:self.isExtendedSearch})}};self.extendedSearchResultClicked=function(){if(!self.isExtendedSearch){self.totalDevResultsCount=null;self.isExtendedSearch=!0;$rootScope.$emit("extendedSearch",{isExtendedSearch:self.isExtendedSearch})}};self.showTopSearchPanel=!1;self.totalDevResultsCount=null;self.isPanelPinned=!1;self.searchStr="";self.searchResultList=[];self.contextMapOption={selectedNode:null,pinDetailsPanel:!1};self.devFilterCriteria={};self.advancedSearchObj={};self.selectedSearchCategory=null;self.isLazyLoading=!1;self.devLazyLoadingDone=!1;self.searchType="full";self.searchResultBtnShow=!1;self.pageInformation=searchMgr.getPageInformation();self.searchResultPaneConfig={showOpenCustomAreaPaneButton:!1,showListViewButton:!0,showRollbackButton:!1};self.rollbackObjectInfomation={};self.showRollbackButton=function(keyWord,advancedSearchResultObject){self.searchResultPaneConfig.showRollbackButton=!0;self.rollbackObjectInfomation={searchKeyWord:keyWord,advancedSearchResultObject:advancedSearchResultObject};stopCancelSearchRollBackEventListener();$timeout((function(){cancelSearchRollBackEventListener=$rootScope.$on("cancelSearchRollBackEvent",(function(){self.searchResultPaneConfig.showRollbackButton=!1;self.rollbackObjectInfomation={}}))}),1e3)};self.rollback=function(){self.searchResultPaneConfig.showRollbackButton=!1;$rootScope.$emit("searchKeyword",{keyword:self.rollbackObjectInfomation.searchKeyWord,advancedSearchResultObject:self.rollbackObjectInfomation.advancedSearchResultObject});stopCancelSearchRollBackEventListener()};var cancelSearchRollBackEventListener;var setSearchRollBackEventListener=$rootScope.$on("setSearchRollBackEvent",(function(event,args){self.showRollbackButton(args.keyword)}));function stopCancelSearchRollBackEventListener(){_.isFunction(cancelSearchRollBackEventListener)&&cancelSearchRollBackEventListener()}self.customAreaEventCallbacks={hidePaneCallback:function(){self.searchResultPaneConfig.showOpenCustomAreaPaneButton=!0},showPaneCallback:function(){self.searchResultPaneConfig.showOpenCustomAreaPaneButton=!1},searchResultPaneConfig:self.searchResultPaneConfig};self.ruleEventCallbacks={showingRuleSearchResults:function(ruleSearchResults){ruleSearchResults&&!ruleSearchResults.ContinueGeneralSearch&&(self.searchResultPaneConfig.showListViewButton=!1)}};self.closeSearchPanel=function(byClick){if("byClick-mini"===byClick){self.searchResultBtnShow=!0;setSearchResultButtonState(!0);byClick="byClick";semanticSearchService.hideCustomAreaPane();self.isPanelPinned=!1}else{void 0!==byClick&&hideSearchResultButton();"byClick"===byClick&&semanticSearchService.closeCustomAreaPane();self.searchResultBtnShow=!1;self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}self.showTopSearchPanel=!1;$(".top-search-panel").addClass("ng-hide");$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinSearchPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","search")}};self.openCustomAreaPane=function(){semanticSearchService.showCustomAreaPane();self.searchResultPaneConfig.showOpenCustomAreaPaneButton=!1};self.lazyLoadingDevSearchItem=function(sortType,devFilterCriteriaApplied,isAdvancedSearch){if(0!==Object.keys(self.searchResultList).length){var deffered=$q.defer();var currentDevNum=self.searchResultList.DevResults.DevResultList.length;sortType=sortType||"relevance";var devFilterCriteria=0===Object.keys(devFilterCriteriaApplied).length?self.devFilterCriteria:devFilterCriteriaApplied;if(self.devLazyLoadingDone)deffered.resolve();else if(!self.isLazyLoading){self.isLazyLoading=!0;var selectedObj={title:self.searchStr,type:searchMgr.getSearchTypeArray(self.selectedSearchCategory)};var preDevices=_.map(self.searchResultList.DevResults.DevResultList,(function(device){return{ID:device.DevGuid,hostName:device.DevName}}));var searchCondition=isAdvancedSearch?searchMgr.genAdvancedDevSearchQuery(self.advancedSearchObj.searchType,self.advancedSearchObj.searchScope,self.advancedSearchObj.searchScopeArgs,self.advancedSearchObj.criteriaList,self.advancedSearchObj.expr,currentDevNum):searchMgr.genSearchQuery(selectedObj,devFilterCriteria,sortType,0,20,1e3,preDevices);(isAdvancedSearch?httpAdvancedSearchSrvc.doAdvancedDeviceSearch(searchCondition):httpGlobalSearchSrvc.doFullSearch(searchCondition)).then((function(searchResult){if(searchResult.DevResults&&searchResult.DevResults.DevResultList){self.searchResultList.DevResults.DevResultList=self.searchResultList.DevResults.DevResultList.concat(searchResult.DevResults.DevResultList);deffered.resolve(searchResult.DevResults.DevResultList)}else deffered.resolve([]);self.devLazyLoadingDone=null==searchResult.DevResults||0===searchResult.DevResults.DevResultList.length}),(function(err){deffered.reject(err);self.devLazyLoadingDone=!1})).finally((function(){self.isLazyLoading=!1}))}return deffered.promise}};self.lazyLoadingSearchItem=function(sortType,devFilterCriteriaApplied,isAdvancedSearch,lazyLoadCatalog,useBeiginIndex,currentNum,totalNum,preDevices,preSites,preDeviceGroups,preNetworkSegments,preMaps,prePaths,preDashboards){if(0!==Object.keys(self.searchResultList).length){var deffered=$q.defer();sortType=sortType||"relevance";var devFilterCriteria=0===Object.keys(devFilterCriteriaApplied).length?self.devFilterCriteria:devFilterCriteriaApplied;if(!self.isLazyLoading){self.isLazyLoading=!0;var selectedObj={title:self.searchStr,type:searchMgr.getSearchTypeArray(self.selectedSearchCategory),isExtendedSearch:self.isExtendedSearch,isExtendTerm:self.isExtendTerm};var searchCondition=isAdvancedSearch?searchMgr.genAdvancedDevSearchQuery(self.advancedSearchObj.searchType,self.advancedSearchObj.searchScope,self.advancedSearchObj.searchScopeArgs,self.advancedSearchObj.criteriaList,self.advancedSearchObj.expr,0,preDevices):searchMgr.genSearchQuery(selectedObj,devFilterCriteria,sortType,!0===useBeiginIndex?currentNum:0,20,1e3,preDevices);searchCondition.LazyLoadCatalog=lazyLoadCatalog;searchCondition.PreSites=preSites;searchCondition.PreDeviceGroups=preDeviceGroups;searchCondition.PreNetworkSegments=preNetworkSegments;searchCondition.PreMaps=preMaps;searchCondition.PrePaths=prePaths;searchCondition.PreDashboards=preDashboards;(isAdvancedSearch?httpAdvancedSearchSrvc.doAdvancedDeviceSearch(searchCondition):httpGlobalSearchSrvc.doFullSearch(searchCondition)).then((function(searchResult){searchResult?deffered.resolve(searchResult):deffered.resolve([])}),(function(err){deffered.reject(err);self.devLazyLoadingDone=!1})).finally((function(){self.isLazyLoading=!1}))}return deffered.promise}};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,searchObj,isFromDetail){if("searchResultShow"!==type)if("search"===type){self.customAreaEventCallbacks.showPaneCallback();hideSearchResultButton();self.searchResultBtnShow=!0;self.searchResultPaneConfig.showListViewButton=!0;if(!isFromDetail){self.devLazyLoadingDone=!1;self.totalDevResultsCount=null;self.searchStr=searchObj.searchStr||"";self.selectedSearchCategory=searchObj.selectedSearchCategory;self.searchResultList=searchObj.searchResultList;self.searchType=searchObj.searchType||"full";self.advancedSearchObj=angular.fromJson(searchObj.advancedSearchObj||{});self.errorMessage=searchObj.errorMessage;self.totalDevResultsCount=self.searchResultList.TotalHitCount;if("advanced"==self.searchType){self.advancedSearchResultObject=searchObj;self.searchStr=""}else self.advancedSearchResultObject=null}self.showTopSearchPanel=!0;self.isExtendTerm=!0;$(".menu-searchResult").removeClass("hide")}else!self.showTopSearchPanel||self.isPanelPinned&&void 0===type?self.showTopSearchPanel&&self.isPanelPinned&&void 0===type||self.closeSearchPanel():self.closeSearchPanel("byClick-mini");else{$(".top-search-panel").removeClass("ng-hide");hideSearchResultButton();self.searchResultPaneConfig.showOpenCustomAreaPaneButton||semanticSearchService.showCustomAreaPane();self.showTopSearchPanel=!0}}));function hideSearchResultButton(){setSearchResultButtonState(!1)}function setSearchResultButtonState(state){$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.UpdateNavigationStatus,{key:"search",hide:!state})}var systemChangedDomain=$rootScope.$on(systemEvent.changedDomain,(function(){self.closeSearchPanel("byClick")}));var doSearchFromMap=$rootScope.$on(netMapEvent.doSearch,(function(event,query,doSearch){self.searchStr=query;$timeout((function(){$rootScope.$emit("searchKeyword",{keyword:query,run:doSearch});self.pinSearchPanel()}))}));self.$on("$destroy",(function(){doSearchFromMap();togglePanelWatcher();systemChangedDomain();setSearchRollBackEventListener();stopCancelSearchRollBackEventListener()}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopDevicesDetailPanelDirective",TopDeviceDetailPanelDirective);TopDeviceDetailPanelDirective.$inject=["$timeout"];function TopDeviceDetailPanelDirective($timeout){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopDeviceDetailPanelDirective.html"};controller.$inject=["$scope","$rootScope","nb.netbrain.httpDeviceSrvc"];function controller($scope,$rootScope,httpDeviceSrvc){var self=$scope;self.showTopDeviceDetailPanel=!1;self.isPanelPinned=!1;self.isFromSearch=!1;self.closeDeviceDetailPanel=function(byClick){self.showTopDeviceDetailPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}if(self.isFromSearch){self.isFromSearch=!1;$rootScope.$emit(viewFrameEvent.toggleTopPanel,"searchResultShow",null,!0)}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinDeviceDetailPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","deviceDetail")}};self.refreshDeviceDetailPanel=function(){$rootScope.$emit(deviceDetailEvent.refreshDetailPane)};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,detailEventData,isFromSearch){if("deviceDetail"===type)httpDeviceSrvc.getSimpleDevicesByGuids(null,[detailEventData.deviceGuid]).then((function(deviceData){if(deviceData&&deviceData.length>0){self.showTopDeviceDetailPanel=!0;self.isFromSearch=!!isFromSearch;detailEventData.deviceType=deviceData[0].subType;event.stopPropagation();$timeout((function(){self.pinDeviceDetailPanel();$rootScope.$emit(deviceDetailEvent.openFullViewContent,detailEventData)}))}else self.closeDeviceDetailPanel()}),(function(){self.closeDeviceDetailPanel()}));else if(!self.isPanelPinned||void 0!==type){self.isFromSearch=!1;self.closeDeviceDetailPanel()}}));self.$on("$destroy",togglePanelWatcher);var systemEventChangedDomain=$rootScope.$on(systemEvent.changedDomain,(function(){self.closeDeviceDetailPanel()}));self.$on("$destroy",systemEventChangedDomain)}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopDevicesGroupPanelDirective",nbTopDevicesGroupPanelDirective);nbTopDevicesGroupPanelDirective.$inject=[];function nbTopDevicesGroupPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopDevicesGroupPanelDirective.html"};controller.$inject=["$scope","$rootScope","$window","$timeout"];function controller($scope,$rootScope,$window,$timeout){var self=$scope;angular.element($window).on("resize",(function(){$scope.callResize=!0}));self.callGridResize=function(){if($scope.callResize){var hideEle=$(".device-browser-right-panel > .ng-hide ");if(hideEle.length>0){hideEle.removeClass("ng-hide");angular.element($window).resize();$scope.callResize=!1}}};self.showTopDeviceGroupPanel=!1;self.isPanelPinned=!1;self.test=function(){$(".tabset ul li")[1].setAttribute("active",!0)};self.deviceBrowserPanel={deviceGroupTitle:"Device Group"};self.browser={toolTip:self.deviceBrowserPanel.siteTitle};self.closeDevicePanel=function(byClick){self.showTopDeviceGroupPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinDevicePanel=function(){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","deviceGroup")};self.init=function(){if(self.isTriggerToggleTopPanelEvent){if(self.searchData){var obj={id:self.searchData.id};"NetworkSegment"===self.searchData.catalog&&(obj={id:self.searchData.id,type:self.searchData.Type});$rootScope.$emit("searchDeviceGroup",obj)}self.isTriggerToggleTopPanelEvent=!1}};self.setDeviceGroupTreeData=function(args){self.deviceGroupTreeData=args};self.getDeviceGroupTreeData=function(){return self.deviceGroupTreeData};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,data){if("deviceGroup"!==type||self.showTopDeviceGroupPanel)self.isPanelPinned&&void 0===type||self.closeDevicePanel();else{self.searchData=data;self.showTopDeviceGroupPanel=!0;self.isTriggerToggleTopPanelEvent=!0;$timeout((function(){if(self.searchData&&self.searchData.catalog&&("DeviceGroup"===self.searchData.catalog||"NetworkSegment"===self.searchData.catalog)){self.browser.toolTip=self.deviceBrowserPanel.deviceGroupTitle;var obj={id:self.searchData.id};"NetworkSegment"===self.searchData.catalog&&(obj={id:self.searchData.id,type:self.searchData.Type});$rootScope.$emit("searchDeviceGroup",obj)}}),500);event.stopPropagation()}}));var onSelectNode=$rootScope.$on(deviceBrowserEvent.siteNodeSelected,(function(event,siteNode){var node=siteNode.selectedNode;if(node){self.deviceBrowserPanel.siteTitle=self.getBrowserPath(node);self.browser.toolTip=self.deviceBrowserPanel.siteTitle}}));self.getBrowserPath=function(node){var name=node.name?node.name:"";if(node.parent){var parentNode=node.parent;name=self.getBrowserPath(parentNode)+" > "+name}return name};self.refreshDeviceBrowser=function(){self.$broadcast(viewFrameEvent.refreshDeviceBrowser)};var devicesDeleted=$rootScope.$on(deviceBrowserEvent.deviceDeleted,(function(){self.$broadcast(viewFrameEvent.refreshDeviceBrowser)}));var systemEventChangedDomain=$rootScope.$on(systemEvent.changedDomain,(function(event,selectedTenant,lsSelectedDomains){self.$broadcast(viewFrameEvent.refreshDeviceBrowser,selectedTenant,lsSelectedDomains)}));self.$on("$destroy",(function(){togglePanelWatcher();onSelectNode();devicesDeleted();systemEventChangedDomain()}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopAppflowPanelDirective",TopAppflowPanelDirective);TopAppflowPanelDirective.$inject=[];function TopAppflowPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopAppflowPanelDirective.html"};controller.$inject=["$scope","$rootScope"];function controller($scope,$rootScope){var self=$scope;self.showTopAppflowPanel=!1;self.isPanelPinned=!1;self.closeAppflowPanel=function(byClick){self.showTopAppflowPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinAppflowPanel=function(){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned","appFlow")};self.refreshAppFlow=function(){$rootScope.$broadcast(viewFrameEvent.refreshApplicationFlowBrowser,"appFlow")};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type){"appFlow"===type?self.showTopAppflowPanel=!0:self.isPanelPinned&&void 0===type||self.closeAppflowPanel()}));self.$on("$destroy",(function(){togglePanelWatcher()}));$rootScope.$on(systemEvent.changedDomain,(function(){self.closeAppflowPanel("byClick")}))}return service}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(NetBrain){angular.module("nb.uiframework").directive("nbSdnEntityDirective",(function(){return{restrict:"E",scope:{triggerSource:"@"},link:function(scope,ele,attr,ctrl){},replace:!0,controller:sdnEntitycontroller,controllerAs:"sdnEntityctrl",templateUrl:"modules/nbUIFramework/views/nbSdnEntity.html"}}));sdnEntitycontroller.$inject=["$scope","$rootScope","$timeout","$log","$uibModal","nb.sdn.httpSdnSrvc","nb.uiframework.mainUISrvc","nb.qmap.mapManagerSrvc","nb.qmap.httpMapSrvc","nb.common.nbAlertSrvc","nb.common.nbDragDropSrvc","nb.ng.utilitySrvc","nb.uiframework.urlStateMgr","md5","nb.systemmodel.deviceTypeMgrSrvc","nb.admin.httpTenantAdminSrvc","$filter","$q","dialogService","nb.ng.userSrvc","nb.sdn.httpContextActionSrvc","nb.runbook.httpRunBookSrvc","nb.runbook.runbookSrvc","nb.runbook.runBookTemplateMgr"];var instanceCount=0;function sdnEntitycontroller($scope,$rootScope,$timeout,$log,$uibModal,httpSdnSrvc,mainUISrvc,mapManagerSrvc,httpMapSrvc,nbAlertSrvc,nbDragDropSrvc,utilitySrvc,urlStateMgr,md5,deviceTypeMgrSrvc,httpTenantAdminSrvc,$filter,$q,dialogService,userSrvc,actionService,httpRunBookService,runBookService,runBookTemplateMgr){var self=this;self.showSDNEntityDetailPanel=!1;$scope.optionsRenderFinishEventId="mapcontext.action.render.finish";$scope.selectedViewID="";$scope.isPanelPinned=!0;$scope.showMaps=!0;$scope.showDetails=!1;$scope.propertyTree=null;$scope.displayedPropertyType="defaultProperty";$scope.emptyProperty=[{key:"",value:"This Node doesn't have any Details",isAddedProperty:!0}];$scope.NODE_NAME_KEY="__Node_Name__";$scope.scrollBarLeftDistance=0;$scope.allPropertyWidth=0;$scope.entityTabData={};$scope.previewInfo={};$scope.openType="sdn";$scope.arrow=!0;$scope.showViewMoreMaps=!1;$scope.haveMaps=!0;$scope.showContextMapsArr=[];$scope.showMapActionsArr=[];$scope.contextMapSuccess=!1;$scope.isLoadingMode=null;$scope.deviceDetailsSuccess=!1;$scope.schemPropertyDisplayName={};$scope.validateType=["boolean","number","string"];$scope.mapsInfo={cur:{mapsInfo:[],pending:0},other:{mapsInfo:[],pending:0},dataReady:null};$scope.cachedNodes={};$scope.cachedNodeIds=[];$scope.maxCacheNodes=20;instanceCount++;$scope.getDataEventName="getDataEventName"+instanceCount;httpSdnSrvc.getDeviceSchemaDisplayNames().then((function(data){if(null!=data&&"result"in data){var childSchemas=data.result;$scope.schemPropertyDisplayName[NetBrain.Common.Const.LegacySchema.Legacy]={};var intf_schemas=[];childSchemas.forEach((function(item){if(item.hasOwnProperty("tableName")&&-1==item.ID.indexOf(".")){intf_schemas.push(item.ID);$scope.schemPropertyDisplayName[NetBrain.Common.Const.LegacySchema.Legacy+"."+item.ID]={}}else if(item.isdisplay){var childSchema=item.ID;var prop_name=childSchema.substring(childSchema.lastIndexOf(".")+1);var parent_name=childSchema.substring(0,childSchema.indexOf("."));if(""==parent_name)$scope.schemPropertyDisplayName[NetBrain.Common.Const.LegacySchema.Legacy][prop_name]=item.displayname;else if(-1!=intf_schemas.indexOf(parent_name)&&childSchema.lastIndexOf(".")==childSchema.indexOf(".")){var subSchema=NetBrain.Common.Const.LegacySchema.Legacy+"."+parent_name;$scope.schemPropertyDisplayName[subSchema][prop_name]=item.displayname}}}))}}));$scope.openOverviewMapPage=function(map,bCreateRunbook,rbaId,templateId,defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId){var op={id:map.ID,activePageId:map.pageId,mapType:map.mapType,defaultSelectedDataViewGroupId:defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId:defaultSelectedDataViewTemplateId,forceOpenSameMapInNewTab:!0};if(bCreateRunbook){op.createRunbook=!0;op.rbtId=templateId}rbaId&&(op.rba=rbaId);urlStateMgr.openMap(op).then((function(result){NetBrain.Map.currentActiveMapPage&&mapManagerSrvc.switchMapPage(map.pageId)}))};var splitIntfName=function(intfName,reg){var ax=[];(intfName||"").replace(reg,(function(_,$1,$2){ax.push([$1||1/0,$2||""])}));return ax};var compareIntfName=function(a,b){var intfReg=/(\d+)|(\D+)/g;var ax=splitIntfName(a,intfReg);var bx=splitIntfName(b,intfReg);for(;ax.length&&bx.length;){var an=ax.shift();var bn=bx.shift();var nn=an[0]-bn[0]||an[1].localeCompare(bn[1]);if(nn)return nn}return ax.length-bx.length};var sortChildrenOfIntfEntify=function sortChildrenOfIntfEntify(children,bDesc){if(!_.isEmpty(children)){bDesc=bDesc||!1;children.sort((function(temp1,temp2){return bDesc?-1*compareIntfName(temp1[$scope.NODE_NAME_KEY],temp2[$scope.NODE_NAME_KEY]):compareIntfName(temp1[$scope.NODE_NAME_KEY],temp2[$scope.NODE_NAME_KEY])}));for(var i=0;i<children.length;++i)children[i].children&&children[i].children.length>0&&sortChildrenOfIntfEntify(children[i].children,bDesc)}};var getNodeUniqueString=function(page,nodePathValue){var tempValue="";page.hasOwnProperty("name")&&null!=page.name&&(tempValue+=page.name);tempValue+=nodePathValue;page.hasOwnProperty("visualSpaceInstanceId")&&null!=page.visualSpaceInstanceId&&(tempValue+=page.visualSpaceInstanceId);page.hasOwnProperty("topoType")&&null!=page.topoType&&(tempValue+=page.topoType);return tempValue};var getMapIdByPathValue=function(pathValue){var mapId=md5.createHash(pathValue);return mapId=(mapId=(mapId=(mapId=mapId.slice(0,20)+"-"+mapId.slice(20)).slice(0,16)+"-"+mapId.slice(16)).slice(0,12)+"-"+mapId.slice(12)).slice(0,8)+"-"+mapId.slice(8)};var getFormattedDateTime=function(val){return TimeUtil.formatDateTime(new Date(val))};function generateSchemaProperty(node){function IsInArray(arr,key){if(null==arr||0==arr.length)return!1;for(var i=0;i<arr.length;i++)if(arr[i].key==key)return!0;return!1}var objInfo=[];if("nbPathSchema"in node){if((nodePathSchema=node.nbPathSchema)in $scope.schemPropertyDisplayName){var displayProperty=$scope.schemPropertyDisplayName[nodePathSchema];for(var prop in node){var prop_type=_typeof(prop_value=node[prop]);if(-1!=$scope.validateType.indexOf(prop_type)&&prop in displayProperty){var item={key:displayProperty[prop],value:prop_value};0==IsInArray(objInfo,item.key)&&objInfo.push(item)}}if(node.hasOwnProperty("childrenEmbedded")&&node.childrenEmbedded.length>0){var tableViewData={};for(var j=0;j<node.childrenEmbedded.length;j++){var singleChild=node.childrenEmbedded[j];var tableViewSingleData={};if("nbPathSchema"in singleChild){var nodePathSchema;if((nodePathSchema=singleChild.nbPathSchema)in $scope.schemPropertyDisplayName){displayProperty=$scope.schemPropertyDisplayName[nodePathSchema];if(singleChild.treeTemplate.isSingleView){item={key:singleChild.treeTemplate.singleViewPropertyName,value:singleChild.__Node_Name__,isAddedProperty:!0};0==IsInArray(objInfo,item.key)&&objInfo.push(item)}else if(singleChild.treeTemplate.isTableView){for(var prop in singleChild){var prop_value;prop_type=_typeof(prop_value=singleChild[prop]);-1!=$scope.validateType.indexOf(prop_type)&&prop in displayProperty&&(tableViewSingleData[displayProperty[prop]]=prop_value)}tableViewData.hasOwnProperty(singleChild.treeTemplate.tableViewPropertyName)||(tableViewData[singleChild.treeTemplate.tableViewPropertyName]=[]);tableViewData[singleChild.treeTemplate.tableViewPropertyName].push(tableViewSingleData)}}}else"treeTemplate"in singleChild&&singleChild.treeTemplate.isTableView&&(tableViewData.hasOwnProperty(singleChild.treeTemplate.tableViewPropertyName)||(tableViewData[singleChild.treeTemplate.tableViewPropertyName]=[]))}if(tableViewData!={})for(var keyName in tableViewData){item={key:keyName,value:tableViewData[keyName],isAddedProperty:!0,isTableViewValue:!0};0==IsInArray(objInfo,item.key)&&objInfo.push(item)}}}else-1!=nodePathSchema.indexOf(NetBrain.Common.Const.LegacySchema.Legacy)||httpSdnSrvc.getGenericSchemasByPrefex(nodePathSchema,!1,!1).then((function(data){if("result"in data){var childSchemas=data.result;var displayProperty={};childSchemas.forEach((function(item){if(item.isDisplayInNodeDetails){var childSchema=item.id;var prop_name=childSchema.substring(childSchema.lastIndexOf(".")+1);displayProperty[prop_name]=item.displayName}}));$scope.schemPropertyDisplayName[nodePathSchema]=displayProperty;for(var prop in node){var prop_value=node[prop];var prop_type=_typeof(prop_value);if(-1!=$scope.validateType.indexOf(prop_type)&&prop in displayProperty){var item={key:displayProperty[prop],value:prop_value};0==IsInArray(objInfo,item.key)&&objInfo.push(item)}}$scope.currentNode.objInfo=objInfo}}))}$scope.currentNode.objInfo=objInfo}function mapsInfoReset(){$scope.mapsInfo.cur={mapsInfo:[],pending:0};$scope.mapsInfo.other={mapsInfo:[],pending:0}}$scope.fillNodeAllMapsInformation=function(node){$scope.node=node;mapsInfoReset();$scope.mapsInfo.dataReady=!1;$scope.tokenId=utilitySrvc.getGUID();httpSdnSrvc.getContextMapPreviewDatas(node.nbPathSchema,node.nbPathValue,$scope.selectedViewID,node[$scope.NODE_NAME_KEY],$scope.tokenId,node.hasOwnProperty("parentIds")?node.parentIds:[],node.contextId).then((function(data){$scope.contextMapSuccess=!0;removeLoadingMode();if(!(null!=data&&data.length>0&&data[0].tokenId!=$scope.tokenId)){mapsInfoReset();!function(data,nodeName,nodePathValue){if(data&&data.result){$scope.mapsInfo.cur.mapErrorMsg=null;for(var i=0;i<data.result.length;++i){var result=data.result[i];if(""==$scope.selectedViewID||result.page.objectTreeTemplateId==$scope.selectedViewID){var that=$scope.mapsInfo.cur;if(result.error){console.warn("context map error: "+result.error,result);105e3===result.errorCode&&(that.mapErrorMsg=result.error)}if(result.overviewMapResult){var tempPage=angular.copy(result.page);var mapId=result.overviewMapResult.mapId;var mapType=result.overviewMapResult.mapType;var mapInfo={};result.hasOwnProperty("mapProperty")&&(mapInfo=result.mapProperty);!function(tempPageInfo,mapId,mapType,mapInfo,overviewMap){httpMapSrvc.getSystemMapByKey(mapId,mapType).then((function(jsonData){if(null!=jsonData){that.pending++;!function(pageName){var defered=$q.defer();$scope.$emit($scope.getDataEventName,{linkInfos:null,dataViewsSegment:null,mapJsonData:jsonData,pageInfo:tempPageInfo},defered);defered.promise.then((function(mapData){var info={};if(mapData.page.hasOwnProperty("parentSchema")&&""!=mapData.page.parentSchema){info.parentSchema=mapData.page.parentSchema;info.parentPathValue=mapData.page.parentPathValue;nodePathValue=info.parentPathValue;nodeName=mapData.page.parentNodeName}info.docName=nodeName+"_"+mapData.page.name;info.updatedBy=userSrvc.getUserName();info.creator=userSrvc.getUserName();info.createTm=TimeUtil.formatDateTime(new Date);info.docModifyTime=TimeUtil.formatDateTime(new Date);info.nodeDataArray=mapData.nodeDataArray;info.linkDataArray=mapData.linkDataArray;info.docPngList=[mapData.image];info.type=mapData.page.type;info.mapType=mapType;info.overviewMaps=[mapData.page];getNodeUniqueString(mapData.page,nodePathValue);info.mapId=mapId;if(0!=info.type&&Object.keys(mapInfo).length>0){info.docName=mapInfo.title;info.ID=mapInfo.ID;info.updatedBy=mapInfo.updatedBy;info.creator=mapInfo.creator;info.createTm=getFormattedDateTime(mapInfo.createTm);info.version=mapInfo.version;info.docModifyTime=getFormattedDateTime(mapInfo.modifyTm);for(var k=0;k<mapInfo.pageListSummary.length;++k)if(2==mapData.page.type||3==mapData.page.type){info.pageId=mapInfo.pageListSummary[k].pageId;break}}fillOverViewMap(info,overviewMap);that.mapsInfo.push(info);that.mapsInfo.sort(down);$scope.haveMaps=!0;that.pending--}))}(tempPageInfo.name)}}))}(tempPage,mapId,mapType,mapInfo,result)}if(result.devicesLinkInfosAndDataViewsResult){var linkInfos=result.devicesLinkInfosAndDataViewsResult.linkInfos;var dataViewsSegment=result.devicesLinkInfosAndDataViewsResult.dataViewsSegment;if(!dataViewsSegment||!dataViewsSegment.devDataViewSegmentList||0==dataViewsSegment.devDataViewSegmentList.length)continue;that.pending++;!function(tempPageInfo,overviewMap){var defered=$q.defer();$scope.$emit($scope.getDataEventName,{linkInfos:linkInfos,dataViewsSegment:dataViewsSegment,pageInfo:tempPageInfo},defered);defered.promise.then((function(mapData){var info={};info.docName=nodeName+"_"+mapData.page.name;info.updatedBy=userSrvc.getUserName();info.creator=userSrvc.getUserName();info.createTm=TimeUtil.formatDateTime(new Date);info.docModifyTime=TimeUtil.formatDateTime(new Date);info.nodeDataArray=mapData.nodeDataArray;info.linkDataArray=mapData.linkDataArray;info.docPngList=[mapData.image];info.type=0;info.overviewMaps=[mapData.page];if(mapData.page.hasOwnProperty("parentSchema")&&""!=mapData.page.parentSchema){info.parentSchema=mapData.page.parentSchema;info.parentPathValue=mapData.page.parentPathValue;nodePathValue=info.parentPathValue}var tempValue=getNodeUniqueString(mapData.page,nodePathValue);info.mapId=getMapIdByPathValue(tempValue);fillOverViewMap(info,overviewMap);that.mapsInfo.push(info);that.mapsInfo.sort(down);$scope.haveMaps=!0;that.pending--}))}(tempPage=angular.copy(result.page),result)}if(result.topologyTypesAndNbrCountResults)for(var j=0;j<result.topologyTypesAndNbrCountResults.length;++j){var topoNbr=result.topologyTypesAndNbrCountResults[j];if(topoNbr&&topoNbr.shortDataViewsSegment&&topoNbr.shortDataViewsSegment.devDataViewSegmentList&&0!=topoNbr.shortDataViewsSegment.devDataViewSegmentList.length){that.pending++;tempPage=angular.copy(result.page);!function(pageName,tempPageInfo,overviewMap){var defered=$q.defer();$scope.$emit($scope.getDataEventName,{linkInfos:topoNbr.shortNbrBaseInfoExtList,dataViewsSegment:topoNbr.shortDataViewsSegment,pageInfo:tempPageInfo},defered);defered.promise.then((function(mapData){var info={};info.docName=pageName;info.updatedBy=userSrvc.getUserName();info.creator=userSrvc.getUserName();info.createTm=TimeUtil.formatDateTime(new Date);info.docModifyTime=TimeUtil.formatDateTime(new Date);info.nodeDataArray=mapData.nodeDataArray;info.linkDataArray=mapData.linkDataArray;info.docPngList=[mapData.image];fillOverViewMap(info,overviewMap);that.mapsInfo.push(info);that.mapsInfo.sort(down);$scope.haveMaps=!0;that.pending--}))}(result.page.name+" - "+topoNbr.name,tempPage,result)}}if(result.mapInfos){for(j=0;j<result.mapInfos.length;++j){mapInfo=result.mapInfos[j];that.pending++;var info={};info.ID=mapInfo.mapProperty.ID;info.docName=mapInfo.mapProperty.title;info.updatedBy=mapInfo.mapProperty.updatedBy;info.creator=mapInfo.mapProperty.creator;info.createTm=getFormattedDateTime(mapInfo.mapProperty.createTm);info.version=mapInfo.mapProperty.version;info.docModifyTime=getFormattedDateTime(mapInfo.mapProperty.modifyTm);if(result.matchedPageId)info.pageId=result.matchedPageId;else for(var k=0;k<mapInfo.mapProperty.pageListSummary.length;++k){if(0==result.page.type&&mapInfo.mapProperty.pageListSummary[k].title==result.page.name){info.pageId=mapInfo.mapProperty.pageListSummary[k].pageId;break}if(2==result.page.type||3==result.page.type||7==result.page.type||8==result.page.type){info.pageId=mapInfo.mapProperty.pageListSummary[k].pageId;break}}info.docPngList=[mapInfo.thumbnail];info.type=result.page.type;info.mapType=mapInfo.mapProperty.mapType;fillOverViewMap(info,result);that.mapsInfo.push(info);$scope.haveMaps=!0;that.pending--}that.mapsInfo.sort(down)}}}}function down(x,y){return x.docName>y.docName?1:-1}}(data,node[$scope.NODE_NAME_KEY],node.nbPathValue);$scope.mapsInfo.dataReady=!0;if("Details Information"==$scope.rightpanelDetail){$scope.currentNode.objInfo.length>0?$scope.onOpenTabContent("defaultProperty"):0==$scope.currentNode.objInfo.length&&$scope.currentNode.curNodeObj.hasOwnProperty("childrenExt")&&$scope.currentNode.curNodeObj.childrenExt.length>0?$scope.onOpenTabContent($scope.currentNode.curNodeObj.childrenExt[0]):$scope.propertyTree=null;$timeout((function(){$scope.calCTabHeaderBarWith()}))}else $scope.selectTab(1)}}),(function(){$scope.contextMapSuccess=!0;removeLoadingMode();mapsInfoReset();$scope.mapsInfo.dataReady=!0}));if(unWatchViewMoreMaps){unWatchViewMoreMaps();unWatchViewMoreMaps=null}if(unWatchDataReady){unWatchDataReady();unWatchDataReady=null}$scope.currentNode.mapsInfo=$scope.mapsInfo;if($scope.currentNode.mapsInfo.dataReady){$scope.haveMaps=$scope.currentNode.mapsInfo.cur.mapsInfo.length+$scope.currentNode.mapsInfo.cur.pending+$scope.currentNode.mapsInfo.other.mapsInfo.length+$scope.currentNode.mapsInfo.other.pending>0;$scope.showViewMoreMaps=$scope.currentNode.mapsInfo.other.mapsInfo.length+$scope.currentNode.mapsInfo.other.pending>0}else{$scope.haveMaps=!0;$scope.showViewMoreMaps=!1;unWatchDataReady=$scope.$watch("currentNode.mapsInfo.dataReady",(function(newData,oldData){if(newData){$scope.haveMaps=$scope.currentNode.mapsInfo.cur.mapsInfo.length+$scope.currentNode.mapsInfo.cur.pending+$scope.currentNode.mapsInfo.other.mapsInfo.length+$scope.currentNode.mapsInfo.other.pending>0;$scope.showViewMoreMaps=$scope.currentNode.mapsInfo.other.mapsInfo.length+$scope.currentNode.mapsInfo.other.pending>0;unWatchDataReady();unWatchDataReady=null}}))}};$scope.onOpenTabContent=function(tab){$scope.$broadcast("tabSwitchSearchEmpty");if("defaultProperty"!=tab){$scope.displayedPropertyType=tab[$scope.NODE_NAME_KEY];if($scope.entityTabData.hasOwnProperty($scope.displayedPropertyType))$scope.propertyTree=$scope.entityTabData[tab[$scope.NODE_NAME_KEY]];else{$scope.packageDetailsTreeData(tab);$timeout((function(){var intfEntityList=angular.copy(tab.children);!function(intfEntityList,bDesc){if(!_.isEmpty(intfEntityList))for(var i=0;i<intfEntityList.length;++i){var entityTmp=intfEntityList[i];sortChildrenOfIntfEntify(entityTmp.children,bDesc)}}(intfEntityList,!1);$scope.entityTabData[tab[$scope.NODE_NAME_KEY]]=intfEntityList;$scope.propertyTree=$scope.entityTabData[tab[$scope.NODE_NAME_KEY]]}))}}else{$scope.displayedPropertyType="defaultProperty";$scope.propertyTree=null}};$scope.hideArrow=function(){$(".sdn-details-scroll-bar .carousel-arrow-left").addClass("arrow-hidden");$(".sdn-details-scroll-bar .carousel-arrow-right").addClass("arrow-hidden")};var unWatchDataReady=null;var unWatchViewMoreMaps=null;var updateSelectedNodeInformation=$rootScope.$on(SDNEvent.DISPLAY_RIGHTPANEL,(function(event,type,data){$scope.templateType=1;type.curNodeObj.treeTemplate&&($scope.templateType=type.curNodeObj.treeTemplate.type);$scope.arrow=1!=(data||!1);$scope.selectedViewID="";if($scope.triggerSource==type.triggerSource)if(0===$scope.templateType)self.showSDNEntityDetailPanel=!1;else{self.showSDNEntityDetailPanel=!0;type.hasOwnProperty("viewId")&&($scope.selectedViewID=type.viewId)}else self.showSDNEntityDetailPanel=!1;$scope.hideArrow();$scope.entityTabData={};if(type&&self.showSDNEntityDetailPanel){if("mapNode"==type.triggerSource){var tempNetMap=type.curNodeObj.netmap;delete type.curNodeObj.netmap;$scope.currentNode=angular.copy(type);$scope.currentNode.curNodeObj.netmap=tempNetMap}else $scope.currentNode=angular.copy(type);if(3==$scope.templateType)getContextDetails(type.curNodeObj);else if($scope.cachedNodes.hasOwnProperty(getCacheKey($scope.currentNode))){$scope.contextMapSuccess=!1;$scope.isLoadingMode||($scope.isLoadingMode=setInterval((function(){0==$("#nbAJAXCallMask").length&&utilitySrvc.enableLoadingMode()}),500));$scope.currentNode=(node=$scope.currentNode,$scope.cachedNodes[getCacheKey(node)]);generateSchemaProperty($scope.currentNode.curNodeObj);$scope.fillNodeAllMapsInformation($scope.currentNode.curNodeObj)}else{$scope.contextMapSuccess=!1;$scope.deviceDetailsSuccess=!1;$scope.isLoadingMode||($scope.isLoadingMode=setInterval((function(){0==$("#nbAJAXCallMask").length&&utilitySrvc.enableLoadingMode()}),500));for(var key in $scope.currentNode.schemPropertyDisplayName)$scope.schemPropertyDisplayName.hasOwnProperty(key)||($scope.schemPropertyDisplayName[key]=$scope.currentNode.schemPropertyDisplayName[key]);$scope.updateNodeDetail($scope.currentNode)}}var node}));function getCacheKey(node){return node.curNodeObj.nbPathValue+"_"+node.curNodeObj.contextId}$scope.dateFormat=function(date){date=new Date(date);return utilitySrvc.formatDateTime(date)};$scope.contextMapsViewMore=function(){$scope.showContextMapsArr=$scope.contextDetailsInfo.maps.slice(0,$scope.showContextMapsArr.length+5)};$scope.mapActionsViewMore=function(){$scope.showMapActionsArr=$scope.contextDetailsInfo.actions.slice(0,$scope.showMapActionsArr.length+5)};function getContextDetails(obj){$scope.showContextMapsArr=[];$scope.showMapActionsArr=[];httpSdnSrvc.getContextMapContextDetail(obj.viewId,obj.id).then((function(data){$scope.contextDetailsInfo=data;$scope.contextMapsViewMore();$scope.mapActionsViewMore()}))}function removeLoadingMode(){if($scope.contextMapSuccess&&$scope.deviceDetailsSuccess){clearInterval($scope.isLoadingMode);$scope.isLoadingMode=null;utilitySrvc.disableLoadingMode()}}var hideSelectedNodeInformation=$rootScope.$on(SDNEvent.HIDE_RIGHTPANEL,(function(event,type,data){if(self.showSDNEntityDetailPanel){$scope.arrow=!1;self.showSDNEntityDetailPanel=!1;$scope.hideArrow();$scope.entityTabData={};$scope.previewInfo.close()}}));$scope.asyncCount=0;$scope.updateNodeDetail=function(node){$scope.fillNodeAllMapsInformation($scope.currentNode.curNodeObj);httpSdnSrvc.getNodeDetailTreeData(node.curNodeObj.nbPathSchema,node.curNodeObj.nbPathValue,self.NODE_NAME_KEY).then((function(data){$scope.deviceDetailsSuccess=!0;removeLoadingMode();if(null!=data&&"result"in data){if("nodeSchemaDisplay"in data.result){var nodeSchemaDisplayResult=data.result.nodeSchemaDisplay;for(var key in nodeSchemaDisplayResult){var displayProperty={};nodeSchemaDisplayResult[key].forEach((function(item){if(item.isDisplayInNodeDetails){var childSchema=item.id;var prop_name=childSchema.substring(childSchema.lastIndexOf(".")+1);displayProperty[prop_name]=item.displayName}}));$scope.schemPropertyDisplayName[key]=displayProperty}delete data.result.nodeSchemaDisplay}for(var key in data.result)node.curNodeObj[key]=data.result[key];$scope.asyncCount=0;$scope.checkLoadCompleted()}}),(function(){$scope.deviceDetailsSuccess=!0;removeLoadingMode()}))};$scope.NODE_NAME_KEY="__Node_Name__";function fillTreeTemplateInfo(item,treeTemplate){item.treeTemplate={type:treeTemplate.type,icon:treeTemplate.icon,overviewMaps:treeTemplate.overviewMaps,visualSpaceInstanceId:treeTemplate.visualSpaceInstanceId};if(treeTemplate.hasOwnProperty("isTableView")&&treeTemplate.hasOwnProperty("tableViewPropertyName")){item.treeTemplate.isTableView=treeTemplate.isTableView;item.treeTemplate.tableViewPropertyName=treeTemplate.tableViewPropertyName}if(treeTemplate.hasOwnProperty("isSingleView")&&treeTemplate.hasOwnProperty("singleViewPropertyName")){item.treeTemplate.isSingleView=treeTemplate.isSingleView;item.treeTemplate.singleViewPropertyName=treeTemplate.singleViewPropertyName}}$scope.fillChildNode=function(parent,treeTemplates,parentPathValue,parentPathSchema,childKey){treeTemplates.forEach((function(treeTemplate,index){if(0==treeTemplate.type){var childItem={_id:utilitySrvc.getGUID()};childItem[$scope.NODE_NAME_KEY]=treeTemplate.displayNameTemplate;childItem[childKey]=[];fillTreeTemplateInfo(childItem,treeTemplate);treeTemplate.hasOwnProperty(childKey)&&$scope.fillChildNode(childItem,treeTemplate[childKey],parentPathValue,parentPathSchema,childKey);if("children"!=childKey&&treeTemplate.hasOwnProperty("children")){childItem.children=[];$scope.fillChildNode(childItem,treeTemplate.children,parentPathValue,parentPathSchema,"children")}if("childrenExt"!=childKey&&treeTemplate.hasOwnProperty("childrenExt")){childItem.childrenExt=[];$scope.fillChildNode(childItem,treeTemplate.childrenExt,parentPathValue,parentPathSchema,"childrenExt")}if("childrenEmbedded"!=childKey&&treeTemplate.hasOwnProperty("childrenEmbedded")){childItem.childrenEmbedded=[];$scope.fillChildNode(childItem,treeTemplate.childrenEmbedded,parentPathValue,parentPathSchema,"childrenEmbedded")}parent[childKey].push(childItem)}else if(1==treeTemplate.type&&treeTemplate.schema){var dictQuery=JSON.parse(null!=treeTemplate.queryFilter&&""!=treeTemplate.queryFilter?treeTemplate.queryFilter:"{}");if(-1!=treeTemplate.schema.indexOf(parentPathSchema+".")){dictQuery.parentPathSchema=parentPathSchema;dictQuery.parentPathValue=parentPathValue}else if(-1!=parentPathSchema.indexOf(treeTemplate.schema+".")){dictQuery.childPathSchema=parentPathSchema;dictQuery.childPathValue=parentPathValue}else{dictQuery.parentPathSchema=parentPathSchema;dictQuery.parentPathValue=parentPathValue}dictQuery.displayNameTemplate=treeTemplate.displayNameTemplate;"relationLinkSchema"in treeTemplate&&(dictQuery.relationLinkSchema=treeTemplate.relationLinkSchema);dictQuery.displayNameKey=self.NODE_NAME_KEY;$scope.asyncCount=$scope.asyncCount+1;httpSdnSrvc.getNodeListByQuery(treeTemplate.schema,dictQuery).then((function(data){$scope.asyncCount=$scope.asyncCount-1;if(null!=data&&"result"in data){data.result.forEach((function(childItem){if(!(-1==childItem.nbPathSchema.indexOf(NetBrain.Common.Const.LegacySchema.Legacy)&&0==childItem.nbPathSchema.indexOf(parentPathSchema)&&-1==childItem.nbPathValue.indexOf(parentPathValue+"/")||childItem&&(-1!=childItem.nbPathSchema.indexOf("fvBD")||-1!=childItem.nbPathSchema.indexOf("fvSubnet"))&&childItem.hasOwnProperty("isFake")&&childItem.isFake)){childItem[childKey]=[];fillTreeTemplateInfo(childItem,treeTemplate);treeTemplate.hasOwnProperty(childKey)&&$scope.fillChildNode(childItem,treeTemplate[childKey],childItem.nbPathValue,childItem.nbPathSchema,childKey);if("children"!=childKey&&treeTemplate.hasOwnProperty("children")){childItem.children=[];$scope.fillChildNode(childItem,treeTemplate.children,childItem.nbPathValue,childItem.nbPathSchema,"children")}if("childrenExt"!=childKey&&treeTemplate.hasOwnProperty("childrenExt")){childItem.childrenExt=[];$scope.fillChildNode(childItem,treeTemplate.childrenExt,childItem.nbPathValue,childItem.nbPathSchema,"childrenExt")}if("childrenEmbedded"!=childKey&&treeTemplate.hasOwnProperty("childrenEmbedded")){childItem.childrenEmbedded=[];$scope.fillChildNode(childItem,treeTemplate.childrenEmbedded,childItem.nbPathValue,childItem.nbPathSchema,"childrenEmbedded")}parent[childKey].splice(index,0,childItem)}}));0==data.result.length&&treeTemplate.hasOwnProperty("isTableView")&&parent[childKey].splice(index,0,{treeTemplate:treeTemplate})}$scope.checkLoadCompleted()}),(function(reason){$scope.asyncCount=$scope.asyncCount-1;$scope.checkLoadCompleted()}));$scope.schemPropertyDisplayName.hasOwnProperty(treeTemplate.schema)||$scope.updateNodeSchemaDisplay(treeTemplate.schema)}}))};$scope.checkLoadCompleted=function(){if(0==$scope.asyncCount){$scope.currentNode.curNodeObj.hasOwnProperty("childrenExt")&&$scope.currentNode.curNodeObj.childrenExt.length>0&&($scope.currentNode.curNodeObj.childrenExt=$scope.currentNode.curNodeObj.childrenExt.filter((function(childItem){return childItem&&(1==childItem.type||childItem.hasOwnProperty("children")&&childItem.children.length>0)})));generateSchemaProperty($scope.currentNode.curNodeObj);node=$scope.currentNode,$scope.cachedNodes[getCacheKey(node)]=node;$scope.cachedNodeIds.push(getCacheKey($scope.currentNode));if($scope.cachedNodeIds.length>$scope.maxCacheNodes){var removeId=$scope.cachedNodeIds.shift();delete $scope.cachedNodes[removeId]}}var node};$scope.updateNodeSchemaDisplay=function(schemaPath){httpSdnSrvc.getGenericSchemasByPrefex(schemaPath,!1,!1).then((function(data){if("result"in data){var childSchemas=data.result;var displayProperty={};childSchemas.forEach((function(item){if(item.isDisplayInNodeDetails){var childSchema=item.id;var prop_name=childSchema.substring(childSchema.lastIndexOf(".")+1);displayProperty[prop_name]=item.displayName}}));$scope.schemPropertyDisplayName[schemaPath]=displayProperty}}))};$scope.calCTabHeaderBarWith=function(){$scope.allPropertyWidth=0;var allElement=$(".sdn-property-element");if(allElement.length>0)for(var i=0;i<allElement.length;i++)$scope.allPropertyWidth+=allElement[i].clientWidth+20;$scope.allPropertyWidth>455?$(".sdn-details-scroll-bar .carousel-arrow-right").removeClass("arrow-hidden"):$(".sdn-details-scroll-bar .carousel-arrow-right").addClass("arrow-hidden")};$scope.scrollHorizontalTab=function(direction){$scope.calCTabHeaderBarWith();$scope.scrollBarLeftDistance="right"==direction?$scope.scrollBarLeftDistance+50:$scope.scrollBarLeftDistance-50;$scope.scrollBarLeftDistance>$scope.allPropertyWidth-455&&$(".sdn-details-scroll-bar .carousel-arrow-right").addClass("arrow-hidden");0==$scope.scrollBarLeftDistance?$(".sdn-details-scroll-bar .carousel-arrow-left").addClass("arrow-hidden"):$(".sdn-details-scroll-bar .carousel-arrow-left").removeClass("arrow-hidden");$(".fullView-tab-dataTables-table-selector").animate({scrollLeft:$scope.scrollBarLeftDistance},100)};$scope.selectTab=function(tab){if(1==tab){$scope.showMaps=!0;$scope.showDetails=!1;$scope.rightpanelDetail="Maps Information"}else{$scope.showMaps=!1;$scope.showDetails=!0;$scope.rightpanelDetail="Details Information";$scope.hideArrow();$scope.currentNode.objInfo&&$scope.currentNode.objInfo.length>0?$scope.onOpenTabContent("defaultProperty"):0==$scope.currentNode.objInfo.length&&$scope.currentNode.curNodeObj.childrenExt&&$scope.currentNode.curNodeObj.childrenExt.length>0&&$scope.onOpenTabContent($scope.currentNode.curNodeObj.childrenExt[0]);$timeout((function(){$scope.calCTabHeaderBarWith()}))}};$scope.closeRightPanel=function(){self.showSDNEntityDetailPanel=!1;$scope.previewInfo.close();$rootScope.$emit(viewFrameEvent.closePanel,"byClick",$scope.triggerSource)};$scope.openTableView=function(item){if(null!=item.value&&item.value.length>0){var ret=[];var len=item.value.length;var tmp={};var tmpKey;for(var i=0;i<len;i++)if(!tmp[tmpKey=_typeof(item.value[i])+JSON.stringify(item.value[i])]){tmp[tmpKey]=1;ret.push(item.value[i])}item.value=ret}var columnDefItemList=[];for(i=0;i<item.value.length;i++)for(var key in item.value[i])columnDefItemList.hasOwnProperty(key)||-1!=key.indexOf("$$")||(columnDefItemList[key]=!0);$uibModal.open({templateUrl:"modules/nbSDN/views/nbSdnEntityDetailTableModalView.html",controller:"nb.sdn.nbSdnEntityDetailTableModalCtrl",windowClass:"sdnEntity-Table-View-Modal",backdrop:"static",resolve:{resolvedData:function(){return{selectedItems:item,columnDefItems:columnDefItemList}}}}).result.then((function(args){}))};$scope.packageDetailsTreeData=function(node){var objInfo=[];var propertyDataList=[];node.hasOwnProperty("finalNode")||(node.finalNode=!1);if((!node.finalNode&&!(node.children&&node.children.length>0&&"Property"==node.children[0][$scope.NODE_NAME_KEY])||0==node.children.length)&&node.nbPathValue&&null!=node.nbPathValue){$scope.objTableInfo=[];if("nbPathSchema"in node){if((nodePathSchema=node.nbPathSchema)in $scope.schemPropertyDisplayName){var displayProperty=$scope.schemPropertyDisplayName[nodePathSchema];for(var prop in node){var prop_type=_typeof(prop_value=node[prop]);-1!=$scope.validateType.indexOf(prop_type)&&prop in displayProperty&&objInfo.push({key:displayProperty[prop],value:prop_value,isAddedProperty:!0,__Node_Name__:displayProperty[prop]+" "+prop_value})}}}if(node.hasOwnProperty("childrenEmbedded")&&node.childrenEmbedded.length>0){var tableViewData={};for(var j=0;j<node.childrenEmbedded.length;j++){var singleChild=node.childrenEmbedded[j];var tableViewSingleData={};if("nbPathSchema"in singleChild){var nodePathSchema;if((nodePathSchema=singleChild.nbPathSchema)in $scope.schemPropertyDisplayName){displayProperty=$scope.schemPropertyDisplayName[nodePathSchema];if(singleChild.treeTemplate.isSingleView)objInfo.push({key:singleChild.treeTemplate.singleViewPropertyName,value:singleChild.__Node_Name__,isAddedProperty:!0,__Node_Name__:singleChild.treeTemplate.singleViewPropertyName+" "+singleChild.__Node_Name__});else{for(var prop in singleChild){var prop_value;prop_type=_typeof(prop_value=singleChild[prop]);-1!=$scope.validateType.indexOf(prop_type)&&prop in displayProperty&&(singleChild.treeTemplate.isTableView?tableViewSingleData[displayProperty[prop]]=prop_value:singleChild.treeTemplate.isSingleView?objInfo.push({key:singleChild.treeTemplate.singleViewPropertyName,value:prop_value,isAddedProperty:!0,__Node_Name__:singleChild.treeTemplate.singleViewPropertyName+" "+prop_value}):objInfo.push({key:displayProperty[prop],value:prop_value,isAddedProperty:!0,__Node_Name__:displayProperty[prop]+" "+prop_value}));"childrenEmbedded"==prop&&null!=prop_value&&prop_value.length>0&&singleChild.treeTemplate.isTableView&&prop_value.forEach((function(childItem){if(childItem.treeTemplate.isSingleView&&childItem.hasOwnProperty("__Node_Name__")){var columnName=childItem.treeTemplate.singleViewPropertyName;var columnValue=childItem.__Node_Name__;tableViewSingleData.hasOwnProperty(columnName)?tableViewSingleData[columnName]=tableViewSingleData[columnName]+", "+columnValue:tableViewSingleData[columnName]=angular.copy(columnValue)}}))}if(singleChild.treeTemplate.isTableView){tableViewData.hasOwnProperty(singleChild.treeTemplate.tableViewPropertyName)||(tableViewData[singleChild.treeTemplate.tableViewPropertyName]=[]);tableViewData[singleChild.treeTemplate.tableViewPropertyName].push(tableViewSingleData)}}}}else"treeTemplate"in singleChild&&singleChild.treeTemplate.isTableView&&(tableViewData.hasOwnProperty(singleChild.treeTemplate.tableViewPropertyName)||(tableViewData[singleChild.treeTemplate.tableViewPropertyName]=[]))}if(tableViewData!={})for(var keyName in tableViewData)objInfo.push({key:keyName,value:tableViewData[keyName],isAddedProperty:!0,isTableViewValue:!0,__Node_Name__:keyName+" "+tableViewData[keyName]})}}if(objInfo.length>0){propertyDataList=[];propertyDataList=objInfo;if(node.hasOwnProperty("children"))if(0==node.children.length){node.children=propertyDataList;node.finalNode=!0}else"Property"!=node.children[0][$scope.NODE_NAME_KEY]&&1!=node.finalNode&&node.children.unshift({__Node_Name__:"Property",children:propertyDataList,isAddedPropertyList:!0});else{node.finalNode=!0;node.children.push({__Node_Name__:"Property",children:propertyDataList,isAddedPropertyList:!0})}}if(node.hasOwnProperty("children")&&!node.finalNode)for(var i=0;i<node.children.length;i++)"Property"!=node.children[i][$scope.NODE_NAME_KEY]&&$scope.packageDetailsTreeData(node.children[i])};$scope.ivhTreeOptions={expandToDepth:0,defaultSelectedState:!1,enableLabelExpand:!1,enableMultipleSelect:!1,enableTwoWayBinding:!0,enableLocationBar:!0,enableSearchBar:!0,selectedAttribute:"selected",idAttribute:$scope.NODE_NAME_KEY,locationLabelAttribute:$scope.NODE_NAME_KEY,labelTemplate:function(node,trvw){var tempNodeName="";if(node.hasOwnProperty("isAddedPropertyList")){tempNodeName="Property";return"<span>"+$filter("nbHighlight")(tempNodeName,trvw.locationQuery)+"</span>"}if(node.hasOwnProperty("isAddedProperty")){if(""==node.key){tempNodeName=node.value;return"<span>"+(filteredValueText=$filter("nbHighlight")(tempNodeName,trvw.locationQuery))+"</span>"}if(node.hasOwnProperty("isTableViewValue")){tempNodeName=node.key;var filteredValueText=$filter("nbHighlight")(tempNodeName,trvw.locationQuery);return node.value.length>0?'<span class="property-name" title="'+node.key+'">'+filteredValueText+': </span><span class="property-value tree-property-value-style" style="cursor:pointer" ><a class="sdn-details-property-table-view">View</a></span>':'<span class="property-name" title="'+node.key+'">'+filteredValueText+': </span><span class="property-value tree-property-value-style" style="cursor:pointer" ></a></span>'}var tempNodeKeyName=node.key;var tempNodeValueName=node.value;var filteredKeyText=$filter("nbHighlight")(tempNodeKeyName,trvw.locationQuery);filteredValueText=$filter("nbHighlight")(tempNodeValueName,trvw.locationQuery);return'<span class="property-name" title="'+node.key+'">'+filteredKeyText+': </span><span class="property-value tree-property-value-style" title="'+node.value+'">'+filteredValueText+"</span>"}tempNodeName=node[$scope.NODE_NAME_KEY];return"<span>"+(filteredValueText=$filter("nbHighlight")(tempNodeName,trvw.locationQuery))+"</span>"},childrenAttribute:"children",iconTemplate:function(node,trvw){},nodeClickCallback:function(node,trvw,event){$(event.target).hasClass("sdn-details-property-table-view")&&$scope.openTableView(node)}};$scope.viewMoreMaps=function(){$scope.showViewMoreMaps=!1;$scope.currentNode.mapsInfo.cur.mapsInfo.push.apply($scope.currentNode.mapsInfo.cur.mapsInfo,$scope.currentNode.mapsInfo.other.mapsInfo);$scope.currentNode.mapsInfo.other.mapsInfo.splice(0,$scope.currentNode.mapsInfo.other.mapsInfo.length);$scope.currentNode.mapsInfo.other.pending>0&&!unWatchViewMoreMaps&&(unWatchViewMoreMaps=$scope.$watch((function(){return $scope.currentNode.mapsInfo.other.mapsInfo.length+$scope.currentNode.mapsInfo.other.pending}),(function(){$scope.currentNode.mapsInfo.cur.mapsInfo.push.apply($scope.currentNode.mapsInfo.cur.mapsInfo,$scope.currentNode.mapsInfo.other.mapsInfo);$scope.currentNode.mapsInfo.other.mapsInfo.splice(0,$scope.currentNode.mapsInfo.other.mapsInfo.length);if(0==$scope.currentNode.mapsInfo.other.pending){unWatchViewMoreMaps();unWatchViewMoreMaps=null}})))};$scope.previewInfo.close=function(){$scope.previewInfo.dialogId&&dialogService.close($scope.previewInfo.dialogId)};$scope.previewInfo.showPreview=function(map){$scope.previewInfo.close();$scope.previewInfo.pic=map.docPngList[0];$scope.previewInfo.map=map;$scope.previewInfo.netmap=$scope.currentNode.curNodeObj.netmap;$scope.previewInfo.title=map.docName;var Options={maxHeight:750,width:490,autoOpen:!1,modal:!1,resizable:!1,position:[1054,40],draggable:{containment:"parent",cancel:".nb-list-menu-directive"},classes:{"ui-dialog":"network-contextmap-img-prev"},close:function(){$scope.previewInfo.dialogId=null}};if(null==$scope.previewInfo.dialogId){$scope.previewInfo.dialogId=utilitySrvc.getGUID();dialogService.open($scope.previewInfo.dialogId,"contextMapPreview.html",{previewInfo:$scope.previewInfo},Options)}};$scope.previewInfo.openMap=function(map){map&&("none"!=map.selectAction.id?actionService.getAction(map.selectAction.id).then((function(action){if(action){if(action.runbookTemplate&&action.runbookTemplate.id){var mapId=map.ID?map.ID:map.mapId;var rbaId=action.runbookTemplate.id+"_"+$scope.node.contextId+"_"+$scope.node.id+"_"+mapId;httpRunBookService.getRunbookById(rbaId).then((function(rba){var createRunbook=!0;rba&&(createRunbook=!1);openMap(map,createRunbook,rbaId,action.runbookTemplate.id,null,null)}))}else openMap(map,null,null,null,null,null)}else nbAlertSrvc.error("the action "+map.selectAction.name+" is deleted. please refresh the context map node.")})):openMap(map))};function openMap(map,createRunbook,rbaId,runbookTemplateId,defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId){if(map.pageId||7==map.type)$scope.openOverviewMapPage(map,createRunbook,rbaId,runbookTemplateId,defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId);else if(0==map.type){var techViewId=$scope.selectedViewID;""==techViewId&&map.overviewMaps&&1==map.overviewMaps.length&&(techViewId=map.overviewMaps[0].objectTreeTemplateId);var extData={id:map.mapId,mapName:map.docName,nbPathSchema:$scope.currentNode.curNodeObj.nbPathSchema,nbPathValue:$scope.currentNode.curNodeObj.nbPathValue,overviewMaps:map.overviewMaps,techSpecViewId:techViewId};if(map.hasOwnProperty("parentSchema")&&""!=map.parentSchema){extData.nbPathSchema=map.parentSchema;extData.nbPathValue=map.parentPathValue}httpSdnSrvc.setMapExtData(extData).then((function(data){if("result"in data&&data.result){var op={id:map.mapId,mapType:NetBrain.Map.Const.MapType.visualSpaceOverViewMap,defaultSelectedDataViewGroupId:defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId:defaultSelectedDataViewTemplateId};if(createRunbook){op.createRunbook=!0;op.rbtId=templateId}rbaId&&(op.rba=rbaId);urlStateMgr.openMap(op)}}))}else{var drawData={actionData:{linkDataArray:map.linkDataArray,nodeDataArray:map.nodeDataArray},actionType:NetBrain.Common.Const.ActionType.DrawJson};mapManagerSrvc.setMapToCache(drawData.actionType,drawData).then((function(){var op={title:$scope.currentNode.curNodeObj.name+"_"+map.docName,urlKey:drawData.actionType,actionKey:drawData.actionType,isNewMap:!0,defaultSelectedDataViewGroupId:defaultSelectedDataViewGroupId,defaultSelectedDataViewTemplateId:defaultSelectedDataViewTemplateId};if(createRunbook){op.createRunbook=!0;op.rbtId=runbookTemplateId}rbaId&&(op.rba=rbaId);urlStateMgr.openMap(op)}))}$scope.previewInfo.close();$scope.$parent&&$scope.$parent.$parent&&$scope.$parent.$parent.ctrl&&$scope.$parent.$parent.ctrl.showPanel&&($scope.$parent.$parent.ctrl.isPanelPinned?$rootScope.$emit(SDNEvent.HIDE_RIGHTPANEL):$scope.$parent.$parent.ctrl.closePanel("byClick"))}$scope.onMouseOverSelectedAction=function(map,eventArg){var atag=eventArg.originalEvent.target.getAttribute("atag");"none"==map.selectAction.id||"nbDropdown:dropdownBtn"!=atag&&"nbDropdown:caretBtn"!=atag||(map.mouseEnterAction=!0)};function fillOverViewMap(mapInfo,mapPreviewData){mapInfo.page=angular.copy(mapPreviewData.page);mapInfo.selectAction=mapInfo.page.actions.length>1?mapInfo.page.actions[1]:mapInfo.page.actions[0];mapInfo.page.actions&&mapInfo.page.actions.length>0&&(mapInfo.page.actions[mapInfo.page.actions.length-1].lastNode||mapInfo.page.actions.push({lastNode:!0}))}$scope.showContextEditDialog=function(){$scope.$parent.$parent.ctrl.editContextDialog($scope.currentNode.curNodeObj,(function(){getContextDetails($scope.currentNode.curNodeObj)}))};$scope.mapAllContextDevices=function(){var lstDevice=[];$scope.currentNode&&$scope.currentNode.curNodeObj&&$scope.currentNode.curNodeObj.children&&_.forEach($scope.currentNode.curNodeObj.children,(function(item){lstDevice.push({id:item.key})}));var drawData={actionData:lstDevice,actionType:NetBrain.Common.Const.ActionType.DrawDevice};nbDragDropSrvc.drawDevice(drawData)};$scope.$on("$destroy",(function(){$scope.triggerSource="";updateSelectedNodeInformation();hideSelectedNodeInformation()}))}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").directive("nbLicenseDetailsDirective",(function(){return{restrict:"E",replace:!0,controller:licenseDetailsDirective,controllerAs:"licenseDetailsDir",template:'<span style="color:#0869a0; cursor:pointer;" ng-click="licenseDetailsDir.openLicenseDetalsPane()">License Details</span>'}}));licenseDetailsDirective.$inject=["$scope","$rootScope","$timeout","$log","$uibModal","nb.sdn.httpSdnSrvc","nb.uiframework.mainUISrvc","nb.qmap.mapManagerSrvc","nb.common.nbAlertSrvc","nb.common.nbDragDropSrvc","nb.ng.utilitySrvc","nb.uiframework.urlStateMgr","md5","nb.systemmodel.deviceTypeMgrSrvc","nb.admin.httpTenantAdminSrvc","$filter","$q","dialogService","nb.ng.userSrvc"];function licenseDetailsDirective($scope,$rootScope,$timeout,$log,$uibModal,httpSdnSrvc,mainUISrvc,mapManagerSrvc,nbAlertSrvc,nbDragDropSrvc,utilitySrvc,urlStateMgr,md5,deviceTypeMgrSrvc,httpTenantAdminSrvc,$filter,$q,dialogService,userSrvc){this.openLicenseDetalsPane=function(){$uibModal.open({templateUrl:"modules/nbUIFramework/views/nbLicenseDetails.html",controller:"nb.uiframework.nbLicenseDetailsController",backdrop:"static",resolve:{resolveData:function(){return{}}}}).result.then((function(result){}))}}}(NetBrain);!function(NetBrain){angular.module("nb.uiframework").directive("nbMainUi",(function(){controller.$inject=["$q","$timeout","$rootScope","$scope","$element","$attrs","nb.ng.utilitySrvc","nb.uiframework.initDataSrvc","nb.common.nbAlertSrvc","nb.uiframework.urlStateMgr","nb.ng.httpAuthSrvc","nb.ng.sessionSrvc","nb.ng.featureSrvc"];return{restrict:"EA",replace:!0,transclude:!0,scope:{settings:"=",licenseFeatureName:"@"},templateUrl:"modules/nbUIFramework/views/nbMainUIDirective.html",controller:controller,controllerAs:"ctrl",link:function(){}};function controller($q,$timeout,$rootScope,$scope,$element,$attrs,utilitySrvc,initDataSrvc,nbAlertSrvc,urlStateMgr,httpAuthSrvc,sessionSrvc,featureSrvc){$scope.ctrl.initDataSrvc=initDataSrvc;featureSrvc.featureCheck($scope.licenseFeatureName).then((function(){}),(function(){nbAlertSrvc.error("There is no proper license to open the page.").then((function(){var redirectUrl=httpAuthSrvc.getLoginRedirectUrl();location.href=redirectUrl&&""!==redirectUrl?redirectUrl:"desktop.html"}))}));(function(){if(!NetBrain.Page.IsDomainCheck||!httpAuthSrvc.isLoggedIn())return ignoreDomainCheck();var query=urlStateMgr.getUrlMap();var destTenantId=query.t;var destDomainId=query.d;if(!destDomainId)return ignoreDomainCheck();var currTenantId=sessionSrvc.getSelectedTenantId();var currDomainId;var domainIds=sessionSrvc.getSelectedDomainIds();domainIds.length>0&&(currDomainId=domainIds[0]);if(destDomainId===currDomainId)return ignoreDomainCheck();var currDomainInfo;var destDomainInfo;return httpAuthSrvc.getDomainsInfo(currDomainId,destDomainId).then((function(domains){currDomainInfo=domains.current;destDomainInfo=domains.destn;return 1===destDomainInfo.status?function(){if(!destDomainId||currDomainId===destDomainId)return resolveTrue();var needConfirm=!utilitySrvc.getLoginSignReadOnce();!0===window.isInIframe&&(needConfirm=!1);if(needConfirm&&currDomainInfo.domain)return nbAlertSrvc.confirm({message:(fromDomainName=currDomainInfo.domain.name,toDomainName=destDomainInfo.domain.name,"The file isn't located in the current domain \""+fromDomainName+'". Do you want to switch your domain from "'+fromDomainName+'" to "'+toDomainName+'" to open the file?'),title:"Warning",iconType:NB_ICON_WARNING}).then((function(){changedDomain();return!0}),(function(){closePage()}));var fromDomainName,toDomainName;changedDomain();return resolveTrue()}():nbAlertSrvc.error({message:0===destDomainInfo.status?"You cannot open the file because the domain where the file is located doesn't exist anymore.":2===destDomainInfo.status?'You cannot open the file, because it is located in another domain "'+(destDomainInfo.domain&&destDomainInfo.domain.name||destDomainId)+"\" and you don't have access to the domain.":"unknow error"}).then((function(){closePage()}))})).catch((function(err){console.error("getDomainsInfo:",err);var message=err&&err.ResultDesc||JSON.stringify(err);return nbAlertSrvc.error(message).then((function(){closePage()}))}));function changedDomain(){var domainIds2=[destDomainId];httpAuthSrvc.setSelectedDomainIds(domainIds2);if(destTenantId!==currTenantId){httpAuthSrvc.setSelectedTenantId(destTenantId);!function(tenantId,domainIds){$rootScope.$emit(systemEvent.changedTenant,{selectedTenantGuid:tenantId,selectedDomainGuids:domainIds})}(destTenantId,domainIds2)}!function(tenantId,domainIds){$rootScope.$emit(systemEvent.changedDomain,tenantId,domainIds)}(destTenantId,domainIds2)}})().then((function(valid){$scope.validInit=valid;!function(){$(".main-ui-maximum").length>0&&(NetBrain.Page.MainUIMaximum=!0);$timeout((function(){$rootScope.$emit(systemEvent.initHeader)}));$(document).on("keydown",(function(e){if(27===(e=window.event||e).keyCode){NetBrain.Page.MainUIMaximum=!1;angular.element("body").removeClass("main-ui-maximum")}}));$rootScope.$on(viewFrameEvent.Maximize,(function(){NetBrain.Page.MainUIMaximum=!0;angular.element("body").addClass("main-ui-maximum")}));$rootScope.$on(viewFrameEvent.Minimize,(function(){NetBrain.Page.MainUIMaximum=!1;angular.element("body").removeClass("main-ui-maximum")}));$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(){$rootScope.$emit(viewFrameEvent.Minimize,"panel")}));$rootScope.$on(viewFrameEvent.pinTopPanel,(function(event,isPinned){if("pinned"===isPinned||"unPinned"===isPinned){var mainSidePane=$element.find(".main-side-pane");$timeout((function(){mainSidePane.css("display","block");$timeout((function(){mainSidePane.css("display","")}),0)}),0)}}));var monitorResizeable=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(){$(".main-side-pane>div.ui-resize-enabled").each((function(i){var minWidth=705;var maxWidth=void 0;var div=$(this);var m1=div.data("resizeMinWidth");angular.isNumber(m1)&&(minWidth=m1);var m2=div.data("resizeMaxWidth");angular.isNumber(m2)&&(maxWidth=m2);div.resizable({handles:"e",minWidth:minWidth,maxWidth:maxWidth})}));monitorResizeable()}))}()}));function ignoreDomainCheck(){return resolveTrue()}function resolveTrue(){return $q.resolve(!0)}function closePage(){window.close()}}}))}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopActionManagerPanelDirective",TopActionManagerPanelDirective);TopActionManagerPanelDirective.$inject=[];function TopActionManagerPanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopActionManagerPanelDirective.html"};controller.$inject=["$scope","$rootScope"];function controller($scope,$rootScope){var self=$scope;self.showTopDashboardPanel=!1;self.isPanelPinned=!1;self.closeActionManagerPanel=function(byClick){self.showTopActionManagerPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.refreshActionManager=function(){self.$broadcast(viewFrameEvent.refreshActionManager)};self.pinActionManagerPanel=function(){if(!self.isPanelPinned){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned")}};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type){if("action"===type){self.showTopActionManagerPanel=!0;event.stopPropagation()}else self.isPanelPinned&&void 0===type||self.closeActionManagerPanel()}));self.$on("$destroy",(function(){togglePanelWatcher()}))}return service}}(NetBrain);!function(){angular.module("nb.uiframework").directive("nbTopOneIpTablePanelDirective",TopOneIpTablePanelDirective);TopOneIpTablePanelDirective.$inject=[];function TopOneIpTablePanelDirective(){var service={restrict:"EA",scope:{},link:function(){},replace:!0,controller:controller,templateUrl:"modules/nbUIFramework/views/nbTopOneIpTablePanelDirective.html"};controller.$inject=["$scope","$rootScope","$timeout"];function controller($scope,$rootScope,$timeout){var self=$scope;self.showTopOneTableIpPanel=!1;self.isPanelPinned=!1;self.oneTableIpBrowserPanel={oneTableIpTitle:"One Table Ip",toolTip:"One Table Ip"};self.closeOneTableIpPanel=function(byClick){self.showTopOneTableIpPanel=!1;if(self.isPanelPinned){self.isPanelPinned=!1;$rootScope.$emit(viewFrameEvent.pinTopPanel,"unPinned")}$rootScope.$emit(viewFrameEvent.closePanel,byClick)};self.pinOneTableIpPanel=function(){self.isPanelPinned=!0;$rootScope.$emit(viewFrameEvent.pinTopPanel,"pinned")};self.init=function(){if(self.isTriggerToggleTopPanelEvent){self.searchData&&$rootScope.$emit("searchSite",{id:self.searchData.id});self.isTriggerToggleTopPanelEvent=!1}};self.setDeviceGroupTreeData=function(args){self.deviceGroupTreeData=args};self.getDeviceGroupTreeData=function(){return self.deviceGroupTreeData};var togglePanelWatcher=$rootScope.$on(viewFrameEvent.toggleTopPanel,(function(event,type,data){if(!self.isCloseing)if("oneIpTable"===type){self.searchData=data;self.showTopOneTableIpPanel=!0;self.isTriggerToggleTopPanelEvent=!0;$timeout((function(){if(self.searchData&&self.searchData.searchStr){self.oneTableIpBrowserPanel.toolTip=self.oneTableIpBrowserPanel.oneTableIpTitle;$rootScope.$emit("searchOneIpTable",self.searchData.searchStr)}}),500)}else if(!self.isPanelPinned||void 0!==type){if(data&&data.alwaysShow)return;self.isCloseing=!0;$timeout((function(){self.closeOneTableIpPanel();self.isCloseing=!1}),200)}}));self.refreshOneTableIpBrowser=function(){self.$broadcast(viewFrameEvent.refreshOneTableIpBrowser,"ss")};self.$on("$destroy",(function(){togglePanelWatcher()}))}return service}}(NetBrain);
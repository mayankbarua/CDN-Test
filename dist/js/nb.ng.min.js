!function(NetBrain){var consts=NetBrain.ns("NG.Const");consts.NS_NAME="nb.ng";consts.iconImagePath="img/icon/";consts.valiteFileNameReg=/[\\\/:*?"<>|.$]/;consts.valiteFileNameRegTip='\\ / : * ? " < > | . $';consts.valiteNodeNameReg=/[~`!@#$%^&*+=,.<>?/;:"'|\\{}\[\]]/;consts.generalForbidChars=/[\\/:*?"<>|]/;consts.generalForbidCharsTip='\\/:*?"<>|';consts.generalForbidWindowsAndMongoChars=/[\\/:*?"<>|.$]/;consts.generalForbidWindowsAndMongoCharsTip='\\/:*?"<>|.$';consts.ServiceMonitorUserType="service_monitor_usertype";consts.PageType={Desktop:"Desktop",Map:"Map",Dashboard:"Dashboard",InventoryReport:"InventoryReport",ApplicationFlowManage:"ApplicationFlowManage",ApplicationManager:"ApplicationManager",Parser:"Parser",DataViewManager:"DataViewManager",DataViewTemplate:"DataViewTemplate",DashboardManager:"DashboardManager",ApiStubManager:"ApiStubManager",VisualSpaceManager:"VisualSpaceManager",ApiMapLink:"ApiMapLink",QappScheduler:"QappScheduler",EventConsole:"EventConsole",RunBook:"Runbook",ChangeMgmtTplEditor:"ChangeMgmtTplEditor",QappEditor:"Qapp",DomainAdmin:"DomainAdmin",TenantAdmin:"TenantAdmin",SystemAdmin:"SystemAdmin",VariableMapping:"VariableMapping",QappGroup:"QappGroup",OneIpTable:"OneIpTable",EndSystem:"EndSystem",ChangeAnalysisReport:"ChangeAnalysisReport",SPOG:"SinglePanelofGlassURL",GoldenBaselineManager:"GoldenBaselineManager"};consts.CacheLevel={Global:"Global",Tenant:"Tenant",Domain:"Domain",Memory:"Memory"};consts.StoreCategory={ConfigFile:"ConfigFile",SiteInfo:"SiteInfo",InterfaceInfo:"InterfaceInfo",DesignReader:"DesignReader"};consts.LicenseModuleType={Essential:"Essential",ChangeMgmt:"ChangeManagement",Automation:"Automation",SDN:"SDN",AAM:"AAM"};consts.nbFeatures={Site:{name:"Site",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},Network:{name:"Network",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},DeviceGroup:{name:"DeviceGroup",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},PathBrowser:{name:"PathBrowser",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},InventoryReport:{name:"InventoryReport",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},DataViewTemplate:{name:"DataViewTemplate",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},DataView:{name:"DataView",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},Map:{name:"Map",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},ParserLibrary:{name:"VariableMapping",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},VariableMapping:{name:"Network",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},Files:{name:"Files",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},OneIpTable:{name:"OneIpTable",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},TaskManager:{name:"TaskManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},ChangeAnalysisReport:{name:"ChangeAnalysisReport",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},DeviceDetailRetrieve:{name:"DeviceDetailRetrieve",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},DeviceDetailCompare:{name:"DeviceDetailCompare",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},RunbookTemplate:{name:"RunbookTemplate",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},Runbook:{name:"Runbook",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},RunbookActionManager:{name:"RunbookActionManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},ContextActionManager:{name:"ContextActionManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Essential},ContextActionManagerAutomation:{name:"ContextActionManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},Qapp:{name:"Qapp",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},Gapp:{name:"Gapp",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},SystemAutomationManager:{name:"SystemAutomationManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},APIManager:{name:"APIManager",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},TunePrivate:{name:"TunePrivate",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},TelnetSSH:{name:"TelnetSSH",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},Crawl:{name:"Crawl",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},PathLive:{name:"PathLive",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},Dashboard:{name:"Dashboard",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},NetworkChange:{name:"NetworkChange",licenseModule:NetBrain.NG.Const.LicenseModuleType.ChangeMgmt},QappScheduler:{name:"QappScheduler",licenseModule:NetBrain.NG.Const.LicenseModuleType.Automation},AAM:{name:"AAM",licenseModule:NetBrain.NG.Const.LicenseModuleType.AAM}}}(NetBrain);var MultiTabEvent={switchTab:"onSwitchTab",closeRelogin:"onCloseRelogin",tabLogOut:"onTabLogOut"};var licenseEvent={licenseActivated:"onLicenseActivated",licenseUnbinded:"onLincenseUnbinded",tenantMaxSeatChanged:"onTenantMaxSeatChanged",licenseInvalid:"onLicenseInvalid",activateLicense:"onActivateLicense",licenseRefreshed:"onLicenseRefreshed"};var viewFrameEvent={toggleTopPanel:"onToggleTopPanel",pinTopPanel:"onPinTopPanel",viewStateChange:"onViewStateChange",refreshBrowseContent:"refreshBrowseContent",previewRefresh:"previewRefresh",refreshDeviceBrowser:"refreshDeviceBrowser",refreshApplicationFlowBrowser:"refreshApplicationFlowBrowser",refreshActionManager:"refreshActionManager",closePanel:"closePanel",Maximize:"Maximize",Minimize:"Minimize"};var mapEvent={newQmap:"onNewQmap",saveOp:"onSaveQmap",saveASOp:"onSaveAsQmap",openOp:"onOpenQmap",duplicateOp:"onDuplicateQmap",closeQmap:"onCloseQmap",closeAllQmap:"onCloseAllQmap",deleteQmap:"onDeleteQmap",deletePage:"onDeletePage",mapVisualSpaceChanged:"onMapVisualSpaceChanged"};var netMapEvent={netMapDoAction:"netMapDoAction",changeMapStyle:"onChangeMapStyle",setZoomStep:"onSetZoomStep",setZoom:"onSetZoom",changeZoomBar:"onChangeZoomBar",addDevicesFromSearchResult:"onAddSearchDevices",searchResultPanelOpen:"onSearchResultOpen",applyDataViews:"onApplyDataViews",enterDataViewEdit:"onEnterDataViewEditMode",leaveDataViewEdit:"onLeaveDataViewEditMode",displayOverflowData:"onDisplayOverflowData",closeOverflowDialog:"onCloseOverflowDialog",closeFloatMenuBtn:"onCloseFloatMenuBtn",doSearch:"doSearch",openPathPane:"openPathPaneFromMap",openPathPaneWithEmbedMap:"openPathPaneWithEmbedMap"};var docMgrEvent={docNew:"onDocNew",taskNew:"onTaskNew",mapNew:"onMapNew",pageNew:"onPageNew",newDocSave:"onNewDocSave",DocSync:"onDocSync",docSave:"onDocSave",taskSave:"onTaskSave",mapSave:"onMapSave",pageSave:"onPageSave",docRemove:"onDocRemove",taskRemove:"onTaskRemove",mapRemove:"onMapRemove",pageRemove:"onPageRemove",docRename:"onDocRename",taskRename:"onTaskRename",mapRename:"onMapRename",pageRename:"onPageRename",docDelete:"onDocDelete",taskDelete:"onTaskDelete",mapDelete:"onMapDelete",pageDelete:"onPageDelete",docActive:"onDocActive",docInternalActive:"onDocInternalActive",closeAllDoc:"close All doc"};var applyDataViewEvent={applyDataView:"onApplyDataView",applyDataViewGroup:"onApplyDataViewGroup"};var compareEvent={showTextDetailPane:"showTextDetailPane",showTableDetailPane:"showTableDetailPane"};var browseEvent={docNew:"onNewBrowseTreeLeaf"};var pagePaneEvent={closePane:"onClosePane",hideTip:"hideTip"};var previewEvent={init:"onInit",changeTitle:"onChanageTitle",showInterfacesOnMap:"onShowInterfacesOnMap",drawTopo:"onDrawTopo"};var pathBrowerEvent={refreshPathBrowerPane:"onRefreshPathBrowerPane"};var deviceDetailEvent={openFullView:"onOpenFullView",closeFullView:"onCloseFullView",refreshDetailPane:"onRefreshDetailPane",reloadInterfaceTable:"onReloadInterfaceTable",reloadModuleTable:"onReloadModuleTable",reloadDeviceProperty:"onReloadDeviceProperty",propertyTabLoaded:"onPropertyTabLoaded",initCompareDivDateTimePicker:"onInitCompareDivDateTimePicker",initCompareDivNctShowCommandFilter:"onInitCompareDivNctShowCommandFilter",openFullViewContent:"openFullViewContent",updateDeviceNote:"updateDeviceNote"};var systemEvent={changedTenant:"onChangedTenant",changedDomain:"onChangedDomain",editedDomain:"onEditedDomain",updateCMGridLicense:"updateCMGridLicense",browserF5Click:"onBrowserF5Click",initHeader:"onInitHeader",clearTabBar:"onClearTabBar",deviceSchemaChanged:"onDeviceSchemaChanged",mainSessionTimeout:"mainSessionTimeout",systemSessionTimeout:"systemSessionTimeout",mainSessionRefresh:"mainSessionRefresh",systemSessionRefresh:"systemSessionRefresh",userDeleted:"userDeleted",databaseError:"databaseError",deleteProxyServer:"deleteProxyServer"};var dySearchEvent={getResult:"onGetResult",addDyDevsToDG:"onAddDynamicDevicesToDeviceGroup",closeDySearch:"onCloseDySearch"};var adminEvent={openStartPage:"onOpenStartPage",openSharePolicy:"onOpenSharePolicy",closeSharePolicy:"onCloseSharePolicy",openDeviceAccessPolicy:"openDeviceAccessPolicy",openNetworkSetting:"onOpenNetworkSetting",openTuneLiveAccess:"onOpenTuneLiveAccess",openTuneLiveAccessPrivate:"onOpenTuneLiveAccessPrivate",onCMSetting:"onCMSetting",openWorkspaceManager:"onOpenWorkspaceManager",openDiscover:"onOpenDiscover",scheduleTask:"onScheduleTask",crawlManager:"onCrawlManager",updateMapManager:"onUpdateMapManager",openDoNotScan:"onDoNotScanTabOpened",openNetworkDef:"onNetworkDefOpened",openExternalAPIServerDef:"onExternalAPIServerDefOpened",openSiteManager:"onSiteManager",openSnapshot:"openSnapshot",openDataFolder:"openDataFolder",rollbackData:"onRollbackData",unknownEndSystem:"onUnknownEndSystem",topoLinkStatus:"onTopoLinkStatus",duplicatedIPSubnet:"onDuplicatedIPSubnet",systemOptions:"onSystemOptions",desktopProfile:"onDesktopProfile",reloadMPLSCloud:"onReloadMPLSCloud",deleteDeviceFromWorkspace:"deleteDeviceFromWorkspace",saveSharePolicy:"onSaveSharePolicy",opsecManager:"onOpsecManager",refreshUnknownIp:"refreshUnknownIp",refreshUnknownIpOther:"refreshUnknownIpOther",refreshUnknownIpUserName:"refreshUnknownIpUserName",refreshUnknownIpPrivilege:"refreshUnknownIpPrivilege",externalAPIServerLoaded:"onExternalAPIServerLoaded",onDataEngineCleanSetting:"onDataEngineCleanSetting",onDefinePathAdditionalSetting:"onDefinePathAdditionalSetting",onChangeAnalysisSetting:"onChangeAnalysisSetting",openAnsibleAgentManager:"openAnsibleAgentManager",openPluginManager:"openPluginManager",openGatewayMapping:"openGatewayMapping",selectDiscoveryFromStartPage:"selectDiscoveryFromStartPage",selectFineTuneFromStartPage:"selectFineTuneFromStartPage",selectSiteManagerFromStartPage:"selectSiteManagerFromStartPage",selectScheduleTaskFromStartPage:"selectScheduleTaskFromStartPage"};var dataViewManagerEvent={dataViewGroupSelected:"onDataViewGroupSelected",devicePropertyOverflowSelected:"onDevicePropertyOverflowSelected",deviceCellPropertyUpdated:"onDeviceCellPropertyUpdated",deviceRowPropertyUpdated:"onDeviceRowPropertyUpdated",deviceInterfaceSelected:"onDeviceInterfaceSelected",deviceInterfaceOverflowSelected:"onDeviceInterfaceOverflowSelected",deviceInterfaceUpdated:"onDeviceInterfaceUpdated",dataViewCompoundSelected:"onDataViewCompoundSelected",switchToUpdateRecordsTab:"onSwitchToUpdateRecordsTab",lastUpdateDate:"onLastUpdateDate",setUpdateRecords:"setUpdateRecords"};var sysManagementEvent={addTenantSuccess:"onAddTenantSuccess",updateTenantSuccess:"onUpdateTenantSuccess",deleteTenantSuccess:"onDeleteTenantSuccess",passwordPolicyChanged:"onPasswordPolicyChanged",userAddedSucess:"onUserAddedSucess",userModifiedSucess:"onUserModifiedSucess",userDeletedSucess:"onUserDeletedSucess",initialTenantCreatedSucess:"onInitialTenantCreatedSucess",setDefaultAdminTabActive:"setDefaultAdminTabActive"};var deviceBrowserEvent={siteNodeSelected:"onSiteNodeSelect",deviceGroupNodeSelected:"onDeviceGroupNodeSelected",deviceGroupUpdated:"onDeviceGroupUpdated",deviceManagementPermissionChanged:"deviceManagementPermissionChanged",deviceDeleted:"deviceDeleted",mediaDeleted:"onMediaDeleted"};var zoneManagerEvent={zoneSelected:"onZoneSelected",addZone:"onAddZone",updateZoneCompleted:"onUpdateZoneCompleted",refreshZoneTree:"onRefreshZoneTree"};var topoLinkTypeManagerEvent={blockedTopoLinkUpdate:"onBlockedTopoLinkUpdate",lockedTopoLinkUpdate:"onLockedTopoLinkUpdate",topoLinkStatusUpdate:"onTopoLinkStatusUpdate",manualTopoLinkUpdate:"onManualTopoLinkUpdate",manualTopoLinkRemove:"onManualTopoLinkRemove"};var dataViewTemplateEvent={dataViewTemplateSave:"dataViewTemplateSave",dataViewTemplateParserSelected:"dataViewTemplateParserSelected",dataViewTemplateDataRefreshed:"dataViewTemplateDataRefreshed",dataViewTemplateSaveAs:"dataViewTemplateSaveAs",runDataViewTemplateFinish:"runDataViewTemplateFinish",runDataViewTemplateDialogOpened:"runDataViewTemplateDialogOpened",runDataViewTemplateStarted:"runDataViewTemplateStarted",runDataViewTemplateDialogClosedByEscKey:"runDataViewTemplateDialogClosedByEscKey",dataViewTemplateParserDeviceNoteSelected:"dataViewTemplateParserDeviceNoteSelected",dataViewTemplateChangeNodeType:"dataViewTemplateChangeNodeType",dataViewTemplateChangeIntfType:"dataViewTemplateChangeIntfType",updateTemplateDataByNoteType:"updateTemplateDataByNoteType",switchTemplateSettingType:"switch-template-setting-type",updateTemplateSetting:"update-template-setting"};var commonUiEvent={nbGridDropdownToggle:"nbGridDropdownToggle"};var MonitorEvent={TASK_DEF_MODAL_STEP_CHANGED:"TASK_DEF_MODAL_STEP_CHANGED",TASK_DEF_FINISH:"TASK_DEF_FINISH",TASK_CARD_RIGHT_CLICK:"TASK_CARD_RIGHT_CLICK"};var RunBookEvent={MINI_TASK_ACTIVITY_UPDATED:"RBA.miniTaskActivityUpdated",MINI_TASK_DELETE_ALOG:"MiniTask.onDeleteAlog",CONTROL_PANE_STARTED:"CONTROLPANE_START",SWITCH_RBA:"switch_rba",TOGGLE_RBA_PANEL:"toggle_rba_panel",CREATE_RBA:"create_rba",HIDE_RUNBOOK:"hide_runbook",OPEN_RBA:"open_rba",DELETE_RBA:"delete_rba",NOTE_CHANGE:"note_change",NODE_NOTE_CHANGE:"node_note_change",RUNBOOK_REMOVE_TAB:"runbook_remove_tab",MAP_RBA_NUMBER_CHANGE:"map_rba_number_change",VIEW_RESULT:"view_rba_result",OpenNodeResult:"OpenNodeResult",DELETE_RESULT_TAB:"delete_result_tab",IS_RBA_RUNNING:"is_rba_running",QAPP_TASK_STOPPED:"qapp_task_stopped",DELETE_NODE:"delete_node",SWITCH_DOCUMENT_PANE:"SWITCH_RBA_DOCUMENT_PANE",RBA_PANEL_READY:"RBA_PANEL_READY",CM_DELETED:"CM_DELETED",TASK_NODE_CHANGED:"task_node_changed",SHOW_RUNBOOK_DETAIL:"show_runbook_detail",SHOW_RUNBOOK_DETAIL_BY_ID:"show_runbook_detail_by_id",CREATE_EMPTY_RUNBOOK:"CREATE_EMPTY_RUNBOOK",FULL_VIEW:"rb_full_view",UN_CHECK_THE_RESULT:"un-check-the-result",TO_SELECT_MODE:"to_select_mode",LOAD_ACTIVITIES:"runbook-load-activities",SHARE_RUNBOOK:"share-runbook",HANDLE_FLOWCHAR_NODE:"handle-flowchar-node",NETWORK_CHANGE_COMPLETED:"network_change_completed",NETWORK_CHANGE_START:"network_change_start",NETWORK_CHANGE_UPDATE:"network_change_update",NETWORK_CHANGE_PAUSE:"network_change_pause",UPDATE_RUNBOOK_ACTIVITIES:"update_runbook_activities",RunbookNodeSelected:"RunbookNodeSelected",AddActionToRunbook:"add-action-to-runbook",CleartRunbookNodeSelected:"CleartRunbookNodeSelected",CleartRunbookNodeChecked:"CleartRunbookNodeChecked",RunbookPanelToggleFullView:"RunbookPanelToggleFullView",SelectRunbookNodeResult:"SelectRunbookNodeResult",SelectRunbookTargetNodes:"select-runbook-target-nodes",RemoveSelectRunbookTargetNodesOption:"remove-select-runbook-target-nodes-option",ActionLogChanged:"actionLogChanged",SaveAsRunbookMode:"SaveAsRunbookMode",RefreshRunbookList:"RefreshRunbookList",RefreshRunbook:"RefreshRunbook",UpdateRunbookNodeName:"ChangeRunbookNodeName",RefreshRunbookDetail:"RefreshRunbookDetail",AddActionToDefaultRunbook:"add-action-to-defualt-runbook",AddRunbookNodeSuccessfully:"add-runbook-node-successfully",SelectedRunbookNodeAndResult:"SelectedRunbookNodeAndResult",SelectedRunbookResult:"SelectedRunbookResult",AppendRbtActionToRunbook:"append-rbt-action-to-defualt-runbook",AppendRbtActionToRunbookAfter:"append-rbt-action-to-defualt-runbook-after",AutoSaveRunbook:"AutoSaveRunbook"};var SDNEvent={HIDE_SDN:"hide_sdn",SELECT_NODE:"select_node",FIND_NODE:"find_node",SELECT_PRE_MATCH_NODE:"select_pre_match_node",SELECT_NEXT_MATCH_NODE:"select_next_match_node",HIGHLIGHT_NODE:"highlight_node",COUNT_RESULT:"count-result",RELOAD_TREETAMPLATE:"reload_treeTemplate",DISPLAY_RIGHTPANEL:"display_rightPanel",HIDE_RIGHTPANEL:"hide_rightPanel",DISPLAY_SETTINGPANEL:"display_settingPanel",DISPLAY_NODEPANEL:"display_nodePanel",RELOAD_CATEGOTYTREE:"reload_categoryTree",RELOAD_TREEData:"reload_treedata",RESET_CACHEDTREENODES:"reset_cachedtreenodes",LAUNCH_NETWORKTREE_FROM_GLOBALSEARCH:"launchNetworkTreeFromGlobalSearch",LAUNCH_GLOBALENDPOINT_FROM_GLOBALSEARCH:"launchGlobalEndpointFromGlobalSearch",BENCHMARK_CLEAR_ALL_CONTROLLER_SELECTION:"benchmark_clear_all_controller_selection"};var MapTabEvent={SHOW_QAPP_INSTANCE:"show_qapp_instance",REMOVE_TAB:"remove_tab",OPEN_TAB:"open_tab",MAX_PANEL:"max_panel",MIN_PANEL:"min_panel",OPEN_FROM_OUTSIDE:"map_tab_open",TEST_EVENT_MSG:"TEST",OPEN_RBA_TAB:"open_rba_tab",OPEN_INSTANTRUNBOOK_TAB:"open_instantRunbook_tab",Min_TAB_OUTSIDE:"min_tab_outside",Max_TAB_OUTSIDE:"max_tab_outside",Init_Select_Default_DataView:"init_select_default_dataview"};var MapLeftPaneEvent={CLOSE_QAPP_INSTANCE_PANE:"CLOSE_QAPP_INSTANCE_PANE"};var MapLayoutEvent={CLOSE_MAP_LAYOUT:"close_map_layout"};var ConsolePaneEvent={REFRESH_DATA_VIEW_CONSOLE_PANE:"refresh_data_view_console_pane",REFRESH_DATA_VIEW_CONSOLE_PANE_TITLE:"refresh_data_view_console_pane_title"};var DataViewEnent={REFRESH_DATAVIEW_LIST:"refreshDataViewList",REFRESH_DATAVIEW_LIST_ONLY_DATA:"refreshDataViewListOnlyData"};var MiniTaskEvent={RUN_BOOK:1,ChangeMgmt:2};var SystemAutomationEvent={LICENSE_EXPIRED:"api_stub_expired"};var UserEvent={RELOGIN:"relogin"};var enumFunction_Appliance_Management=0;var enumFunction_L2_Topology_Management=1;var enumFunction_Live_Network_Discovery=2;var enumFunction_Benchmark=3;var enumFunction_Common_Device_Setting_Management=4;var enumFunction_Configuration_File_Management=5;var enumFunction_Topology_Stitching_Management=6;var enumFunction_Traffic_Stitching_Management=7;var enumFunction_Device_Group_Management=8;var enumFunction_Local_Simulation=9;var enumFunction_Local_Documentation=10;var enumFunction_Local_Live_Network_Discovery=11;var enumFunction_Local_Advance_Troubleshooting=12;var enumFunction_Advance_Troubleshooting=13;var enumFunction_Documentation=14;var enumFunction_Local_Monitor=15;var enumFunction_Monitor=16;var enumFunction_Local_Path=17;var enumFunction_Path=18;var enumFunction_LinkGroup=19;var enumFunction_Site=20;var enumFunction_SharedMap=21;var enumFunction_Update_Shared_Map=22;var enumFunction_Design_Module=23;var enumFunction_DeviceIcon=24;var enumFunction_ShowCommand_Template=25;var enumFunction_Live_Access=26;var enumFunction_Shared_Device_Settings=27;var enumFunction_Define_Change_Management=28;var enumFunction_Execute_Change_Management=29;var SearchTypes={ALL:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],DEVICES:[0],MAPTASKS:[1],QAPPS:[2],DOCS:[3],NETWORKSEGMENT:[4],SITE:[5],DEVICEGROUP:[6],PATH:[7],DASHBOARD:[8],CONFIGURATION:[9],SDN:[10]};var SearchScope={ALLDEVICES:0,SITE:1,DEVGROUPS:2};var SearchSortType={RELEVANCE:0,NAMEASC:1,NAMEDES:2};!function(NetBrain){NetBrain.ns("NG").LocalStorageDefine={nbuserId:{mainUi:"mainUi.token",system:"system.token"},nbEmbedMapId:{mainUi:"embedmap.mainUi.token",system:"embedmap.system.token"},userObj:"userObj",newTabTenantDomainId:"onNewTabTenantDomainId",IS_REDIRECT_FROM_NB_TAB:"nb_is_redirect_tab",selectedTenantGuid:"nb_selectedTenantGuid",selectedDomainGuids:"nb_selectedDomainGuids",DOMAIN_MGT_TENANT_ID:"nb_domain_mgt_tenantGuid",DOMAIN_MGT_DOMAIN_IDS:"nb_domain_mgt_domainGuids",LOGIN_REDIRECT_URL:"nb_redirect_url",LOGIN_FAILURE_REDIRECT_URL:"nb_login_failure_redirect_url",LOGIN_FAILURE_ERROR:"nb_login_failure_Error",userPermissions:{mainUi:"mainUi.user.permissions",system:"system.user.permissions"},loginUserName:{mainUi:"mainUi.user.userName",system:"system.user.userName"},loginAuth:{mainUi:"mainUi.user.authentication",system:"system.user.authentication"},RECENT_PAGES:"recent_pages",MultiTab_EVENT_Trigger:"multitab_event_trigger",SWITCH_SERVICEMONITOR_USETTYPE:"switch_sm_user",LICENSE_MODULE:"license_module"}}(NetBrain);!function(NetBrain){NetBrain.ns("NG").ErrorMsg={0:{Id:"OK",Message:"OK"},100001:{Id:"SC_WRONG_API_SPECIFIED",Message:"Incorrect or non-existing API."},100002:{Id:"SC_UNAUTHORIZED",Message:"Unauthorized access is denied"},100003:{Id:"SC_NO_SESSION_COOKIE",Message:"No session cookie identified"},100004:{Id:"SC_BAD_JSON_OBJECT",Message:"Incorrect Json data format."},100005:{Id:"SC_NO_DATA_FOUND",Message:"The data is not found."},100006:{Id:"SC_EXCEPTION",Message:"Status is missing."},100007:{Id:"SC_DB_ERROR",Message:"DataBase Error"},100015:{Id:"SC_USERNAME_PASSOWRD_INCORRECT",Message:"The username or password is incorrect."},100020:{Id:"SC_PASSWORD_EXPIRED",Message:"The user password has expired."},100021:{Id:"SC_USER_ACCOUNT_EXPIRED",Message:"The user account has expired."},100022:{Id:"SC_NO_USER",Message:"The user is not found."},100023:{Id:"SC_NO_PERMISSION_LOGIN",Message:"The user is not found."},100024:{Id:"SC_NO_PERMISSION_TENANT_DOMAIN",Message:"The user does not have privileges to access the tenant or domain."},100025:{Id:"SC_NO_DOMAIN",Message:"The user does not have privileges to create domains."},100026:{Id:"SC_NO_TENANT",Message:"The user does not have access to the tenant."},100090:{Id:"SC_SAMEUSER_DIFFERENT_DEVICE",Message:"This user account is already logged in from other machines."}}}(NetBrain);!function(NetBrain){NetBrain.ns("NG").Permissions={getRelevantPermission:function(permissionId,isChecked){return function(permissionId,isChecked){if(isChecked)return function(permissionId){var Permissions=NetBrain.ns("NG").Permissions;switch(permissionId){case Permissions.domainMgmt:return[];case Permissions.sharePolicyMgmt:return[Permissions.domainMgmt];case Permissions.deviceMgmt:case Permissions.sharedResourceManagement:case Permissions.variableMappingManagement:return[];case Permissions.siteManagement:return[Permissions.domainMgmt];case Permissions.discoverTuneNetworkDevice:return[Permissions.domainMgmt,Permissions.manageDeviceSettings,Permissions.manageNetworkSettings,Permissions.accessToLiveNetwork];case Permissions.scheduleBenchmark:return[Permissions.domainMgmt,Permissions.accessToLiveNetwork];case Permissions.manageNetworkSettings:return[Permissions.domainMgmt,Permissions.manageDeviceSettings,Permissions.accessToLiveNetwork];case Permissions.executeNetworkChange:return[Permissions.domainMgmt,Permissions.deviceManagement,Permissions.discoverTuneNetworkDevice,Permissions.manageNetworkSettings,Permissions.manageDeviceSettings,Permissions.accessToLiveNetwork,Permissions.viewNetworkChange];case Permissions.createNetworkChange:case Permissions.approveNetworkChange:return[Permissions.viewNetworkChange];case Permissions.manageDeviceSettings:return[Permissions.accessToLiveNetwork];case Permissions.accessToLiveNetwork:default:return[]}}(permissionId);return function(permissionId){var Permissions=NetBrain.ns("NG").Permissions;switch(permissionId){case Permissions.domainMgmt:return[Permissions.sharePolicyMgmt,Permissions.siteManagement,Permissions.discoverTuneNetworkDevice,Permissions.scheduleBenchmark,Permissions.manageNetworkSettings,Permissions.executeNetworkChange];case Permissions.sharePolicyMgmt:return[];case Permissions.deviceMgmt:return[Permissions.executeNetworkChange];case Permissions.sharedResourceManagement:case Permissions.variableMappingManagement:case Permissions.siteManagement:return[];case Permissions.discoverTuneNetworkDevice:return[Permissions.executeNetworkChange];case Permissions.scheduleBenchmark:return[];case Permissions.manageNetworkSettings:return[Permissions.discoverTuneNetworkDevice,Permissions.executeNetworkChange];case Permissions.manageDeviceSettings:return[Permissions.discoverTuneNetworkDevice,Permissions.manageNetworkSettings,Permissions.executeNetworkChange];case Permissions.accessToLiveNetwork:return[Permissions.discoverTuneNetworkDevice,Permissions.scheduleBenchmark,Permissions.manageNetworkSettings,Permissions.manageDeviceSettings,Permissions.executeNetworkChange];case Permissions.viewNetworkChange:return[Permissions.createNetworkChange,Permissions.executeNetworkChange,Permissions.approveNetworkChange];default:return[]}}(permissionId)}(permissionId,isChecked)},systemMgmt:"systemManagement",tenantMgmt:"tenantManagement",domainMgmt:"domainManagement",addDomain:"addDomain",tenantUser:"tenantUser",sharePolicyMgmt:"sharePolicyManagement",deviceMgmt:"deviceManagement",siteManagement:"siteManagement",discoverTuneNetworkDevice:"discoverTuneNetworkDevice",scheduleBenchmark:"scheduleBenchmark",manageNetworkSettings:"manageNetworkSettings",manageDeviceSettings:"manageDeviceSettings",accessToLiveNetwork:"accessToLiveNetwork",viewConfigFile:"viewConfigurationFile",deviceManagement:"deviceManagement",viewConfigurationFile:"viewConfigurationFile",createNetworkChange:"createNetworkChange",executeNetworkChange:"executeNetworkChange",approveNetworkChange:"approveNetworkChange",viewNetworkChange:"viewNetworkChange",sharedResourceManagement:"sharedResourceManagement",variableMappingManagement:"variableMappingManagement",monitor:"monitor",mapLayoutManagement:"mapLayoutManagement",scheduleQapp:"scheduleQapp",runQapp:"runQapp",GBManualDefinition:"GBManualDefinition",GBDynamicCalculationManagement:"GBDynamicCalculationManagement",ManageSPOGURL:"manageSpogUrl"}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var NgUtil=function(){};NgUtil.inherit=function(subclass,baseclass){function Subproto(){}Subproto.prototype=baseclass.prototype;subclass.prototype=new Subproto;subclass.prototype.constructor=subclass};NgUtil.isValidID=function(strGuid){return null!=strGuid&&"00000000-0000-0000-0000-000000000000"!==strGuid};NgUtil.getGUID=function(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,(function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}))};NgUtil.cloneJson=function(obj){return jQuery.extend(!0,{},obj)};NgUtil.cloneJsonUseJQuery=function(obj){var copy;if(null==obj||"object"!==_typeof(obj))return obj;if(obj instanceof Date){(copy=new Date).setTime(obj.getTime());return copy}if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i+=1)copy[i]=this.cloneJson(obj[i]);return copy}if(obj instanceof Object){copy={};for(var attr in obj)Object.prototype.hasOwnProperty.call(obj,attr)&&(copy[attr]=this.cloneJson(obj[attr]));return copy}throw new Error("Unable to copy obj! Its type isn't supported.")};NgUtil.getUniqueStr=function(str){var guid=NgUtil.getGUID();return null==str?guid:guid+" "+str};NgUtil.getSafeFonts=function(){return["Georgia","Palatino Linotype","Times New Roman","Arial","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Lucida Grande","Tahoma","Trebuchet MS","Verdana","Courier New","Lucida Console"]};NgUtil.repeatStr=function(str,repeatTimes){var rtn="";for(var i=0;i<repeatTimes;i+=1)rtn+=str;return rtn};NgUtil.getRefreshWindowCallBack=function(){};NgUtil.isExistInList=function(ls,item){if(null==ls||null==item)return!1;for(var i=0;i<ls.length;i+=1)if(item===ls[i])return!0;return!1};NgUtil.isSuccess=function(data){return(data=data.operationResult||data)&&0===data.ResultCode};NgUtil.UrlInstance=function(){var _urlInstance=new URI(window.location.href);return{getInstanceObj:function(){return _urlInstance},getQuery:function(key){if(_urlInstance.hasQuery(key))return _urlInstance.query(!0)[key]},getTenantId:function(){return this.getQuery("t")},getDomainId:function(){return this.getQuery("d")}}};NgUtil.getValueFromObjAndPath=function(obj,path,defaultValue){var value=null;var keys=path.split(".");var tempObj=obj;for(var i=0,len=keys.length;i<len;i+=1){var key=keys[i];if(!_.isObject(tempObj))break;i===len-1?value=tempObj[key]:tempObj=tempObj[key]}return null!=value?value:void 0!==defaultValue?defaultValue:null};NgUtil.loadImages=function($q,imgUrls){if(!$q)throw new Error("arguments error.");var promises=[];imgUrls.forEach((function(url){var defer=$q.defer();var img=new Image;img.onload=function(){defer.resolve()};img.onerror=function(){defer.resolve()};img.src=url;promises.push(defer.promise)}));return $q.all(promises)};NgUtil.changeJsonValueToString=function(info){if(!_.isObject(info)||_.isFunction(info))return info&&_.isFunction(info.toString)?info.toString():String(info);_.each(info,(function(value,key){info[key]=NgUtil.changeJsonValueToString(value)}));return info};NgUtil.CanvasTools={clacHeightCanvasContext:document&&document.createElement("canvas").getContext("2d"),calcHeight:function(font,text){var clacHeightCanvasContext=NgUtil.CanvasTools.clacHeightCanvasContext;clacHeightCanvasContext.font=font;var metrics=clacHeightCanvasContext.measureText(text||"M");return text?metrics.width:1.3*metrics.width}};!function(NetBrain){angular.module("nb.ng",["nb.framework","angular-cache","angular-md5","ngCookies","ngStorage","ngSanitize","ui.bootstrap","pascalprecht.translate"]).constant("LOCALES",{locales:{en_US:"English"},preferredLocale:"en_US"}).config(["$provide",function($provide){$provide.decorator("$templateCache",["$delegate",function($delegate){var templateCache=$delegate;var normalGet=templateCache.get;var normalPut=templateCache.put;templateCache.get=function(key){return normalGet(keyToLower(key))};templateCache.put=function(key,value){normalPut(keyToLower(key),value)};return $delegate}])}]).config((function($translateProvider){$translateProvider.useMissingTranslationHandlerLog()})).config((function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"resources/locale-",suffix:".json"});$translateProvider.preferredLanguage("en_US")}));angular.module("nb.ng").service("nb.ng",NGSrvc);function keyToLower(key){return key&&"[object String]"===Object.prototype.toString.call(key)?key.toLowerCase():key}function keyToLower(key){return key&&"[object String]"===Object.prototype.toString.call(key)?key.toLowerCase():key}NGSrvc.$inject=["$log","nb.ng.httpAuthSrvc","nb.ng.nbHttp","nb.ng.userSrvc","nb.ng.utilitySrvc","nb.ng.logSrvc"];function NGSrvc($log,httpAuthSrvc,nbHttp,userSrvc,utilitySrvc,logSrvc){this.HttpAuthSrvc=httpAuthSrvc;this.NBHttp=nbHttp;this.UserSrvc=userSrvc;this.UtilitySrvc=utilitySrvc;this.LogSrvc=logSrvc}angular.module("nb.ng").config(["$logProvider","$provide",function($logProvider,$provide){$logProvider.debugEnabled(NetBrain.NG.ConfigSettings.DEBUG_MODE);$provide.decorator("$log",["$delegate",function($delegate){angular.forEach(["log","debug","info","warn","error"],(function(){}));return $delegate}])}]);angular.module("nb.ng").run(["$http","$templateCache","CacheFactory",function($http,$templateCache,CacheFactory){var cache=CacheFactory.get("httpCache");$http.defaults.cache=cache||CacheFactory("httpCache",{maxAge:3e4,cacheFlushInterval:18e5,deleteOnExpire:"aggressive"});setTimeout((function(){$templateCache.put("ui-grid/selectionRowHeaderButtons",'<input type="checkbox" class="ui-grid-selection-row-checkbox" ng-checked="row.isSelected" ng-click="selectButtonClick(row, $event)" />');$templateCache.put("ui-grid/selectionSelectAllButtons",'<input type="checkbox" class="ui-grid-selection-row-checkbox" ng-checked="grid.selection.selectAll" ng-click="headerButtonClick($event)" />');$templateCache.put("ui-grid/treeBaseRowHeaderButtons","<div class=\"ui-grid-tree-base-row-header-buttons\" ng-class=\"{'ui-grid-tree-base-header': row.treeLevel > -1 }\" ng-click=\"treeButtonClick(row, $event)\"><i ng-class=\"{'ui-grid-icon-minus-squared': ( ( grid.options.showTreeExpandNoChildren && row.treeLevel > -1 ) || ( row.treeNode.children && row.treeNode.children.length > 0 ) ) && row.treeNode.state === 'expanded', 'ui-grid-icon-plus-squared': ( ( grid.options.showTreeExpandNoChildren && row.treeLevel > -1 ) || ( row.treeNode.children && row.treeNode.children.length > 0 ) ) && row.treeNode.state === 'collapsed'}\" ng-style=\"{'margin-left': grid.options.treeIndent * row.treeLevel + 'px'}\"></i> &nbsp;</div>")}),100);$(document).ready((function(){$(document).on("keydown",(function(e){var promise;var promise1;if((116===(e=window.event||e).keyCode||e.ctrlKey&&82===e.keyCode)&&NetBrain.Page&&NetBrain.Page.F5Callback&&"function"==typeof NetBrain.Page.F5Callback&&(promise=NetBrain.Page.F5Callback())&&"function"==typeof promise.then){e.preventDefault();promise.then((function(){window.location.href=window.location.href}))}if(!0===e.ctrlKey&&83===e.keyCode&&NetBrain.Page&&NetBrain.Page.SaveCallback&&"function"==typeof NetBrain.Page.SaveCallback){promise1=NetBrain.Page.SaveCallback();e.preventDefault();promise1&&promise1.then;return!1}if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.L){if(NetBrain.Page&&NetBrain.Page.AltL&&"function"==typeof NetBrain.Page.AltL){var promisel=NetBrain.Page.AltL();e.preventDefault();promisel&&promisel.then;return!1}}else if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.R){if(NetBrain.Page&&NetBrain.Page.AltR&&"function"==typeof NetBrain.Page.AltR){var promiser=NetBrain.Page.AltR();e.preventDefault();promiser&&promiser.then;return!1}}else if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.C){if(NetBrain.Page&&NetBrain.Page.AltC&&"function"==typeof NetBrain.Page.AltC){var promisec=NetBrain.Page.AltC();e.preventDefault();promisec&&promisec.then;return!1}}else if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.T){if(NetBrain.Page&&NetBrain.Page.AltT&&"function"==typeof NetBrain.Page.AltT){var promiset=NetBrain.Page.AltT();e.preventDefault();promiset&&promiset.then;return!1}}else if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.B){if(NetBrain.Page&&NetBrain.Page.AltB&&"function"==typeof NetBrain.Page.AltB){var promiseb=NetBrain.Page.AltB();e.preventDefault();promiseb&&promiseb.then;return!1}}else if(e.altKey&&NetBrain.Common&&e.keyCode===NetBrain.Common.Const.KeyCode.M&&NetBrain.Page&&NetBrain.Page.AltM&&"function"==typeof NetBrain.Page.AltM){var promisem=NetBrain.Page.AltM();e.preventDefault();promisem&&promisem.then;return!1}}));$(document).on("mouseover",".modal-dialog",(function(){var self=$(this);if(!self.parent().hasClass("disabled-draggable"))if("function"!=typeof self.draggable&&"true"!==self.data("draggable"));else{var parent1=self.find(".modal-header").data("containment");void 0!==parent1&&""!==parent1||(parent1="parent");self.draggable({handle:".modal-header",containment:parent1});self.data("draggable","true")}var $modalHeader=self.find(".modal-header");var $modalContent=self.find(".modal-content");if($modalHeader.hasClass("ui-resize-enabled")&&"true"!==self.data("resized")){var minWidth=$modalContent.outerWidth()+1;var minHeight=$modalContent.outerHeight()+1;var maxWidth;var maxHeight;var m1=$modalHeader.data("resizeMinWidth");angular.isNumber(m1)&&(minWidth=m1);var m2=$modalHeader.data("resizeMinHeight");angular.isNumber(m2)&&(minHeight=m2);var m3=$modalHeader.data("resizeMaxWidth");angular.isNumber(m3)&&(maxWidth=m3);var m4=$modalHeader.data("resizeMaxHeight");angular.isNumber(m4)&&(maxHeight=m4);$modalContent.resizable({minWidth:minWidth,minHeight:minHeight,maxWidth:maxWidth,maxHeight:maxHeight});self.data("resized","true")}}))}));$(document).bind("contextmenu",(function(e){var node=e.target.nodeName;return $(document.body).hasClass("enable-contextmenu")||$(".admin-login-enable-contextmenu").hasClass("enable-contextmenu")||$(e.target).hasClass("enable-contextmenu")||"INPUT"===node||"TEXTAREA"===node}))}]);angular.module("nb.ng").run(["$rootScope","$injector","nb.ng.sessionSrvc","nb.ng.multiTabEventSrvc",function($rootScope,$injector,sessionSrvc,multiTabEventSrvc){window.addEventListener("unload",(function(){sessionSrvc.clearPageSession();window.name=""}));multiTabEventSrvc.on(MultiTabEvent.switchTab,(function(data){if(void 0!==data){var identity=data.identity,type=data.type,extData=data.extData;var page=sessionSrvc.getPageSessionIfOpend(identity,type);if(void 0!==page&&NetBrain.Page.Identity===identity&&NetBrain.Page.Type===type){sessionSrvc.updateOpendPageSession(identity,type);type===NetBrain.NG.Const.PageType.Desktop&&(extData===NetBrain.NG.Const.PageType.Desktop?$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-desktop"):void 0!==page&&page.Options.subType===NetBrain.NG.Const.PageType.Map&&$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-map"));$rootScope.$emit("multiTabEventSrvcSwitchTab");if(window.localStorage.getItem(RunBookEvent.OPEN_RBA)){NotificationHandler.showNotification("Switching to "+NetBrain.Page.Name,"Click this notification in order to switch...","Switching to "+NetBrain.Page.Name+"\n\n Due to the browser limitation, it is necessary to display this dialog in order to switch to the current tab.");var rbaInfo=JSON.parse(window.localStorage.getItem(RunBookEvent.OPEN_RBA));if(0===document.getElementsByClassName("edit-rba-node-panel").length){$rootScope.$emit(window.RunBookEvent.IS_RBA_RUNNING);if($rootScope.rba_running){$rootScope.rba_running=!1;window.localStorage.removeItem(rbaInfo[1]);window.localStorage.removeItem(window.RunBookEvent.OPEN_RBA);return}$rootScope.$emit(window.MapTabEvent.OPEN_FROM_OUTSIDE,"RunBook");$rootScope.$emit(window.RunBookEvent.CREATE_RBA,rbaInfo[0],rbaInfo[1])}else{$injector.get("nb.common.nbAlertSrvc").alert("This map has a Runbook that is currently being edited. Please exit the edit mode for this map or select another map.")}window.localStorage.removeItem(rbaInfo[1]);window.localStorage.removeItem(window.RunBookEvent.OPEN_RBA)}else NotificationHandler.showNotification("Switching to "+NetBrain.Page.Name,"Click this notification in order to switch...","Switching to "+NetBrain.Page.Name+"\n\n Due to the browser limitation, it is necessary to display this dialog in order to switch to the current tab.")}}}))}]);angular.module("nb.ng").run(["$window","$rootScope","nb.ng.licenseSrvc","nb.ng.utilitySrvc",function($window,$rootScope,licenseSrvc,utilitySrvc){if($window.location.href.toLowerCase().indexOf("/domainadmin.html")>0){utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE)||licenseSrvc.getLicense(!1).then((function(resultLicense){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,resultLicense)}))}}])}(NetBrain);!function(NetBrain){NetBrain.ns("NG.Model").APIURL={GET_USER_FULL_PERMISSIONS:"/users/permissions/full",GET_USER_CURRENT_PERMISSIONS:"/users/permissions/current"}}(NetBrain);!function(NetBrain){NetBrain.ns("NG.Model").CUserConf=CUserConf;function CUserConfWrapper(){this.data={ID:null,conf:{}}}CUserConfWrapper.prototype={constructor:CUserConfWrapper,resetJsData:function(jsData){this.data=jsData},resetJsDataForUser:function(userId){this.data={ID:userId,conf:{}}},getJsData:function(){return this.data},getId:function(){return this.data.ID},setId:function(obj){this.data.ID=obj},getDataTableCompareFields:function(){return this.data.conf.dataTableCompareFields},setDataTableCompareFields:function(obj){this.data.conf.dataTableCompareFields=obj},getSelectedTenantGuid:function(){return this.data.conf.selectedTenantGuid},getSelectedDomainGuids:function(){return{selectedTenantGuid:this.data.conf.selectedTenantGuid,selectedDomainGuids:this.data.conf.selectedDomainGuids}},getMapViewOption:function(){return this.data.conf.mapViewOption},setMapViewOption:function(data){this.data.conf.mapViewOption=data;this.data.conf.mapViewOption&&(this.data.conf.mapViewOption._id=void 0)},setIsNeatUp:function(obj){this.data.conf.mapViewOption.isNeatUp=obj},getIsNeatUp:function(){return this.data.conf.mapViewOption.isNeatUp},getUserL3StyleInExpandedStyle:function(){return this.data.conf.currentUserL3StyleInExpandedStyle},setUserL3StyleInExpandedStyle:function(arr){this.data.conf.currentUserL3StyleInExpandedStyle=arr},getUserInterfaceHighlightMode:function(){return this.data.conf.currentUserInterfaceHighlightMode},setUserInterfaceHighlightMode:function(mode){this.data.conf.currentUserInterfaceHighlightMode=mode},setMapAutoLinkOptionList:function(obj,vspaceId){vspaceId||(vspaceId=VisualSpaceConstant.defaultVisualSpaceInstanceId);this.data.conf.mapAutoLinkOptionDict||(this.data.conf.mapAutoLinkOptionDict={});this.data.conf.mapAutoLinkOptionDict[vspaceId]=obj},getMapAutoLinkOptionList:function(vspaceId){vspaceId||(vspaceId=VisualSpaceConstant.defaultVisualSpaceInstanceId);if(!this.data.conf.mapAutoLinkOptionDict){if(!this.data.conf.mapAutoLinkOptionList)return null;if(Array.isArray(this.data.conf.mapAutoLinkOptionList[vspaceId]))this.data.conf.mapAutoLinkOptionDict=this.data.conf.mapAutoLinkOptionList;else{if(!(Array.isArray(this.data.conf.mapAutoLinkOptionList)&&this.data.conf.mapAutoLinkOptionList.length>0))return null;if(vspaceId===VisualSpaceConstant.defaultVisualSpaceInstanceId){this.data.conf.mapAutoLinkOptionDict={};this.data.conf.mapAutoLinkOptionDict[VisualSpaceConstant.defaultVisualSpaceInstanceId]=this.data.conf.mapAutoLinkOptionList;return this.data.conf.mapAutoLinkOptionList}}}return this.data.conf.mapAutoLinkOptionDict[vspaceId]},setMapAutoLinkOptionExcluedeMip:function(vspaceId,obj){this.data.conf.mapAutoLinkOptionExcluedeMip||(this.data.conf.mapAutoLinkOptionExcluedeMip={});this.data.conf.mapAutoLinkOptionExcluedeMip[vspaceId]=obj},getMapAutoLinkOptionExcluedeMip:function(){return this.data.conf.mapAutoLinkOptionExcluedeMip}};function CUserConf(){this._jsWrapper=new CUserConfWrapper}CUserConf.prototype={constructor:CUserConf,getJsWrapper:function(){return this._jsWrapper},resetJsData:function(jsData){this._jsWrapper.resetJsData(jsData)},getJsData:function(){return this._jsWrapper.getJsData()},getDataTableCompareFields:function(){return this._jsWrapper.getDataTableCompareFields()},setDataTableCompareFields:function(obj){this._jsWrapper.setDataTableCompareFields(obj)},getMapViewOption:function(){return this._jsWrapper.getMapViewOption()},setMapViewOption:function(data){this._jsWrapper.setMapViewOption(data)},setIsNeatUp:function(data){this._jsWrapper.setIsNeatUp(data)},getIsNeatUp:function(){return this._jsWrapper.getIsNeatUp()},setMapAutoLinkOptionList:function(obj,vspaceId){this._jsWrapper.setMapAutoLinkOptionList(obj,vspaceId)},getMapAutoLinkOptionList:function(vspaceId){return this._jsWrapper.getMapAutoLinkOptionList(vspaceId)},setMapAutoLinkOptionExcluedeMip:function(vspaceId,obj){this._jsWrapper.setMapAutoLinkOptionExcluedeMip(vspaceId,obj)},getMapAutoLinkOptionExcluedeMip:function(){return this._jsWrapper.getMapAutoLinkOptionExcluedeMip()}}}(NetBrain);!function(NetBrain){function dataSrcWrapper(){this.obj=null}dataSrcWrapper.prototype={constructor:dataSrcWrapper,setJsData:function(obj){null!==obj&&(this.obj=obj)},getJsData:function(){return this.obj},getTenantId:function(tenant){return tenant.ID},getTenantName:function(tenant){return tenant.name},getTenantById:function(tenantId){var _foundTenant=null;angular.forEach(this.obj,(function(objTenant){objTenant.ID===tenantId&&(_foundTenant=objTenant)}));return _foundTenant},getDomainsByTenant:function(tenant){return tenant.domains},getDomainsByTenantId:function(tenantId){var _foundDomains=null;angular.forEach(this.obj,(function(objTenant){objTenant.ID===tenantId&&(_foundDomains=objTenant.domains)}));return _foundDomains},getDomainId:function(domain){return domain.guid},getDomainName:function(domain){return domain.name},resetJSData:function(jsData,httpAuthSrvc){if(jsData){httpAuthSrvc.setSelectedTenantId(jsData.selectedTenantGuid);httpAuthSrvc.setSelectedDomainIds(jsData.selectedDomainGuids)}}};NetBrain.ns("NG.Model").DataSrcWrapper=dataSrcWrapper}(NetBrain);function EventDispatch(){this.subscribeFuncList={}}EventDispatch.prototype.constructor=EventDispatch;EventDispatch.prototype.registerSubscribeFunc=function(ID,subsFunc){if(null!=ID&&null!=subsFunc){var funcList=this.subscribeFuncList[ID];if(null==funcList){funcList=[];this.subscribeFuncList[ID]=funcList}for(var i=0;i<funcList.length;i+=1){var func=funcList[i];if(null!=func&&func===subsFunc)return}funcList.push(subsFunc)}};EventDispatch.prototype.callSubscribeFunc=function(ID,varList){if(null!=ID){var funcList=this.subscribeFuncList[ID];if(null!=funcList)for(var i=0;i<funcList.length;i+=1){var func=funcList[i];null!=func&&func(varList)}}};var GlobalContext=function(globalContext){null==globalContext&&(globalContext={});globalContext.isDrawPathSelect=!1;globalContext.EventDispatch=new EventDispatch;return globalContext}(GlobalContext);!function(window){window.ngHub={getInstance:function(){if(!instance){instance=new NgHub;if($.connection&&$.connection.hub){var endWithCode="/"===NetBrain.NG.ConfigSettings.API_ROOT.charAt(NetBrain.NG.ConfigSettings.API_ROOT.length-1);$.connection.hub.url=NetBrain.NG.ConfigSettings.API_ROOT+(endWithCode?"":"/")+"signalr"}instance.getSignalrHubClientId(!0)}return instance},signalrHubClientId:""};var instance;function NgHub(){this.hubName=null;this.eventMap={};this.eventContainer={};this.businessContainer=[];this.isStart=!1;this.isRegEvent=!1;this.tryingToReconnect=!1;this.reconnectTimerId=null;this.receivedCallback=[];this.reconnectCallback=[];this.token=""}NgHub.prototype.setHub=function(connection,hubName){if(!(void 0===connection&&null==connection||void 0===hubName&&null==hubName)){this.hubName=hubName;if(!SJ.iwc.SignalR)throw new Error("SignelR component failed to load, please check if web server started successfully.");this.hub=SJ.iwc.SignalR.getHubProxy(hubName,{client:{nothing:_.noop}});this.connection=connection}};NgHub.prototype.setReceivedCallback=function(callback){this.receivedCallback.push(callback)};NgHub.prototype.setReconnectCallback=function(callback){this.reconnectCallback.push(callback)};NgHub.prototype.registerEvent=function(fnName,fn){if(!fnName||!fn)throw new Error("NgHub registerEvent function param is null");this.eventContainer[fnName]||(this.eventContainer[fnName]={});var eventsId=_.uniqueId("hubEvents_");this.eventContainer[fnName][eventsId]=fn;if(!this.eventMap[fnName]){var fnArray=this.eventContainer[fnName];this.eventMap[fnName]=function(result){_.each(fnArray,(function(fn1){fn1 instanceof Function||console.error(fn1);fn1(result)}))}}this.subBusinessId(fnName,fnName);if(!this.hub)throw new Error("SignelR component failed to load, please check if web server started successfully.");this.hub.client[fnName]=_.noop;return eventsId};NgHub.prototype.unRegisterEvent=function(eventName,fnId){if(!eventName||!fnId)throw new Error("NgHub unRegisterEvent function param is null");if(this.isStart)if(this.eventContainer[eventName]&&fnId){this.eventContainer[eventName][fnId]&&delete this.eventContainer[eventName][fnId];if(0===_.keys(this.eventContainer[eventName]).length){delete this.eventContainer[eventName];delete this.eventMap[eventName]}}else delete this.eventContainer[eventName];this.hub.client[eventName]&&delete this.hub.client[eventName];this.unsubBusinessId(eventName,eventName)};NgHub.prototype.subBusinessIdAsync=function(eventName,businessId){if(eventName&&businessId){var subscriberId=SJ.iwc.WindowMonitor.getThisWindowId();this.businessContainer.push({eventName:eventName,businessId:businessId,subscriberId:subscriberId});return this.hub.server.subscribeHubEvent(eventName,businessId,subscriberId)}};NgHub.prototype.subBusinessId=function(eventName,businessId){if(eventName&&businessId){var subscriberId=SJ.iwc.WindowMonitor.getThisWindowId();this.businessContainer.push({eventName:eventName,businessId:businessId,subscriberId:subscriberId});this.isStart&&this.hub.server.subscribeHubEvent(eventName,businessId,subscriberId)}};NgHub.prototype.unsubBusinessId=function(eventName,businessId){var index=_.findIndex(this.businessContainer,(function(item){return item.eventName===eventName&&item.businessId===businessId}));index>-1&&this.businessContainer.splice(index,1);if(this.isStart){var subscriberId=SJ.iwc.WindowMonitor.getThisWindowId();this.hub.server.unsubscribeHubEvent(eventName,businessId,subscriberId)}};NgHub.prototype.start=function(){var self=this;this.bindingSignalREvents();self.isRegEvent||function(){self.isRegEvent=!0;self.connection.hub.logging=NetBrain.NG.ConfigSettings.DEBUG_MODE;SJ.iwc.SignalR.on("error",(function(){}));SJ.iwc.SignalR.on("statechanged",(function(data){1===data?self.tryingToReconnect=!1:4===data&&(self.tryingToReconnect=!0)}));SJ.iwc.SignalR.on("connected",(function(){initSignalrEvents()}));SJ.iwc.SignalR.on("reconnecting",(function(){self.tryingToReconnect=!0}));SJ.iwc.SignalR.on("reconnected",(function(){self.tryingToReconnect=!1}));SJ.iwc.SignalR.on("received",(function(e){_.each(self.receivedCallback,(function(callback){callback.call(self,e,null)}));!function(e){if(!e.M)return;var fnName=e.M;if(!self.eventMap[fnName]&&!_.isFunction(self.eventMap[fnName]))return;if(e.A[0].businessIds&&!(businessIds=e.A[0].businessIds,null!=_.find(self.businessContainer,(function(item1){return null!=_.find(businessIds,(function(citem){return item1.businessId===citem}))}))))return;var businessIds;self.eventMap[fnName](e.A[0].data)}(e)}));SJ.iwc.SignalR.on("disconnected",(function(){if(self.tryingToReconnect){null!=self.reconnectTimerId&&clearInterval(self.reconnectTimerId);self.reconnectTimerId=setInterval(reconnectTimerFunc,1e4)}}))}();var fullTransport=["webSockets","foreverFrame","serverSentEvents","longPolling"];var transport=_.intersection(fullTransport,NetBrain.NG.ConfigSettings.SignalRTransport);0===transport.length&&(transport=fullTransport);console.debug("SignalR transport: "+transport);this.setToken(self.token);return SJ.iwc.SignalR.start({transport:transport}).then((function(){self.isStart=!0;initSignalrEvents()}),(function(err){console.error(err)}));function initSignalrEvents(){var subscriberId=SJ.iwc.WindowMonitor.getThisWindowId();self.hub.server.subscribeHubEvents(self.businessContainer,subscriberId);$(window).on("unload",(function(){self.hub.server.unsubscribeHubEvents(self.businessContainer,subscriberId)}))}function reconnectTimerFunc(){if(self.tryingToReconnect){_.each(self.reconnectCallback,(function(callback){callback.call(self)}));self.start()}else clearInterval(self.reconnectTimerId)}};NgHub.prototype.restartIfNeed=function(){SJ.iwc.SignalR.restartIfNeed()};NgHub.prototype.bindingSignalREvents=function(){if(void 0!==this.hub||null!=this.hub)for(var b in this.hub.server)({}).hasOwnProperty.call(this.hub.server,b)&&(NgHub.prototype[b]=this.hub.server[b])};NgHub.prototype.setToken=function(token){this.token=token;"undefined"!=typeof SJ&&refreshHubToken(this)};NgHub.prototype.getClientId=function(){if(window.ngHub.signalrHubClientId)return window.ngHub.signalrHubClientId};NgHub.prototype.getSignalrHubClientId=function(valiSJ){var self=this;var deferred=$.Deferred();if(window.ngHub.signalrHubClientId){deferred.resolve(window.ngHub.signalrHubClientId);return deferred.promise()}var signalrHubClientId=window.ngHub.signalrHubClientId=getHubClientId(self);if(signalrHubClientId){deferred.resolve(signalrHubClientId);return deferred.promise()}if(valiSJ&&"undefined"==typeof SJ){deferred.reject("SJ-IWC has not yet been loaded!");return deferred.promise()}var hubClientIdKey=getHubClientIdKey(self);SJ.interlockedCall(hubClientIdKey,(function(){if(signalrHubClientId=window.ngHub.signalrHubClientId=getHubClientId(self))deferred.resolve(signalrHubClientId);else{signalrHubClientId=function(self){var hubClientIdKey=getHubClientIdKey(self);var hubClientId=window.ngHub.signalrHubClientId=getSignalrDomain(self)+"_"+window.Utility.getGUID();window.localStorage.setItem(hubClientIdKey,hubClientId);return hubClientId}(self);deferred.resolve(signalrHubClientId)}}));return deferred.promise()};NgHub.prototype.informLogin=function(scope,token){clearHubClientId(this);refreshHubToken(this,!0)};NgHub.prototype.informLogout=function(){clearHubClientId(this)};function refreshHubToken(self,valiSJ){self.getSignalrHubClientId(valiSJ).then((function(signalrHubClientId){SJ.iwc.SignalR.changeQs({bearer_token:self.token,signalrHubClientId:signalrHubClientId})}))}function getSignalrDomain(self){return window.applicationName||"mainUI"}function getHubClientIdKey(self){return getSignalrDomain()+"_signalrHubClientId"}function getHubClientId(self){var hubClientIdKey=getHubClientIdKey();return window.localStorage.getItem(hubClientIdKey)}function clearHubClientId(self){var hubClientIdKey=getHubClientIdKey();window.localStorage.removeItem(hubClientIdKey)}}(window);!function(window){window.NotificationHandler={isNotificationSupported:"Notification"in window,isPermissionGranted:function(){return"granted"===Notification.permission},requestPermission:function(){this.isNotificationSupported&&Notification.requestPermission((function(){}))},showNotification:function(title,message,backupMessage){if(browser.isChrome)alert(backupMessage);else if(this.isNotificationSupported)if(this.isPermissionGranted()){var n=new Notification(title,{icon:"/img/notification.png",body:message});n.onshow=function(){window.focus();setTimeout((function(){window.focus();n.close()}),1e4)};n.onclick=function(){window.focus();n.close()};n.onerror=function(){window.focus()};n.onclose=function(){window.focus()}}else alert(backupMessage);else alert(backupMessage)}}}(window);var NgDocType=function(){};NgDocType.Doc="Doc";NgDocType.QDoc="QDoc";NgDocType.Page="Page";NgDocType.Map="Map";NgDocType.Task="Task";NgDocType.DocMgr="DocMgr";NgDocType.MapMgr="MapMgr";NgDocType.TaskMgr="TaskMgr";NgDocType.QDocMgr="QDocMgr";NgDocType.Invalidate="Invalidate";function NgDoc(){this._type=NgDocType.Doc}NgDoc.prototype={constructor:NgDoc,getDocType:function(){return this._type},getDocId:function(){throw new Error("subclass must implement getDocId!")},setDocId:function(){throw new Error("subclass must implement setDocId!")},isDocMgr:function(){return-1!=[NgDocType.Map,NgDocType.Task,NgDocType.MapMgr,NgDocType.TaskMgr,NgDocType.QDocMgr].indexOf(this._type)},toJson:function(){throw new Error("subclass must implement toJson!")},fromJson:function(){throw new Error("subclass must implement fromJson!")}};function NgDocMgr(){NgDoc.call(this);this._docList=[];this._type=NgDocType.DocMgr}NgDocMgr.prototype=new NgDoc;NgDocMgr.createNewDoc=function(docType,bCreateSubDoc){if(NgDocType.Page==docType)return this.createSubDoc(!0);if(NgDocType.Map==docType){var map=new NetBrain.Map.CQMap;if(bCreateSubDoc){map.createSubDoc(!0);map.setRealDocId(map.getDocId())}return map}if(NgDocType.Task==docType){var task=new CTask;if(bCreateSubDoc){task.createSubDoc(!0);task.setRealDocId(task.getDocId())}return task}return NgDocType.QDocMgr==docType?new CQDocMgr:null};NgDocMgr.prototype.createNewDoc=NgDocMgr.createNewDoc;NgDocMgr.prototype.isTitleDuplicated=function(strTitle){if(null==strTitle)return!1;for(var i=0;i<this._docList.length;i+=1){var oneDoc=this._docList[i];if(null!=oneDoc){var docTitle=oneDoc.getTitle();if(null==docTitle)continue;docTitle.trim();strTitle.trim();if(strTitle==docTitle)return!0}}return!1};NgDocMgr.getNewDocName=function(docType){var tailNumber=this._docList.length;var newName;tailNumber+=1;do{newName=null!=docType?docType+" "+tailNumber:this._type+" "+tailNumber;tailNumber+=1}while(this.isTitleDuplicated(newName));return newName};NgDocMgr.prototype.getNewDocName=NgDocMgr.getNewDocName;NgDocMgr.prototype.addDoc=function(doc){if(null!=doc){var docId=doc.getDocId();this.isExistDoc(docId)&&this._docList.pop();this._docList.push(doc)}};NgDocMgr.prototype.refreshDoc=function(doc){if(null!=doc){var docId=doc.getDocId();var newArr=[];for(var i=0;i<this._docList.length;i+=1)this._docList[i].getDocId()!=docId&&newArr.push(this._docList[i]);newArr.push(doc);newArr.length>0&&(this._docList=newArr)}};NgDocMgr.prototype.getDocById=function(docId){for(var i=0;i<this._docList.length;i+=1)if(this._docList[i].getDocId()==docId)return this._docList[i];return null};NgDocMgr.prototype.isExistDoc=function(docId){for(var i=0;i<this._docList.length;i+=1)if(this._docList[i].getDocId()==docId)return!0;return!1};NgDocMgr.prototype.getActiveDoc=function(){var resultDoc=null;for(var i=0;i<this._docList.length;i+=1)this._docList[i].realActive&&(resultDoc=this._docList[i]);return resultDoc};NgDocMgr.prototype.getDocListLength=function(){return this._docList.length};NgDocMgr.prototype.removeDoc=function(docId){for(var i=0;i<this._docList.length;i+=1)this._docList[i].getDocId()==docId&&this._docList.splice(i,1)};NgDocMgr.prototype.removeLastTask=function(){var length=this._docList.length;if(!(length<=0)){var docId=this._docList[length-1].getDocId();this.removeDoc(docId)}};NgDocMgr.prototype.initDocList=function(docType){var doc=this.createNewDoc(docType);doc.setRealActive(!0);doc.setActive(!0);doc.isDocMgr()&&doc.initDocList(doc.getDocType())};NgDocMgr.prototype.removeAll=function(){this._docList=[]};NgDocMgr.prototype.getDocIndex=function(doc){return _.indexOf(this._docList,doc)};NgDocMgr.prototype.insertDoc=function(doc,index){if(index>=0&&index<this._docList.length){this._docList.splice(index,0,doc);return doc}return this.addDoc(doc)};function CQDoc(){NgDocMgr.call(this);this._type=NgDocType.QDoc;this.realModify=!1;this.realNew=!0;this.realSaveAs=!1;this.realImage=""}CQDoc.prototype=new NgDocMgr;CQDoc.prototype.toJson=function(){throw new Error("subclass must implement toJson!")};CQDoc.prototype.fromJson=function(){throw new Error("subclass must implement fromJson!")};CQDoc.prototype.getActive=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.setActive=function(){throw new Error("subclass must implement this method")};Object.defineProperty(CQDoc.prototype,"realActive",{get:function(){return this.getActive()},set:function(val){this.setActive(val)}});CQDoc.prototype.getTitle=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.setTitle=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.getDocId=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.setDocId=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.getOwner=function(){throw new Error("subclass must implement this method")};CQDoc.prototype.setOwner=function(){throw new Error("subclass must implement this method")};Object.defineProperty(CQDoc.prototype,"realOwner",{get:function(){return this.getOwner()},set:function(val){this.setOwner(val)}});Object.defineProperty(CQDoc.prototype,"realUpdatedBy",{get:function(){return this.getUpdatedBy()},set:function(val){this.setUpdatedBy(val)}});CQDoc.prototype.isModify=function(){return this.realModify};CQDoc.prototype.getRealModify=function(){return this.realModify};CQDoc.prototype.setRealModify=function(obj){this.realModify=obj};CQDoc.prototype.getRealNew=function(){return this.realNew};CQDoc.prototype.setRealNew=function(obj){this.realNew=obj};CQDoc.prototype.getRealImage=function(){return this.realImage};CQDoc.prototype.setRealImage=function(image){this.realImage=image};CQDoc.prototype.activeDoc=function(doc){if(null!=doc){for(var i=0;i<this._docList.length;i+=1)this._docList[i].setRealActive(!1);doc.setRealActive(!0)}};CQDoc.prototype.activeDocById=function(docId){var doc=this.getDocById(docId);this.activeDoc(doc)};CQDoc.prototype.getActiveDoc=function(){for(var i=0;i<this._docList.length;i+=1){var doc=this._docList[i];if(doc.getRealActive())return doc}return null};CQDoc.prototype.getActiveMap=function(){var doc=this.getActiveDoc();return null==doc?null:doc.getDocType()==NgDocType.Map?doc:doc.getDocType()==NgDocType.Task?doc=doc.getActiveDoc():null};CQDoc.prototype.getActivePage=function(){var doc=this.getActiveDoc();if(null==doc)return null;if(doc.getDocType()==NgDocType.Map)return doc.getActiveDoc();if(doc.getDocType()==NgDocType.Task){var map=doc.getActiveMap();return null==map?null:map.getActivePage()}return doc.getDocType()==NgDocType.Page?doc:null};CQDoc.prototype.getThumbnailList=function(){var thumbnailList=[];for(var i=0;i<this._docList.length;i+=1){var doc=this._docList[i];var thumbnail=new Thumbnail;var thumbnailJsWrapper=thumbnail.getJsWrapper();thumbnailJsWrapper.setDocType(doc.getDocType());thumbnailJsWrapper.setDocId(doc.getDocId());thumbnailJsWrapper.SetDocName(doc.getTitle());null!=doc._docList?thumbnailJsWrapper.setDocCount(doc._docList.length):thumbnailJsWrapper.setDocCount(0);thumbnailJsWrapper.setDocPngList(doc.getPngList());thumbnailList.push(thumbnail)}return thumbnailList};CQDoc.prototype.getAllDocList=function(){return this._docList};function CQDocMgr(){CQDoc.call(this);this._docList=[];this._type=NgDocType.QDocMgr}CQDocMgr.prototype=new CQDoc;CQDocMgr.prototype.getDocById=function(docId){for(var i=0;i<this._docList.length;i+=1)if(this._docList[i].getDocId()==docId)return this._docList[i];return null};CQDocMgr.prototype.openDoc=function(type,jsData){var doc=this.createNewDoc(type);doc.fromJson(jsData);this.addDoc(doc);this.activeDoc(doc);return doc};CQDocMgr.prototype.replaceDoc=function(type,jsData){var doc=this.createNewDoc(type);doc.fromJson(jsData);this.refreshDoc(doc);this.activeDoc(doc);return doc};CQDocMgr.prototype.newDoc=function(type,jsData){this.openDoc(type,jsData).setRealNew(!0)};CQDocMgr.prototype.removeDoc=function(docId){var doc=this.getDocById(docId);if(null==doc)return!1;var bActive=doc.getRealActive();NgDocMgr.prototype.removeDoc.call(this,docId);if(bActive)for(var i=0;i<this._docList.length;i+=1){this._docList[i].setRealActive(!0);return}return!1};!function(){angular.module("nb.ng").directive("nbPermission",nbPermission);nbPermission.$inject=["nb.ng.permissionSrvc"];function nbPermission(permissionSrvc){return{restrict:"A",link:function(scope,element,attrs){var permission=attrs.nbPermission;var type=void 0===attrs.permissionType?"":attrs.permissionType.toLowerCase();var action=void 0===attrs.permissionAction?"remove":attrs.permissionAction.toLowerCase();("system"===type?permissionSrvc.hasSystemPermission(permission):"tenant"===type?permissionSrvc.hasTenantPermission(permission):"domain"===type?permissionSrvc.hasDomainPermission(permission):permissionSrvc.anyPermission(permission))?angular.element(element).removeClass("disabled hidden").removeAttr("disabled"):"disabled"===action?angular.element(element).addClass("disabled").attr("disabled","disabled"):"hide"===action||"hidden"===action?angular.element(element).addClass("hidden"):element.remove()}}}}(NetBrain);!function(){angular.module("nb.ng").directive("nbRole",nbRole);nbRole.$inject=["nb.ng.permissionSrvc"];function nbRole(permissionSrvc){return{restrict:"A",link:function(scope,element,attrs){var role=attrs.nbRole;var type=void 0===attrs.roleType?"":attrs.roleType.toLowerCase();var action=void 0===attrs.roleAction?"remove":attrs.roleAction.toLowerCase();var hasRole=!1;"system"===type?hasRole=permissionSrvc.hasSystemRole(role):"tenant"===type?hasRole=permissionSrvc.hasTenantRole(role):"domain"===type&&(hasRole=permissionSrvc.hasDomainRole(role));hasRole?angular.element(element).removeClass("disabled hidden").removeAttr("disabled"):"disabled"===action?angular.element(element).addClass("disabled").attr("disabled","disabled"):"hide"===action||"hidden"===action?angular.element(element).addClass("hidden"):element.remove()}}}}(NetBrain);!function(){angular.module("nb.ng").directive("deviceAccessPrivileges",deviceAccessPrivileges);deviceAccessPrivileges.$inject=["nb.ng.deviceAccessCacheSrvc"];function deviceAccessPrivileges(deviceAccessCacheSrvc){return{scope:{deviceAccessCallback:"&",deviceAccessPrivileges:"=",deviceAccessEnable:"=",deviceAccessScope:"=",deviceAccessShow:"="},restrict:"A",link:function(scope,element,attrs){var action=attrs.deviceAccessAction||"remove";scope.deviceAccessShow||angular.element(element).addClass("device-access-privileges-hidden");scope.$watch("deviceAccessEnable",(function(isEnable){"string"!=typeof isEnable&&null!=isEnable&&setElementType(isEnable)}));scope.$watch("deviceAccessScope",(function(deviceIds,oldDeviceIds){if(deviceIds){_.isArray(deviceIds)||(deviceIds=JSON.parse(deviceIds));var ids=[];_.each(deviceIds,(function(id){id&&ids.push(id)}));ids.length>0?deviceAccessCacheSrvc.getDAPObject(ids,scope.deviceAccessPrivileges).then((function(res){!function(ids){var hasAccess=[],noAccess=[],allDevicePermission=!0;_.each(ids,(function(value,key){if(value)hasAccess.push(key);else{allDevicePermission=!1;noAccess.push(key)}}));setElementType(allDevicePermission);if(scope.deviceAccessCallback){var handler=scope.deviceAccessCallback();_.isFunction(handler)&&handler(allDevicePermission,hasAccess,noAccess,element)}}(res)})):oldDeviceIds[0]&&setElementType(!0)}}),!0);function setElementType(devicePermission){angular.element(element).find(".device-access-privileges").remove();if(devicePermission){angular.element(element).removeClass("device-access-privileges-hidden");angular.element(element).children().removeClass("device-access-privileges-hidden")}else if("replace"===action){var message=attrs.deviceAccessMessage||"===No privilege to view device data===";angular.element(element).removeClass("device-access-privileges-hidden");angular.element(element).children().addClass("device-access-privileges-hidden");angular.element(element).prepend('<div class="device-access-privileges">'+message+"</div>")}else if("disabled"==action){angular.element(element).removeClass("device-access-privileges-hidden");angular.element(element).addClass("disabled").attr("disabled","disabled")}else"remove"==action&&element.remove()}}}}}(NetBrain);!function(){angular.module("nb.ng").directive("deviceAccessPrivilegesSuper",deviceAccessPrivilegesSuper);deviceAccessPrivilegesSuper.$inject=["nb.ng.deviceAccessCacheSrvc"];function deviceAccessPrivilegesSuper(deviceAccessCacheSrvc){return{scope:{deviceAccessScope:"=",deviceAccessPrivilegesSuper:"=",deviceAccessCallback:"&",deviceAccessEnable:"=",deviceAccessMessage:"@"},restrict:"A",transclude:!0,template:'<div class="device-access-privileges-super" ng-show="!isChecking"></div>',compile:function(element,attrs){!function(){var rootEl=angular.element(element).find(".device-access-privileges-super");switch(attrs.deviceAccessAction||"ng-if-replace"){case"remove":rootEl.attr("ng-transclude","").attr("ng-if","hasPermission");break;case"hide":case"hidden":rootEl.attr("ng-transclude","").attr("ng-show","hasPermission");break;case"replace":rootEl.append('<div ng-show="!hasPermission"  class="not-have-permission" ng-bind-html="message"></div><div class="have-permission" ng-show="hasPermission"  ng-transclude></div>');break;case"ng-if-replace":rootEl.append('<div ng-if="!hasPermission"  class="not-have-permission" ng-bind-html="message"></div><div class="have-permission" ng-if="hasPermission"  ng-transclude></div>');break;case"disabled":rootEl.attr("ng-transclude","").removeAttr("ng-show")}}();return{pre:function(){},post:function(scope){scope.message=scope.deviceAccessMessage||"===No privilege to view device data===";scope.isChecking=!0;scope.hasPermission=!0;scope.$watch("deviceAccessEnable",(function(isEnable){"boolean"==typeof isEnable&&setPermissionStatus()}));scope.$watch("deviceAccessScope",(function(deviceIds){scope.timer&&clearTimeout(scope.timer);if(deviceIds&&_.isArray(deviceIds))if((deviceIds=_.compact(deviceIds)).length){scope.isChecking=!0;deviceAccessCacheSrvc.getDAPObject(deviceIds,scope.deviceAccessPrivilegesSuper).then((function(res){!function(deviceAccessPolicy){scope.currentPermission=!0;for(var prop in deviceAccessPolicy)if(Object.prototype.hasOwnProperty.call(deviceAccessPolicy,prop)&&!deviceAccessPolicy[prop]){scope.currentPermission=!1;break}setPermissionStatus();if(scope.deviceAccessCallback){var hasAccess=[],noAccess=[];_.each(deviceAccessPolicy,(function(value,key){value?hasAccess.push(key):noAccess.push(key)}));var handler=scope.deviceAccessCallback();_.isFunction(handler)&&handler(scope.hasPermission,hasAccess,noAccess,element)}}(res);scope.isChecking=!1}))}else scope.isChecking=!1;else scope.timer=setTimeout((function(){scope.isChecking=!1}),300)}),!0);function setPermissionStatus(){"boolean"==typeof scope.deviceAccessEnable?scope.hasPermission=scope.deviceAccessEnable:scope.hasPermission=scope.currentPermission;"disabled"===(attrs.deviceAccessAction||"ng-if-replace")&&(scope.hasPermission?angular.element(element).removeClass("disabled").removeAttr("disabled"):angular.element(element).addClass("disabled").attr("disabled","disabled"))}}}}}}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(){angular.module("nb.ng").directive("contenteditable",(function(){return{restrict:"A",priority:5,scope:!1,require:"?ngModel",link:function(scope,element,attrs,ctrl){if(ctrl){element.bind("keyup",(function(){scope.$evalAsync((function(){ctrl.$setViewValue(element.html())}))}));ctrl.$render=function(){element.html(ctrl.$viewValue||"")};ctrl.$render()}}}}));angular.module("nb.ng").directive("nbValidationForm",["nb.ng.nbValidationSrvc",function(nbValidationSrvc){return{restrict:"A",scope:!0,link:function(scope,element,attr){var objForm={name:attr.nbValidationForm,scope:scope,status:!0};nbValidationSrvc.registerForm(objForm);element.on("$destroy",(function(){nbValidationSrvc.unRegisterForm(objForm.name)}));scope.$on("$destroy",(function(){nbValidationSrvc.unRegisterForm(objForm.name)}));scope.$on("nbValidationForm",(function(event,value){attr.nbValidationForm=value;var objForm2={name:attr.nbValidationForm,scope:scope,status:!0};nbValidationSrvc.registerForm(objForm2);element.on("$destroy",(function(){nbValidationSrvc.unRegisterForm(objForm2.name)}));scope.$on("$destroy",(function(){nbValidationSrvc.unRegisterForm(objForm2.name)}))}))}}}]);angular.module("nb.ng").directive("nbValidator",["$q","$timeout","$compile","$sanitize","nb.ng.nbValidationSrvc",function($q,$timeout,$compile,$sanitize,nbValidationSrvc){var getErrorHtml=function(strErrorMsg,strErrorPosition,strValidName){var lStrErrorMsg=strErrorPosition.toLowerCase();strErrorMsg=$sanitize(strErrorMsg);return"top"===lStrErrorMsg||"bottom"===lStrErrorMsg?'<p class="validation-has-error">'+strErrorMsg+"</p>":"summary"===lStrErrorMsg?'<p class="validation-has-error" id="'+strValidName+'">'+strErrorMsg+"</p>":'<span class="validation-has-error">'+strErrorMsg+"</span>"};var toggleErrorMsg=function(objElement,bIsError,bIsShowErrorStr,strError,strErrorPosition,strMessageId,strValidName,scope,arrIconOffset,bIsOldError){var lStrErrorMsg=strErrorPosition.toLowerCase();if(bIsError)if(bIsOldError){angular.element($("#"+strValidName)).scope().tooltipStrError=strError}else{objElement.toggleClass("validation-error-input");if(bIsShowErrorStr)if(null==strMessageId||""===strMessageId){if("top"===lStrErrorMsg||"left"===lStrErrorMsg){$(objElement).prev().html("");$(objElement).prev().append(getErrorHtml(strError,strErrorPosition))}if("right"===lStrErrorMsg||"bottom"===lStrErrorMsg){$(objElement).next().html("");$(objElement).next().append(getErrorHtml(strError,strErrorPosition))}}else{$(strMessageId).children("#"+strValidName).remove();$(strMessageId).append(getErrorHtml(strError,"summary",strValidName))}else{var span=document.createElement("span");var objPostion=$(objElement).offset();var objWidth=$(objElement).outerWidth();var objHeight=$(objElement).outerHeight();$(span).toggleClass("validation-has-error icon_nb_error_16");"top"!==lStrErrorMsg&&"bottom"!==lStrErrorMsg||$(span).toggleClass("validation-arrow-vertical");"left"!==lStrErrorMsg&&"right"!==lStrErrorMsg||$(span).toggleClass("validation-arrow-horizontal");scope.nbValidator&&scope.nbValidator.atagInfo&&$(span).attr("atag",scope.nbValidator.atagInfo);$(span).attr("id",strValidName);$(span).attr("uib-tooltip","{{tooltipStrError}}");$(span).attr("tooltip-placement",strErrorPosition);$(span).attr("tooltip-append-to-body","true");$(span).attr("tooltip-class","validation-error-tooltip");$(span).css({fontSize:"18px",zIndex:999,position:"absolute"});var spanScope=scope.$new();spanScope.tooltipStrError=strError;angular.element(objElement).after($compile(span)(spanScope));$(span).offset({top:objPostion.top+objHeight/2-8+arrIconOffset[0],left:objPostion.left+objWidth-20+arrIconOffset[1]})}}else{objElement.toggleClass("validation-error-input");if(bIsShowErrorStr)if(null==strMessageId||""===strMessageId){"top"!==lStrErrorMsg&&"left"!==lStrErrorMsg||$(objElement).prev().html("");"right"!==lStrErrorMsg&&"bottom"!==lStrErrorMsg||$(objElement).next().html("")}else $(strMessageId).children("#"+strValidName).remove();else{if(!$(objElement).next().hasClass("validation-has-error"))return;var tooltip1=angular.element($(objElement).next());tooltip1.scope().$destroy();tooltip1.remove()}}};var checkValidation=function(strValue,arrRules){var value=null==strValue?"":strValue.toString();var deferred=$q.defer();var firstValidatorName=arrRules[0].ruleId;$timeout((function(){for(var i=0,ii=arrRules.length;i<ii;i+=1)if("customized"===firstValidatorName||"required"===firstValidatorName||""!==strValue||"matchField"===arrRules[i].ruleId||"required"===arrRules[i].ruleId){var validator=nbValidationSrvc.getValidator(arrRules[i].ruleId);if("function"!=typeof validator)throw new Error("Could not find validator: "+arrRules[i].ruleId);var params={};angular.copy(arrRules[i].params,params);params&&params.validateCondition&&!1===params.validateCondition()||validator(value,params)||deferred.resolve({valid:!1,validatorIndex:i,validator:arrRules[i].ruleId})}deferred.resolve({valid:!0,validatorIndex:-1,validator:""})}));return deferred.promise};return{restrict:"A",require:"ngModel",scope:{model:"=ngModel",nbValidatorCondition:"=",nbValidateIf:"=",nbValidator:"=",nbValidationResult:"=",nbValidationEvent:"="},link:function(scope,element,attrs,ctrl){var _s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};var _watcher=function(){};scope._isValid={valid:!0,validatorIndex:-1};scope.nbValidator=scope.nbValidator||{};var strValidMethod=scope.nbValidator.method||"watch";var arrValidRules=[];var emptyArr=[];var strValidName=scope.nbValidator.name||_s4()+_s4()+_s4()+_s4();var strMessageId=scope.nbValidator.messageId||"";var strErrorMessage=scope.nbValidator.errorMessage;var bShowError=!0===scope.nbValidator.showErrorMessage;var strErrorPosition=(scope.nbValidator.errorTipPosition||bShowError?scope.nbValidator.errorTipPosition:"right").toLowerCase();var arrIconOffset=scope.nbValidator.offset&&_.isArray(scope.nbValidator.offset)?scope.nbValidator.offset:[0,0];"function"==typeof scope.nbValidatorCondition?scope.watches=["model",function(){return scope.nbValidatorCondition()},"nbValidateIf"]:scope.watches=["model","nbValidatorCondition","nbValidateIf"];scope.$on("$destroy",(function(){_watcher()}));scope.nbValidationEvent&&(scope.nbValidationEvent.execValidate=function(fn){if($(element).next().hasClass("validation-has-error")){angular.element($(element).next()).remove();fn(scope,element)}});function unifyRulesObj(){if(scope.nbValidator)if(scope.nbValidator.rules&&_.isArray(scope.nbValidator.rules)){arrValidRules=[];for(var i=0;i<scope.nbValidator.rules.length;i+=1){var tempRuleItem=scope.nbValidator.rules[i];"string"==typeof tempRuleItem?arrValidRules.push({ruleId:tempRuleItem,params:{}}):"object"===_typeof(tempRuleItem)&&arrValidRules.push(tempRuleItem)}}else arrValidRules=[{ruleId:"required",params:{}}]}unifyRulesObj();var validObj={valid:!0,validatorIndex:-1,validator:""};scope.$watch((function(){if(scope.nbValidator){if(!1!==scope.nbValidateIf)return scope.nbValidator.rules?scope.nbValidator.rules:emptyArr;scope._isValid=validObj}}),(function(newArr,oldArr){_.isEqual(newArr,oldArr)||unifyRulesObj()}));if(""===strMessageId&&bShowError){"bottom"!==strErrorPosition&&"right"!==strErrorPosition||$(element).after("<span></span>");"left"!==strErrorPosition&&"top"!==strErrorPosition||$(element).before("<span></span>")}!function(){"blur"===strValidMethod&&element.bind("blur",(function(){$timeout((function(){var value=ctrl.$viewValue;arrValidRules&&arrValidRules.length>0&&(null==value||0===value.length)&&"number"===element.attr("type")&&!element[0].validity.valid&&(value=".");if(!1!==scope.nbValidateIf){!ctrl.$pristine||void 0!==ctrl.$viewValue&&null!==ctrl.$viewValue||(value="");checkValidation(value,arrValidRules).then((function(result){scope._isValid=result}))}else scope._isValid={valid:!0,validatorIndex:-1,validator:""}}))}));scope.$on("submit-validation",(function(event,objForm){var value=ctrl.$viewValue;if(!1!==scope.nbValidateIf){ctrl.$pristine&&void 0===ctrl.$viewValue&&(value="");checkValidation(value,arrValidRules).then((function(result){scope._isValid=result;if(!scope._isValid.valid){var err=angular.copy(scope._isValid);err.scrollIntoView=function(args){element[0].scrollIntoView(args)};objForm.errors.push(err)}objForm.status=scope._isValid.valid&&objForm.status;_watcher();_watcher=scope.$watchGroup(scope.watches,(function(values){void 0!==values[0]&&null!==values[0]||(values[0]="");!1!==values[2]?checkValidation(values[0],arrValidRules).then((function(result2){scope._isValid=result2})):scope._isValid={valid:!0,validatorIndex:-1,validator:""}}))}))}else scope._isValid={valid:!0,validatorIndex:-1,validator:""}}));"watch"===strValidMethod&&(_watcher=scope.$watchGroup(scope.watches,(function(values){void 0!==values[0]&&null!==values[0]||(values[0]="");if(ctrl.$pristine&&ctrl.$viewValue)ctrl.$setViewValue(ctrl.$viewValue);else if(ctrl.$pristine)return;!1!==values[2]?checkValidation(values[0],arrValidRules).then((function(result){scope._isValid=result})):scope._isValid={valid:!0,validatorIndex:-1,validator:""}})))}();scope.$watch("_isValid",(function(newValue,oldValue){var strError="";var isValid=newValue.valid;var oldIsValid=oldValue.valid;var isDyMsg=!1;if("object"===_typeof(arrValidRules[newValue.validatorIndex])){var errorMsgFromFunction=arrValidRules[newValue.validatorIndex].dynamicErrorMsgFunc?arrValidRules[newValue.validatorIndex].dynamicErrorMsgFunc(scope.model):null;errorMsgFromFunction&&0==errorMsgFromFunction.length&&(errorMsgFromFunction=null);isDyMsg=!!errorMsgFromFunction;strError=attrs.nbValidationMessage||errorMsgFromFunction||arrValidRules[newValue.validatorIndex].errorMessage||strErrorMessage||nbValidationSrvc.getValidatorMessage(newValue.validator);"maxLength"===arrValidRules[newValue.validatorIndex].ruleId&&arrValidRules[newValue.validatorIndex].params.length>0&&(strError=strError.replace(/128/gi,arrValidRules[newValue.validatorIndex].params.length))}else strError=attrs.nbValidationMessage||strErrorMessage||nbValidationSrvc.getValidatorMessage(newValue.validator);(isDyMsg||isValid!==oldIsValid||newValue.validatorIndex!==oldValue.validatorIndex)&&(void 0===isValid&&null==isValid||toggleErrorMsg(element,!isValid,bShowError,strError,strErrorPosition,strMessageId,strValidName,scope,arrIconOffset,!oldIsValid));scope.nbValidationResult=isValid}));scope.$on("reset-validation",(function(){toggleErrorMsg(element,!1,bShowError,"",strErrorPosition,strMessageId,strValidName,scope,arrIconOffset,!1);scope._isValid.valid=void 0}));scope.$on("clear-validation",(function(){scope._isValid={valid:!0,validatorIndex:-1,validator:""}}))}}}])}(NetBrain);!function(){angular.module("nb.ng").directive("nbFeature",nbFeature);nbFeature.$inject=["nb.ng.featureSrvc"];function nbFeature(featureSrvc){return{restrict:"A",link:function(scope,element,attrs){var featureName=attrs.nbFeature;featureSrvc.isFeatureValid(featureName)||element.remove()}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.callbackSrvc",CallbackSrvc);CallbackSrvc.$inject=[];function CallbackSrvc(){var _callbackList=[];function _getCallback(ID){var returnMothod=null;angular.forEach(_callbackList,(function(callbackObj){ID==callbackObj.ID&&(returnMothod=callbackObj.callbackMethod)}));return returnMothod}function _unRegisterCallback(ID){var index=_callbackList.map((function(v){return v.ID})).indexOf(ID);-1!=index&&_callbackList.splice(index,1)}return{registerCallback:function(ID,callbackMethod){return function(ID,callbackMethod){null!==_getCallback(ID)&&_unRegisterCallback(ID);_callbackList.push({ID:ID,callbackMethod:callbackMethod});return!0}(ID,callbackMethod)},getCallback:function(ID){return _getCallback(ID)},unRegisterCallback:function(ID){return _unRegisterCallback(ID)}}}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(NetBrain){angular.module("nb.ng").service("nb.ng.utilitySrvc",utilitySrvc);utilitySrvc.$inject=["$q","$log","$window","$interval","$timeout","$document","$translate"];function utilitySrvc($q,$log,$window,$interval,$timeout,$document,$translate){this.wrapAsAsync=function(fn){return function(){try{var result=fn.apply(null,arguments);return $q.resolve(result)}catch(ex){console.error(ex);return $q.reject(ex)}}};this.isIE=function(){return Utility.isIE.call(this)};this.openTarget=function(url){var link=angular.element('<a href="'+url+'" target="_blank"></a>');angular.element(document.body).append(link);link[0].click();link.remove()};this.getDocumentPosition=function(event){return function(event){var parentPosition=function(element){var xPosition=0;var yPosition=0;for(;element;){xPosition+=element.offsetLeft-element.scrollLeft+element.clientLeft;yPosition+=element.offsetTop-element.scrollTop+element.clientTop;element=element.offsetParent}return{x:xPosition,y:yPosition}}(event.currentTarget);var xPosition=event.clientX-parentPosition.x;var yPosition=event.clientY-parentPosition.y;return{x:xPosition,y:yPosition}}(event)};this.setElementPosition=function(position,element,isSetX,isSetY){return function(position,element,isSetX,isSetY){var doc=$document[0].documentElement;var docLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),docTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elementWidth=element[0].scrollWidth,elementHeight=element[0].scrollHeight;var docWidth=doc.clientWidth+docLeft,docHeight=doc.clientHeight+docTop,totalWidth=elementWidth+position.x,totalHeight=elementHeight+position.y,left=Math.max(position.x-docLeft,0),top=Math.max(position.y-docTop,0);totalWidth>docWidth&&(left-=totalWidth-docWidth);totalHeight>docHeight&&(top-=totalHeight-docHeight);isSetX&&element.css("left",left+"px");isSetY&&element.css("top",top+"px");return{top:top,left:left}}(position,element,isSetX,isSetY)};this.getGUID=function(){return Utility.getGUID()};this.getTxTime=function(){return(new Date).getTime()};this.getUserAgent=function(){return $window.navigator.userAgent};this.replacer=function(key,value){return Utility.replacer(key,value)};this.limitString=function(inStr,limitInt){return inStr.length<limitInt?inStr:inStr.substring(0,limitInt)+"..."};this.killTimer=function(promise){return function(promise){$log.info("$interval - refreshData: Compiled");if(angular.isDefined(promise)){$interval.cancel(promise);promise=void 0}}(promise)};this.formatDate=function(date){return TimeUtil.formatDate(date)};this.formatDateTime=function(date){return TimeUtil.formatDateTime(date)};this.formatTime=function(time){return TimeUtil.formatTime(time)};this.format=function(date,formatter){return TimeUtil.format(date,formatter)};this.csvConvertToArray=function(csv){return CSVToArrayFullMatch(csv)};this.isValidDate=function(date){var dateObj=date;"string"!=typeof date&&"number"!=typeof date||(dateObj=new Date(date));return"[object Date]"===Object.prototype.toString.call(dateObj)&&!isNaN(dateObj)};this.hasProp=function(obj,key){if(!obj||_.isUndefined(key))return!1;var keys=key.split("."),keysLen=keys.length;for(var i=0;i<keysLen;i++){key=keys[i];if(!_.has(obj,key))return!1;obj=obj[key]}return!0};this.formatString=function(str,data){if(!str||void 0===data)return str;if("object"!==_typeof(data)){var args=arguments,reg=new RegExp("{([0-"+(args.length-1)+"])}","g");return str.replace(reg,(function(match,index){return args[index- -1]}))}for(var key in data)({}).hasOwnProperty.call(data,key)&&(str=str.replace(new RegExp("{"+key+"}","g"),data[key]));return str};this.ip2int=function(ip){ip=ip.split(".");var num=256*Number(ip[0])*256*256+256*Number(ip[1])*256+256*Number(ip[2])+Number(ip[3]);return num>>>=0};this.ip2Mask=function(ip){var mask;if(ip&&(ip=ip.split("."))&&4===ip.length){var ip2String=(1*ip[0]).toString(2).concat((1*ip[1]).toString(2)).concat((1*ip[2]).toString(2)).concat((1*ip[3]).toString(2));mask=0;for(var i=0;i<ip2String.length;i+=1)mask+=1*ip2String[i]}return mask.toString()};this.second2Age=function(second){var age="";if(second){var w=Math.floor(second/604800);var divisorW=second%604800;var d=Math.floor(divisorW/86400);var divisorD=divisorW%86400;var h=Math.floor(divisorD/3600);var divisorH=divisorD%3600;var m=Math.floor(divisorH/60);var s=divisorH%60;age=0!==w?w+"w"+d+"d":0!==d?d+"d"+formatNumber(h)+"h":formatNumber(h)+":"+formatNumber(m)+":"+formatNumber(s)}return age};this.toShowStr=function(str,disableU,disableC){if(!str)return str;disableU||(str=str.substr(0,1).toUpperCase()+str.substr(1));if(!disableC&&"."!==str.charAt(str.length-1))return str+".";return str};this.getQueryString=function(name,url){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");url||(url=window.location.search);var r=url.substr(1).match(reg);return null!=r?unescape(r[2]):null};this.setQueryString=function(name,value){var s=window.location.search.substr(1).split("&");var q={};var qs=[];s.forEach((function(query){var p=query.split("=");q[decodeURIComponent(p[0])]=decodeURIComponent(p[1])}));q[name]=value;null!=value&&""!==value||delete q[name];Object.keys(q).forEach((function(key){qs.push(key+"="+q[key])}));var url=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+qs.join("&");if(window.history&&window.history.pushState){window.history.pushState({path:url},"",url);angular.element($window).triggerHandler("popstate")}};this.setQueryString=function(name,value){var s=window.location.search.substr(1).split("&");var q={};var qs=[];s.forEach((function(query){var p=query.split("=");q[decodeURIComponent(p[0])]=decodeURIComponent(p[1])}));q[name]=value;null!=value&&""!==value||delete q[name];Object.keys(q).forEach((function(key){qs.push(key+"="+q[key])}));var url=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+qs.join("&");if(window.history&&window.history.pushState){window.history.pushState({path:url},"",url);angular.element($window).triggerHandler("popstate")}};this.replaceParameter=function(name,value){var s=window.location.search.substr(1).split("&");var q={};var qs=[];s.forEach((function(query){var p=query.split("=");q[decodeURIComponent(p[0])]=decodeURIComponent(p[1])}));q[name]=value;null!=value&&""!==value||delete q[name];Object.keys(q).forEach((function(key){qs.push(key+"="+q[key])}));return window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+qs.join("&")};this.translate=function(key,opt){var result=$q.defer();$translate(key,opt).then((function(value){result.resolve(value)}),(function(s){result.resolve(s)}));return result.promise};this.translateMulti=function(keys,opts){var result=$q.defer();$translate(keys,opts).then((function(translations){result.resolve(translations)}),(function(){result.resolve(keys)}));return result.promise};this.parseURLParam2Json=function(keyValues){var obj={};keyValues.indexOf("?")>-1&&(keyValues=keyValues.substring(keyValues.indexOf("?")+1));angular.forEach((keyValues||"").split("&"),(function(keyValue){var splitPoint,key,val;if(keyValue){key=keyValue=keyValue.replace(/\+/g,"%20");if(-1!==(splitPoint=keyValue.indexOf("="))){key=keyValue.substring(0,splitPoint);val=keyValue.substring(splitPoint+1)}key=tryDecodeURIComponent(key);if(angular.isDefined(key)){val=!angular.isDefined(val)||tryDecodeURIComponent(val);hasOwnProperty.call(obj,key)?isArray(obj[key])?obj[key].push(val):obj[key]=[obj[key],val]:obj[key]=val}}}));return obj};this.addParameter2Url=function(name,value){var s=window.location.search.substr(1).split("&");var q={};var qs=[];s.forEach((function(query){var p=query.split("=");q[decodeURIComponent(p[0])]=decodeURIComponent(p[1])}));q[name]=value;null!=value&&""!==value||delete q[name];Object.keys(q).forEach((function(key){qs.push(key+"="+q[key])}));return window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+qs.join("&")};this.removeIP=function(aList,vsep,IP){return function(aList,vsep,IP){if(null==vsep)return;for(var i=0;i<aList.length;i+=1)if(vsep.name===aList[i].name){var j=0;for(j=0;j<vsep.vseps.length&&IP.id!==vsep.vseps[j].id;j+=1);j<vsep.vseps.length&&vsep.vseps.splice(j,1);break}}(aList,vsep,IP)};this.cloneJson=function(obj){return Utility.cloneJson(obj)};this.cloneObject=function(obj){return Utility.cloneObject(obj)};this.upperFirstLetter=function(str){return _.isString(str)?str[0].toUpperCase()+str.substring(1,str.length):""};this.getLocalStorage=function(name){return function(name){try{var raw=window.localStorage[name];if(raw&&"undefined"!==raw&&"null"!==raw){var parsed=JSON.parse(raw);return parsed||null}}catch(ex){$log.info("getLocalStorage Exception "+ex)}return null}(name)};this.setLocalStorage=function(name,value){return function(name,value){var raw=window.localStorage[name];var localObject=raw&&"undefined"!==raw&&"null"!==raw?JSON.parse(raw):{};null!==value&&"undefined"!==localObject.value?localObject=value:delete localObject[name];var serialized=JSON.stringify(localObject);window.localStorage.setItem(name,serialized)}(name,value)};this.removeLocalStorage=function(name){return function(name){window.localStorage.removeItem(name)}(name)};this.removeSessionStorage=function(name){return function(name){window.sessionStorage.removeItem(name)}(name)};this.getSessionStorage=function(name){return function(name){try{var raw=window.sessionStorage[name];if(raw&&"undefined"!==raw&&"null"!==raw){var parsed=JSON.parse(raw);return parsed||null}}catch(ex){$log.info("_getSessionStorage Exception "+ex)}return null}(name)};this.setSessionStorage=function(name,value){return function(name,value){var raw=window.sessionStorage[name];var localObject=raw&&"undefined"!==raw&&"null"!==raw?JSON.parse(raw):{};null!==value&&"undefined"!==localObject.value?localObject=value:delete localObject[name];var serialized=JSON.stringify(localObject);window.sessionStorage.setItem(name,serialized)}(name,value)};this.getErrorMessage=function(reason){return reason&&reason.ResultDesc?reason.ResultDesc:reason&&reason.ExceptionMessage?reason.ExceptionMessage:reason&&reason.Message?reason.Message:reason&&reason.errorDescription?reason.errorDescription:_.isString(reason)?reason:""};this.setLoginSignReadOnce=function(){return this.setSessionStorage("LOGIN_SIGN_READ_ONCE",!0)};this.getLoginSignReadOnce=function(){var loginSign=this.getSessionStorage("LOGIN_SIGN_READ_ONCE");loginSign&&this.removeSessionStorage("LOGIN_SIGN_READ_ONCE");return loginSign};this._obj={};this.setValue=function(name,value){this._obj[name]=value};this.getValue=function(name){return this._obj[name]};this.isIpOrIpMask=function(ip){return Utility.isIpOrIpMask(ip)};this.isValidRegular=function(regString){return Utility.isValidRegular(regString)};this.isAJAXRequesting=!1;this.delayMaskingTimer=null;this.enableLoadingMode=function(delayTime,allowOP){return _enableLoadingMode.call(this,delayTime,allowOP)};this.disableLoadingMode=function(){return _disableLoadingMode.call(this)};this.decodeEntities=function(encodedString){var element=document.implementation.createHTMLDocument("").createElement("div");var getText=function(str){element.innerHTML=str;str=element.textContent;element.textContent="";return str};return function(str){if(str&&"string"==typeof str){var x=getText(str);for(;str!==x;){str=x;x=getText(x)}return x}}(encodedString)};this.secondsToHms=function(d){d=Number(d);var h=Math.floor(d/3600);var m=Math.floor(d%3600/60);return(h>0?h+"h "+(m<10?"0":""):"")+m+"m "+Math.floor(d%3600%60)+"s"};this.CSV2JSON=function(csv,headerMapping){var array=function(strData,strDelimiter){strDelimiter=strDelimiter||",";var objPattern=new RegExp("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]*))","gi");var arrData=[[]];var arrMatches=null;for(;arrMatches=objPattern.exec(strData);){var strMatchedDelimiter=arrMatches[1];var strMatchedValue;strMatchedDelimiter.length&&strMatchedDelimiter!==strDelimiter&&arrData.push([]);(strMatchedValue=arrMatches[2]?arrMatches[2].replace(new RegExp('""',"g"),'"'):arrMatches[3])&&strMatchedValue.length>0&&arrData[arrData.length-1].push(strMatchedValue)}return arrData}(csv);var objArray=[];for(var i=1;i<array.length;i+=1){objArray[i-1]={};for(var k=0;k<array[0].length&&k<array[i].length;k+=1){var key=array[0][k];if(!key)break;if("ID"===key&&0===array[i][k].length)break;key=headerMapping[key];objArray[i-1][key]=array[i][k]}}return JSON.stringify(objArray).replace(/},/g,"},\r\n")};this.StringtoObjectArray=function(csv,headerMapping){var array=CSVToArrayFullMatch(csv);var objArray=[];for(var i=1;i<array.length;i+=1){objArray[i-1]={};for(var k=0;k<array[0].length&&k<array[i].length;k+=1){var key=array[0][k];if(!key)break;if("ID"===(key=key.trim())&&0===array[i][k].length)break;key=headerMapping[key];objArray[i-1][key]=array[i][k]}}return objArray};this.sortNumber=function(a,b){return a+0>b+0?1:a+0<b+0?-1:0};this.innerJoin=function(arr1,prop1,arr2,prop2){return arr1.map((function(item){var p=item[prop1];var el=arr2.filter((function(item1){return item1[prop2]===p}));if(0===el.length)return null;var res=item;for(var ii in item)ii!==prop1&&(res[ii]=item[ii]);for(var i2 in el[0])i2!==prop2&&(res[i2]=el[0][i2]);return res})).filter((function(el){return null!==el}))};this.formatNumberBySegmet=function(number,seg){seg=seg||",";"number"==typeof number&&(number+="");return number.replace(/(?=(?!\b)(\d{3})+$)/g,seg)};this.resolveSequencialPromises=function(promises){promises.reduce((function(promiseChain,currentTask){return promiseChain.then(currentTask)}),$q.resolve())};this.getUniqueName=function(arr,name){if(-1===arr.indexOf(name))return name;var trimmedName=name.replace(/(\d)+$/,"");var maxAppendix=arr.reduce((function(max,item){var appendix=item.replace(trimmedName,"");return/^\d+$/.test(appendix)?max>parseInt(appendix)?max:parseInt(appendix):max}),0);return trimmedName+ ++maxAppendix};function CSVToArrayFullMatch(strData,strDelimiter){if(0===strData.length)return[];strDelimiter=strDelimiter||",";var objPattern=new RegExp("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]*))","gi");var arrData=[[]];var arrMatches=null;for(;arrMatches=objPattern.exec(strData);){var strMatchedDelimiter=arrMatches[1];var strMatchedValue;strMatchedDelimiter.length&&strMatchedDelimiter!==strDelimiter&&arrData.push([]);strMatchedValue=arrMatches[2]?arrMatches[2].replace(new RegExp('""',"g"),'"'):arrMatches[3];arrData[arrData.length-1].push(strMatchedValue)}1===arrData[arrData.length-1].length&&""===arrData[arrData.length-1][0]&&arrData.splice(arrData.length-1,1);return arrData}function _enableLoadingMode(delayTime,allowOP){var that=this;var delay=delayTime||50;that.isAJAXRequesting=!0;clearTimeout(that.delayMaskingTimer);that.delayMaskingTimer=setTimeout((function(){if(that.isAJAXRequesting){var mask=document.createElement("DIV");mask.innerHTML='<div style="position:absolute;right:3%;top:95%;font-size: large; color: #0F749A;"><i class="fa fa-cog fa-lg fa-spin" style="color: #06A3DD;"></i>&nbsp;&nbsp; Loading...</div>';mask.id="nbAJAXCallMask";mask.style.cssText=allowOP?"top:0;left:0;right:0;bottom:0;z-index:9999;opacity:1;cursor:wait;":"position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;opacity:1;cursor:wait;";document.body.appendChild(mask)}}),delay)}function _disableLoadingMode(){var mask=document.querySelector("#nbAJAXCallMask");if(mask){mask.style.cursor="default";document.body.style.cursor="default";document.body.removeChild(mask)}this.isAJAXRequesting=!1}function formatNumber(number){return number<10?"0"+number:number}this.setMenuPosition=function(menu,defaultPosition,ele){var position=this.calculateMenuPosition(menu,defaultPosition,ele);menu.css("top",position.top+"px");menu.css("left",position.left+"px")};this.calculateMenuPosition=function(menu,defaultPosition,ele){var containerEle=ele||$document.get(0).body;var docLeft=(window.pageXOffset||containerEle.scrollLeft)-(containerEle.clientLeft||0),docTop=(window.pageYOffset||containerEle.scrollTop)-(containerEle.clientTop||0),elementWidth=menu.get(0).scrollWidth,elementHeight=menu.get(0).scrollHeight;var docWidth=containerEle.clientWidth+docLeft,docHeight=containerEle.clientHeight+docTop,totalWidth=elementWidth+defaultPosition.left,totalHeight=elementHeight+defaultPosition.top,left=Math.max(defaultPosition.left-docLeft,0),top=Math.max(defaultPosition.top-docTop,0);totalWidth>docWidth&&(left=left-(totalWidth-docWidth)-5);totalHeight>docHeight&&(top=top-(totalHeight-docHeight)-5);return{top:top,left:left}};this.checkSpecialChars=function(string){for(var i=0;i<"<>@!#%^&()+[]{}?:;|'\"\\,./~`=".length;i+=1)if(string.indexOf("<>@!#%^&()+[]{}?:;|'\"\\,./~`="[i])>-1)return!0;return!1};return;function tryDecodeURIComponent(value){try{return decodeURIComponent(value)}catch(e){}return value}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.http3rdPartyApiIntegrationSrvc",Http3rdPartyApiIntegrationSrvc);Http3rdPartyApiIntegrationSrvc.$inject=["nb.ng.nbHttp"];function Http3rdPartyApiIntegrationSrvc(nbHttp){function ajax(url,method,requestData){return nbHttp[method.toLowerCase()](url,requestData)}function post(url,requestData){return ajax(url,"POST",requestData)}function get(url,requestData){return ajax(url,"GET",requestData)}function remove(url,requestData){return ajax(url,"DELETE",requestData)}return{getPluginBriefList:function(){return get("Admin/ThirdPartyApiPlugin/GetPluginBriefList")},getAllPluginName:function(){return get("Admin/ThirdPartyApiPlugin/GetAllPluginName")},getPlugin:function(data){return get("Admin/ThirdPartyApiPlugin/GetPlugin/"+data)},deletePlugin:function(data){return remove("Admin/ThirdPartyApiPlugin/DeletePlugin/"+data)},deleteBatchAPIPlugin:function(data){return remove("Admin/ThirdPartyApiPlugin/DeleteBatchAPIPlugin",data)},upSertAPIPlugin:function(data){return post("Admin/ThirdPartyApiPlugin/UpSertAPIPlugin",data)},getAPIFunctions:function(data){return post("Admin/ThirdPartyApiPlugin/GetAPIFunctions",data)},getAPIFunctionsById:function(data){return get("Admin/ThirdPartyApiPlugin/GetAPIFunctionsById/"+data)},getAPIFunctionsByName:function(data){return get("Admin/ThirdPartyApiPlugin/GetAPIFunctionsByName/"+data)},testAPIPlugin:function(data){return post("Admin/ThirdPartyApiPlugin/TestAPIPlugin",data)},getPluginSetting:function(data){return get("Admin/ThirdPartyApiPlugin/GetPluginSetting/"+data)}}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.sessionSrvc",SessionSrvc);SessionSrvc.$inject=["$rootScope","$location","nb.ng.nbHttp","nb.ng.utilitySrvc"];function SessionSrvc($rootScope,$location,nbHttp,utilitySrvc){var _fullPermission;var _timer;return{setToken:_setToken,getToken:_getToken,removeToken:function(scope){_setToken(scope,"")},buildTokenName:__buildTokenName,clearSelectedTenantDomainId:function(){_setSelectedTenantId("");_setSelectedDomainIds([]);_setSelectedTenantId("",!0);_setSelectedDomainIds([],!0)},getDataSrc:function(){return{TenantGuid:_getSelectedTenantId(),DomainGuid:_getSelectedDomainIds()}},setRedirectFlag:function(isRedirect){utilitySrvc.setSessionStorage(NetBrain.NG.LocalStorageDefine.IS_REDIRECT_FROM_NB_TAB,isRedirect)},setSelectedTenantId:_setSelectedTenantId,getSelectedTenantId:_getSelectedTenantId,clearRedirectSessionStorage:_clearRedirectSessionStorage,setSelectedDomainIds:_setSelectedDomainIds,getSelectedDomainIds:_getSelectedDomainIds,initSetTenantDomain:function(){var path=$location.path();_clearRedirectSessionStorage();if(path.indexOf("/domainAdmin")>-1){$rootScope.selectedTenantId=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.DOMAIN_MGT_TENANT_ID);$rootScope.selectedDomainIds=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.DOMAIN_MGT_DOMAIN_IDS)}else{$rootScope.selectedTenantId=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid)||"";$rootScope.selectedDomainIds=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids)||""}},setFullPermission:function(fullPermission,scope){utilitySrvc.setLocalStorage("system"===scope?NetBrain.NG.LocalStorageDefine.userPermissions.system:NetBrain.NG.LocalStorageDefine.userPermissions.mainUi,fullPermission);_fullPermission=fullPermission},getFullPermission:function(scope){return void 0!==_fullPermission?_fullPermission:utilitySrvc.getLocalStorage("system"===scope?NetBrain.NG.LocalStorageDefine.userPermissions.system:NetBrain.NG.LocalStorageDefine.userPermissions.mainUi)},setDomainMgtIds:function(){utilitySrvc.setSessionStorage(NetBrain.NG.LocalStorageDefine.DOMAIN_MGT_TENANT_ID,$rootScope.selectedTenantId||"");utilitySrvc.setSessionStorage(NetBrain.NG.LocalStorageDefine.DOMAIN_MGT_DOMAIN_IDS,$rootScope.selectedDomainIds||[])},setPageSession:function(identity,name,type,options){""!==window.name&&null!=window.name&&void 0!==window.name?_clearPageSession():window.name=utilitySrvc.getGUID();NetBrain.Page.Guid=window.name;NetBrain.Page.Identity=identity;NetBrain.Page.Name=name;NetBrain.Page.Type=type;NetBrain.Page.Url=window.location.href;NetBrain.Page.Options=options;NetBrain.Page.Time=(new Date).getTime();var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];if(void 0===_.find(pages,(function(page1){return page1[0]===NetBrain.Page.Guid}))){pages.push([NetBrain.Page.Guid,NetBrain.Page.Identity,NetBrain.Page.Name,NetBrain.Page.Type,NetBrain.Page.Url,NetBrain.Page.Options,NetBrain.Page.Time,_getSelectedTenantId(),_getSelectedDomainIds()[0],NetBrain.Page.Time]);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,pages)}clearTimeout(_timer);options&&options.keepalived&&(_timer=setTimeout((function(){!function ___keepalive(){nbHttp.get("users/keepalive/"+NetBrain.Page.Guid,{},{avoidBlockUI:!0}).then((function(){_timer=setTimeout((function(){___keepalive()}),NetBrain.NG.ConfigSettings.KEEP_ALIVE_INTERVAL)}),(function(){_timer=setTimeout((function(){___keepalive()}),NetBrain.NG.ConfigSettings.KEEP_ALIVE_INTERVAL)}))}()}),1e3))},getPageSession:function(){if(""===window.name||null==window.name||void 0===window.name)return;var guid=window.name;var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];return __convertPageSession(_.find(pages,(function(page1){return page1[0]===guid})))},clearPageSession:_clearPageSession,getPageSessionIfOpend:_getPageSessionIfOpend,getPageSessionIfRealAlived:function(identity,type){var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];var filterPages=_.filter(pages,(function(page1){return page1[1]===identity&&page1[3]===type&&page1[8]===_getSelectedDomainIds()[0]}));filterPages=_.sortBy(filterPages,(function(p){return p[9]}));var now=(new Date).getTime();var lastPage;var removePages=[];filterPages.forEach((function(p){var pageObj=__convertPageSession(p);if(now-pageObj.KeepAliveTime<500)lastPage=pageObj;else{_.difference(pages,[p]);removePages.push(p)}}));if(removePages.length>0){pages=_.filter(pages,(function(p){return 0==_.any(removePages,(function(p1){return p[0]==p1[0]}))}));utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,pages)}return lastPage},updateOpendPageSession:function(){if(""===window.name||null==window.name||void 0===window.name)return;var guid=window.name;var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];var page=_.find(pages,(function(page1){return page1[0]===guid}));if(void 0!==page){var newPages=_.difference(pages,[page]);page[9]=(new Date).getTime();newPages.push(page);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,newPages)}},getAllCurrentPages:function(){var types=[NetBrain.NG.Const.PageType.Desktop,NetBrain.NG.Const.PageType.Map,NetBrain.NG.Const.PageType.Dashboard,NetBrain.NG.Const.PageType.Parser,NetBrain.NG.Const.PageType.RunBook,NetBrain.NG.Const.PageType.QappEditor,NetBrain.NG.Const.PageType.QappGroup];var allPages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];var pages=_.filter(allPages,(function(page){return page[8]===_getSelectedDomainIds()[0]&&_.contains(types,page[3])}));var p=_.filter(_.map(pages,__convertPageSession),(function(page){return void 0!==page}));return _.sortBy(p,(function(page){return 0-page.Time}))},hasPageOpend:function(identity,type){return void 0!==_getPageSessionIfOpend(identity,type)},keepSession:function(){return nbHttp.get("users/keepSession/"+NetBrain.Page.Guid,{},{avoidBlockUI:!0})}};function _setToken(scope,token){utilitySrvc.setLocalStorage(__buildTokenName(scope),token);var newToken=_getToken(scope);void 0!==ngHub&&ngHub.getInstance().setToken(newToken.accessToken)}function _getToken(scope){var token=utilitySrvc.getLocalStorage(__buildTokenName(scope));return token=null==token?{}:token}function __buildTokenName(scope){var inIFrame=!1;try{inIFrame=window.self!==window.top}catch(e){inIFrame=!0}var id=inIFrame?NetBrain.NG.LocalStorageDefine.nbEmbedMapId:NetBrain.NG.LocalStorageDefine.nbuserId;return"system"===scope?id.system:id.mainUi}function _clearRedirectSessionStorage(){if(utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.IS_REDIRECT_FROM_NB_TAB)){utilitySrvc.removeSessionStorage(NetBrain.NG.LocalStorageDefine.IS_REDIRECT_FROM_NB_TAB);utilitySrvc.removeSessionStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid);utilitySrvc.removeSessionStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids)}}function _setSelectedTenantId(selectedTenantId,setToLocalStorage){if(setToLocalStorage)utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid,selectedTenantId);else{utilitySrvc.setSessionStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid,selectedTenantId);$rootScope.selectedTenantId=selectedTenantId}}function _getSelectedTenantId(){var idInRootScope=$rootScope.selectedTenantId;var idInSessionStorage=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid);var idInLocalStorage=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.selectedTenantGuid);return null==idInRootScope||""==idInRootScope?null==idInSessionStorage||""==idInSessionStorage?idInLocalStorage||"":idInSessionStorage:idInRootScope}function _setSelectedDomainIds(selectedDomainIds,setToLocalStorage){if(setToLocalStorage)utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids,selectedDomainIds||[]);else{utilitySrvc.setSessionStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids,selectedDomainIds||[]);$rootScope.selectedDomainIds=selectedDomainIds}}function _getSelectedDomainIds(){var idsInRootScope=$rootScope.selectedDomainIds||[];var idsInSessionStorage=utilitySrvc.getSessionStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids)||[];var idsInLocalStorage=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.selectedDomainGuids)||[];return""==idsInRootScope||idsInRootScope==[]?""==idsInSessionStorage||idsInSessionStorage==[]?idsInLocalStorage:idsInSessionStorage:idsInRootScope}function _clearPageSession(){if(""!==window.name&&null!=window.name&&void 0!==window.name){var guid=window.name;var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];var page=_.find(pages,(function(page1){return page1[0]===guid}));void 0!==page&&utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,_.difference(pages,[page]));clearTimeout(_timer)}}function _getPageSessionIfOpend(identity,type){var pages=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES)||[];return __convertPageSession(_.find(pages,(function(page1){return page1[1]===identity&&page1[3]===type&&page1[8]===_getSelectedDomainIds()[0]})))}function __convertPageSession(obj){var page;if(_.isArray(obj)){(page={}).Guid=obj[0];page.Identity=obj[1];page.Name=obj[2];page.Type=obj[3];page.Url=obj[4];page.Options=obj[5];page.Time=obj[6];page.SelectedTenantId=obj[7];page.SelectedDomainIds=obj[8];page.KeepAliveTime=obj[9]}return page}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.multiTabEventSrvc",MultiTabEventSrvc);MultiTabEventSrvc.$inject=["$rootScope","$location","nb.ng.utilitySrvc"];function MultiTabEventSrvc($rootScope,$location,utilitySrvc){var _eventList=[];$(window).on("storage",(function(e){if(e.originalEvent.key===NetBrain.NG.LocalStorageDefine.MultiTab_EVENT_Trigger){var item=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.MultiTab_EVENT_Trigger);if(null!=item&&void 0!==item&&void 0!==item.event){var args=item.data;var event=item.event;var events=_.filter(_eventList,(function(item1){return item1.event===event}));_.each(events,(function(item2){_.isFunction(item2.callback)&&item2.callback.apply(null,args)}))}}}));return{on:function(event,callback){var eventId=utilitySrvc.getGUID();var item={eventId:eventId,event:event,callback:callback};_eventList.push(item);return eventId},off:function(eventId){var item=_.find(_eventList,(function(item1){return item1.eventId===eventId}));void 0!==item&&(_eventList=_.difference(_eventList,[item]))},trigger:function(event){var args=Array.prototype.slice.call(arguments,1);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.MultiTab_EVENT_Trigger,{event:event,data:args,random:(new Date).getTime()})}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.permissionSrvc",PermissionSrvc);PermissionSrvc.$inject=["$rootScope","$log","nb.ng.sessionSrvc"];function PermissionSrvc($rootScope,$log,sessionSrvc){var SYSTEM_ADMIN="systemAdmin";var USER_MANAGER="userManager";var SYSTEM_MANAGER="systemManager";var TENANT_ADMIN="tenantAdmin";var DOMAIN_ADMIN="domainAdmin";return{setFullPermission:function(fullPermission,scope){sessionSrvc.setFullPermission(fullPermission,scope)},getFullPermission:_getFullPermission,hasSystemRole:_hasSystemRole,hasTenantRole:_hasTenantRole,hasDomainRole:_hasDomainRole,hasSystemPermission:_hasSystemPermission,hasTenantPermission:_hasTenantPermission,hasDomainPermission:_hasDomainPermission,anyPermission:function(permission){return _hasSystemPermission(permission)||_hasTenantPermission(permission)||_hasDomainPermission(permission)},getSystemRoles:function(scope){var set=_getFullPermission(scope);return set?set.roles:{}},isSystemAdminRole:function(scope){return _hasSystemRole(SYSTEM_ADMIN,scope)},hasUserManagePermission:function(scope){if(_hasSystemRole(USER_MANAGER,scope))return!0;return _hasSystemPermission("userManagement",scope)},hasSystemManagementPermission:function(scope){if(_hasSystemRole(SYSTEM_MANAGER,scope))return!0;return _hasSystemPermission("systemManagement",scope)},isTenantAdminRole:function(scope){if(_hasSystemRole(SYSTEM_ADMIN,scope)||_hasTenantRole(TENANT_ADMIN,scope))return!0;return!1}};function _getFullPermission(scope){return sessionSrvc.getFullPermission(scope)}function _hasSystemRole(role,scope){var set=_getFullPermission(scope);return set&&set.roles&&_.contains(set.roles,role)}function _hasTenantRole(role,scope){var set=_getFullPermission(scope);if(set&&set.tenants){var currTenant=_.find(set.tenants,(function(tenant){return tenant.id===sessionSrvc.getSelectedTenantId()}));if(currTenant&&currTenant.roles)return _.contains(currTenant.roles,role)}return!1}function _hasDomainRole(role,scope){var set=_getFullPermission(scope);if(set&&set.tenants&&sessionSrvc.getSelectedDomainIds().length>0){var currTenant=_.find(set.tenants,(function(tenant){return tenant.id===sessionSrvc.getSelectedTenantId()}));if(currTenant&&currTenant.domains){var currDomain=_.find(currTenant.domains,(function(domain){return domain.id===sessionSrvc.getSelectedDomainIds()[0]}));if(currDomain&&currDomain.roles)return _.contains(currDomain.roles,role)}}return!1}function _hasSystemPermission(permission,scope){if(_hasSystemRole(SYSTEM_ADMIN,scope))return!0;var set=_getFullPermission(scope);return set&&set.permissions&&_.contains(set.permissions,permission)}function _hasTenantPermission(permission,scope){if(_hasSystemRole(SYSTEM_ADMIN,scope)||_hasTenantRole(TENANT_ADMIN,scope))return!0;var set=_getFullPermission(scope);if(set&&set.tenants){var currTenant=_.find(set.tenants,(function(tenant){return tenant.id===sessionSrvc.getSelectedTenantId()}));if(currTenant&&currTenant.permissions)return _.contains(currTenant.permissions,permission)}return!1}function _hasDomainPermission(permission,scope){if(_hasSystemRole(SYSTEM_ADMIN,scope)||_hasTenantRole(TENANT_ADMIN,scope)||_hasDomainRole(DOMAIN_ADMIN,scope))return!0;var set=_getFullPermission(scope);if(set&&set.tenants&&sessionSrvc.getSelectedDomainIds().length>0){var currTenant=_.find(set.tenants,(function(tenant){return tenant.id===sessionSrvc.getSelectedTenantId()}));if(currTenant&&currTenant.domains){var currDomain=_.find(currTenant.domains,(function(domain){return domain.id===sessionSrvc.getSelectedDomainIds()[0]}));if(currDomain&&currDomain.permissions)return _.contains(currDomain.permissions,permission)}}return!1}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.tenantSessionSrvc",TenantSessionSrvc);TenantSessionSrvc.$inject=["nb.ng.nbHttp","$log","nb.ng.sessionSrvc"];function TenantSessionSrvc(nbHttp,$log,sessionSrvc){var _tenantObj=null;var _isSeatAvailable=null;return{getTenantDomain:function(){return _tenantObj},clearTenantDomain:function(){_tenantObj=null},setTenantDomain:_setTenantDomain,addTenantDomain:_updateTenantDomain,updateTenantDomain:_updateTenantDomain,updateAllTenant:function(tenantObjs){if(!tenantObjs)return tenantObjs;if(!tenantObjs)return;_tenantObj.obj=tenantObjs},updateDomainByGuid:function(tenantGuid,domainGuid,domainName,domainDescr,domainNodeSize){if(!_tenantObj)return;for(var index=0;index<_tenantObj.obj.length;index+=1)if(_tenantObj.obj[index].ID===tenantGuid)for(var j=0;j<_tenantObj.obj[index].domains.length;j+=1){var currDomain=_tenantObj.obj[index].domains[j];if(currDomain.guid===domainGuid){currDomain.name=domainName;currDomain.description=domainDescr;currDomain.nodeSize=domainNodeSize;break}}return!0},deleteTenantDomain:function(tenantObj){if(!tenantObj)return tenantObj;if(!_tenantObj)return;for(var index=0;index<_tenantObj.obj.length;index+=1)if(_tenantObj.obj[index].ID===tenantObj.ID){_tenantObj.obj.splice(index,1);break}_setTenantDomain(_tenantObj.getJsData());return!0},getAllDomainDisplayNamesInDB:function(){if(!_tenantObj)return;var lsDomainNames=[];var lsTenants=_tenantObj.obj;if(!lsTenants||0===lsTenants.length)return[];lsTenants.forEach((function(tenant){var lsDomains=tenant.domains;lsDomains&&lsDomains.length>0&&lsDomains.forEach((function(domain){lsDomainNames.push(domain.name)}))}));return lsDomainNames},getAllDomainDisplayNameInTenant:function(argTenantId){if(!argTenantId||!_tenantObj)return;var lsDomainDisplayNames=[];var lsTenants=_tenantObj.obj;if(!lsTenants||0===lsTenants.length)return[];var currTenant=_.find(lsTenants,(function(tenant){return tenant.ID===argTenantId}));void 0!==currTenant&&void 0!==currTenant.domains&&currTenant.domains.length>0&&(lsDomainDisplayNames=currTenant.domains.map((function(domain){return domain.name})));return lsDomainDisplayNames},getTenantUserIdList:function(){if(!_tenantObj)return;var currTenant=null;for(var i=0;i<_tenantObj.obj.length;i+=1)if(_tenantObj.obj[i].ID===sessionSrvc.getSelectedTenantId()){currTenant=_tenantObj.obj[i];break}if(null==currTenant){$log.error("Error in tenantSessionSrvc.getTenantUserIdList()");return}if(!currTenant.auths||jQuery.isEmptyObject(currTenant.auths)||0===currTenant.auths.length){$log.error("Error in tenantSessiongetTenantUserIdList()");return}return currTenant.auths.users},getSelectedTenant:function(){var selectedTenant=null;if(!_tenantObj)return selectedTenant;angular.forEach(_tenantObj.obj,(function(tenant){tenant.ID===sessionSrvc.getSelectedTenantId()&&(selectedTenant=tenant)}));return selectedTenant},getSelectedDomainsByIds:_getSelectedDomainsByIds,getSelectedDomains:function(){return _getSelectedDomainsByIds(sessionSrvc.getSelectedDomainIds())},addNewDomain:function(newDomain){for(var i=0;i<_tenantObj.obj.length;i+=1){var currTenant=_tenantObj.obj[i];if(currTenant.ID===sessionSrvc.getSelectedTenantId()){currTenant.domains||(currTenant.domains=[]);currTenant.domains.push(newDomain);return!0}}return!1},deleteDomain:function(guidDomainToDelete){if(!_tenantObj||!_tenantObj.obj)return;for(var i=0;i<_tenantObj.obj.length;i+=1){var currTenant=_tenantObj.obj[i];if(currTenant.domains)for(var j=0;j<currTenant.domains.length;j+=1)if(currTenant.domains[j].guid===guidDomainToDelete){currTenant.domains.splice(j,1);return!0}}return!1},getFirstDomain:function(){for(var i=0;i<_tenantObj.obj.length;i+=1){var currTenant=_tenantObj.obj[i];if(currTenant.ID===sessionSrvc.getSelectedTenantId())return currTenant.domains&&0!==currTenant.domains.length?currTenant.domains[0]:null}return null},setTenantSeatAvailable:function(isSeatAvailable){_isSeatAvailable=isSeatAvailable},getTenantSeatAvailable:function(){return _isSeatAvailable},checkTenantAvailableSeats:function(tenantId,isForCurrentUser){return nbHttp.get("Admin/Tenant/checkTenantAvailableSeats/"+tenantId+"/"+isForCurrentUser)}};function _setTenantDomain(tenant){var tenantObj=tenant.getJsData?tenant.getJsData():tenant;if(!tenantObj)return tenantObj;null!==_tenantObj&&null!==_tenantObj.obj||(_tenantObj=new NetBrain.NG.Model.DataSrcWrapper);_tenantObj.setJsData(tenantObj);return!0}function _updateTenantDomain(tenantObj){if(!tenantObj)return tenantObj;if(_tenantObj){for(var i=0;i<_tenantObj.obj.length;i+=1)if(_tenantObj.obj[i].ID===tenantObj.ID){_tenantObj.obj.splice(i,1);_tenantObj.obj.splice(i,0,tenantObj);return!0}_tenantObj.obj.push(tenantObj);return!0}}function _getSelectedDomainsByIds(selectedDomainIds){if(!_tenantObj)return[];var selectedTenantdomains=_tenantObj.getDomainsByTenantId(sessionSrvc.getSelectedTenantId());var selectedDomains=[];angular.forEach(selectedTenantdomains,(function(objTenantDomain){angular.forEach(selectedDomainIds,(function(objSelectedDomainId){objSelectedDomainId===objTenantDomain.guid&&selectedDomains.push(objTenantDomain)}))}));return selectedDomains}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.errorHandleSrvc",ErrorHandleSrvc);ErrorHandleSrvc.$inject=["$log","$window","$injector","nb.framework.stackTraceSrvc"];function ErrorHandleSrvc($log,$window,$injector,stackTraceSrvc){var _errorCache=[];var FATAL_ERROR=NetBrain.NG.ConfigSettings.FATAL_ERROR;var DEBUG_MODE=NetBrain.NG.ConfigSettings.DEBUG_MODE;var buildErrorObj=function(exMsg,cause,exObj){return{errorUrl:$window.location.href,errorMessage:exMsg.toString(),errorStack:void 0!==exObj?stackTraceSrvc.getErrorStack({e:exObj,guess:!0}):[],errorCause:cause||"",timeStamp:Date.now()}};$window.closeErrorBox=function(event){var errorBox=event.target.parentNode.parentNode.parentNode;$(errorBox).remove()};$window.submitErrorBox=function(){};$window.onerror=function(ex,url,line,col,exObj){$injector.get("$timeout")((function(){var isFromAngular=exObj.fromAngular;var isFatalError=FATAL_ERROR;var errorData=isFromAngular?_errorCache[_errorCache.length-1]:buildErrorObj(ex,url,exObj);if(!isFatalError)throw ex;errorBox='<div style="width:100vw;height:100vh;position:absolute;background-color:rgba(255,255,255,.5);top:0;left:0;z-index: 9999;" id="error-box"><div style="min-width: 40%;height:auto;padding: 1em;position: absolute;top: 30%;left: 30%;border: 1px solid gray;border-radius: 5px;background-color: rgb(233, 239, 245);"><label><i class="fa fa-warning fa-2x" style="color:darkred;margin-right: .5em;"></i>Program stopped due to the following error: </label><br><br><label style="color:red;font-weight:bold;">'+(exception=errorData).errorMessage+'</label><br><span>Error stack trace: </span><div style="width:100%;height: 200px;overflow-y:auto;border:1px solid lightgrey;color:gray;background-color: white;">'+exception.errorStack.join("<br><br>")+'</div><div style="width:100%;text-align: right;"><button class="btn btn-default" onclick="closeErrorBox(event)" style="margin-top:1em;">Close</button><button class="btn btn-primary" onclick="submitErrorBox(event)" style="margin-top:1em;margin-left: 1em;">Submit</button></div></div></div>',angular.element(document.body).append(errorBox);var exception,errorBox}))};return function(exception,cause){exception.fromAngular=!0;var errorData=buildErrorObj(exception.toString(),cause,exception);_errorCache.length>0?_errorCache[_errorCache.length-1].errorMessage!==errorData.errorMessage&&_errorCache.push(errorData):_errorCache.push(errorData);if(DEBUG_MODE)throw exception;$log.error(exception,{Debug_Info:errorData})}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.httpAuthSrvc",HttpAuthSrvc);HttpAuthSrvc.$inject=["$q","$log","$filter","$location","$window","$timeout","$rootScope","$uibModalStack","nb.ng.utilitySrvc","nb.ng.sessionSrvc","nb.ng.tenantSessionSrvc","nb.ng.userSrvc","nb.ng.nbHttp","nb.ng.licenseSrvc","$uibModal","nb.ng.deviceAccessCacheSrvc"];function HttpAuthSrvc($q,$log,$filter,$location,$window,$timeout,$rootScope,$uibModalStack,utilitySrvc,sessionSrvc,tenantSessionSrvc,userSrvc,nbHttp,licenseSrvc,$uibModal,deviceAccessCacheSrvc){var _jsDataSystemConf=null;return{login:function(userId,passwd,authentication,scope,loginType){var deferred=$q.defer();var loginNOE="system"!==scope?NetBrain.NG.LocalStorageDefine.loginUserName.mainUi:NetBrain.NG.LocalStorageDefine.loginUserName.system,loginAuth="system"===scope?NetBrain.NG.LocalStorageDefine.loginAuth.system:NetBrain.NG.LocalStorageDefine.loginAuth.mainUi;userId||(userId="");passwd||(passwd="");nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var key,pwdRtn;if(!data||data.length<2)pwdRtn=passwd;else if(""!==passwd){setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,passwd)}pwdRtn||(pwdRtn="");var tokenData="grant_type=password&username="+encodeURIComponent(userId)+"&password="+pwdRtn+"&client_id="+NetBrain.NG.ConfigSettings.CLIENT_ID+"&scope="+scope;authentication&&authentication.id&&(tokenData+="&authentication_id="+authentication.id);void 0!==loginType&&(tokenData+="&login_type="+loginType);nbHttp.post("GenerateAccessToken",tokenData,{headers:{},contentType:"application/x-www-form-urlencoded"}).then((function(response){nbHttp.get(NetBrain.NG.Model.APIURL.GET_USER_FULL_PERMISSIONS,null,{headers:{Authorization:"Bearer "+response.access_token}}).then((function(data2){sessionSrvc.setToken(scope,{accessToken:response.access_token,tokenType:response.token_type,refreshToken:response.refresh_token,userId:response.userId});sessionSrvc.setFullPermission(data2,scope);utilitySrvc.setLocalStorage(loginNOE,response.userName);utilitySrvc.setLocalStorage(loginAuth,authentication||{id:response.authentication_id||"",alias:response.authentication_name||"NetBrain",type:parseInt(response.authentication_type)||0});sessionSrvc.clearSelectedTenantDomainId();ngHub.getInstance().informLogin();licenseSrvc.getLicense(!1).then((function(resultLicense){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,resultLicense);$q.all([_getCloudMode(),_getAllowShareState(),deviceAccessCacheSrvc.initDeviceAccessCacheDB()]).then((function(res){utilitySrvc.setLocalStorage("allowShare",res[1]);NetBrain.NG.ConfigSettings.couldMode=res[0];utilitySrvc.setLocalStorage("cloudMode",res[0]);deferred.resolve(tenantSessionSrvc.getTenantDomain())}),(function(){NetBrain.NG.ConfigSettings.couldMode=!1;utilitySrvc.setLocalStorage("cloudMode",!1);deferred.resolve(tenantSessionSrvc.getTenantDomain())}))}),(function(reason){sessionSrvc.setFullPermission({},scope);deferred.reject(reason)}))}),(function(reason){sessionSrvc.setFullPermission({},scope);deferred.reject(reason)}))}),(function(reason){deferred.reject(reason)}))}),(function(reason){deferred.reject(reason)}));return deferred.promise},reLogin:function(userId,passwd,authentication,scope,isForce){authentication=authentication||{id:"",alias:"NetBrain",type:0};var deferred=$q.defer();var loginNOE="system"===scope?NetBrain.NG.LocalStorageDefine.loginUserName.system:NetBrain.NG.LocalStorageDefine.loginUserName.mainUi,loginAuth="system"===scope?NetBrain.NG.LocalStorageDefine.loginAuth.system:NetBrain.NG.LocalStorageDefine.loginAuth.mainUi;userId||(userId="");passwd||(passwd="");nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var key,pwdRtn;if(!data||data.length<2)pwdRtn=passwd;else if(""!==passwd){setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,passwd)}pwdRtn||(pwdRtn="");var tokenData="grant_type=password&username="+encodeURIComponent(userId)+"&password="+pwdRtn+"&client_id="+NetBrain.NG.ConfigSettings.CLIENT_ID+"&authentication_id="+authentication.id+"&scope="+scope+"&login_type="+isForce;nbHttp.post("GenerateAccessToken",tokenData,{headers:{},contentType:"application/x-www-form-urlencoded"}).then((function(response){sessionSrvc.setToken(scope,{accessToken:response.access_token,tokenType:response.token_type,refreshToken:response.refresh_token,userId:response.userId});utilitySrvc.setLocalStorage(loginNOE,response.userName);utilitySrvc.setLocalStorage(loginAuth,authentication);deviceAccessCacheSrvc.initDeviceAccessCacheDB().then((function(){deviceAccessCacheSrvc.createDomainDBCommon(sessionSrvc.getSelectedDomainIds()[0])}));deferred.resolve(response)}),(function(reason){deferred.reject(reason)}))}));return deferred.promise},refreshPermission:function(scope){var deferred=$q.defer();nbHttp.get(NetBrain.NG.Model.APIURL.GET_USER_FULL_PERMISSIONS,null,{headers:{Authorization:"Bearer "+sessionSrvc.getToken(scope).accessToken}}).then((function(data){sessionSrvc.setFullPermission(data,scope)}),(function(reason){sessionSrvc.setFullPermission({},scope);deferred.reject(reason)}));return deferred.promise},logout:function(scope){var data={scope:scope};var deferred=$q.defer();var waitSSOLogout=function(scope){if(_getSsoLogoutUrl(scope)){var iframe=document.getElementsByName("ssoLogoutIframe");try{iframe=document.createElement('<iframe name="ssoLogoutIframe"></iframe>')}catch(e){(iframe=document.createElement("iframe")).name="ssoLogoutIframe"}iframe.width="0";iframe.height="0";iframe.src=_getSsoLogoutUrl(scope);document.body.appendChild(iframe);return!0}return!1}(scope);var waitSSOLogoutTimeOut=0;waitSSOLogout&&(waitSSOLogoutTimeOut=3e3);$timeout((function(){nbHttp.post("Session/Logout",data,{}).then((function(result){tenantSessionSrvc.clearTenantDomain();sessionSrvc.clearSelectedTenantDomainId();sessionSrvc.removeToken(scope);userSrvc.initData({});ngHub.getInstance().informLogout();deferred.resolve(result)}),(function(reason){tenantSessionSrvc.clearTenantDomain();sessionSrvc.clearSelectedTenantDomainId();sessionSrvc.removeToken(scope);utilitySrvc.removeLocalStorage("allowShare");userSrvc.initData({});deferred.resolve(reason)}))}),waitSSOLogoutTimeOut);return deferred.promise},sessionTest:_sessionTest,isValidSession:function(){return nbHttp.get("Session/IsValidSession")},forceLogout:function(scope){tenantSessionSrvc.clearTenantDomain();sessionSrvc.clearSelectedTenantDomainId();sessionSrvc.removeToken(scope);userSrvc.initData({})},getAccessToken:_getAccessToken,isLoggedIn:function(scope){return null!=_getAccessToken(scope)},isNeedResignin:function(scope){if(null==sessionSrvc.getToken(scope).accessToken)return!0;var defer=$q.defer();defer.reject();return defer.promise},isNeedResigninFromTest:function(scope){if(null==sessionSrvc.getToken(scope).accessToken)return!0;var defer=$q.defer();_sessionTest().then((function(data){defer.reject(data)}),(function(reason){defer.resolve(reason)}));return defer.promise},reSignin:function(scope){"system"===scope?$window.location.replace($location.absUrl().split("admin.html")[0]+"admin.html#/adminLogin"):$window.location.href="login.html";$uibModalStack.dismissAll()},initSetTenantDomain:sessionSrvc.initSetTenantDomain,removeToken:sessionSrvc.removeToken,refreshToken:function(scope){var deferred=$q.defer();var token=sessionSrvc.getToken(scope);var clientId=NetBrain.NG.ConfigSettings.CLIENT_ID;var tokenData="grant_type=refresh_token&refresh_token="+(token.refreshToken||"")+"&client_id="+clientId+"&session_id="+(token.sessionId||"");nbHttp.post("GenerateAccessToken",tokenData,{headers:{},contentType:"application/x-www-form-urlencoded"}).then((function(response){sessionSrvc.setToken(scope,{accessToken:response.access_token,tokenType:response.token_type,refreshToken:response.refresh_token,userId:response.userId});deferred.resolve(response)}),(function(reason){deferred.reject(reason)}));return deferred.promise},getUserTenantRole:function(userId){if(!userId)return $q.resolve(null);var data={userId:userId};return nbHttp.post("Admin/User/getUserTenantRole",data,{headers:{}})},resetPasswordDialog:function(userInfo,passwordPolicy){return $uibModal.open({templateUrl:"modules/nbNG/views/adminChangePasswordDialog.html",controller:"nb.ng.adminChangePasswordDialogCtrl",windowClass:"userPasswordDialog",backdrop:"static",resolve:{resolveData:function(){return{userObj:userInfo,passwordPolicy:passwordPolicy}}}}).result},resetPassword:function(userIdAndPwd){var deferred=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var oldPwd=userIdAndPwd.oldPwd,newPwd=userIdAndPwd.newPwd,pwdForLogin=userIdAndPwd.newPwd;if(data&&data.length>=2&&""!==oldPwd&&""!==newPwd){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);oldPwd=encryptedString(key,oldPwd);newPwd=encryptedString(key,newPwd)}userIdAndPwd.oldPwd=oldPwd;userIdAndPwd.newPwd=newPwd;nbHttp.post("Admin/User/resetLoginPassword",userIdAndPwd).then((function(res){!0===res?deferred.resolve(pwdForLogin):deferred.reject(res)}),(function(err){deferred.reject(err)}))}));return deferred.promise},changePassword:function(userIdAndPwd){var deferred=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var oldPwd=userIdAndPwd.oldPwd,newPwd=userIdAndPwd.newPwd,pwdForLogin=userIdAndPwd.newPwd;if(data&&data.length>=2&&""!==oldPwd&&""!==newPwd){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);oldPwd=encryptedString(key,oldPwd);newPwd=encryptedString(key,newPwd)}userIdAndPwd.oldPwd=oldPwd;userIdAndPwd.newPwd=newPwd;nbHttp.post("Admin/User/changePassword",userIdAndPwd).then((function(res){!0===res?deferred.resolve(pwdForLogin):deferred.reject(res)}),(function(err){deferred.reject(err)}))}));return deferred.promise},adminChangePassword:function(userIdAndPwd){var deferred=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var newPwd=userIdAndPwd.newPwd,pwdForLogin=userIdAndPwd.newPwd;if(data&&data.length>=2&&""!==newPwd){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);newPwd=encryptedString(key,newPwd)}userIdAndPwd.newPwd=newPwd;nbHttp.post("Admin/User/changePasswordbyAdmin",userIdAndPwd).then((function(res){!0===res?deferred.resolve(pwdForLogin):deferred.reject(res)}),(function(err){deferred.reject(err)}))}));return deferred.promise},getRSAPublicKey:function(){return nbHttp.post("admin/getPublicKey",{},{}).then((function(data){if(data&&data.length>=2){setMaxDigits(129);return new RSAKeyPair(data[0],"",data[1])}return $q.reject()}))},recoverDataFromBackend:function(scope){var deferred=$q.defer();var tempUser=sessionSrvc.getToken(scope);var tempUserId=(tempUser=null==tempUser?{}:tempUser).userId||"";""===tempUserId?deferred.reject("invalidUserId"):_getUserInfo(tempUserId,scope).then((function(loginResult){if(loginResult){userSrvc.initData(loginResult.user);userSrvc.getUserConf().getJsWrapper().setId(loginResult.user.ID);tenantSessionSrvc.setTenantDomain(loginResult.tenant);_setCurrentUserSystemConf(loginResult.systemConf);tenantSessionSrvc.setTenantSeatAvailable(loginResult.isSeatAvailable)}deferred.resolve(tenantSessionSrvc.getTenantDomain())}),(function(reason){deferred.reject(reason)}));return deferred.promise},getCurrentUserSystemConf:function(){return _jsDataSystemConf},setCurrentUserSystemConf:_setCurrentUserSystemConf,getTenantByUserId:function(userId){var data={userId:userId};return nbHttp.post("Admin/Tenant/getTenantByUserId",data)},createNewTabTenantDomain:function(userId,tenantGuid,domainGuid){var data={scope:"mainUI",tenantId:tenantGuid,domainId:domainGuid};var deferred=$q.defer();nbHttp.post("Admin/Tenant/createNewTabTenantDomain",data).then((function(result){sessionSrvc.setSelectedTenantId(tenantGuid,!0);sessionSrvc.setSelectedDomainIds([domainGuid],!0);deferred.resolve(result)}),(function(reason){deferred.reject(reason)}));return deferred.promise},getLoginRedirectUrl:function(){var url=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_REDIRECT_URL);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_REDIRECT_URL,"");return url},setLoginRedirectUrl:function(url){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_REDIRECT_URL,url)},getSsoUrl:function(sso,scope,isRelogin){var webUrl=$location.protocol()+"://"+$location.host();$location.port()&&(webUrl+=":"+$location.port());var serverUrl=NetBrain.NG.ConfigSettings.API_ROOT+(StringUtil.endsWith(NetBrain.NG.ConfigSettings.API_ROOT,"/")?"":"/");serverUrl+="SSO/SAML2/AuthorizeService?alias="+encodeURIComponent(sso.alias)+"&scope="+scope+"&fromHost="+encodeURI(webUrl);isRelogin&&(serverUrl+="&isRelogin=true");return serverUrl},getSsoLogoutUrl:_getSsoLogoutUrl,getCloudMode:_getCloudMode,getLoginFailureRedirectUrl:function(){var url=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_REDIRECT_URL);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_REDIRECT_URL,"");return url},setLoginFailureRedirectUrl:function(url){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_REDIRECT_URL,url)},getLoginFailureError:function(){var error=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_ERROR);utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_ERROR,"");return error},setLoginFailureError:function(error){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.LOGIN_FAILURE_ERROR,error)},getDataSrc:sessionSrvc.getDataSrc,setRedirectFlag:sessionSrvc.setRedirectFlag,clearRedirectSessionStorage:sessionSrvc.clearRedirectSessionStorage,getSelectedTenantId:sessionSrvc.getSelectedTenantId,setSelectedTenantId:sessionSrvc.setSelectedTenantId,getSelectedDomainIds:sessionSrvc.getSelectedDomainIds,setSelectedDomainIds:sessionSrvc.setSelectedDomainIds,setDomainMgtIds:sessionSrvc.setDomainMgtIds,setTenantDomain:tenantSessionSrvc.setTenantDomain,addTenantDomain:tenantSessionSrvc.addTenantDomain,updateTenantDomain:tenantSessionSrvc.updateTenantDomain,updateAllTenant:tenantSessionSrvc.updateAllTenant,updateDomainByGuid:tenantSessionSrvc.updateDomainByGuid,deleteTenantDomain:tenantSessionSrvc.deleteTenantDomain,getTenantDomain:tenantSessionSrvc.getTenantDomain,getManageableTenants:function(){var accessibleTenants=tenantSessionSrvc.getTenantDomain();var fullPermission=sessionSrvc.getFullPermission("system");if(null!=fullPermission){if(null!=fullPermission.roles&&fullPermission.roles.length>0&&(_.indexOf(fullPermission.roles,"systemAdmin")>-1||_.indexOf(fullPermission.roles,"userManager")>-1||fullPermission.roles.includes("systemManager")))return accessibleTenants;var tenantPolicies=fullPermission.tenants;if(null!=tenantPolicies&&null!=accessibleTenants&&null!=accessibleTenants.obj){var mngTenantIds=$filter("filter")(tenantPolicies,(function(t){return null!=t.roles&&_.indexOf(t.roles,"tenantAdmin")>-1})).map((function(t){return t.id}));return{obj:$filter("filter")(accessibleTenants.obj,(function(tObj){return null!=tObj&&_.indexOf(mngTenantIds,tObj.ID)>-1}))}}}return{}},getAllDomainDisplayNamesInDB:tenantSessionSrvc.getAllDomainDisplayNamesInDB,getAllDomainDisplayNameInTenant:tenantSessionSrvc.getAllDomainDisplayNameInTenant,getTenantUserIdList:tenantSessionSrvc.getTenantUserIdList,getSelectedTenant:tenantSessionSrvc.getSelectedTenant,getSelectedDomainsByIds:tenantSessionSrvc.getSelectedDomainsByIds,getSelectedDomains:tenantSessionSrvc.getSelectedDomains,addNewDomain:tenantSessionSrvc.addNewDomain,deleteDomain:tenantSessionSrvc.deleteDomain,getFirstDomain:tenantSessionSrvc.getFirstDomain,getDomainsInfo:function(currDomainId,destDomainId){var data={domains:[currDomainId,destDomainId]};return nbHttp.post("Admin/Tenant/getTenentDomainInfo",data).then((function(returnData){return function(tenentDomains){var dic={};_.each(tenentDomains,(function(tenantDomain){dic[tenantDomain.domainId]=tenantDomain}));return{current:convertTenantDomain(dic[currDomainId]),destn:convertTenantDomain(dic[destDomainId])}}(returnData.tenentDomainInfos)}));function convertTenantDomain(tenantDomain){var newObj={};if(!tenantDomain){newObj.status=0;return newObj}newObj.status=tenantDomain.status;newObj.domain={id:tenantDomain.domainId,name:tenantDomain.domainName};newObj.tenant={id:tenantDomain.tenentId,name:tenantDomain.tenentName};return newObj}},getExternalAuthServers:function(flag){return nbHttp.get("ExternalAuthtication/AuthenticationServers/"+flag)},getLoginBanner:function(){return nbHttp.get("AdvancedSettings/LoginBanner")},getExternalAuthByAlias:function(alias){return nbHttp.get("ExternalAuthtication/alias?alias="+encodeURIComponent(alias))},getUserInfo:_getUserInfo,isNeedMorInfo:function(){return nbHttp.get("Admin/User/GetUserAdditionalInfo")},extraInfo:function(_userInfo){return $uibModal.open({templateUrl:"extraInfoDialog.html",controller:"nb.ng.extraInfoDialogCtrl",controllerAs:"extraInfoCtrl",windowClass:"externalUserEmailDialog",backdrop:"static",resolve:{userInfo:function(){return _userInfo}}}).result}};function _sessionTest(){return nbHttp.get("Session/Test")}function _getSsoLogoutUrl(scope){var loginAuthKey="system"===scope?NetBrain.NG.LocalStorageDefine.loginAuth.system:NetBrain.NG.LocalStorageDefine.loginAuth.mainUi;var loginAuth=utilitySrvc.getLocalStorage(loginAuthKey);var loginUserKey="system"===scope?NetBrain.NG.LocalStorageDefine.loginUserName.system:NetBrain.NG.LocalStorageDefine.loginUserName.mainUi;var loginUserName=utilitySrvc.getLocalStorage(loginUserKey);if(loginAuth&&loginUserName&&4===loginAuth.type){var webUrl=$location.protocol()+"://"+$location.host();$location.port()&&(webUrl+=":"+$location.port());var serverUrl=NetBrain.NG.ConfigSettings.API_ROOT+(StringUtil.endsWith(NetBrain.NG.ConfigSettings.API_ROOT,"/")?"":"/");return serverUrl+="SSO/SAML2/logout?alias="+encodeURIComponent(loginAuth.alias)+"&userName="+encodeURIComponent(loginUserName)+"&scope="+scope+"&fromHost="+encodeURI(webUrl)}return null}function _getUserInfo(userId,scope){var path="Admin/User/GetUserInfo/"+(scope=scope||"mainUI");return nbHttp.get(path)}function _getAccessToken(scope){var token=sessionSrvc.getToken(scope);return token=null==token?token:token.accessToken}function _setCurrentUserSystemConf(jsDataSystemConf){_jsDataSystemConf=jsDataSystemConf}function _getCloudMode(){var deferred=$q.defer();nbHttp.get("AdvancedSettings/CloudMode").then((function(cloudMode){deferred.resolve(cloudMode)}),(function(){deferred.reject(!1)}));return deferred.promise}function _getAllowShareState(){var deferred=$q.defer();nbHttp.get("systemSetting/allowShare").then((function(allowShare){deferred.resolve(allowShare)}),(function(){deferred.reject(!1)}));return deferred.promise}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.httpDownloadingSrvc",HttpDownloadingSrvc);HttpDownloadingSrvc.$inject=["nb.ng.nbHttp","nb.ng.sessionSrvc"];function HttpDownloadingSrvc(nbHttp,sessionSrvc){return{getTicket:getTicket,getSMTicket:function(){return get("ServiceMonitor/apply-for-ticket")},contentType:{CSV:"text/csv",ZIP:"application/zip",JSON:"application/json"},exportToCsv:function(data,fileName,authInfo){var csvContents=JSON.stringify(data);fileName=fileName||"my_data";authInfo=authInfo||{tenandId:sessionSrvc.getSelectedTenantId(),domainId:sessionSrvc.getSelectedDomainIds()[0]};getTicket().then((function(ticketData){var exportCSVUrl=NetBrain.NG.ConfigSettings.API_ROOT+"resource-fetcher/downloadCsv/";exportCSVUrl+="?dl_ticket="+ticketData+"&TenantGuid="+authInfo.tenandId+"&DomainGuid="+authInfo.domainId;var csvData=document.createElement("input");csvData.setAttribute("type","hidden");csvData.setAttribute("name","record");csvData.setAttribute("value",csvContents);var csvFileName=document.createElement("input");csvFileName.setAttribute("type","hidden");csvFileName.setAttribute("name","fileName");csvFileName.setAttribute("value",fileName);downloadFileUsingFormNoRedirect(exportCSVUrl,[csvData,csvFileName])}),(function(err){alert("failed to get downloading ticket...")}))},downloadFileByPost:function(url,data){url=filterUrl(url);var inputs=[];for(var key in data)if(Array.isArray(data[key]))for(var i=0;i<data[key].length;i++)isValidValue(data[key][i])&&(inputs[inputs.length]=createInput(key,data[key][i]));else isValidValue(data[key])&&(inputs[inputs.length]=createInput(key,data[key]));downloadFileUsingFormNoRedirect(url,inputs)},downloadFileUsingForm:function(url,InputList){url=filterUrl(url);var myForm=document.createElement("form");document.body.appendChild(myForm);InputList.forEach((function(input){myForm.appendChild(input)}));myForm.action=url;myForm.method="POST";myForm.enctype="application/x-www-form-urlencoded";myForm.submit();return!1},downloadFileUsingFormNoRedirect:downloadFileUsingFormNoRedirect,doDownload:function(fileContent,fileName,fileType){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(new Blob([fileContent],{type:fileType}),fileName);else{var blob=new Blob([fileContent],{type:fileType});var downloadLink=document.createElement("a");downloadLink.download=fileName;downloadLink.href=window.URL.createObjectURL(blob);downloadLink.onclick=function(){document.body.removeChild(downloadLink)};downloadLink.style.display="none";document.body.appendChild(downloadLink);downloadLink.click()}},downloadFile:function(url,fileName){url=filterUrl(url);var link=document.createElement("a");link.setAttribute("href",url);link.setAttribute("target","_blank");fileName&&link.setAttribute("download",fileName);document.body.appendChild(link);if(window.navigator.userAgent.indexOf("Safari")>0&&window.navigator.userAgent.indexOf("Mac OS")>0){var clickEv=document.createEvent("MouseEvents");clickEv.initEvent("click",!0,!0);link.dispatchEvent(clickEv)}else link.click()},doDownloadFromBase64:function(data,fileName,fileType){var byteCharacters=atob(data);var byteContent=[byteCharacters.length];for(var i=0;i<byteCharacters.length;i+=1)byteContent[i]=byteCharacters.charCodeAt(i);var fileContent=new Uint8Array(byteContent);this.doDownload(fileContent,fileName,fileType)}};function ajax(url,method,requestData){url=filterUrl(url);return nbHttp[method.toLowerCase()](url,requestData)}function get(url,requestData){return ajax(url=filterUrl(url),"GET",requestData)}function getTicket(){return get("resource-fetcher/apply-for-ticket")}function downloadFileUsingFormNoRedirect(url,InputList){url=filterUrl(url);var frame=document.createElement("iframe");frame.style.display="none";document.body.appendChild(frame);var myForm=document.createElement("form");frame.contentDocument.body.appendChild(myForm);InputList.forEach((function(input){myForm.appendChild(input)}));myForm.action=url;myForm.method="POST";myForm.enctype="application/x-www-form-urlencoded";myForm.submit();myForm.remove();return!1}function isValidValue(obj){return obj||0===obj}function createInput(name,value){var element=document.createElement("input");element.setAttribute("type","hidden");element.setAttribute("name",name);element.setAttribute("value",value);return element}function filterUrl(url){var prefix="";var rUrl=url;if(StringUtil.startsWith(url,"http://")){prefix="http://";rUrl=url.substring(7)}else if(StringUtil.startsWith(url,"https://")){prefix="https://";rUrl=url.substring(8)}return prefix+rUrl.replace(new RegExp("/{2,}","gm"),"/")}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.nbHttp",NBHttp);NBHttp.$inject=["$http","$q","$log","$rootScope","$window","$injector","$timeout","CacheFactory","nb.framework.stackTraceSrvc","nb.ng.utilitySrvc"];function NBHttp($http,$q,$log,$rootScope,$window,$injector,$timeout,CacheFactory,stackTraceSrvc,utilitySrvc){var nbHttp={};angular.forEach(["get","post","delete","put","patch"],(function(value){nbHttp[value]=function(url,data,options){return sendRequest.call(nbHttp,value.toUpperCase(),url,data,options)}}));nbHttp.CacheLevel=NetBrain.NG.Const.CacheLevel;nbHttp.OfflineCache=CacheFactory.get("offlineCache");nbHttp.OfflineCache||(nbHttp.OfflineCache=CacheFactory("offlineCache",{maxAge:36e5,cacheFlushInterval:18e5,deleteOnExpire:"aggressive",storageMode:"localStorage"}));return nbHttp;function sendRequest(method,url,data,options){var self=this;var avoidBlockUI=(options=options||{}).avoidBlockUI;var showLoading=options.showLoading;var _deferred=$q.defer();var _dataSrc={TenantGuid:$rootScope.selectedTenantId||"",DomainGuid:$rootScope.selectedDomainIds||""};var _params,_sendData;var _method=method||"POST";StringUtil.endsWith(NetBrain.NG.ConfigSettings.API_ROOT,"/")||(NetBrain.NG.ConfigSettings.API_ROOT=NetBrain.NG.ConfigSettings.API_ROOT+"/");StringUtil.startsWith(url,"/")&&(url=url.slice(1));var _url=NetBrain.NG.ConfigSettings.API_ROOT+url;var _headers=angular.extend({},{TenantGuid:_dataSrc.TenantGuid,DomainGuid:_dataSrc.DomainGuid});void 0!==options.headers&&(_headers=angular.extend(_headers,options.headers));if("GET"===_method.toUpperCase())_params=data;else{_headers["Content-Type"]=options.contentType?options.contentType:"application/json;charset=utf-8";_sendData="application/json;charset=utf-8"===_headers["Content-Type"]?JSON.stringify(data):data}var cacheKey=url;if("GET"===_method.toUpperCase()&&options.cache&&options.cacheLevel&&(cacheKey=function(level){var cKey="";switch(level){case self.CacheLevel.Global:cKey+=self.CacheLevel.Global;break;case self.CacheLevel.Tenant:cKey+=_dataSrc.TenantGuid;break;case self.CacheLevel.Domain:cKey+=_dataSrc.DomainGuid}return cKey}(options.cacheLevel)+cacheKey)!==url&&self.OfflineCache.get(cacheKey)){_deferred.resolve(self.OfflineCache.get(cacheKey));return _deferred.promise}avoidBlockUI?showLoading&&utilitySrvc.enableLoadingMode(options.delay,!0):utilitySrvc.enableLoadingMode(options.delay);$http({cache:options.cache||!1,url:_url,method:_method,params:_params,data:_sendData,timeout:options.timeout||!1,transformRequest:null,headers:_headers,responseType:options.responseType}).success((function(XHRObjs){!function(XHRObjs){avoidBlockUI&&!showLoading||utilitySrvc.disableLoadingMode();if(void 0!==XHRObjs.access_token||void 0===XHRObjs.operationResult){_deferred.resolve(XHRObjs);_canOfflineCache()&&self.OfflineCache.put(cacheKey,XHRObjs)}else{if(!XHRObjs.operationResult)return;if(0==XHRObjs.operationResult.ResultCode){_deferred.resolve(XHRObjs.data,XHRObjs.operationResult);_canOfflineCache()&&self.OfflineCache.put(cacheKey,XHRObjs.data)}else _deferred.reject(XHRObjs.operationResult)}}(XHRObjs)})).error((function(msg,statusCode){!function(msg){avoidBlockUI&&!showLoading||utilitySrvc.disableLoadingMode();_deferred.reject(msg)}(msg)}));return _deferred.promise;function _canOfflineCache(){var level=options.cacheLevel;return options.cache&&(level===self.CacheLevel.Global||level===self.CacheLevel.Tenant||level===self.CacheLevel.Domain)}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.nbValidationSrvc",nbValidationSrvc);nbValidationSrvc.$inject=["$q","$timeout","nb.ng.utilitySrvc"];function nbValidationSrvc($q,$timeout,utilitySrvc){var _specialChars=["'","/","\\",".",'"',"$","*","<",">",":","|","?","&","^","~","`","!","@","#","%","=","+","{","}","[","]",";",","];var mongoDbForbidChars=["/","\\",".",'"',"$","*","<",">",":","|","?"];var _monitorTaskNameSpecialChars=["\\","/",":","*","?",'"',"<",">","|"];var _generalForbidChars=["\\","/",":","*","?",'"',"<",">","|"];var _generalForbidWindowsAndMongoChars=["\\","/",":","*","?",'"',"<",">","|",".","$"];var _generalForbidWindowsAndMongoCharsAndComma=["\\","/",":","*","?",'"',"<",">","|",".","$",","];var isValidIP=function(strValue){return/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})(?::\d+)?$/g.test(strValue)};var arrValidatorMap={required:function(strValue){return 0!==strValue.length},minLength:function(strValue,params){var min=params.length||5;return strValue.length>=min},maxLength:function(strValue,params){var max=params.length||128;return strValue.length<=max},min:function(intValue,params){var intVal=Number(intValue);var returnVal="number"==typeof intVal;return returnVal=(returnVal=returnVal&&intVal%1==0)&&intVal>=params.min},max:function(intValue,params){var intVal=Number(intValue);var returnVal="number"==typeof intVal;return returnVal=(returnVal=returnVal&&intVal%1==0)&&intVal<=params.max},licenseMax:function(intValue,params){if(params.max<=-1)return!0;var intVal=Number(intValue);var returnVal="number"==typeof intVal;return returnVal=(returnVal=returnVal&&intVal%1==0)&&intVal<=params.max},pattern:function(strValue,params){return params.pattern.test(strValue)},matchField:function(strValue,params){return strValue===(params.matchField?params[params.matchField]:params.matchValue)},mismatchField:function(strValue,params){return strValue!==(params.value||params.name)},mismatchFieldIgnoreCase:function(strValue,params){var matchingField=params.value||params.name||"";return(strValue||"").toLowerCase()!==matchingField.toLowerCase()},email:function(strValue){return/^(([^<>()[\]\.,;:\s@\"\\]+(\.[^<>()[\]\.,;:\s@\"\\]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"\\]+\.)+[^<>()[\]\.,;:\s@\"\\]{2,})$/i.test(strValue)},ipv4:function(strValue){return utilitySrvc.isIpOrIpMask(strValue)},ipv6:function(strValue){return/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(strValue)},mac:function(strValue){return/^(([0-9a-fA-F]{2})(([/\s:.-][0-9a-fA-F]{2}){5}))|(([0-9a-fA-F]{4})(([/\s:.-][0-9a-fA-F]{4}){2}))$/.test(strValue)},ipv4OrIpv6:function(strValue,params){var reIpv4=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/;var rePpv6=/^\s*((([0-9A-Fa-f]{1,4}:){7}(([0-9A-Fa-f]{1,4})|:))|(([0-9A-Fa-f]{1,4}:){6}(:|((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})|(:[0-9A-Fa-f]{1,4})))|(([0-9A-Fa-f]{1,4}:){5}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){4}(:[0-9A-Fa-f]{1,4}){0,1}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){3}(:[0-9A-Fa-f]{1,4}){0,2}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){2}(:[0-9A-Fa-f]{1,4}){0,3}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:)(:[0-9A-Fa-f]{1,4}){0,4}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(:(:[0-9A-Fa-f]{1,4}){0,5}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})))(%.+)?\s*$/;return"ipv4"===(params=params||{}).sign?params.onlyABC?reIpv4.test(strValue)&&arrValidatorMap.ipv4OnlyABC(strValue):reIpv4.test(strValue):"ipv6"===params.sign?rePpv6.test(strValue):reIpv4.test(strValue)||rePpv6.test(strValue)},ipv4OnlyABC:function(ipv4){return parseInt(ipv4.split(".")[0])<224},ipv4AllIp:function(ipv4){return"0.0.0.0"===ipv4||"255.255.255.255"===ipv4},ipv4Mask:function(strValue,onlyABC){var reIpv4Mask=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)(\/([1-2]\d|3[0-2]|[89]))$/;return onlyABC?reIpv4Mask.test(strValue)&&arrValidatorMap.ipv4OnlyABC(strValue.split("/")[0]):reIpv4Mask.test(strValue)},ipv4MaskList:function(strValue,params){params=_.extend({separator:";"},params||{});var ipList=strValue.split(params.separator),ret=!0;for(var i=0;i<ipList.length;i++)if(!arrValidatorMap.ipv4Mask(ipList[i],params.onlyABC)){ret=!1;break}return ret},isNetworkOrBroadcastIpv4:function(ipv4Mask){var splitIpv4Mask=ipv4Mask.split("/"),ip=splitIpv4Mask[0],mask=splitIpv4Mask[1];var ipBin="";_.each(ip.split("."),(function(item){var numBin=parseInt(item).toString(2);for(;numBin.length<8;)numBin="0"+numBin;ipBin+=numBin}));var hostBits=ipBin.substring(parseInt(mask),32);return hostBits.length&&(/^0+$/.test(hostBits)||/^1+$/.test(hostBits))},ipv4MaskListNotNB:function(strValue,params){params=_.extend({separator:";"},params||{});var ipList=strValue.split(params.separator),ret=!0;for(var i=0;i<ipList.length;i++)if(arrValidatorMap.isNetworkOrBroadcastIpv4(ipList[i])){ret=!1;break}return ret},ipv6Mask:function(strValue){return/^((\s*((([0-9A-Fa-f]{1,4}:){7}(([0-9A-Fa-f]{1,4})|:))|(([0-9A-Fa-f]{1,4}:){6}(:|((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})|(:[0-9A-Fa-f]{1,4})))|(([0-9A-Fa-f]{1,4}:){5}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){4}(:[0-9A-Fa-f]{1,4}){0,1}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){3}(:[0-9A-Fa-f]{1,4}){0,2}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){2}(:[0-9A-Fa-f]{1,4}){0,3}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:)(:[0-9A-Fa-f]{1,4}){0,4}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(:(:[0-9A-Fa-f]{1,4}){0,5}((:((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(((25[0-5]|2[0-4]\d|[01]?\d{1,2})(\.(25[0-5]|2[0-4]\d|[01]?\d{1,2})){3})))(%.+)?\s*)(\/([1-9]\d?|1[0-2][0-8])))$/.test(strValue)},ipv6MaskList:function(strValue,params){params=_.extend({separator:";"},params||{});var ipList=strValue.split(params.separator),ret=!0;for(var i=0;i<ipList.length;i++)if(!arrValidatorMap.ipv6Mask(ipList[i])){ret=!1;break}return ret},ipv6EllipsisFill:function(ivp6){var splitIvp6=ivp6.split("::"),resultArray=[];if(""===splitIvp6[0]){resultArray=splitIvp6[1].split(":");for(;resultArray.length<8;)resultArray.unshift("0000")}else if(""===splitIvp6[1]){resultArray=splitIvp6[0].split(":");for(;resultArray.length<8;)resultArray.push("0000")}else{var tmpArrayBegin=splitIvp6[0].split(":"),tmpArrayEnd=splitIvp6[1].split(":");var middleArray=new Array(8-tmpArrayBegin.length-tmpArrayEnd.length);resultArray=tmpArrayBegin.concat(_.map(middleArray,(function(item){;"0000";return"0000"})),tmpArrayEnd)}return resultArray.join(":")},ipv6ZeroFill:function(ivp6){return _.map(ivp6.split(":"),(function(item){return item.length<4?function(str){for(;str.length<4;)str="0"+str;return str}(item):item})).join(":")},ipv6Completion:function(ivp6){var splitIvp6=ivp6.split("/");return arrValidatorMap.ipv6ZeroFill(-1!==splitIvp6[0].indexOf("::")?arrValidatorMap.ipv6EllipsisFill(splitIvp6[0]):splitIvp6[0])+(splitIvp6[1]?"/"+splitIvp6[1]:"")},isNetworkOrBroadcastIpv6:function(ipv6Mask){var splitIpv6Mask=ipv6Mask.split("/"),ip=splitIpv6Mask[0],mask=splitIpv6Mask[1];var ipBin="";_.each(ip.split(":"),(function(item){var numBin=parseInt(item,16).toString(2);for(;numBin.length<16;)numBin="0"+numBin;ipBin+=numBin}));var hostBits=ipBin.substring(parseInt(mask),128);return hostBits.length&&(/^0+$/.test(hostBits)||/^1+$/.test(hostBits))},ipv6MaskListNotNB:function(strValue,params){params=_.extend({separator:";"},params||{});var ipList=strValue.split(params.separator),ret=!0;for(var i=0;i<ipList.length;i++)if(arrValidatorMap.isNetworkOrBroadcastIpv6(arrValidatorMap.ipv6Completion(ipList[i]))){ret=!1;break}return ret},duplicatedIpMaskList:function(strValue,params){params=_.extend({separator:";"},params||{});var ipList=strValue.split(params.separator),s=strValue+params.separator,ret=!0;for(var i=0;i<ipList.length;i++)if(""!==ipList[i]&&s.replace(ipList[i]+params.separator,"").indexOf(ipList[i]+params.separator)>-1){ret=!1;break}return ret},IP:isValidIP,IPList:function(strValue){var ipArray=strValue.split(",");var ret=!0;ipArray.forEach((function(ipStr){var ip=ipStr.trim();isValidIP(ip)||(ret=!1)}));return ret},strongestPassword:function(strValue){return/^(((?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!\"#\$%\&'\(\)\*\+,\-\.\/:;\<=\>\?@\[\\\]\^_`\{\|\}~])))(?=.{8,128})/g.test(strValue)},strongPassword:function(strValue){return new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})").test(strValue)},normalPassword:function(strValue){return new RegExp("^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})").test(strValue)},duplicationChecker:function(strValue,params){if(null!=params&&null!=params.lsExistingNames&&params.lsExistingNames.length>0){var lsExistingNames=params.lsExistingNames;for(var i=0;i<lsExistingNames.length;i+=1)if(lsExistingNames[i].toLowerCase()===strValue.toLowerCase())return!1;return!0}return!0},phoneNumber:function(strValue){return/^\(?([0-9]*)\)?[-. ]?([0-9]*)[-. ]?([0-9]*)$/.test(strValue)},mongoUser:function(strValue,params){return params.regex.test(strValue)},mongoPassword:function(strValue,params){return params.regex.test(strValue)},mongoDBNameValidateChecker:function(strValue){for(var i=0;i<mongoDbForbidChars.length;i+=1){var specialChar=mongoDbForbidChars[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},specialChars:function(strValue,params){var chars=_specialChars;params&&params.specialChars&&(chars=params.specialChars);for(var i=0;i<chars.length;i+=1){var specialChar=chars[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},verifiyVariable:function(str){return new RegExp("^[a-zA-Z_][a-zA-Z\\d_]*$").test(str)},monitorTaskNameSpecialChars:function(strValue){for(var i=0;i<_monitorTaskNameSpecialChars.length;i+=1){var specialChar=_monitorTaskNameSpecialChars[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},generalForbidChars:function(strValue){for(var i=0;i<_generalForbidChars.length;i+=1){var specialChar=_generalForbidChars[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},generalForbidWindowsAndMongoChars:function(strValue){for(var i=0;i<_generalForbidWindowsAndMongoChars.length;i+=1){var specialChar=_generalForbidWindowsAndMongoChars[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},generalForbidWindowsAndMongoCharsAndComma:function(strValue){for(var i=0;i<_generalForbidWindowsAndMongoCharsAndComma.length;i+=1){var specialChar=_generalForbidWindowsAndMongoCharsAndComma[i];if(strValue.indexOf(specialChar)>=0)return!1}return!0},isPossibleName:function(strValue){return/^[0-9a-z;\-]*$/.test(strValue)},isInteger:function(strValue,params){if(strValue.indexOf(".")>=0||isNaN(strValue))return!1;try{var intValue=parseInt(strValue);return!(params.canOnlyBePositive&&intValue<0)&&(!(params.canOnlyBeNegative&&intValue>0)&&!(!params.canBeZero&&0===intValue))}catch(err){return!1}},isPositiveInteger:function(strValue){return/^(0|[1-9]\d*)$/.test(strValue)},isFloat:function(strValue){if(isNaN(strValue))return!1;try{parseFloat(strValue);return!0}catch(err){return!1}},isStrictFloat:function(strValue){return!isNaN(strValue)&&(Number(strValue)==strValue&&Number(strValue)%1!=0)},isGTE:function(strValue,params){var lowerStr=params[params.compareField].minValue;if(isNaN(strValue)||isNaN(lowerStr))return!1;if(isNaN(lowerStr)||isNaN(lowerStr))return!1;try{var upperValue=parseFloat(strValue);return parseFloat(lowerStr)<=upperValue}catch(err){return!1}},isFloatList:function(strValue){var numArr=strValue.split(",");for(var i=0;i<numArr.length;i+=1){var numValue=numArr[i].trim();if(isNaN(numValue))return!1;try{parseFloat(numValue)}catch(err){return!1}}return!0},customized:function(strValue,params){return params.func(params.param,strValue)},regExp:function(strValue){try{new RegExp(strValue);return!0}catch(e){return!1}},disconnect:function(strValue,params){var _pwdI=params.num;if(_pwdI){var _pwdArr=params.value.split("");for(var i=0;i<=_pwdArr.length-_pwdI;i++){var str="";for(var j=i;j<i+_pwdI;j++)str+=_pwdArr[j];if(-1!=strValue.indexOf(str))return!1}}return!0},itemMaxLength:function(strValue,params){var max=params.length||128;var newTags=strValue.replace(/\s/g,"").replace(/;{2,}/,";").replace(/;\s*$/,"").split(";");for(var i=0;i<newTags.length;i+=1)if(newTags[i].length>max)return!1;return!0},validUrl:function(strValue){return/^((https|http):\/\/((?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})|((([0-9a-zA-Z_!~*'()-]+\.)*([0-9a-zA-Z_-][0-9a-zA-Z_-]{0,61})?[0-9a-zA-Z_-]\.[a-zA-Z]{2,6})))((\/[a-zA-Z0-9#_-]+\/?)*)(:(6553[0-5]|655[0-2]\d|65[0-4]\d{2}|6[0-4]\d{3}|[1-5]\d{4}|[1-9]\d{0,3}))?(;|;\s|,|,\s)*)+$/i.test(strValue)},validUrlSchema:function(strValue){return/^(https|http):\/\/$/i.test(strValue)},validUrlHost:function(strValue){return/^((?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[0-9]{1,2})|((([0-9a-zA-Z_!~*'()-]+\.)*([0-9a-zA-Z_-][0-9a-zA-Z_-]{0,61})?[0-9a-zA-Z_-]\.[a-zA-Z]{2,6})))(\/[a-zA-Z0-9#_-]+\/?)*$/i.test(strValue)},validUrlPort:function(strValue){return/^(:(6553[0-5]|655[0-2]\d|65[0-4]\d{2}|6[0-4]\d{3}|[1-5]\d{4}|[1-9]\d{0,3}))$/i.test(strValue)},validPortNumber:function(strValue){var intVal=Number(strValue);return/^\d+$/g.test(strValue)&&intVal>=1&&intVal<=65535}};var arrRegistedForm=[];var arrValidatorMessage={required:"This field is required",minLength:"This field should contains more than 5 characters",maxLength:"This field should contains less than 128 characters",email:"Please enter valid email address",ipv4:"Please enter valid ipv4 address",ipv6:"Please enter valid ipv6 address",min:"The value is lower than the lower limit",max:"The value is greater than the upper limit",licenseMax:"The value is greater than the upper limit",pattern:"The value is not valid",matchField:"The password does not match",strongPassword:"Password should contains more than 8 characters, and have at least one uppercase letter, one lowercase letter, one number and one special character (@#$%^&*)",normalPassword:"Password should contains more than 6 characters, and have at least one letter, and one number",isInteger:"Input must be integer!",customized:"The value is not valid.",regExp:"The input must be regular.",specialChars:"The field should not contain special chars\n"+_specialChars.join(" "),generalForbidChars:"The field should not contain special chars\n"+_generalForbidChars.join(" "),validUrl:"url is invalid"};return{getSpecialCharsArr:function(){return _specialChars},getSpecialChars:function(){return _specialChars.join(" ")},getGeneralForbidChars:function(){return _generalForbidChars.join(" ")},getValidator:function(strValidatorName){return arrValidatorMap[strValidatorName]},getValidatorMessage:function(strValidatorName){return arrValidatorMessage[strValidatorName]},changeValidatorByName:function(strValidatorName,newStrValidatorName){var oldValidator=_.find(arrRegistedForm,(function(validator){return validator.name===strValidatorName}));oldValidator&&(oldValidator.name=newStrValidatorName)},submit:function(formName){var deffered=$q.defer();var index=arrRegistedForm.map((function(v){return v.name})).indexOf(formName);if(-1===index)throw new Error("Could not find form "+formName);arrRegistedForm[index].status=!0;arrRegistedForm[index].errors=[];arrRegistedForm[index].scope.$broadcast("submit-validation",arrRegistedForm[index]);$timeout((function(){arrRegistedForm[index].status?deffered.resolve():deffered.reject(arrRegistedForm[index].errors)}),10);return deffered.promise},reset:function(formName){var index=arrRegistedForm.map((function(v){return v.name})).indexOf(formName);if(-1===index)throw new Error("Could not find form "+formName);arrRegistedForm[index].scope.$broadcast("reset-validation")},clear:function(formName){var index=arrRegistedForm.map((function(v){return v.name})).indexOf(formName);if(-1===index)throw new Error("Could not find form "+formName);arrRegistedForm[index].scope.$broadcast("clear-validation")},registerForm:function(objForm){-1===arrRegistedForm.map((function(v){return v.name})).indexOf(objForm.name)&&arrRegistedForm.push(objForm)},unRegisterForm:function(strFormName){var index=arrRegistedForm.map((function(v){return v.name})).indexOf(strFormName);-1!==index&&arrRegistedForm.splice(index,1)},specialCharString:function(){var specialString="";for(var i=0;i<_specialChars.length;i+=1)specialString+=_specialChars[i]+" ";return specialString},mongoDbForbidCharString:function(){var specialString="";for(var i=0;i<mongoDbForbidChars.length;i+=1)specialString+=mongoDbForbidChars[i]+" ";return specialString},getGeneralForbidWindowsAndMongoChars:function(){return _generalForbidWindowsAndMongoChars.join(" ")},generalForbidWindowsAndMongoCharsAndComma:function(){return _generalForbidWindowsAndMongoCharsAndComma.join(" ")}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.serviceMonitorSrvc",ServiceMonitorSrvc);ServiceMonitorSrvc.$inject=["$rootScope","$location","$q","nb.ng.multiTabEventSrvc","nb.ng.utilitySrvc"];function ServiceMonitorSrvc($rootScope,$location,$q,multiTabEventSrvc,utilitySrvc){return{openServiceMonitorWithMainUIUser:function(){utilitySrvc.setLocalStorage(NetBrain.NG.Const.ServiceMonitorUserType,"MainUI");multiTabEventSrvc.trigger(NetBrain.NG.LocalStorageDefine.SWITCH_SERVICEMONITOR_USETTYPE);utilitySrvc.openTarget(NetBrain.NG.HelpLink.ServiceMonitor)},openServiceMonitor:function(){utilitySrvc.openTarget(NetBrain.NG.HelpLink.ServiceMonitor)}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.featureSrvc",FeatureSrvc);FeatureSrvc.$inject=["$rootScope","$q","nb.ng.licenseSrvc"];function FeatureSrvc($rootScope,$q,licenseSrvc){return{isFeatureValid:_isFeatureValid,featureCheck:function(featureName){var deferred=$q.defer();var featureIsValid=_isFeatureValid(featureName);featureName&&!0!==featureIsValid?deferred.reject():deferred.resolve();return deferred.promise}};function _isFeatureValid(featureName){if(!featureName)return!1;var feature=NetBrain.NG.Const.nbFeatures[featureName];return!!feature&&licenseSrvc.isModuleLicenseValid(feature.licenseModule)}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.deviceAccessCacheSrvc",deviceAccessCacheSrvc);deviceAccessCacheSrvc.$inject=["$rootScope","$q","nb.ng.sessionSrvc","nb.ng.nbHttp","nb.ng.utilitySrvc","nb.ng.userSrvc","nb.ng.permissionSrvc"];function deviceAccessCacheSrvc($rootScope,$q,sessionSrvc,nbHttp,utilitySrvc,userSrvc,permissionSrvc){var mulitDB=!1,baseVersion=1,baseDBKey="deviceAccessCache-";$rootScope.$on(systemEvent.changedDomain,(function(e,tenant,domain){_createDomainDBCommon(domain[0]?domain[0].guid:void 0)}));function _createDomainDBCommon(domianId){_getDeviceAccessPolicy().then((function(deviceAccessPolicy){deviceAccessPolicy&&(mulitDB?function(domainId){var currentDomainId=domainId||sessionSrvc.getSelectedDomainIds()[0];if(!currentDomainId)return;Dexie.exists(baseDBKey+currentDomainId).then((function(exists){if(!exists){var db=new Dexie(baseDBKey+currentDomainId),stores={};stores[currentDomainId]="devId";db.version(baseVersion).stores(stores);var mateDB=new Dexie("deviceAccessCacheDB");mateDB.version(baseVersion).stores({cache:"domainId"});mateDB.cache.get(domainId).then((function(res){res||mateDB.cache.put({domainId:currentDomainId})}));_getRulesData().then((function(data){db[currentDomainId].bulkAdd(data).then((function(){})).catch(Dexie.BulkError,(function(){}))}))}}))}(domianId):_checkDomainId(domianId).then((function(currentDomainId){var db=new Dexie("deviceAccessCacheDB");db.version(baseVersion).stores({allDomain:"domainId"});return db.allDomain.get(currentDomainId).then((function(res){return res?$q.resolve():_getRulesData().then((function(data){return db.allDomain.add({domainId:currentDomainId,permission:data}).then((function(){}))}))}))})))}))}function _getDeviceAccessPolicy(alwaysNetwork){var localDeviceAccessPolicy=utilitySrvc.getLocalStorage("deviceAccessPolicy");return alwaysNetwork||null===localDeviceAccessPolicy?_ajax({url:"AdvancedSettings/DeviceAccessControlSetting"}).then((function(res){utilitySrvc.setLocalStorage("deviceAccessPolicy",res.enabled);return $q.resolve(res.enabled)}),(function(){utilitySrvc.setLocalStorage("deviceAccessPolicy",!1);return $q.resolve(!1)})):$q.resolve(localDeviceAccessPolicy)}function _checkDomainId(domainId){var currentDomainId=domainId||sessionSrvc.getSelectedDomainIds()[0];return currentDomainId?$q.resolve(currentDomainId):$q.reject("domainId is invalid")}function _getRulesData(){return _ajax({url:mulitDB?"DevicePrivilege/list":"DevicePrivilege"})}function _getDeviceAccessPermission(devIds,permission,options){var opt=_.extend({returnType:"array"},options);return _getDeviceAccessPolicy().then((function(deviceAccessPolicy){if(deviceAccessPolicy)return devIds&&_.isArray(devIds)?mulitDB?function(devIds,permission,options){return _checkDomainId().then((function(domain){var db=new Dexie(baseDBKey+domain),stores={};stores[domain]="devId";db.version(baseVersion).stores(stores);var promiseAll=[];_.each(devIds,(function(devId){promiseAll.push(db[domain].get(devId).then((function(value){return{devId:devId,value:value||{}}})))}));return Promise.all(promiseAll).then((function(res){if("object"===options.returnType.toLowerCase()){var result={};_.each(res,(function(item){result[item.devId]=_checkPermission(permission,item.value.privilege)}));return result}if("array"===options.returnType.toLowerCase())return _.map(res,(function(item){return _checkPermission(permission,item.value.privilege)}))}))}))}(devIds,permission,opt).then((function(res){return res})):function(devIds,permission,options){return _checkDomainId().then((function(domain){var db=new Dexie("deviceAccessCacheDB");db.version(baseVersion).stores({allDomain:"domainId"});return db.allDomain.get(domain).then((function(res){var data=res||{permission:{}};if("object"===options.returnType.toLowerCase()){var result={};_.each(devIds,(function(devId){result[devId]=_checkPermission(permission,data.permission[devId])}));return result}if("array"===options.returnType.toLowerCase())return _.map(devIds,(function(devId){return _checkPermission(permission,data.permission[devId])}))}))}))}(devIds,permission,opt).then((function(res){return res})):$q.reject({errorMsg:"DevIds must be an Array"});var systemExecuteNetworkChange=permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.executeNetworkChange);var status=_checkPermission(permission,systemExecuteNetworkChange?3:1);var result={};_.each(devIds,(function(devId){result[devId]=status}));return $q.resolve("array"===opt.returnType?_.map(devIds,(function(){return status})):result)}))}function _checkPermission(toCheckP,deviceP){var status=!1;if(!toCheckP||""===toCheckP)return!0;if(void 0===deviceP)return!0;if(0===deviceP)return!1;toCheckP=_.isArray(toCheckP)?toCheckP:[toCheckP];for(var i=0;i<toCheckP.length;i++)if((toCheckP[i]&deviceP)===toCheckP[i]){status=!0;break}return status}function _ajax(opt,canceler){var defaultRequest=$.extend(!0,{method:"GET",url:"",data:{}},opt);return nbHttp[defaultRequest.method.toLowerCase()](defaultRequest.url,defaultRequest.data,{timeout:canceler,avoidBlockUI:!0})}return{initDeviceAccessCacheDB:function(){return _getDeviceAccessPolicy(!0).finally((function(){var mateDB=new Dexie("deviceAccessCacheDB");if(mulitDB){mateDB.version(baseVersion).stores({cache:"domainId"});return mateDB.cache.each((function(domain){return Dexie.delete(baseDBKey+domain.domainId)})).then((function(){return mateDB.cache.clear()}))}return mateDB.delete()}))},createDomainDBCommon:_createDomainDBCommon,getDAPArray:function(a,b){return _getDeviceAccessPermission(a,b,{returnType:"array"})},getDAPObject:function(a,b){return _getDeviceAccessPermission(a,b,{returnType:"object"})},getDAPBool:function(devIds,permission){return _getDeviceAccessPermission(devIds,permission,{returnType:"array"}).then((function(result){return!!(result&&result.length>0)&&result.indexOf(!1)<0}))},getGlobalDAPStatus:_getDeviceAccessPolicy}}}(NetBrain);var gUserName=null;var gUserId=null;var gUserConf=null;var globalUser=null;!function(NetBrain){angular.module("nb.ng").service("nb.ng.userSrvc",userSrvc);userSrvc.$inject=["$log","nb.ng.utilitySrvc","nb.ng.sessionSrvc","nb.ng.permissionSrvc"];function userSrvc($log,utilitySrvc,sessionSrvc,permissionSrvc){this._userName="anonymous";this._userID="";this._password="";this._hubClientId="";this._userObject={};this._sessionId="";this._userConf=new NetBrain.NG.Model.CUserConf;this.initData=function(obj){if(null!=obj){this._userObject=obj;this._userName=obj.name;this._firstName=obj.firstName;this._lastName=obj.lastName;this._userID=obj.ID;this._password=obj.password;this._email=obj.email;this._description=obj.description;this._department=obj.department;this._phoneNumber=obj.phoneNumber;this._canResetPassword=obj.canResetPassword;this._hubClientId=obj.hubClientId;this._sessionId=obj.sessionId;this._avatar=obj.avatar;this._userConf=new NetBrain.NG.Model.CUserConf;null!=obj._userConf&&null!=obj._userConf._jsWrapper&&this._userConf.resetJsData(obj._userConf._jsWrapper.data);gUserName=this._userName;gUserId=this._userID;gUserConf=this._userConf}};this.getUserName=function(){return this._userName};this.setUserName=function(obj){this._userName=obj;gUserName=this._userName};this.getFirstName=function(){return this._firstName};this.setFirstName=function(obj){this._firstName=obj};this.getLastName=function(){return this._lastName};this.setLastName=function(obj){this._lastName=obj};this.getDepartment=function(){return this._department};this.setDepartment=function(obj){this._department=obj};this.getUserID=function(){return this._userID};this.setUserID=function(obj){this._userID=obj;gUserId=this._userID};this.getPassword=function(){return this._password};this.setPassword=function(obj){this._password=obj};this.getEmail=function(){return this._email};this.setEmail=function(obj){this._email=obj};this.getDescription=function(){return this._description};this.setDescription=function(obj){this._description=obj};this.getPhoneNumber=function(){return this._phoneNumber};this.setPhoneNumber=function(obj){this._phoneNumber=obj};this.getAvatar=function(){return this._avatar};this.getAvatar=function(obj){this._avatar=obj};this.getCanResetPassword=function(){return this._canResetPassword};this.setCanResetPassword=function(obj){this._canResetPassword=obj};this.getUserObject=function(){return this._userObject};this.setUserObject=function(userObj){this._userObject=userObj};this.getHubClientId=function(){return this._hubClientId};this.setHubClientId=function(obj){this._hubClientId=obj};this.checkPermission=function(permission){return permissionSrvc.anyPermission(permission)};this.getUserConf=function(){return this._userConf};this.getAuthName=function(){if(this._userObject&&this._userObject.authentication&&this._userObject.authentication.alias)return this._userObject.authentication.alias};this.getUserNameTitle=function(){var title=this._userName||"";return title+="\nAuthentication Server: "+(this._userObject&&this._userObject.authentication&&this._userObject.authentication.alias||"NULL")}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.httpUserConfSrvc",httpUserConfSrvc);httpUserConfSrvc.$inject=["nb.ng.nbHttp","$q"];function httpUserConfSrvc(nbHttp,$q){function ajax(url,method,requestData){return nbHttp[method.toLowerCase()](url,requestData)}return{upInsertUserConf:function(dataSrc,userConf){var data={userConf:userConf};var defer=$q.defer();var cloneObj=angular.copy(data);(function(pwd){var defer=$q.defer();pwd||defer.resolve("");nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var key,pwdRtn;if(!data||data.length<2)pwdRtn=pwd;else{setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,pwd)}defer.resolve(pwdRtn)}),(function(reason){defer.reject(reason)}));return defer.promise})(cloneObj.userConf.conf.browseEmailSetting.senderPassword).then((function(pwd){cloneObj.userConf.conf.browseEmailSetting.senderPassword=pwd;ajax("User/Config/upInsertUserConf","POST",cloneObj).then((function(result){defer.resolve(result)}),(function(error){defer.reject(error)}))}),(function(){}));return defer.promise},getUserConfByUserId:function(dataSrc,userId){return ajax("User/Config/getUserConfByUserId","POST",{userId:userId})},upInsertResourceManagerDefaultSetting:function(parentId,viewId){return ajax("User/Config/upInsertResourceManagerDefaultSetting/"+parentId+"/"+viewId,"GET")}}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.httpUserSystemConfSrvc",httpUserSystemConfSrvc);httpUserSystemConfSrvc.$inject=["nb.ng.nbHttp"];function httpUserSystemConfSrvc(nbHttp){function ajax(url,method,requestData){return nbHttp[method.toLowerCase()](url,requestData)}return{upInsertUserSystemConf:function(userId,userConf){return ajax("User/System/Config/upInsertUserSystemConf","POST",{userConf:{conf:userConf}})},updateUserMaxTimeout:function(userId,timeout){return ajax("User/System/Config/updateUserIdleTimeout","POST",{timeout:timeout})}}}}(NetBrain);var XHRSrvc=function($http,$q,$log,utilitySrvc,avoidBlockUI,delay){var _deferred=$q.defer();this._successCallback=function(XHRObjs){avoidBlockUI||utilitySrvc.disableLoadingMode();if(this.useWebApi){if(!XHRObjs.operationResult)throw new Error("error:web api["+this.url+"] operationResult is null");0===XHRObjs.operationResult.ResultCode?_deferred.resolve(XHRObjs.data,XHRObjs.operationResult):_deferred.reject(XHRObjs.operationResult)}else if(0===XHRObjs.ngRes.resultInfo.resultCode&&"OK"===XHRObjs.ngRes.resultInfo.resultDesc)_deferred.resolve(XHRObjs);else if(NetBrain&&void 0!==window.NetBrain.NG.ErrorMsg[XHRObjs.ngRes.resultInfo.resultCode]){var msg=window.NetBrain.NG.ErrorMsg[XHRObjs.ngRes.resultInfo.resultCode].Message;"100006"===XHRObjs.ngRes.resultInfo.resultCode&&""!==XHRObjs.ngRes.resultInfo.resultDesc&&(msg=XHRObjs.ngRes.resultInfo.resultDesc);_deferred.reject(msg)}else _deferred.reject("Server error - error description missing.")};this._failureCallback=function(msg){avoidBlockUI||utilitySrvc.disableLoadingMode();$log.info("failureCallback! - msg: "+msg);_deferred.reject(msg)};this.sendRequest=function(request,httpAuthSrvc){avoidBlockUI||utilitySrvc.enableLoadingMode(delay);this.useWebApi=request.useWebApi;var sendData,headers,method="",params=null;var dataSrc=httpAuthSrvc.getDataSrc();if(this.useWebApi){headers={TenantGuid:dataSrc.TenantGuid,DomainGuid:dataSrc.DomainGuid};if("GET"===(method=request.method||"POST").toUpperCase()){params=request.data;sendData=null}else{headers["Content-Type"]=request.contentType?request.contentType:"application/json;charset=utf-8";sendData=JSON.stringify(request.data)}for(var key in request.header)headers[key]=request.header[key];request.url=NetBrain.NG.ConfigSettings.API_ROOT+request.url;this.url=request.url}else{sendData=JSON.stringify(request.data);headers={"Content-Type":"application/json;charset=utf-8",TenantGuid:dataSrc.TenantGuid,DomainGuid:dataSrc.DomainGuid};method=request.method}var that=this;$http({cache:!1,url:request.url,method:method,params:params,data:sendData,transformRequest:null,headers:headers}).success((function(){that._successCallback.apply(that,arguments)})).error((function(msg,statusCode){401!==statusCode&&that._failureCallback.apply(that,arguments)}));return _deferred.promise};this.sendSyncRequest=function(request,httpAuthSrvc,callback){this.useWebApi=request.useWebApi;this.url=request.url;var sendData,headers,method="",params=null;var dataSrc=httpAuthSrvc.getDataSrc();if(this.useWebApi){headers={TenantGuid:dataSrc.TenantGuid,DomainGuid:dataSrc.DomainGuid};if("GET"===(method=request.method||"POST").toUpperCase()){params=request.data;sendData=null}else{headers["Content-Type"]=request.contentType?request.contentType:"application/json;charset=utf-8";sendData=JSON.stringify(request.data)}for(var key in request.header)headers[key]=request.header[key];request.url=NetBrain.NG.ConfigSettings.API_ROOT+request.url;this.url=request.url}else{sendData=JSON.stringify(request.data);headers={"Content-Type":"application/json;charset=utf-8",TenantGuid:dataSrc.TenantGuid,DomainGuid:dataSrc.DomainGuid};method=request.method}headers.Authorization="Bearer "+httpAuthSrvc.getAccessToken();"GET"===method.toUpperCase()&&(this.url+="?"+params);$.ajax({url:this.url,method:method,headers:headers,async:!1,cache:!1,data:sendData,dataType:"json",error:function(jqXHR,textStatus,errorThrown){callback({code:-1,data:null})},success:function(data,textStatus,jqXHR){callback({code:0,data:data})}})}};var NgXHRSrvc=function($http,$q,$log,$location,utilitySrvc,httpAuthSrvc,avoidBlockUI,delay){this.x=new XHRSrvc($http,$q,$log,utilitySrvc,avoidBlockUI,delay);this.sendRequest=function(request){if(!request.useWebApi)if(void 0===window.ngHub)$log.log("hub is not setup");else{var hubClientId=window.ngHub.getInstance().getClientId();request.data.ngReq.reqInfo.hubClientId=hubClientId}return this.x.sendRequest(request,httpAuthSrvc)};this.sendSyncRequest=function(request,callback){if(!request.useWebApi)if(void 0===window.ngHub)$log.log("hub is not setup");else{var hubClientId=window.ngHub.getInstance().getClientId();request.data.ngReq.reqInfo.hubClientId=hubClientId}this.x.sendSyncRequest(request,httpAuthSrvc,callback)}};!function(NetBrain){var trySettingsForServerError={tryTimes:2,delay:1e3};angular.module("nb.ng").factory("nb.ng.oauthHttpIntercepterSrvc",OAuthIntercepter);OAuthIntercepter.$inject=["$q","$rootScope","$injector","nb.ng.utilitySrvc","nb.ng.nbReloginSrvc"];function OAuthIntercepter($q,$rootScope,$injector,utilitySrvc,nbReloginSrvc){var __pendingHttpQueue=[];var __isReLoginOccur=!1;var __isAuthLoginPage=window.location.href.toLowerCase().indexOf("/auth.html")>0;var __isMainPage=window.location.href.toLowerCase().indexOf("/admin.html")<0;__isAuthLoginPage&&(__isMainPage=window.location.href.toLowerCase().indexOf("scope=system")<0);var inIFrame=!1;try{inIFrame=window.self!==window.top}catch(e){inIFrame=!0}var tokenId=inIFrame?NetBrain.NG.LocalStorageDefine.nbEmbedMapId:NetBrain.NG.LocalStorageDefine.nbuserId;var tokenName=__isMainPage?tokenId.mainUi:tokenId.system;var timeoutEventName=__isMainPage?systemEvent.mainSessionTimeout:systemEvent.systemSessionTimeout;var userNotExistEventName=systemEvent.userDeleted;var databaseErrorEventName=systemEvent.databaseError;var __appType=__isMainPage?"mainUI":"system";return{request:function(config){if(config.url.indexOf(NetBrain.NG.ConfigSettings.API_ROOT)<0||StringUtil.endsWith(config.url.toLowerCase(),".json"))return config;if(__isReLoginOccur&&config.url.indexOf("/GenerateAccessToken")<0&&config.url.indexOf("/admin/getPublicKey")<0&&config.url.indexOf("/Admin/User/resetLoginPassword")<0){utilitySrvc.disableLoadingMode();return __appendPendingRequest(config,!1)}if(config.url.indexOf("/users/permissions/full")>-1)return config;config.headers=config.headers||{};var authData=utilitySrvc.getLocalStorage(tokenName);authData&&(config.headers.Authorization="Bearer "+authData.accessToken);return config},responseError:function(rejection){utilitySrvc.disableLoadingMode();$("#pathCalculatingMask").remove();if(rejection.config.url.indexOf("/Session/Test")>-1)return $q.reject(rejection);if(401===rejection.status){var errorCode="";if(rejection.data instanceof ArrayBuffer){var jsonStr=String.fromCharCode.apply(null,new Int8Array(rejection.data));var jsonObj=JSON.parse(jsonStr);jsonObj&&(errorCode=jsonObj.error||"")}else errorCode=rejection.data.error||"";if(100108!==errorCode&&100105!==errorCode&&100101!==errorCode&&100106!==errorCode){!function(errorCode){$injector.get("nb.ng.httpAuthSrvc");if("100007"===errorCode)$rootScope.$emit(databaseErrorEventName);else{"100045"!==errorCode?$rootScope.$emit(timeoutEventName):$rootScope.$emit(userNotExistEventName);utilitySrvc.setLocalStorage(tokenName,"")}}(errorCode);return $q.reject(rejection)}var authSrvc=$injector.get("nb.ng.httpAuthSrvc");if(__isMainPage){var userName=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginUserName.mainUi),loginAuth=utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginAuth.mainUi);if(!userName||""===userName||!loginAuth||null===loginAuth.id||void 0===loginAuth.id){$rootScope.$emit(timeoutEventName);return $q.reject(rejection)}if(!__isReLoginOccur){__isReLoginOccur=!0;nbReloginSrvc.reLogin(__appType,"Your session has expired. Please log in again. ").then((function(response){__isReLoginOccur=!1;ngHub.getInstance().setToken(authSrvc.getAccessToken(__appType));null!=response&&function(){var $http=$injector.get("$http");_.each(__pendingHttpQueue,(function(obj){var authData=utilitySrvc.getLocalStorage(tokenName);authData&&(obj.config.headers.Authorization="Bearer "+authData.accessToken);"request"===obj.type?obj.defer.resolve(obj.config):$http(obj.config).then((function(rawResult){var result=rawResult||{};obj.defer.resolve(result)}),(function(reason){obj.defer.reject(reason)}))}));__flushPendingRequests()}()}),(function(){__isReLoginOccur=!1;__flushPendingRequests()}));return __appendPendingRequest(rejection.config,!0,rejection)}return __appendPendingRequest(rejection.config,!0,rejection)}$rootScope.$emit(timeoutEventName)}else if(rejection.status>=500&&rejection.status<=599){var config=rejection.config;var tryTimes=config.tryTimes||0;if(tryTimes<trySettingsForServerError.tryTimes){config.tryTimes=tryTimes+1;return function(config){var defer=$q.defer();setTimeout((function(){$injector.get("$http")(config).then(defer.resolve.bind(defer)).catch(defer.reject.bind(defer))}),trySettingsForServerError.delay);return defer.promise}(config)}if("yes"!==(sessionStorage.getItem("oAuthInterceptor_alerted")||"")){sessionStorage.setItem("oAuthInterceptor_alerted","yes");if("undefined"!=typeof alertSrvc&&alertSrvc)alertSrvc.error("The server encountered an internal error and was unable to complete your request. Please try again later.").then((function(){sessionStorage.setItem("oAuthInterceptor_alerted","no")}));else{alert("The server encountered an internal error and was unable to complete your request. Please try again later.");sessionStorage.setItem("oAuthInterceptor_alerted","no")}}return $q.reject(rejection)}return $q.reject(rejection)},response:function(response){return response}};function __appendPendingRequest(config,isResponse,rejection){var defer=$q.defer();__pendingHttpQueue.push({config:config,defer:defer,type:isResponse?"response":"request",rejection:rejection});return defer.promise}function __flushPendingRequests(){__pendingHttpQueue=[]}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.systemSrvc",SystemSrvc);SystemSrvc.$inject=["$rootScope","$location","$q","nb.ng.nbHttp"];function SystemSrvc($rootScope,$location,$q,nbHttp){return{getDomainSummary:function(tenantId,domainId){var deferred=$q.defer();nbHttp.post("system/domain/domainsummary",{domainId:"",tenantId:""}).then((function(data){deferred.resolve(data)}),(function(reason){deferred.reject(reason)}));return deferred.promise},getVersionInfo:function(){var deferred=$q.defer();nbHttp.get("/conf/fix_releaseinfo.txt").then((function(data){deferred.resolve(data)}),(function(){deferred.resolve({ProductVersion:"",SoftwareVersion:"",Date:"",GitVersion:""})}));return deferred.promise},getPatchVersionInfo:function(){var deferred=$q.defer();nbHttp.get("/conf/fix_patchinfo.txt").then((function(data){deferred.resolve(data)}),(function(){deferred.resolve({SoftwareVersion:"",PatchVersion:"",PatchInstalledDate:""})}));return deferred.promise},getKCVersionInfo:function(){var deferred=$q.defer();nbHttp.get("system/KCversion").then((function(data){deferred.resolve(data)}),(function(){deferred.resolve(["N/A","N/A","N/A"])}));return deferred.promise}}}}(NetBrain);!function(netBrain){var consts=NetBrain.ns("NG.Const.Cache");consts.Level={System:"System",Tenant:"Tenant",Domain:"Domain"};consts.Joiner="_"}();!function(netBrain){OfflineCacheSrvc.$inject=["$q","nb.ng.httpAuthSrvc"];angular.module("nb.ng").factory("nb.ng.offlineCacheSrvc",OfflineCacheSrvc);var indexedDbVersion=6;var metaDbName="NbOfflineCacheMeta";Dexie.exists(metaDbName).then(openMetaDb).then((function(db){if(db&&db.verno<indexedDbVersion)return db.table("dbs").toArray((function(items){return _.pluck(items,"id")}))})).then((function(dbs){if(dbs&&dbs.length>0){dbs.push(metaDbName);var promises=[];_.each(dbs,(function(db){promises.push(Dexie.delete(db))}));return Promise.all(promises)}}));return;function OfflineCacheSrvc($q,httpAuthSrvc){var consts=netBrain.ns("NG.Const.Cache");var joiner=consts.Joiner;var levels=consts.Level;var dbDic=createEmptyDic();var freshFlag=createEmptyDic();var defaultOptions={level:levels.Domain};var metaDb,dbs,stores;!function(){(metaDb=new Dexie(metaDbName)).version(indexedDbVersion).stores({dbs:"id",stores:"id"});dbs=metaDb.dbs;stores=metaDb.stores}();var srvc={initStores:function(configs){configs=_.map(configs,(function(config){return _.extend({},defaultOptions,config)}));!function(configGroups){var dbName;getTenantId(),getDomainId();if(configGroups.System&&!dbDic.System){dbName=getDbName(levels.System);dbDic.System=createDb(dbName,configGroups.System)}if(configGroups.Tenant){dbName=getDbName(levels.Tenant);dbDic[dbName]||(dbDic[dbName]=createDb(dbName,configGroups.Tenant))}if(configGroups.Domain){dbName=getDbName(levels.Domain);dbDic[dbName]||(dbDic[dbName]=createDb(dbName,configGroups.Domain))}}(_.groupBy(configs,"level"));_.each(configs,(function(config){srvc[config.name]=(name=config.name,level=config.level,{get:function(paramObj,getter){var storeMeta=function(name,level){var dbName=getDbName(level=level||levels.Domain);var db=dbDic[dbName];if(!db)throw new Error("has no db: "+dbName);var store=db.storeDic[name];if(!store)throw new Error("has no store: "+name+" in db "+dbName);return store}(name,level);var id=storeMeta.config.generateId(paramObj);var store=storeMeta.store;return ngPromise(store.get(id).then((function(cacheData){return cacheData?cacheData.fresh?function(cacheData,store){var change={last:Date.now(),hit:cacheData.hit+1};return updateCacheDataByChange(cacheData.id,change,store)}(cacheData,store).then((function(){return cacheData.originalData})):getter(paramObj).then((function(originalData){return function(cacheData,originalData,store){var change={originalData:originalData,size:getSize(originalData),fresh:1,last:Date.now(),hit:cacheData.hit+1};return updateCacheDataByChange(cacheData.id,change,store)}(cacheData,originalData,store).then((function(){return originalData}))}),(function(reason){console.error(reason);return cacheData.originalData})):getter(paramObj).then((function(originalData){return function(id,originalData,store){return function(cacheData,store){return store.put(cacheData)}(function(id,originalData){var now=Date.now();return{id:id,cacheOn:now,size:getSize(originalData),hit:0,fresh:1,last:now,originalData:originalData}}(id,originalData),store)}(id,originalData,store).then((function(){return originalData}))}))})))}});var name,level}));return function(){var promises=[];_.each(_.values(dbDic),(function(db){var store=db.storeDic[_.keys(db.storeDic)[0]].store;promises.push(store.get("1"))}));return $q.all(promises)}().then(checkFresh)},getStore:function(id){return this[id]||{get:function(paramObj,getter){return getter(paramObj)}}},resetFreshFlags:function(){freshFlag=createEmptyDic();return ngPromise(function(){var shrinkSetting={maxCount:1e4,maxSize:2e9,maxAge:6048e5};var shrinkers=[function(store){return store.where("fresh").equals(0).toArray(toIdArray).then((function(ids){bulkRemove(ids,store)}))},function(store){var expireDate=Date.now()-shrinkSetting.maxAge;return store.where("last").below(expireDate).toArray(toIdArray).then((function(ids){bulkRemove(ids,store)}))}];var dbsDic=createEmptyDic();var storesDic=createEmptyDic();return Dexie.exists(metaDbName).then(openMetaDb).then((function(db){var promises=[];var notExistDbs=[];return db&&db.table("dbs").each((function(dbMeta){var dbName=dbMeta.name;var promise=Dexie.exists(dbName).then((function(exist){if(exist){return(dbsDic[dbName]=new Dexie(dbName)).open()}notExistDbs.push(dbMeta.id)}));promises.push(promise)})).then((function(){return Promise.all(promises).then(deleteNotExistDbs.bind(null,notExistDbs)).then((function(){return db}))}))})).then((function(db){return db&&db.table("stores").each((function(storeMeta){var db3=dbsDic[storeMeta.db];if(db3){var store=storesDic[storeMeta.id]=db3.table(storeMeta.name);store.db=db3;store.id=storeMeta.id}}))})).then((function tryShrink(level){level=level||0;return Promise.resolve(level<shrinkers.length).then((function(should){if(should)return function(level,storesToShrink){return Promise.resolve().then((function(){return storesToShrink||getStores()})).then((function(stores){var promises=[];_.each(stores,(function(item){promises.push(function(level,store){var shrinker=shrinkers[level];return store&&shrinker?shrinker(store):Promise.resolve()}(level,item))}));return Promise.all(promises)}))}(level).then((function(){return tryShrink(level+1)}))}))})).then((function(){return function(){var promises=[];var stores=getStores();_.each(stores,(function(store){promises.push(function(store){var total=0;return store.each((function(item){total+=item.size})).then((function(){return total}))}(store))}));return Promise.all(promises).then(sumArr)}().then((function(cacheSize){return cacheSize>shrinkSetting.maxSize})).then((function(shouldShrink){return function(){var promises=[];_.each(getStores(),(function(store){promises.push(function(store){return store.toArray().then((function(datas){return _.map(datas,(function(item){var obj=_.pick(item,"id","last","size");obj.store=store.id;return obj}))}))}(store))}));return Promise.all(promises).then((function(allDatas){return _.flatten(allDatas)}))}().then(findDataToRemove).then(removeDatasByStore)}))}));function deleteNotExistDbs(notExistDbs){}function getStores(){return _.values(storesDic)}function sumArr(arr){var total=0;_.each(arr,(function(n){total+=n}));return total}function removeDatasByStore(datas){var groups=_.groupBy(datas,"store");var promises=[];_.each(_.keys(groups),(function(storeId){var store=storesDic[storeId];var ids=_.pluck(groups[storeId],"id");promises.push(bulkRemove(ids,store))}));return Promise.all(promises)}function findDataToRemove(allDatas){if(allDatas&&!(allDatas.length<1)){var index=(allDatas=_.sortBy(allDatas,"last")).length-1;var size=0;for(;index>-1&&!((size+=allDatas[index].size)>shrinkSetting.maxSize);)index-=1;index<0&&(index=0);return allDatas.slice(0,index)}}function bulkRemove(ids,store){return ids.length>0?store.bulkDelete(ids):Promise.resolve()}function toIdArray(arr){return _.pluck(arr,"id")}}())}};return srvc;function checkFresh(){var promises=[];_.each(_.values(dbDic),(function(db){var dbName=db.dbName;if(!freshFlag[dbName]){freshFlag[dbName]=!0;_.each(_.values(db.storeDic),(function(store){promises.push(function(store){var config=store.config;var checkFresh1=config.freshChecker;if(checkFresh1)return function(store,checkFresh2,getUpdateOn){var ids=[];var freshChangeItems=[];var size=0;var count=0;return ngPromise(store.each((function(item){size+=item.size;count+=1;ids.push(item.id)})).then((function(){!function(store,count,size){var storeId=getStoreKey(store);stores.update(storeId,{count:count,size:size})}(store,count,size);return ids.length>0?checkFresh2(ids):{}})).then((function(dataDic){return store.each((function(item){var fresh=getUpdateOn(item.originalData)>=dataDic[item.id]?1:0;if(item.fresh!==fresh){item.fresh=fresh;freshChangeItems.push(item)}}))})).then((function(){return store.bulkPut(freshChangeItems)})))}(store.store,checkFresh1,config.getUpdateOn);return Promise.resolve()}(store))}))}}));return $q.all(promises)}function createDb(dbName,configs){var db=new Dexie(dbName);!function(dbName){dbs.put({id:dbName,name:dbName,stores:0,size:0,version:indexedDbVersion})}(dbName);return{dbName:dbName,db:db,storeDic:createStores(db,configs)}}function createStores(db,configs){var storeDic=createEmptyDic();var stores2={};_.each(configs,(function(config){var storeName=config.name;storeDic[storeName]=function(config){return{storeName:config.name,config:config}}(config);stores2[storeName]="id,fresh,last,hit,size"}));db.version(indexedDbVersion).stores(stores2);_.each(configs,(function(config){var storeName=config.name;var store=storeDic[storeName].store=db[storeName];store.db=db;!function(store){store.hook("creating",(function(primKey,obj,trans){updateStoreMeta(store,obj.size,1)}));store.hook("updating",(function(mods,primKey,obj,trans){_.isNumber(mods.size)&&updateStoreMeta(store,mods.size-obj.size,0)}));store.hook("deleting",(function(primKey,obj,transaction){updateStoreMeta(store,-obj.size,-1)}))}(store);!function(storeName,dbName){var storeId=[dbName,storeName].join(joiner);stores.put({id:storeId,name:storeName,db:dbName,size:0,count:0,last:Date.now()}).then((function(){return metaDb.transaction("rw",dbs,(function(){return dbs.get(dbName).then((function(db){dbs.update(dbName,{stores:db.stores+1})}))}))}))}(storeName,db.name)}));return storeDic}function updateStoreMeta(store,sizeChange,countChange){var storeId=getStoreKey(store);return metaDb.transaction("rw",stores,(function(){return stores.get(storeId).then((function(store3){stores.update(storeId,{count:store3.count+countChange,size:store3.size+sizeChange,last:Date.now()})}))}))}function getStoreKey(store){return[store.db.name,store.name].join(joiner)}function updateCacheDataByChange(id,change,store){return store.update(id,change)}function getDbName(level){return level===levels.System?level:level===levels.Tenant?[levels.Tenant,getTenantId()].join(joiner):level===levels.Domain?[levels.Domain,getDomainId()].join(joiner):void 0}function getTenantId(){return httpAuthSrvc.getSelectedTenantId()}function getDomainId(){return httpAuthSrvc.getSelectedDomainIds()[0]}function ngPromise(promise){var deffered=$q.defer();promise.then((function(value){deffered.resolve(value);return value})).catch((function(reason){deffered.reject(reason);return Promise.reject(reason)}));return deffered.promise}}function openMetaDb(exist){if(exist){return new Dexie(metaDbName).open()}}function getSize(data){return void 0===data?0:JSON.stringify(data).length}function createEmptyDic(){return Object.create(null)}}(NetBrain);!function(NetBrain){angular.module("nb.ng").controller("nb.ng.signinCtrl",SigninCtrl);SigninCtrl.$inject=["$http","$q","$timeout","$scope","$window","$location","$log","$parse","$rootScope","$uibModal","nb.ng.httpAuthSrvc","nb.ng.systemSrvc","nb.ng.multiTabEventSrvc","nb.ng.utilitySrvc","nb.ng.sessionSrvc"];function SigninCtrl($http,$q,$timeout,$scope,$window,$location,$log,$parse,$rootScope,$uibModal,httpAuthSrvc,systemSrvc,multiTabEventSrvc,utilitySrvc,sessionSrvc){utilitySrvc.translate("NetBrain.login.header_title").then((function(translation){$rootScope.title=translation}));$scope.isITEVersion=NetBrain.NG.ConfigSettings.IS_ITE_VERSION;$scope.smartCliDownloadPath=NetBrain.NG.ConfigSettings.SMART_CLI_DOWNLOAD_PATH;$scope.loginErrors={PRODUCT_VERSION_NOT_MATCH:"100000",NO_ACTIVATED_LICENSE:"100015",SC_NODE_USAGE_EXCEEDS_LICENSE_NODE_SIZE_FAIL:"103001",PWD_EXPIRED:"100070",PWD_NEEDCHANGE:"100075",ACCOUNT_LOCKED_BY_LOCAL_STRATEGE:"100076",ACCOUNT_LOCKED_BY_LOCAL_STRATEGE_FIRST:"100078",NEED_MORE_INFO:"100054",NEED_LOGOUT:"100071",BROWSER_LOGGED:"100074",NO_DOMAIN:"100018",NO_TENANT:"100019",INVALID_INDENTITY:"100012",PASSWORD_EXPIRED:"100013",ACCOUNT_EXPIRED:"100014",NO_LOGIN_PERMISSION:"100016",NO_SEAT:"100072",ACCOUNT_DISABLED:"101001",NOT_ACTIVATED:"100063",NEED_APPROVAL:"100055",UPDATE_GROUP_PATH:"101003",SERVER_NOT_EXIST:"101004",SERVER_DISABLED:"101005",SERVER_INVALID:"101006",INVALID_USER:"100087"};$scope.isShowLoginForm=!1;$scope.ForLogoutIcon=!1;$scope.$on("LOGIN_PAGE_LOADED",(function(){$scope.isShowLoginForm=!0}));$scope.form={userName:utilitySrvc.getLocalStorage("mainUI.loginUserName")};$scope.rememberMeChecked={status:utilitySrvc.getLocalStorage("mainUI.loginRememberMe")};$scope.authenticationList=[];$scope.ssoList=[];$scope.loginCtrlStatus={bannerLoading:!0,authLoading:!0};systemSrvc.getVersionInfo().then((function(version){$scope.version=version}));httpAuthSrvc.getLoginBanner().then((function(bannerData){$scope.banner=bannerData;$scope.loginCtrlStatus.bannerLoading=!1}),(function(reason){$scope.loginCtrlStatus.bannerLoading=!1;$scope.serverMessage=utilitySrvc.getErrorMessage(reason)}));httpAuthSrvc.getExternalAuthServers(!0).then((function(data){$scope.loginCtrlStatus.authLoading=!1;if(data&&data.length){var group=_.groupBy(data,(function(item){return 4===item.type?"sso":"other"}));$scope.authenticationList=group.other||[];$scope.ssoList=group.sso||[]}}),(function(reason){$scope.loginCtrlStatus.authLoading=!1;$scope.serverMessage=utilitySrvc.getErrorMessage(reason)}));httpAuthSrvc.getCloudMode().then((function(mode){NetBrain.NG.ConfigSettings.couldMode=mode;utilitySrvc.setLocalStorage("cloudMode",mode)}),(function(){NetBrain.NG.ConfigSettings.couldMode=!1;utilitySrvc.setLocalStorage("cloudMode",!1)}));$scope.getSsoUrl=function(sso){return httpAuthSrvc.getSsoUrl(sso,"mainUI")};$scope.getSsoUrlAndRedirect=function(sso){$window.location.href=$scope.getSsoUrl(sso)};$scope.getBoxWidth=function(){return $scope.banner&&$scope.banner.enabled?"1000px":"500px"};$scope.getBoxHeight=function(){return $scope.authenticationList&&$scope.ssoList.length?"615px":"538px"};$scope.SystemForceLogOut=function(){return{forceUserLogoutUser:function(){return $q.reject()}}};$scope.kickOffThisUser=function(){var data={UserName:$scope.form.userName};$scope.SystemForceLogOut($http,$q,$log,$timeout,$location,utilitySrvc,httpAuthSrvc).forceUserLogoutUser(data).then((function(){$window.location.href=""}),(function(){}))};function realLogin(){utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,[]);var redirectUrl=httpAuthSrvc.getLoginRedirectUrl();utilitySrvc.setValue("signinCtrl.openTenantPopout",!0);!function(userName){!function(userName){clearFirstOpenMark("OVERVIEWMAP_FIRST_OPEN",userName)}(userName);!function(userName){clearFirstOpenMark("DESKTOP_FIRST_OPEN",userName)}(userName)}($scope.form.userName);utilitySrvc.setLoginSignReadOnce();if(redirectUrl&&redirectUrl.indexOf("/monitor.html")>=0){redirectUrl="desktop.html";utilitySrvc.setLocalStorage(NetBrain.NG.Const.ServiceMonitorUserType,"MainUI");multiTabEventSrvc.trigger(NetBrain.NG.LocalStorageDefine.SWITCH_SERVICEMONITOR_USETTYPE)}$window.location.href=redirectUrl&&""!==redirectUrl?redirectUrl:"desktop.html"}$scope.sendLoginRequest=function(scope,loginType,auth){$scope.serverMessage="";$scope.copyUserName=angular.copy($scope.form.userName);httpAuthSrvc.login($scope.form.userName.toLowerCase(),$scope.form.password,auth,scope,loginType).then((function(){httpAuthSrvc.isLoggedIn()&&httpAuthSrvc.isNeedMorInfo().then((function(userInfo){userInfo?""===$.trim(userInfo.email)||""===$.trim(userInfo.firstName)||""===$.trim(userInfo.lastName)?httpAuthSrvc.extraInfo(userInfo).then((function(emailAddress){if(emailAddress)realLogin();else{$scope.serverMessage="NetBrain.login.error_messages.need_more_info";httpAuthSrvc.logout()}}),(function(){$scope.serverMessage="NetBrain.login.error_messages.need_more_info";httpAuthSrvc.logout()})):realLogin():httpAuthSrvc.logout()}),(function(){httpAuthSrvc.logout()}))}),(function(error){var reason=error?error.error:"unknown";var desc=error.error_description?error.error_description:"Failed to log in due to internal service issue.";switch(reason){case $scope.loginErrors.PRODUCT_VERSION_NOT_MATCH:$scope.serverMessage="NetBrain.login.error_messages.product_version_not_match";break;case $scope.loginErrors.NO_ACTIVATED_LICENSE:$scope.serverMessage="NetBrain.login.error_messages.no_activated_license";break;case $scope.loginErrors.PWD_EXPIRED:case $scope.loginErrors.PWD_NEEDCHANGE:var params=desc.split(","),reSetPasswordAuthId=params[0],userId=params[1],pwdPolicy={minimumLength:params[2],expiredInDays:params[3],complexityRequirement:params[4],pwdNotSameAsUserName:params[5],pwdCantSameWithPrevious:parseInt(params[6]),userName:$scope.form.userName,password:$scope.form.password};$scope.resetUserPassword(userId,pwdPolicy,reSetPasswordAuthId,reason);break;case $scope.loginErrors.NEED_LOGOUT:var splitDesc=desc.split(","),realDesc=desc.replace(splitDesc[0]+",",""),kickOffAuthId=splitDesc[0];$scope.kickOffUserDlg(realDesc,$scope.form.userName,kickOffAuthId);break;case $scope.loginErrors.NO_TENANT:$scope.serverMessage="NetBrain.login.error_messages.no_tenant";break;case $scope.loginErrors.NO_DOMAIN:$scope.serverMessage="NetBrain.login.error_messages.no_domain";break;case $scope.loginErrors.INVALID_INDENTITY:$scope.serverMessage="NetBrain.login.error_messages.invalid_identity_full";$scope.form.password="";angular.element(".login-password").focus();break;case $scope.loginErrors.NO_LOGIN_PERMISSION:$scope.serverMessage="NetBrain.login.error_messages.no_login_permission";break;case $scope.loginErrors.ACCOUNT_EXPIRED:$scope.serverMessage="NetBrain.login.error_messages.account_expired";break;case $scope.loginErrors.PASSWORD_EXPIRED:$scope.serverMessage="NetBrain.login.error_messages.password_expired";break;case $scope.loginErrors.ACCOUNT_DISABLED:$scope.serverMessage="NetBrain.login.error_messages.account_disabled";break;case $scope.loginErrors.ACCOUNT_LOCKED_BY_LOCAL_STRATEGE:$scope.serverMessage="NetBrain.login.error_messages.account_locked_by_local_strategy";break;case $scope.loginErrors.ACCOUNT_LOCKED_BY_LOCAL_STRATEGE_FIRST:$scope.serverMessage="NetBrain.login.error_messages.account_locked_by_local_strategy_first";break;case $scope.loginErrors.NO_SEAT:$scope.serverMessage="NetBrain.login.error_messages.no_seat";break;case $scope.loginErrors.NOT_ACTIVATED:$scope.serverMessage="NetBrain.login.error_messages.not_activated";break;case $scope.loginErrors.NEED_APPROVAL:$scope.serverMessage="NetBrain.login.error_messages.need_approval";break;case $scope.loginErrors.INVALID_USER:$scope.serverMessage="NetBrain.login.error_messages.invalid_user";break;case $scope.loginErrors.UPDATE_GROUP_PATH:$scope.serverMessage="NetBrain.login.error_messages.update_group_path";break;case $scope.loginErrors.SERVER_NOT_EXIST:$scope.serverMessage="NetBrain.login.error_messages.server_not_exist";break;case $scope.loginErrors.SERVER_DISABLED:$scope.serverMessage="NetBrain.login.error_messages.server_disabled";break;case $scope.loginErrors.SERVER_INVALID:$scope.serverMessage="NetBrain.login.error_messages.server_invalid";break;case $scope.loginErrors.SC_NODE_USAGE_EXCEEDS_LICENSE_NODE_SIZE_FAIL:$scope.serverMessage="NetBrain.login.error_messages.node_usage_exceed_license";break;default:$scope.serverMessage="NetBrain.login.error_messages.default"}}))};$scope.submitForm=function(){$scope.serverMessage="";if($scope.rememberMeChecked.status){utilitySrvc.setLocalStorage("mainUI.loginRememberMe",$scope.rememberMeChecked.status);utilitySrvc.setLocalStorage("mainUI.loginUserName",$scope.form.userName)}else{utilitySrvc.setLocalStorage("mainUI.loginRememberMe","");utilitySrvc.setLocalStorage("mainUI.loginUserName","")}utilitySrvc.setLocalStorage("appScope","mainui");utilitySrvc.setLocalStorage("NewMapIndex",1);$scope.sendLoginRequest("mainUI","normal_login")};$scope.resetUserPassword=function(uId,pwdPolicy,authId,reason){$scope.passwordModal=$uibModal.open({templateUrl:"loginResetPasswordDialog.html",controller:"nb.ng.loginResetPasswordDialogCtrl",windowClass:"userPasswordDialog",backdrop:"static",resolve:{resolveData:function(){return{userId:uId,reason:reason,passwordPolicy:pwdPolicy}}}});$scope.passwordModal.result.then((function(newPwd){$scope.form.password=newPwd;$scope.sendLoginRequest("mainUI","resetPwd_login",{id:authId})}))};$scope.kickOffUserDlg=function(desc,userName,authId){$scope.kickOffModal=$uibModal.open({templateUrl:"kickOffUserDialog.html",controller:"nb.ng.signinKickOffCtrl",windowClass:"userKickOffDialog",backdrop:"static",resolve:{resolveData:function(){return{usr:userName,msg:desc}}}});$scope.kickOffModal.result.then((function(doKickLogin){doKickLogin&&$scope.sendLoginRequest("mainUI","kick_login",{id:authId})}))};function clearFirstOpenMark(category,userName){var key=userName+"_"+category;utilitySrvc.setSessionStorage(key,{})}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").controller("nb.ng.authCtrl",AuthCtrl);AuthCtrl.$inject=["$http","$q","$timeout","$scope","$window","$location","$log","$parse","$rootScope","$uibModal","nb.ng.httpAuthSrvc","nb.ng.multiTabEventSrvc","nb.ng.utilitySrvc"];function AuthCtrl($http,$q,$timeout,$scope,$window,$location,$log,$parse,$rootScope,$uibModal,httpAuthSrvc,multiTabEventSrvc,utilitySrvc){$scope.serverMessage="";var LoginType={SSO:"sso_login",EmbedMapIntegratedLogin:"embed_map_integrated_login"};$scope.AuthenticationCode=getQueryString("authenticationCode");$scope.scope=getQueryString("scope")||"mainUI";$scope.loginType=getQueryString("type")||LoginType.SSO;$scope.isRelogin=getQueryString("isRelogin")||!1;$scope.alias=getQueryString("alias");$scope.error=getQueryString("error");$scope.loginSuccessfully=!1;$scope.sendLoginRequest=function(scope,loginType){var redirectUrl=httpAuthSrvc.getLoginRedirectUrl();(function(loginType){var deferred=$q.defer();loginType==LoginType.SSO?httpAuthSrvc.getExternalAuthByAlias($scope.alias).then((function(ssoModel){deferred.resolve(ssoModel)}),(function(error){deferred.reject(error)})):deferred.resolve({id:"",alias:"NetBrain",type:0});return deferred.promise})(loginType).then((function(authModel){authModel?httpAuthSrvc.login($scope.AuthenticationCode,$scope.AuthenticationCode,authModel,scope,loginType).then((function(){httpAuthSrvc.setLoginFailureRedirectUrl("");var redirectTargetUrl;if(httpAuthSrvc.isLoggedIn("system")&&"system"===$scope.scope){$scope.loginSuccessfully=!0;redirectTargetUrl="admin.html#/systemAdmin"}else if(httpAuthSrvc.isLoggedIn()&&"mainUI"==$scope.scope){$scope.loginSuccessfully=!0;utilitySrvc.setLocalStorage(NetBrain.NG.LocalStorageDefine.RECENT_PAGES,[]);utilitySrvc.setValue("signinCtrl.openTenantPopout",!0);!function(userName){!function(userName){clearFirstOpenMark("OVERVIEWMAP_FIRST_OPEN",userName)}(userName);!function(userName){clearFirstOpenMark("DESKTOP_FIRST_OPEN",userName)}(userName)}($scope.AuthenticationCode);utilitySrvc.setLoginSignReadOnce();if(redirectUrl&&redirectUrl.indexOf("/monitor.html")>=0){redirectUrl="desktop.html";utilitySrvc.setLocalStorage(NetBrain.NG.Const.ServiceMonitorUserType,"MainUI");multiTabEventSrvc.trigger(NetBrain.NG.LocalStorageDefine.SWITCH_SERVICEMONITOR_USETTYPE)}redirectTargetUrl=redirectUrl&&""!==redirectUrl?redirectUrl:"desktop.html"}if(!$scope.isRelogin&&!0===$scope.loginSuccessfully){$scope.serverMessage="Redirect...";$window.location.href=redirectTargetUrl}}),(function(error){var desc=error&&error.error_description?error.error_description:"Failed to log in due to internal service issue.";desc&&_setServerErrorMessage(desc)})):_setServerErrorMessage("invalid identity provider.")}),(function(){_setServerErrorMessage("invalid identity provider.")}))};$scope.AuthenticationCode&&$scope.AuthenticationCode.length>0?$scope.sendLoginRequest($scope.scope,$scope.loginType):_setServerErrorMessage($scope.error);function clearFirstOpenMark(category,userName){var key=userName+"_"+category;utilitySrvc.setSessionStorage(key,{})}function getQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);return null!=r?decodeURIComponent(r[2]):null}function _setServerErrorMessage(error){$scope.serverMessage=error||"unknown error";httpAuthSrvc.setLoginRedirectUrl("");var loginFailureRedirectUrl=httpAuthSrvc.getLoginFailureRedirectUrl();if(loginFailureRedirectUrl&&""!==loginFailureRedirectUrl){httpAuthSrvc.setLoginFailureError($scope.serverMessage);$window.location.href=loginFailureRedirectUrl}}}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.resetPasswordCtrl",ResetPasswordCtrl);ResetPasswordCtrl.$inject=["$scope","$location","$sce","$parse","nb.ng.httpUserRegistrationSrvc","nb.ng.nbValidationSrvc"];function ResetPasswordCtrl($scope,$location,$sce,$parse,httpUserRegistrationSrvc,nbValidationSrvc){$scope.form={};$scope.form.successMessage=null;$scope.passwordPolicy=null;$scope.passwordPolicyReady=!1;$scope.passwordValidator=[];$scope.passwordMinLength=6;$scope.form.matchValue=$scope.form.password;$scope.form.activated=!0;$scope.htmlPasswordTemplate='<div style="display:block;width:400px;"><label>No password policy set in the system</label></div>';$scope.getPasswordPolicy=function(){httpUserRegistrationSrvc.getPasswordPolicy().then((function(passwordPolicy){$scope.passwordPolicyReady=!0;$scope.passwordPolicy=passwordPolicy;$scope.passwordMinLength=angular.copy($scope.passwordPolicy.minimumLength>6?$scope.passwordPolicy.minimumLength:6);if($scope.passwordPolicy){$scope.htmlPasswordTemplate="<div><label>Password length: "+$scope.passwordPolicy.minimumLength+" - "+$scope.validationRuleExtra.passwordMaxLength+" characters</label></div>";$scope.passwordPolicy.expiredInDays&&$scope.passwordPolicy.expiredInDays>0&&($scope.htmlPasswordTemplate+="<div><label>Password will expire in "+$scope.passwordPolicy.expiredInDays+" days </label></div>");$scope.passwordPolicy.complexityRequirement&&($scope.htmlPasswordTemplate+="<div><label>Password must meet at least 3 of the following 4 rules:</label></div><ul><li>Includes uppercase letters (A - Z)</li><li>Includes lowercase letters (a - z)</li><li>Includes a number (0 - 9)</li><li>Includes a non-alphabetic character (such as ! $ # %)</li></ul></div>");$scope.passwordPolicy.pwdNotSameAsUserName&&($scope.htmlPasswordTemplate+="<div><label>Password cannot be same as username</label></div>")}$scope.passwordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:"Please enter your password."},{ruleId:"minLength",params:{length:$scope.passwordMinLength},errorMessage:"Please enter at least "+$scope.passwordMinLength+" characters"},{ruleId:"maxLength",params:{length:$scope.validationRuleExtra.passwordMaxLength},errorMessage:"Password should have less than "+$scope.validationRuleExtra.passwordMaxLength+" characters."}]};$scope.passwordPolicy.complexityRequirement&&$scope.passwordValidator.rules.push({ruleId:"strongestPassword",errorMessage:"The password has to meet password policy."});$scope.passwordPolicy.pwdNotSameAsUserName&&$scope.passwordValidator.rules.push({ruleId:"customized",params:{func:function(param,intValue){return($scope.form.userName||"").toLowerCase()!==intValue.toLowerCase()}},errorMessage:"Password cannot be same as username."})}))};$scope.validationRuleExtra={passwordMaxLength:128};$scope.getPasswordPolicy();$scope.getUserInfo=function(token){var serverMessage=$parse("form.$error.serverMessage");var tokenObj={token:token};httpUserRegistrationSrvc.getUserInfoByToken(tokenObj).then((function(result){if(result&&result.success){$scope.form.userName=result.userName;$scope.form.email=result.email;$scope.form.activated=result.activated}else{var reasons=result.reasons?result.reasons.join():"";serverMessage.assign($scope,reasons);$scope.form.successMessage=null;$scope.form.userName=result.userName;$scope.form.email=result.email}}),(function(error){serverMessage.assign($scope,error.Message)}))};$scope.setMatchValue=function(){$scope.form.matchValue=$scope.form.password};$scope.confirmPasswordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:"Please re-enter your password."},{ruleId:"matchField",params:$scope.form,errorMessage:"Your passwords dont match. Please try again."}]};var absUrl=$location.absUrl();$scope.form.token=function(url){var parts=(url||"").split("?");if(parts.length<=1)return;return parts[1].substring(6).replace(/20%/g,"+")}(absUrl);$scope.getUserInfo($scope.form.token);$scope.submitForm=function(){nbValidationSrvc.submit("resetPasswordForm").then((function(){var serverMessage=$parse("form.$error.serverMessage");httpUserRegistrationSrvc.resetPassword($scope.form).then((function(result){if(result&&result.success){$scope.form.successMessage=$sce.trustAsHtml('Your password has been successfully changed.<br>You can <a href="login.html" target="_blank">log in</a> to Netbrain now');serverMessage.assign($scope,"")}else{var reasons=result.reasons?result.reasons.join():"";serverMessage.assign($scope,reasons);$scope.form.successMessage=null}}),(function(error){serverMessage.assign($scope,error.Message)}))}),(function(){}))}}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.findPasswordCtrl",FindPasswordCtrl);FindPasswordCtrl.$inject=["$scope","nb.ng.httpUserRegistrationSrvc","nb.common.nbAlertSrvc","nb.ng.utilitySrvc"];function FindPasswordCtrl($scope,httpUserRegistrationSrvc,nbAlert,utilitySrvc){$scope.form={successMessage:null};$(".registration-message-header").hide();$scope.submitForm=function(){$scope.form.pageUrl=document.location.href;httpUserRegistrationSrvc.findBackPassword($scope.form).then((function(result){if(result&&result.success){$scope.form.successMessage=$scope.successMessage;$scope.form.$error&&($scope.form.$error.serverMessage=null);!function(msg){$(".find-back-password-form").hide();$(".register-user-success").html(msg).show();$(".registration-message-header").show()}($scope.form.successMessage)}else{$scope.form.successMessage=null;showErrorModal(result.reasons?result.reasons.join():"")}}),(function(error){showErrorModal(error.Message)}))};utilitySrvc.translateMulti(["NetBrain.find_pwd.header_title","NetBrain.find_pwd.success_1","NetBrain.find_pwd.success_2"],{support_email:"mailto:support@netbraintech.com"}).then((function(translations){$scope.title=translations["NetBrain.find_pwd.header_title"];$scope.successMessage=translations["NetBrain.find_pwd.success_1"]+"<br/>"+translations["NetBrain.find_pwd.success_2"]}));function showErrorModal(errorMsg){nbAlert.error(errorMsg)}}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.registerUserCtrl",RegisterUserCtrl);RegisterUserCtrl.$inject=["$sce","$scope","$rootScope","nb.ng.httpUserRegistrationSrvc","nb.ng.nbValidationSrvc","nb.common.nbAlertSrvc","nb.ng.systemSrvc","nb.ng.utilitySrvc"];function RegisterUserCtrl($sce,$scope,$rootScope,httpUserRegistrationSrvc,nbValidationSrvc,nbAlert,systemSrvc,utils){$scope.version={};$scope.CONSTANT_LENGTH_TEXT={Max64:64,Max128:128,Max256:256};$scope.policyLoaded=!1;$scope.submitBtnDisabled=!1;$scope.form={};$scope.form.successMessage=null;$scope.form.matchValue="";$scope.nameSpecialChars=["\\"];$scope.setMatchValue=function(){$scope.form.matchValue=angular.copy($scope.form.password)};$scope.submitForm=function(){nbValidationSrvc.submit("registerUserForm").then((function(){$scope.form.pageUrl=document.location.href;$scope.submitBtnDisabled=!0;httpUserRegistrationSrvc.registerUser($scope.form).then(handleSubmitResponse,assignErrorMsg)}))};$scope.setUpUITexts=function(translations){$rootScope.title=translations["NetBrain.register_user.header_title"];$scope.htmlPasswordTemplate=$sce.trustAsHtml('<div style="display:block;width:400px;"><label>'+translations["NetBrain.register_user.no_pwd_policy"]+"</label></div>");$scope.htmlUsernameTipTemplate=$sce.trustAsHtml("<div><label>"+translations["NetBrain.util.user_info.username_tip"]+"</label></div>")};$scope.initValidators=function(translations){$scope.emailValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.email_required"]},{ruleId:"email",errorMessage:translations["NetBrain.util.user_info.validation.email_valid"]},{ruleId:"duplicationChecker",params:{lsExistingNames:$scope.allEmails},errorMessage:translations["NetBrain.util.user_info.error_messages.email_duplicate"]}]};$scope.firstNameValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.first_name_required"]},{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max128},errorMessage:translations["NetBrain.util.user_info.validation.first_name_max_length"]}]};$scope.lastNameValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.last_name_required"]},{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max128},errorMessage:translations["NetBrain.util.user_info.validation.last_name_max_length"]}]};$scope.nameValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.username_required"]},{ruleId:"duplicationChecker",params:{lsExistingNames:$scope.allUserName},errorMessage:translations["NetBrain.util.user_info.error_messages.username_duplicate"]},{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max128},errorMessage:translations["NetBrain.util.user_info.validation.username_max_length"]},{ruleId:"specialChars",params:{specialChars:$scope.nameSpecialChars},errorMessage:translations["NetBrain.util.user_info.validation.username_special_char"]}]};$scope.confirmPasswordValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.confirm_pwd_required"]},{ruleId:"matchField",params:$scope.form,errorMessage:translations["NetBrain.util.user_info.validation.confirm_pwd_match"]}]};$scope.phoneNumberValidator={method:"watch",rules:[{ruleId:"phoneNumber",errorMessage:translations["NetBrain.util.user_info.validation.phone_valid"]},{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max64},errorMessage:translations["NetBrain.util.user_info.validation.phone_max_length"]}]};$scope.departmentValidator={method:"watch",rules:[{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max128},errorMessage:translations["NetBrain.util.user_info.validation.dept_max_length"]}]};$scope.descriptionValidator={method:"watch",rules:[{ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max256},errorMessage:translations["NetBrain.util.user_info.validation.description_max_length"]}]}};$scope.enforcePwdPolicy=function(translations){var htmlTemplate="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_length"]+"</label></div>";$scope.passwordPolicy.expiredInDays&&$scope.passwordPolicy.expiredInDays>0&&(htmlTemplate+="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_expire"]+"</label></div>");$scope.passwordPolicy.complexityRequirement&&(htmlTemplate+="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_complex_label"]+'</label><ul style="padding-left: 15px;"><li>'+translations["NetBrain.util.pwd_policy.pwd_complex_item_1"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_2"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_3"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_4"]+"</li></ul></div>");$scope.passwordPolicy.pwdNotSameAsUserName&&(htmlTemplate+="<div><label>Password cannot be same as username</label></div>");var _pwdI=$scope.passwordPolicy.pwdCantSameWithPrevious;_pwdI&&(htmlTemplate+='<div><label style="text-align:left;">New password can only contain at most '+(_pwdI-1)+" consecutive characters of the old one</label></div>");$scope.htmlPasswordTemplate=$sce.trustAsHtml(htmlTemplate);$scope.passwordValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.user_info.validation.pwd_required"]},{ruleId:"customized",params:{func:function(param,intValue){return!intValue.match(/[^\x00-\xff]/g)}},errorMessage:"Password contains invalid characters."}]};$scope.passwordValidator.rules.push({ruleId:"minLength",params:{length:$scope.passwordPolicy.minimumLength},errorMessage:translations["NetBrain.util.pwd_policy.pwd_min_length"]});$scope.passwordValidator.rules.push({ruleId:"maxLength",params:{length:$scope.CONSTANT_LENGTH_TEXT.Max128},errorMessage:translations["NetBrain.util.pwd_policy.pwd_max_length"]});$scope.passwordPolicy.complexityRequirement&&$scope.passwordValidator.rules.push({ruleId:"strongestPassword",errorMessage:translations["NetBrain.util.pwd_policy.pwd_cplx_rule"]});$scope.passwordPolicy.pwdNotSameAsUserName&&$scope.passwordValidator.rules.push({ruleId:"customized",params:{func:function(param,intValue){return($scope.form.userName||"").toLowerCase()!==intValue.toLowerCase()}},errorMessage:translations["NetBrain.util.pwd_policy.pwd_not_same_as_userName_rule"]})};$scope.loadTranslations=function(){utils.translateMulti(["NetBrain.register_user.header_title","NetBrain.util.user_info.error_messages.email_duplicate","NetBrain.util.user_info.error_messages.username_duplicate","NetBrain.util.user_info.validation.email_required","NetBrain.util.user_info.validation.email_valid","NetBrain.util.user_info.validation.first_name_required","NetBrain.util.user_info.validation.first_name_max_length","NetBrain.util.user_info.validation.first_name_special_char","NetBrain.util.user_info.validation.last_name_required","NetBrain.util.user_info.validation.last_name_max_length","NetBrain.util.user_info.validation.last_name_special_char","NetBrain.util.user_info.validation.username_required","NetBrain.util.user_info.validation.username_max_length","NetBrain.util.user_info.validation.username_special_char","NetBrain.util.user_info.validation.pwd_required","NetBrain.util.user_info.validation.phone_max_length","NetBrain.util.pwd_policy.pwd_length","NetBrain.util.pwd_policy.pwd_expire","NetBrain.util.pwd_policy.pwd_complex_label","NetBrain.util.pwd_policy.pwd_complex_item_1","NetBrain.util.pwd_policy.pwd_complex_item_2","NetBrain.util.pwd_policy.pwd_complex_item_3","NetBrain.util.pwd_policy.pwd_complex_item_4","NetBrain.util.pwd_policy.pwd_max_length","NetBrain.util.pwd_policy.pwd_min_length","NetBrain.util.pwd_policy.pwd_cplx_rule","NetBrain.util.pwd_policy.pwd_not_same_as_userName_rule","NetBrain.util.pwd_policy.cant_same_with_previous_rule","NetBrain.util.user_info.validation.pwd_required","NetBrain.util.user_info.validation.confirm_pwd_required","NetBrain.util.user_info.validation.confirm_pwd_match","NetBrain.util.user_info.validation.phone_valid","NetBrain.util.user_info.validation.dept_max_length","NetBrain.util.user_info.validation.description_max_length","NetBrain.util.user_info.username_tip"],{first_name_max:$scope.CONSTANT_LENGTH_TEXT.Max128,first_name_spec_char:$scope.nameSpecialChars.join(" "),last_name_max:$scope.CONSTANT_LENGTH_TEXT.Max128,last_name_spec_char:$scope.nameSpecialChars.join(" "),username_max:$scope.CONSTANT_LENGTH_TEXT.Max128,username_spec_char:$scope.nameSpecialChars.join(" "),dept_max:$scope.CONSTANT_LENGTH_TEXT.Max128,description_max:$scope.CONSTANT_LENGTH_TEXT.Max256,phone_max:$scope.CONSTANT_LENGTH_TEXT.Max64,pwd_min:$scope.passwordPolicy.minimumLength,pwd_max:$scope.CONSTANT_LENGTH_TEXT.Max128,pwd_expire_day:$scope.passwordPolicy.expiredInDays,pwd_previous_num:$scope.passwordPolicy.pwdCantSameWithPrevious}).then((function(translations){$scope.setUpUITexts(translations);$scope.initValidators(translations);$scope.enforcePwdPolicy(translations);$scope.policyLoaded=!0}))};$scope.init=function(){$(".registration-message-header").hide();httpUserRegistrationSrvc.getPasswordPolicy().then((function(result){$scope.passwordPolicy=result;$scope.loadTranslations()}),assignErrorMsg);systemSrvc.getVersionInfo().then((function(releaseInfo){releaseInfo&&($scope.version=JSON.parse(JSON.stringify(releaseInfo)))}))};$scope.init();function assignErrorMsg(errorResponse){$scope.submitBtnDisabled=!1;utils.translate("NetBrain.register_user.error_default").then((function(translation){var err=utils.getErrorMessage(errorResponse);err=""===err?translation:err;nbAlert.error(err)}))}function handleSubmitResponse(result){var message;if(result&&result.success){var errorMsg=result.reasons?result.reasons.join("\n"):"";utils.translateMulti(["NetBrain.register_user.submit_success_1","NetBrain.register_user.submit_success_2","NetBrain.register_user.submit_error"],{register_user_submit_errors:errorMsg}).then((function(translations){message=translations["NetBrain.register_user.submit_success_1"];!function(msg){$(".register-user-form").hide();$(".register-user-success").html(msg).show();$(".registration-message-header").show()}(message+=""!==errorMsg?"\n"+translations["NetBrain.register_user.submit_error"]:" "+translations["NetBrain.register_user.submit_success_2"]);$(".logo-user-email").hide()}))}else{message=result.reasons?result.reasons.join():"";$scope.submitBtnDisabled=!1;nbAlert.error(message)}}}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.activateUserCtrl",ActivateUserCtrl);ActivateUserCtrl.$inject=["$http","$q","$sce","$timeout","$scope","$window","$location","$log","$parse","$rootScope","nb.ng.httpUserRegistrationSrvc"];function ActivateUserCtrl($http,$q,$sce,$timeout,$scope,$window,$location,$log,$parse,$rootScope,httpUserRegistrationSrvc){var serverMessage=$parse("form.$error.serverMessage");$scope.form={};var queryParams=function(url){var qparams={},parts=(url||"").split("?");if(parts.length<=1)return qparams;qparams.param=parts[1];return qparams}($location.absUrl());$scope.form.param=queryParams.param;if($scope.form.param){$scope.submitForm=function(){httpUserRegistrationSrvc.activateUser($scope.form).then((function(result){if(result&&result.success){$scope.form.successMessage=$sce.trustAsHtml('Your account has been activated.<br>You can <a href="login.html" target="_blank">log in</a> to Netbrain now');serverMessage.assign($scope,"");$location.url($location.path())}else{var reasons=result.reasons?result.reasons.join():"";serverMessage.assign($scope,reasons);$scope.form.successMessage=null}}),(function(error){serverMessage.assign($scope,error.Message)}))};$scope.submitForm()}else serverMessage.assign($scope,"The account has already been activated.")}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.extraInfoDialogCtrl",ExtraInfoDialogCtrl);ExtraInfoDialogCtrl.$inject=["$scope","$uibModalInstance","$q","$timeout","$rootScope","$parse","nb.ng.nbValidationSrvc","nb.ng.httpUserRegistrationSrvc","nb.ng.utilitySrvc","userInfo"];function ExtraInfoDialogCtrl($scope,$uibModalInstance,$q,$timeout,$rootScope,$parse,nbValidationSrvc,httpUserRegistrationSrvc,utilitySrvc,userInfo){var self=this;self.userName=userInfo.userName;self.authId=userInfo.authId;self.userId=userInfo.userId;self.securityCode=userInfo.securityCode;self.form={emailAddress:(userInfo.email||"").trim(),firstName:(userInfo.firstName||"").trim(),lastName:(userInfo.lastName||"").trim()};self.nameSpecialChars=["\\"];self.validationRuleExtra={firstNameMaxLength:128,lastNameMaxLength:128};utilitySrvc.translateMulti(["NetBrain.login.extra_info_dlg.error_messages.email_required","NetBrain.login.extra_info_dlg.error_messages.email_format","NetBrain.login.extra_info_dlg.error_messages.name_special_char","NetBrain.login.extra_info_dlg.error_messages.first_name_max","NetBrain.login.extra_info_dlg.error_messages.first_name_required","NetBrain.login.extra_info_dlg.error_messages.last_name_max","NetBrain.login.extra_info_dlg.error_messages.last_name_required"],{fmax:self.validationRuleExtra.firstNameMaxLength,lmax:self.validationRuleExtra.lastNameMaxLength,nspecial:self.nameSpecialChars.join(" ")}).then((function(translations){self.emailValidator={method:"blur",rules:[{ruleId:"required",errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.email_required"]},{ruleId:"email",errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.email_format"]}]};self.firstNameValidator={method:"blur",rules:[{ruleId:"required",errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.first_name_required"]},{ruleId:"maxLength",params:{length:self.validationRuleExtra.firstNameMaxLength},errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.first_name_max"]}]};self.lastNameValidator={method:"blur",rules:[{ruleId:"required",errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.last_name_required"]},{ruleId:"maxLength",params:{length:self.validationRuleExtra.lastNameMaxLength},errorMessage:translations["NetBrain.login.extra_info_dlg.error_messages.last_name_max"]}]}}));self.submitForm=function(){$scope.errorMsg="";nbValidationSrvc.submit("extraUserInfoForm").then((function(){var userInfoObj={authId:userInfo.authId,userId:self.userId,email:self.form.emailAddress,firstName:self.form.firstName,lastName:self.form.lastName,securityCode:self.securityCode};httpUserRegistrationSrvc.updateUserInfo(userInfoObj).then((function(result){if(result.success)$uibModalInstance.close(self.form.emailAddress);else{$scope.errorMsg=result.reasons?result.reasons.join():"";self.form.successMessage=null}}),(function(error){$scope.errorMsg=error&&error.Message?error.Message:"NetBrain.login.extra_info_dlg.error_messages.default"}))}))};self.enterToSubmit=function(event){13===event.keyCode&&self.submitForm()};self.cancel=function(){$uibModalInstance.dismiss()}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.httpUserRegistrationSrvc",HttpUserRegistrationSrvc);HttpUserRegistrationSrvc.$inject=["nb.ng.nbHttp","$q"];function HttpUserRegistrationSrvc(nbHttp,$q){return{getUserEmails:function(){return nbHttp.get("Admin/User/userEmails")},registerUser:function(userObj){var user=angular.copy(userObj);var deferred=$q.defer();nbHttp.post("ServiceMonitor/publicKey",{},{}).then((function(result){var data=result.data;var confirmPwd=user.confirmPassword,newPwd=user.password;if(data&&data.length>=2&&""!==newPwd&&""!==confirmPwd){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);confirmPwd=encryptedString(key,confirmPwd);newPwd=encryptedString(key,newPwd)}user.password=newPwd;user.confirmPassword=confirmPwd;user.matchValue=confirmPwd;nbHttp.post("admin/registerUser",user,{}).then((function(data2){deferred.resolve(data2)}),(function(reason){deferred.reject(reason)}))}),(function(reason){deferred.reject(reason)}));return deferred.promise},findBackPassword:function(userObj){return nbHttp.post("admin/findBackPassword",{userName:userObj.userName,pageUrl:userObj.pageUrl},{})},resetPassword:function(userObj){var user=angular.copy(userObj);var deferred=$q.defer();nbHttp.post("ServiceMonitor/publicKey",{},{}).then((function(result){var data=result.data;var confirmPwd=user.confirmPassword,newPwd=user.password;if(data&&data.length>=2&&""!==newPwd&&""!==confirmPwd){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);confirmPwd=encryptedString(key,confirmPwd);newPwd=encryptedString(key,newPwd)}user.password=newPwd;user.confirmPassword=confirmPwd;user.matchValue=newPwd;return nbHttp.post("admin/resetPassword",user,{}).then((function(data2){deferred.resolve(data2)}),(function(reason){deferred.reject(reason)}))}),(function(reason){deferred.reject(reason)}));return deferred.promise},grantUser:function(userWithRole,pageUrl){return nbHttp.post("admin/grantUser",{UserTenantRole:userWithRole,pageUrl:pageUrl})},denyUser:function(user,reason){return nbHttp.post("admin/denyUser",{user:user,reasons:[reason]})},addToWhiteList:function(emailDomain){return nbHttp.post("admin/addToWhiteList",{emailDomain:emailDomain})},activateUser:function(user){return nbHttp.post("admin/activateUser",user,{})},updateUserInfo:function(user){return nbHttp.post("admin/updateUserInfo",user,{})},isInWhiteList:function(email){return nbHttp.post("admin/isInWhiteList",{email:email})},getUserProfile:function(){return nbHttp.get("admin/getUserProfile")},getUserProfiles:function(userIds){return nbHttp.post("admin/getUserProfiles",userIds)},addAvatarPicture:function(imageData){return nbHttp.post("admin/addAvatarPicture",{avatarList:imageData})},getUserAvatarPictureList:function(){return nbHttp.get("admin/getUserAvatarPictureList")},setCurrentAvatar:function(avatar){return nbHttp.post("admin/setCurrentAvatar",{avatar:avatar})},getPasswordPolicy:function(){return nbHttp.post("admin/getPasswordPolicy",null,{})},getUserInfoByToken:function(token){return nbHttp.post("admin/getUserInfoByToken",token,{})},saveUserProfile:function(userObj){userObj&&(userObj.ID=null);return nbHttp.post("admin/saveUserProfile",userObj)}}}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.userPasswordDialogCtrl",UserPasswordDialogCtrl);UserPasswordDialogCtrl.$inject=["$scope","$sce","$rootScope","$uibModal","$uibModalInstance","$q","nb.ng.httpAuthSrvc","nb.ng.nbValidationSrvc","nb.ng.userSrvc","nb.common.nbAlertSrvc","md5","resolveData"];function UserPasswordDialogCtrl($scope,$sce,$rootScope,$uibModal,$uibModalInstance,$q,httpAuthSrvc,nbValidationSrvc,userSrvc,nbAlertSrvc,md5,resolveData){if(resolveData.isLoginUser)$scope.userObj=userSrvc.getUserObject();else if(resolveData.userObj)$scope.userObj=resolveData.userObj;else if(resolveData.userId){$scope.userObj={};$scope.userObj.ID=resolveData.userId;$scope.reason=resolveData.reason}$scope.passwordObj={oldPassword:"",newPassword:"",confirmPassword:"",matchField:"newPassword"};$scope.errorCodes={INVALID_PWD:100022,INVALID_IDENTITY:100012};$scope.passwordPolicy=resolveData.passwordPolicy;$scope.htmlPasswordTemplate=$sce.trustAsHtml("<div><label>No password policy set in the system</label><br></div>");$scope.oldPasswordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:"The old password is required."}]};$scope.passwordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:"The new password is required."},{ruleId:"customized",params:{func:function(param,intValue){return!intValue.match(/[^\x00-\xff]/g)}},errorMessage:"Password contains invalid characters."}]};if($scope.passwordPolicy){$scope.passwordValidator.rules.push({ruleId:"minLength",params:{length:$scope.passwordPolicy.minimumLength},errorMessage:"The password should not be less than "+$scope.passwordPolicy.minimumLength+" characters"});$scope.passwordValidator.rules.push({ruleId:"maxLength",params:{length:128},errorMessage:"The password should be less than 128 characters"});$scope.passwordPolicy.complexityRequirement&&$scope.passwordValidator.rules.push({ruleId:"strongestPassword",errorMessage:"The password has to meet password policy."});$scope.passwordPolicy.pwdNotSameAsUserName&&$scope.passwordValidator.rules.push({ruleId:"mismatchFieldIgnoreCase",params:{value:$scope.userObj.name},errorMessage:"Password cannot be same as username"})}$scope.confirmPasswordValidator={method:"watch",rules:[{ruleId:"required",errorMessage:"The confirm password is required."},{ruleId:"matchField",params:$scope.passwordObj,errorMessage:"Your passwords don't match."}]};$scope.onSave=function(){nbValidationSrvc.submit("userAccountPasswordForm").then((function(){var uidPwdObj={userId:$scope.userObj.ID,oldPwd:$scope.passwordObj.oldPassword,newPwd:$scope.passwordObj.newPassword};httpAuthSrvc.changePassword(uidPwdObj).then((function(newPwd){$scope.errorMsg="";$uibModalInstance.close(newPwd)}),(function(err){if(err&&err.ResultCode)switch(err.ResultCode){case $scope.errorCodes.INVALID_PWD:case $scope.errorCodes.INVALID_IDENTITY:nbAlertSrvc.error(err.ResultDesc);break;default:nbAlertSrvc.error("Failed to update user")}else nbAlertSrvc.error("Failed to update user")}))}))};$scope.onCancel=function(){$uibModalInstance.dismiss("Cancel Button Clicked!")};$scope.initData=function(){if($scope.passwordPolicy){var htmlTemplate="<div><label>Password length: "+$scope.passwordPolicy.minimumLength+" - 128 characters</label></div>";128==$scope.passwordPolicy.minimumLength&&(htmlTemplate="<div><label>Password length: "+$scope.passwordPolicy.minimumLength+" characters</label></div>");$scope.passwordPolicy.expiredInDays&&$scope.passwordPolicy.expiredInDays>0&&(htmlTemplate+="<div><label>Password will expire in "+$scope.passwordPolicy.expiredInDays+" days </label></div>");$scope.passwordPolicy.complexityRequirement&&(htmlTemplate+="<div><label>Password must meet the following 4 rules:</label></div><ul><li>Includes uppercase letters (A - Z)</li><li>Includes lowercase letters (a - z)</li><li>Includes a number (0 - 9)</li><li>Includes a non-alphabetic character (such as ! $ # %)</li></ul></div>");$scope.passwordPolicy.pwdNotSameAsUserName&&(htmlTemplate+="<div><label>Password cannot be same as username</label></div>");$scope.passwordPolicy.pwdCantSameWithPrevious&&(htmlTemplate+='<div><label style="text-align:left;">New password can only contain at most '+($scope.passwordPolicy.pwdCantSameWithPrevious-1)+" consecutive characters of the old one</label></div>");htmlTemplate+="</div>";$scope.htmlPasswordTemplate=$sce.trustAsHtml(htmlTemplate)}};$scope.initData()}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.adminChangePasswordDialogCtrl",UserPasswordDialogCtrl);UserPasswordDialogCtrl.$inject=["$scope","$sce","$rootScope","$uibModal","$uibModalInstance","$q","nb.ng.httpAuthSrvc","nb.ng.nbValidationSrvc","nb.ng.userSrvc","nb.common.nbAlertSrvc","md5","resolveData"];function UserPasswordDialogCtrl($scope,$sce,$rootScope,$uibModal,$uibModalInstance,$q,httpAuthSrvc,nbValidationSrvc,userSrvc,nbAlertSrvc,md5,resolveData){if(resolveData.isLoginUser)$scope.userObj=userSrvc.getUserObject();else if(resolveData.userObj)$scope.userObj=resolveData.userObj;else if(resolveData.userId){$scope.userObj={};$scope.userObj.ID=resolveData.userId;$scope.reason=resolveData.reason}$scope.passwordObj={oldPassword:"",newPassword:"",confirmPassword:"",matchField:"newPassword"};$scope.errorCodes={INVALID_PWD:100022,INVALID_IDENTITY:100012};$scope.passwordPolicy=resolveData.passwordPolicy;$scope.htmlPasswordTemplate=$sce.trustAsHtml("<div><label>No password policy set in the system</label><br></div>");$scope.passwordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:"The new password is required."},{ruleId:"customized",params:{func:function(param,intValue){return!intValue.match(/[^\x00-\xff]/g)}},errorMessage:"Password contains invalid characters."}]};if($scope.passwordPolicy){$scope.passwordValidator.rules.push({ruleId:"minLength",params:{length:$scope.passwordPolicy.minimumLength},errorMessage:"The password should not be less than  "+$scope.passwordPolicy.minimumLength+" characters"});$scope.passwordValidator.rules.push({ruleId:"maxLength",params:{length:128},errorMessage:"The password should be less than 128 characters"});$scope.passwordPolicy.complexityRequirement&&$scope.passwordValidator.rules.push({ruleId:"strongestPassword",errorMessage:"The password has to meet password policy."});$scope.passwordPolicy.pwdNotSameAsUserName&&$scope.passwordValidator.rules.push({ruleId:"mismatchFieldIgnoreCase",params:{value:$scope.userObj.name},errorMessage:"Password cannot be same as username"})}$scope.confirmPasswordValidator={method:"watch",rules:[{ruleId:"required",errorMessage:"The confirm password is required."},{ruleId:"matchField",params:$scope.passwordObj,errorMessage:"Your passwords don't match."}]};$scope.onSave=function(){nbValidationSrvc.submit("userAccountPasswordForm").then((function(){var uidPwdObj={userId:$scope.userObj.ID,newPwd:$scope.passwordObj.newPassword};httpAuthSrvc.adminChangePassword(uidPwdObj).then((function(newPwd){$scope.errorMsg="";$uibModalInstance.close(newPwd)}),(function(err){if(err&&err.ResultCode)switch(err.ResultCode){case $scope.errorCodes.INVALID_PWD:case $scope.errorCodes.INVALID_IDENTITY:nbAlertSrvc.error(err.ResultDesc);break;default:nbAlertSrvc.error(err.ResultDesc||"Failed to change the password.")}else nbAlertSrvc.error("Failed to change the password.")}))}))};$scope.onCancel=function(){$uibModalInstance.dismiss("Cancel Button Clicked!")};$scope.initData=function(){if($scope.passwordPolicy){var htmlTemplate="<div><label>Password length: "+$scope.passwordPolicy.minimumLength+" - 128 characters</label></div>";128===$scope.passwordPolicy.minimumLength&&(htmlTemplate="<div><label>Password length: "+$scope.passwordPolicy.minimumLength+" characters</label></div>");$scope.passwordPolicy.expiredInDays&&$scope.passwordPolicy.expiredInDays>0&&(htmlTemplate+="<div><label>Password will expire in "+$scope.passwordPolicy.expiredInDays+" days </label></div>");$scope.passwordPolicy.complexityRequirement&&(htmlTemplate+="<div><label>Password must meet the following 4 rules:</label></div><ul><li>Includes uppercase letters (A - Z)</li><li>Includes lowercase letters (a - z)</li><li>Includes a number (0 - 9)</li><li>Includes a non-alphabetic character (such as ! $ # %)</li></ul></div>");$scope.passwordPolicy.pwdNotSameAsUserName&&(htmlTemplate+="<div><label>Password cannot be same as username</label></div>");htmlTemplate+="</div>";$scope.htmlPasswordTemplate=$sce.trustAsHtml(htmlTemplate)}};$scope.initData()}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.loginResetPasswordDialogCtrl",LoginResetPasswordDialogCtrl);LoginResetPasswordDialogCtrl.$inject=["$scope","$sce","$rootScope","$uibModal","$uibModalInstance","$q","nb.ng.httpAuthSrvc","nb.ng.nbValidationSrvc","nb.ng.utilitySrvc","resolveData"];function LoginResetPasswordDialogCtrl($scope,$sce,$rootScope,$uibModal,$uibModalInstance,$q,httpAuthSrvc,nbValidationSrvc,utilitySrvc,resolveData){$scope.loginErrors={PWD_EXPIRED:"100070",PWD_NEEDCHANGE:"100075"};$scope.userId=resolveData.userId;$scope.reason=resolveData.reason===$scope.loginErrors.PWD_EXPIRED?"NetBrain.login.error_messages.pwd_expired":"NetBrain.login.error_messages.pwd_needChange";$scope.reasonCode=resolveData.reason;$scope.passwordObj={oldPassword:"",newPassword:"",confirmPassword:"",matchField:"newPassword"};$scope.errorCodes={INVALID_PWD:100022,INVALID_IDENTITY:100012,ACCOUNT_LOCKED:100076,ACCOUNT_LOCKED_FIRST:100078};$scope.passwordPolicy=resolveData.passwordPolicy;$scope.htmlPasswordTemplate=$sce.trustAsHtml("<div><label>No password policy set in the system</label></div>");$scope.onSave=function(){$scope.passwordObj.matchValue=$scope.passwordObj.newPassword;nbValidationSrvc.submit("userResetPasswordForm").then((function(){var uidPwdObj={userId:$scope.userId,oldPwd:$scope.passwordObj.oldPassword,newPwd:$scope.passwordObj.newPassword};httpAuthSrvc.resetPassword(uidPwdObj).then((function(newPwd){$scope.errorMsg="";$uibModalInstance.close(newPwd)}),(function(err){if(err&&err.ResultCode)switch(err.ResultCode){case $scope.errorCodes.INVALID_PWD:$scope.errorMsg=err.ResultDesc;break;case $scope.errorCodes.INVALID_IDENTITY:$scope.errorMsg="Please input your current password correctly.";break;case $scope.errorCodes.ACCOUNT_LOCKED_FIRST:case $scope.errorCodes.ACCOUNT_LOCKED:$scope.errorMsg=err.ResultDesc;break;default:$scope.errorMsg="Failed to update your password. Please contact your NetBrain administrator for help."}else $scope.errorMsg="Failed to update your password. Please contact your NetBrain administrator for help."}))}))};$scope.enterToSubmit=function(event){13===event.keyCode&&$scope.onSave()};$scope.onCancel=function(){$uibModalInstance.dismiss("Pwd_Reset_Canceled")};$scope.initData=function(){utilitySrvc.translateMulti(["NetBrain.util.reset_pwd.error_messages.current_pwd_required","NetBrain.util.reset_pwd.error_messages.new_pwd_required","NetBrain.util.reset_pwd.error_messages.confirm_pwd_required","NetBrain.util.reset_pwd.error_messages.new_pwd_length_max","NetBrain.util.reset_pwd.error_messages.new_pwd_length_min","NetBrain.util.reset_pwd.error_messages.complex_pwd","NetBrain.util.reset_pwd.error_messages.match_pwd_failure"],{min:$scope.passwordPolicy.minimumLength,max:128}).then((function(translations){$scope.oldPasswordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.reset_pwd.error_messages.current_pwd_required"]}]};$scope.passwordValidator={method:"blur",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.reset_pwd.error_messages.new_pwd_required"]},{ruleId:"maxLength",params:{length:128},errorMessage:translations["NetBrain.util.reset_pwd.error_messages.new_pwd_length_max"]}]};eval($scope.passwordPolicy.pwdNotSameAsUserName.toLowerCase())&&$scope.passwordValidator.rules.push({ruleId:"mismatchFieldIgnoreCase",params:{value:$scope.passwordPolicy.userName},errorMessage:"Password cannot be same as username."});if($scope.passwordPolicy){$scope.passwordValidator.rules.push({ruleId:"minLength",params:{length:$scope.passwordPolicy.minimumLength},errorMessage:translations["NetBrain.util.reset_pwd.error_messages.new_pwd_length_min"]});"True"===$scope.passwordPolicy.complexityRequirement&&$scope.passwordValidator.rules.push({ruleId:"strongestPassword",errorMessage:translations["NetBrain.util.reset_pwd.error_messages.complex_pwd"]})}$scope.confirmPasswordValidator={method:"watch",rules:[{ruleId:"required",errorMessage:translations["NetBrain.util.reset_pwd.error_messages.confirm_pwd_required"]},{ruleId:"matchField",params:$scope.passwordObj,errorMessage:translations["NetBrain.util.reset_pwd.error_messages.match_pwd_failure"]}]}}));$scope.passwordPolicy&&utilitySrvc.translateMulti(["NetBrain.util.pwd_policy.pwd_length","NetBrain.util.pwd_policy.pwd_expire","NetBrain.util.pwd_policy.pwd_complex_label","NetBrain.util.pwd_policy.pwd_complex_item_1","NetBrain.util.pwd_policy.pwd_complex_item_2","NetBrain.util.pwd_policy.pwd_complex_item_3","NetBrain.util.pwd_policy.pwd_complex_item_4"],{pwd_min:$scope.passwordPolicy.minimumLength,pwd_max:128,pwd_expire_day:$scope.passwordPolicy.expiredInDays}).then((function(translations){var htmlTemplate="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_length"]+"</label></div>";$scope.passwordPolicy.expiredInDays&&$scope.passwordPolicy.expiredInDays>0&&(htmlTemplate+="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_expire"]+"</label></div>");"True"===$scope.passwordPolicy.complexityRequirement&&(htmlTemplate+="<div><label>"+translations["NetBrain.util.pwd_policy.pwd_complex_label"]+'</label><ul style="padding-left: 15px;"><li>'+translations["NetBrain.util.pwd_policy.pwd_complex_item_1"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_2"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_3"]+"</li><li>"+translations["NetBrain.util.pwd_policy.pwd_complex_item_4"]+"</li></ul></div>");eval($scope.passwordPolicy.pwdNotSameAsUserName.toLowerCase())&&(htmlTemplate+="<div><label>Password cannot be same as username</label></div>");var _pwdI=$scope.passwordPolicy.pwdCantSameWithPrevious;_pwdI&&(htmlTemplate+='<div><label style="text-align:left;">New password can only contain at most '+(_pwdI-1)+" consecutive characters of the old one</label></div>");$scope.htmlPasswordTemplate=$sce.trustAsHtml(htmlTemplate)}))};$scope.initData()}}(NetBrain);!function(){angular.module("nb.ng").controller("nb.ng.signinKickOffCtrl",SigninKickOffCtrl);SigninKickOffCtrl.$inject=["$scope","$uibModalInstance","$q","$rootScope","resolveData"];function SigninKickOffCtrl($scope,$uibModalInstance,$q,$rootScope,resolveData){var self=$scope;self.errorMessage=resolveData.msg;self.userName=resolveData.usr;self.onConfirm=function(){$uibModalInstance.close(!0)};self.translationData={username:self.userName};self.onCancel=function(){$uibModalInstance.dismiss()}}}(NetBrain);!function(netBrain){angular.module("nb.ng").controller("nb.ng.dbAlertDialogCtrl",dbAlertDialogCtrl);dbAlertDialogCtrl.$inject=["$scope","$uibModalInstance","$timeout","dbAlert"];function dbAlertDialogCtrl(self,$uibModalInstance,$timeout,dbAlert){self.initData=function(){$timeout((function(){document.getElementById("dbAlertMess").innerHTML=dbAlert}))};self.initData();self.onCancel=function(){$uibModalInstance.close(null)}}}(NetBrain);!function(NetBrain){angular.module("nb.ng").factory("nb.ng.licenseSrvc",LicenseService);LicenseService.$inject=["nb.ng.nbHttp","$q","$log","$timeout","nb.ng.utilitySrvc","nb.ng.httpDownloadingSrvc"];function LicenseService(nbHttp,$q,$log,$timeout,utils,httpDownloadingSrvc){return{activateLicense:function(type,method,licenseData){var url="";"trial"===type&&"online"===method?url="License/Activate/Trial/Online":"permanent"===type&&"online"===method?url="License/Activate/Permanent/Online":"permanent"===type&&"email"===method&&(url="License/Activate/Permanent/Email");var defer=$q.defer();if(""!==url){nbHttp.post("admin/getPublicKey",{},{}).then((function(data){if("trial"===type&&"online"===method);else{var key,pwdRtn;if(!data||data.length<2)pwdRtn=licenseData.password;else{setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,licenseData.password)}licenseData.password=pwdRtn}nbHttp.post(url,licenseData).then((function(result){$timeout(3e3);defer.resolve(result)}),(function(error){defer.reject(error.resultDesc||error.ResultDesc)}))}),(function(reason){defer.reject(reason)}));return defer.promise}return $q.reject("Activate Type Not Defined")},refreshLicense:function(){var defer=$q.defer();nbHttp.get("License/RefreshInformation",{},{}).then((function(licenseData){utils.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,licenseData);defer.resolve(licenseData)}),(function(error){defer.reject(error.resultDesc||error.ResultDesc||error.resultDescription||error.ResultDescription||error.errorDescription||error.ErrorDescription)}));return defer.promise},generateOfflineRefreshFile:function(){var defer=$q.defer();nbHttp.post("License/createOfflineRefreshString").then((function(result){if(utils.isIE()){httpDownloadingSrvc.doDownload(result.props,NetBrain.NG.ConfigSettings.LICENSE_ACTIVATE_FILE_NAME,"text");defer.resolve()}else if(result.status){defer.resolve();var licenseFile="data:text;charset=utf-8,"+result.props;var link=document.createElement("a");$(document.body).append(link);var fileName=NetBrain.NG.ConfigSettings.LICENSE_REFRESH_FILE_NAME;link.setAttribute("href",licenseFile);link.setAttribute("download",fileName);link.click();$(link).remove()}else defer.reject(result.error)}),(function(error){defer.reject(error.ResultDesc)}));return defer.promise},updateOfflineRefreshFile:function(licenseData){var defer=$q.defer();nbHttp.post("License/OfflineUpdate",licenseData).then((function(result){defer.resolve(result)}),(function(error){defer.reject(error.resultDesc||error.ResultDesc)}));return defer.promise},getLicense:__getLicense,getInformationNoUpdateSession:function(check){var defer=$q.defer();nbHttp.get("License/GetInformationNoUpdateSession",{bCheck:check},{}).then((function(licenseData){utils.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,licenseData);defer.resolve(licenseData)}),(function(error){defer.reject(error.resultDesc||error.ResultDesc)}));return defer.promise},getModuleLicense:function(moduleName){var deferred=$q.defer();moduleName||deferred.reject();__getLicenseFromLocalStorage().then((function(licenseData){if(moduleName&&licenseData&&licenseData.modules&&moduleName in licenseData.modules){var terms=licenseData.modules[moduleName];terms&&terms.currentTerm?deferred.resolve(terms.currentTerm):deferred.reject()}else deferred.reject()}),(function(){deferred.reject()}));return deferred.promise},displayLicenseInfo:function(licenseInfo,isCurrentTerm){var displayInfo={};displayInfo.basic=function(licenseInfo,isCurrentTerm){var basicInfo=[];var elem={};elem.id="licenseInfoId";elem.label="License ID";elem.value=licenseInfo.licenseId;basicInfo.push(elem);if(7===licenseInfo.version||"7"===licenseInfo.version){(elem={}).id="licenseInfoType";elem.label="License Type";elem.value="Permanent";basicInfo.push(elem);(elem={}).id="licenseStatus";elem.label="Status";elem.value="Unsupported";elem.isInvalid=!0;basicInfo.push(elem);return basicInfo}var essentialDisplayTerm=null;licenseInfo&&licenseInfo.modules&&licenseInfo.modules.hasOwnProperty(ADMIN_LICENSE.FEATURE.FEATURE_TYPE.ESSENTIAL)&&(essentialDisplayTerm=isCurrentTerm?licenseInfo.modules[ADMIN_LICENSE.FEATURE.FEATURE_TYPE.ESSENTIAL].currentTerm:licenseInfo.modules[ADMIN_LICENSE.FEATURE.FEATURE_TYPE.ESSENTIAL].nextTerm);if(!essentialDisplayTerm){(elem={}).id="licenseStatus";elem.label="Status";elem.value="Disabled";elem.isInvalid=!0;basicInfo.push(elem);return basicInfo}var termStartEssential=essentialDisplayTerm.startTime?new Date(essentialDisplayTerm.startTime):null;var termEssentialEnd=essentialDisplayTerm.endTime?new Date(essentialDisplayTerm.endTime):null;var dateNow=new Date;var isUnlimitedEssential=!!essentialDisplayTerm.endTime&&termEssentialEnd.getFullYear()-dateNow.getFullYear()>20;(elem={}).id="licenseInfoType";elem.label="License Type";licenseInfo.isActivate?isUnlimitedEssential?elem.value="Permanent":licenseInfo.isTrial?elem.value="Trial":elem.value="Subscription":elem.value="Unactivated";basicInfo.push(elem);if(licenseInfo.isTrial){(elem={}).id="LicenseValidity";elem.label="License Validity";elem.value=TimeUtil.formatDateTime(termEssentialEnd);basicInfo.push(elem)}else{(elem={}).id="licenseTerm";elem.label="Term";elem.value="From "+(termStartEssential?TimeUtil.formatDateTime(termStartEssential):"N/A")+" To "+(termEssentialEnd?isUnlimitedEssential?"unlimited":TimeUtil.formatDateTime(termEssentialEnd):"N/A");basicInfo.push(elem);(elem={}).id="licenseStatus";elem.label="Status";if(essentialDisplayTerm.isValid&&!0!==essentialDisplayTerm.isExpired)elem.value="In Use";else if(!0===essentialDisplayTerm.isDisabled){elem.value="Disabled";elem.isInvalid=!0}else if(!0===essentialDisplayTerm.isExpired){elem.value="Expired";if(!1===essentialDisplayTerm.isGracePeriodExpired&&essentialDisplayTerm.gracePeriod>0){var dtNow=new Date;var dtExp=new Date(essentialDisplayTerm.endTime);var leftDays=essentialDisplayTerm.gracePeriod-TimeUtil.getDateDiff(dtNow,dtExp);elem.value+=", "+leftDays+" day(s) of grace remaining"}else elem.value+=", 0 day(s) of grace remaining";elem.isInvalid=!0}else if(!1===essentialDisplayTerm.isStarted){elem.value="Not in Use";elem.isInvalid=!0}basicInfo.push(elem)}return basicInfo=basicInfo.concat(function(essentialDisplayTerm,isCurrentTerm){var basciDetail=[];var elem={};elem.id="nodeSize";elem.label="Maximum Node Count";essentialDisplayTerm.nodeSize<0?elem.value="Unlimited":null!==essentialDisplayTerm.nodeSize&&void 0!==essentialDisplayTerm.nodeSize?elem.value=isCurrentTerm?toThousands(essentialDisplayTerm.nodeSize)+" ("+toThousands(essentialDisplayTerm.freeNodeSize)+" free for assignment)":toThousands(essentialDisplayTerm.nodeSize):elem.value="N/A";basciDetail.push(elem);(elem={}).id="essentialCpuRatio";elem.label="CPU Processor Conversion Rate (Non-SDN)";elem.value="1 CPU : "+Math.floor(100*(essentialDisplayTerm.cpuRatio?essentialDisplayTerm.cpuRatio:0))/100+" node(s)";basciDetail.push(elem);(elem={}).id="seatSize";elem.label="Concurrent Seat Count";essentialDisplayTerm.seatSize<0?elem.value="Unlimited":null!==essentialDisplayTerm.seatSize&&void 0!==essentialDisplayTerm.seatSize?elem.value=toThousands(essentialDisplayTerm.seatSize):elem.value="N/A";basciDetail.push(elem);return basciDetail}(essentialDisplayTerm,isCurrentTerm))}(licenseInfo,isCurrentTerm);displayInfo.features={};licenseInfo.modules&&Object.keys(licenseInfo.modules).forEach((function(featureType){if(featureType!==ADMIN_LICENSE.FEATURE.FEATURE_TYPE.ESSENTIAL){var featureDisplayTerm=isCurrentTerm?licenseInfo.modules[featureType].currentTerm:licenseInfo.modules[featureType].nextTerm;featureDisplayTerm&&(displayInfo.features[featureType]=function(featureLicense,isTrial,featureType){var termStartFeature=featureLicense.startTime?new Date(featureLicense.startTime):null;var termEndFeature=featureLicense.endTime?new Date(featureLicense.endTime):null;var featureLicenseInfo=[];var elem={};if(isTrial){elem.id="licenseTerm";elem.label="License Validity";elem.value=TimeUtil.formatDateTime(termEndFeature)}else{var dateNow=new Date;var isUnlimitedFeature=!!featureLicense.endTime&&termEndFeature.getFullYear()-dateNow.getFullYear()>20;elem.id="licenseTerm";elem.label="Term";elem.value="From "+(termStartFeature?TimeUtil.formatDateTime(termStartFeature):"N/A")+" To "+(termEndFeature?isUnlimitedFeature?"unlimited":TimeUtil.formatDateTime(termEndFeature):"N/A");featureLicenseInfo.push(elem);(elem={}).id="licenseStatus";elem.label="Status";if(featureLicense.isValid&&!0!==featureLicense.isExpired)elem.value="In Use";else if(!0===featureLicense.isDisabled){elem.value="Disabled";elem.isInvalid=!0}else if(!0===featureLicense.isExpired){elem.value="Expired";if(!1===featureLicense.isGracePeriodExpired&&featureLicense.gracePeriod>0){var dtNow=new Date;var dtExp=new Date(featureLicense.endTime);var leftDays=featureLicense.gracePeriod-TimeUtil.getDateDiff(dtNow,dtExp);elem.value+=", "+leftDays+" day(s) of grace remaining"}else!0===featureLicense.isGracePeriodExpired&&(elem.value+=", 0 day(s) of grace remaining");elem.isInvalid=!0}else if(!1===featureLicense.isStarted){elem.value="Not in Use";elem.isInvalid=!0}}featureLicenseInfo.push(elem);featureType===ADMIN_LICENSE.FEATURE.FEATURE_TYPE.SDN&&(featureLicenseInfo=featureLicenseInfo.concat(function(featureInfo){var arr=[];var portMax={};portMax.id="sdnPortRatio";portMax.label="Port Conversion Rate (SDN)";portMax.value="1 port : "+Math.floor(100*(featureInfo.portRatio?featureInfo.portRatio:0))/100+" node(s)";arr.push(portMax);var cpuMax={};cpuMax.id="sdnCpuRatio";cpuMax.label="CPU Processor Conversion Rate (SDN)";cpuMax.value="1 CPU : "+Math.floor(100*(featureInfo.cpuRatio?featureInfo.cpuRatio:0))/100+" node(s)";arr.push(cpuMax);return arr}(featureLicense)));return featureLicenseInfo}(featureDisplayTerm,licenseInfo.isTrial,featureType))}}));return displayInfo},allowCreateTenant:function(){return nbHttp.get("License/allowCreateTenant")},unbindLicense:function(licenseData){var defer=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var key,pwdRtn;if(!data||data.length<2)pwdRtn=licenseData.password;else{setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,licenseData.password)}licenseData.password=pwdRtn;nbHttp.post("License/Unbind",licenseData).then((function(result){result.status?defer.resolve(result.props):defer.reject(result.error)}),(function(error){defer.reject(error.ResultDesc)}))}),(function(reason){defer.reject(reason)}));return defer.promise},generateLicenseFile:function(data){var defer=$q.defer();nbHttp.post("ServiceMonitor/publicKey",{},{}).then((function(keyResult){var publicKey=keyResult.data;setMaxDigits(129);var key=new RSAKeyPair(publicKey[0],"",publicKey[1]);data.password=encryptedString(key,data.password);nbHttp.post("License/Activate/Permanent/SendIdentity",data).then((function(result){if(utils.isIE()){httpDownloadingSrvc.doDownload(result.props,NetBrain.NG.ConfigSettings.LICENSE_ACTIVATE_FILE_NAME,"text");defer.resolve()}else if(result.status){defer.resolve();var licenseFile="data:text;charset=utf-8,"+result.props;var link=document.createElement("a");$(document.body).append(link);var fileName=NetBrain.NG.ConfigSettings.LICENSE_ACTIVATE_FILE_NAME;link.setAttribute("href",licenseFile);link.setAttribute("download",fileName);link.click();$(link).remove()}else defer.reject(result.error)}),(function(error){defer.reject(error.ResultDesc)}))}),(function(error){defer.reject(error.ResultDesc)}));return defer.promise},generateUnbindFile:function(content){var unbindFile="data:text;charset=utf-8,"+content;var link=document.createElement("a");$(document.body).append(link);var fileName=NetBrain.NG.ConfigSettings.LICENSE_UNBIND_FILE_NAME;link.setAttribute("href",unbindFile);link.setAttribute("download",fileName);link.click();$(link).remove()},getProxySetting:function(){return nbHttp.get("License/Proxy/Get")},setProxySetting:function(data){var defer=$q.defer();(function(pwd){var defer=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var key,pwdRtn;if(!data||data.length<2)pwdRtn=pwd;else{setMaxDigits(129);key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,pwd)}defer.resolve(pwdRtn)}),(function(reason){defer.reject(reason)}));return defer.promise})(data.proxyPassword).then((function(pwd){data.proxyPassword=pwd;nbHttp.post("License/Proxy/Set",data).then((function(result){result?defer.resolve():defer.reject("Failed to set internet proxy")}),(function(){defer.reject("Failed to set internet proxy")}))}),(function(error){defer.reject(error)}));return defer.promise},forbiddenExtensions:/(exe|jpg|jpeg|png|gif|docx?|pptx?|xslx?|one|pub|vsdx?|dotx?)$/,getLicenseLeftTime:function(expDateStr){return TimeUtil.getDiffTwoTimeString(expDateStr,Date.now())},isModuleLicenseValid:function(moduleName){var licenseData=utils.getLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE);if(!licenseData||licenseData.isError||!licenseData.isActivate||!licenseData.modules)return!1;if(!(moduleName in licenseData.modules))return!1;var terms=licenseData.modules[moduleName];if(!terms||!terms.currentTerm)return!1;return terms.currentTerm.isValid},isModuleLicenseNotDisabled:function(moduleName){var licenseData=utils.getLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE);if(!licenseData||licenseData.isError||!licenseData.isActivate||!licenseData.modules)return!1;if(!(moduleName in licenseData.modules))return!1;var terms=licenseData.modules[moduleName];if(!terms||!terms.currentTerm)return!1;return!terms.currentTerm.isDisabled},getLicenseFromLocalStorage:__getLicenseFromLocalStorage,getModuleExpInfo:_getModuleExpInfo,getLicenseExpInfo:function(){var deferred=$q.defer();__getLicense(!1).then((function(licenseData){if(licenseData&&licenseData.modules){var rtn={};for(var moduleName in licenseData.modules)moduleName!==NetBrain.NG.Const.LicenseModuleType.Automation&&licenseData.modules.hasOwnProperty(moduleName)&&(rtn[moduleName]=_getModuleExpInfo(licenseData.modules[moduleName].currentTerm));deferred.resolve(rtn)}else deferred.reject()}),(function(reason){$log.error(reason)}));return deferred.promise},hasAnyNextTerm:function(licenseData){if(!licenseData||!licenseData.modules)return!1;for(var moduleName in licenseData.modules)if(licenseData.modules.hasOwnProperty(moduleName)&&licenseData.modules[moduleName]&&licenseData.modules[moduleName].nextTerm&&!licenseData.modules[moduleName].nextTerm.isDisabled)return!0;return!1}};function toThousands(numStr){return(parseInt(numStr)||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,").toString()}function _getModuleExpInfo(moduleTerm){if(!moduleTerm||moduleTerm.isDisabled)return null;var dtNow=new Date;var dtExp=new Date(moduleTerm.endTime);var dtDiff=TimeUtil.getDateDiff(dtNow,dtExp);var leftDaysToGracePeriodEnd=moduleTerm.gracePeriod-dtDiff;var isInReminderPeriod=dtDiff>0||dtDiff<=0&&-1*dtDiff<=moduleTerm.reminderPeriod;return{isExpired:!0===moduleTerm.isExpired,isGracePeriodExpired:!0===moduleTerm.isGracePeriodExpired,leftDaysToExpire:dtDiff<0?-1*dtDiff:0,leftDaysToGracePeriodEnd:leftDaysToGracePeriodEnd>0?leftDaysToGracePeriodEnd:0,isInReminderPeriod:isInReminderPeriod}}function __getLicense(check){var defer=$q.defer();nbHttp.get("License/GetInformation",{bCheck:check},{}).then((function(licenseData){utils.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,licenseData);defer.resolve(licenseData)}),(function(error){defer.reject(error.resultDesc||error.ResultDesc||error.resultDescription||error.ResultDescription||error.errorDescription||error.ErrorDescription)}));return defer.promise}function __getLicenseFromLocalStorage(){var defer=$q.defer();var licenseData=utils.getLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE);licenseData&&!licenseData.isError&&licenseData.modules?defer.resolve(licenseData):__getLicense(!1).then((function(data){utils.setLocalStorage(NetBrain.NG.LocalStorageDefine.LICENSE_MODULE,data);defer.resolve(data)}),(function(reason){defer.reject(reason)}));return defer.promise}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.nbReloginSrvc",NbReloginSrvc);NbReloginSrvc.$inject=["$q","$timeout","$injector"];function NbReloginSrvc($q,$timeout,$injector){var isModalOpen=!1;return{reLogin:function(appType,customMessage){if(isModalOpen){var deferred2=$q.defer();deferred2.reject();return deferred2.promise}isModalOpen=!0;var message=null!=customMessage?customMessage:"Your session has expired. Please log in again. ";var uibModal=$injector.get("$uibModal");var deferred=$q.defer();uibModal.open({templateUrl:"modules/nbCommon/views/loginPopup.html",controller:"nb.common.loginPopupCtrl",windowClass:"login-popup-modal",backdrop:"static",resolve:{reloginObj:function(){return{type:appType,message:message}}}}).result.then((function(response){response?deferred.resolve(response):deferred.reject();isModalOpen=!1}),(function(error){deferred.reject(error);isModalOpen=!1}));return deferred.promise}}}}(NetBrain);!function(netBrain){angular.module("nb.ng").factory("nb.ng.fileHeadSrvc",fileHeadSrvc);fileHeadSrvc.$inject=["$q"];function fileHeadSrvc($q){var hasNoFileReader="There is no FileReader";var hasNoBlob="There is no Blob";var validateFileHeadFailed="Invalid file format.";var hasNoHeadChecker="There is no head checker for <%= extensionName %>";var fileHeadCheckers={};return{initConfig:function(config){_.each(config,(function(signature){_.each(signature.extensions,(function(extension){fileHeadCheckers[extension]={heads:signature.signatures,checker:commonCheckHead}}))}))},validateFileHead:function(fileInfo,result,accepts,unAccepts){if(!fileInfo.checkFileHead)return;var fileExtensionName=getFileExtensionName(fileInfo.name),checkHead=getHeadSettings(fileExtensionName).checker;if(function(fileInfo,result){var hasFileReader=_.isFunction(FileReader);!hasFileReader&&fileInfo.defaultError&&result.errors.push(hasNoFileReader);return hasFileReader}(fileInfo,result)&&function(fileInfo,result){var hasBlob=_.isFunction(Blob);!hasBlob&&fileInfo.defaultError&&result.errors.push(hasNoBlob);return hasBlob}(fileInfo,result)){var settingList=function(extensionNameList){var newHeads=[];extensionNameList&&_.isArray(extensionNameList)&&extensionNameList.length&&$.each(extensionNameList,(function(index,extensionName){var everyHeadSetting=fileHeadCheckers[extensionName];if(!(everyHeadSetting&&everyHeadSetting.heads&&everyHeadSetting.heads.length)){newHeads=[];return!1}newHeads=newHeads.concat(everyHeadSetting.heads)}));return newHeads}(accepts);if(settingList.length&&_.isFunction(checkHead))return(checkHead=checkHead.bind({heads:settingList}))(fileInfo,result);if(fileInfo.defaultError){var errorMessage=_.template(hasNoHeadChecker)({extensionName:fileExtensionName});result.errors.push(errorMessage);return}return function(fileInfo,result,unAccepts){unAccepts=_.difference(unAccepts,fileInfo.accept||[]);var excludeHeads=[];_.each(unAccepts,(function(extensionName){var currentHeads=getHeadSettings(extensionName);currentHeads&&currentHeads.heads&&(excludeHeads=excludeHeads.concat(currentHeads.heads))}));var sampleLength=getMaxLength(excludeHeads);return readSampleHead(fileInfo.originalFile,sampleLength).then((function(sampleHead){matchHeads(sampleHead,excludeHeads)&&result.errors.push(validateFileHeadFailed)}))}(fileInfo,result,unAccepts)}},getFileExtensionName:getFileExtensionName,getFileNameWithoutExtension:function(fileName){var lastIndex=_getFileExtensionDotPosition(fileName);return fileName.slice(0,lastIndex)}};function getHeadSettings(fileExtensionName){return fileHeadCheckers[fileExtensionName]||{}}function commonCheckHead(fileInfo,result,heads){var sampleLength=getMaxLength(heads=heads||this&&this.heads||[[]]);return readSampleHead(fileInfo.originalFile,sampleLength).then((function(sampleHead){matchHeads(sampleHead,heads)||result.errors.push(validateFileHeadFailed)}))}function matchHeads(sampleHead,heads){sampleHead=sampleHead.toUpperCase();return _.chain(heads).map(joinArrayToString).any((function(item){item=item.toUpperCase();return!!sampleHead.match(new RegExp("^"+item.replace(/\?/g,".")+".*$"))})).value()}function readSampleHead(file,sampleLength){var deferred=$q.defer();var blob=file.slice(0,sampleLength);var reader=new FileReader;reader.onload=function(){var arr=new Uint8Array(this.result);var headString=(unitArray=arr,_.chain(unitArray).map(unitToHexString).join("").value());var unitArray;deferred.resolve(headString)};reader.readAsArrayBuffer(blob);return deferred.promise}function getMaxLength(array){return _.chain(array).map(getLength).max().value()}function joinArrayToString(arr){return arr.join("")}function unitToHexString(unit){return(parseInt(unit)<16?"0":"")+unit.toString(16)}function getLength(item){return item.length}function getFileExtensionName(fileName){var lastIndex=_getFileExtensionDotPosition(fileName);return fileName.slice(lastIndex)}function _getFileExtensionDotPosition(fileName){var lastIndex=fileName.lastIndexOf(".");-1===lastIndex&&(lastIndex=0);return lastIndex}}}(NetBrain);!function(netBrain){angular.module("nb.ng").factory("nb.ng.inputFileSrvc",inputFileSrvc);inputFileSrvc.$inject=["$q","$log","$compile","nb.ng.nbHttp","nb.ng.fileHeadSrvc"];function inputFileSrvc($q,_$log,$compile,nbHttp,fileHeadSrvc){var fileTooLarge="The file size can't exceed <%=  Utility.bytesToHuman(maxSize) %>.";var fileTooLargeMultiple="Upload Failed. At least one file exceeds the size limit: <%=  Utility.bytesToHuman(maxSize) %>.";var extensionNameValidateFailedAccept="Invalid file format.<br>Allowed file extensions: <%= accepts %>";var extensionNameValidateFailedUnAccept="Invalid file format.<br>Files with the following extensions are not allowed: <%= unAccepts %>";var acceptAll=".*";var configs={businessConfig:{},acceptMapping:{},unAcceptConfig:{}};var dataPromise=nbHttp.get("/FileUploadConfig").then((function(data){if(data){data.restrictions&&(configs={businessConfig:data.restrictions.configs||{},acceptMapping:data.restrictions.acceptMapping||{},unAcceptConfig:data.restrictions.globalBlackList||[]});data.signatures&&fileHeadSrvc.initConfig(data.signatures)}}));return{getFileAccept:function(fileType){return getFileSettings(fileType).accept},validateFile:function(fileInfo,parallel,isMultiple){var result={errors:[]};return parallel?function(fileInfo,result){return $q.all([validateFileExtensionName(fileInfo,result),validateFileSize(fileInfo,result),fileHeadSrvc.validateFileHead(fileInfo,result,mapAccepts(fileInfo.accept||acceptAll),getUnaccepts(fileInfo.type))]).then((function(){return result}))}(fileInfo,result):function(fileInfo,result,isMultiple){return $q.resolve().then(wrapValidate(validateFileExtensionName)).then(wrapValidate(validateFileSize)).then(wrapValidate(fileHeadSrvc.validateFileHead.bind(fileHeadSrvc))).then(returnResult).catch(returnResult);function wrapValidate(validate){return function(){return $q.when(validate(fileInfo,result,mapAccepts(fileInfo.accept||acceptAll),getUnaccepts(fileInfo.type),isMultiple)).then((function(){return result.errors.length>0?$q.reject(result.errors):$q.resolve()}))}}function returnResult(){return result}}(fileInfo,result,isMultiple)},createInputFile:function(options){var element;options=_.extend({fileType:"",maxSize:"",fileAccept:"",fileChange:"",isMultiple:!1,maxFileCount:Number.MAX_VALUE,isParallel:!1,container:angular.element("body")},options);var compiled=_.template(['<input type="file"','auto-create="true"',"nb-input-file",'file-type="<%= fileType %>"','accept="<%= fileAccept %>"','max-size="<%= maxSize %>"',"parallel-validation=<%= isParallel %>","max-file-count=<%= maxFileCount %>",'file-change="<%= fileChange %>"',">"].join(" "));(element=$compile(compiled(options))(options.scope)).attr("multiple",options.isMultiple);options.container&&options.container.append(element);element.click();return element},checkData:function(){return dataPromise}};function validateFileExtensionName(fileInfo,result){var accept=fileInfo.accept||acceptAll,accepts=mapAccepts(accept),unAccepts=getUnaccepts(fileInfo.type),extensionName=fileHeadSrvc.getFileExtensionName(fileInfo.name);if(!(_.includes(_.map(accepts,(function(item){return item.toLowerCase()})),extensionName.toLowerCase())||accept===acceptAll&&!_.includes(_.map(unAccepts,(function(item){return item.toLowerCase()})),extensionName.toLowerCase()))){var errorMessage=_.template(accept!==acceptAll?extensionNameValidateFailedAccept:extensionNameValidateFailedUnAccept)({accepts:accepts.join(", "),unAccepts:unAccepts.join(", ")});result.errors.push(errorMessage)}}function validateFileSize(fileInfo,result,_accepts,_unAccepts,isMultiple){var fileSettings=getFileSettings(fileInfo.type);fileSettings.maxSize=fileInfo.localMaxSize&&_.isNumber(fileInfo.localMaxSize)&&fileInfo.localMaxSize>0?fileInfo.localMaxSize:fileSettings.maxSize;if(fileSettings.maxSize&&fileInfo.size>fileSettings.maxSize){var errorMessage=_.template(isMultiple?fileTooLargeMultiple:fileTooLarge)({maxSize:fileSettings.maxSize});result.errors.push(errorMessage)}}function getFileSettings(fileType){return configs&&configs.businessConfig&&configs.businessConfig[fileType]||configs.businessConfig.default||{}}function mapAccepts(accept){return configs&&configs.acceptMapping&&configs.acceptMapping[accept]||_.map(accept.split(","),(function(item){return $.trim(item)}))}function getUnaccepts(fileType){var currentConfig=getFileSettings(fileType);return currentConfig&&currentConfig.unaccept||configs&&configs.unAcceptConfig||[]}}}(NetBrain);!function(){angular.module("nb.ng").factory("nb.ng.dbAlertSrvc",DBAlertSrvc);DBAlertSrvc.$inject=["nb.ng.nbHttp"];function DBAlertSrvc(nbHttp){var API_DATACLEAN_BASE="DataClean";var API_DATACLEAN_SERVICEMONITOR_BASE="ServiceMonitor/DataClean";return{showDBAlert:function(isServiceMonitor){return nbHttp.get((isServiceMonitor?API_DATACLEAN_SERVICEMONITOR_BASE:API_DATACLEAN_BASE)+"/showDBAlert")}}}}(NetBrain);!function(){angular.module("nb.ng").directive("nbInputFile",nbInputFile);nbInputFile.$inject=["$q","nb.common.nbAlertSrvc","nb.common.nbToastr","nb.ng.inputFileSrvc"];function nbInputFile($q,nbAlertSrvc,nbToastr,inputFileSrvc){return{scope:{fileType:"@",fileAccept:"@",maxSize:"@",parallelValidation:"@",maxFileCount:"@",fileCheckHead:"@",fileChange:"&"},restrict:"A",priority:100,link:function(scope,element){element.on("change",(function(event){inputFileSrvc.checkData().then((function(){(accept=scope.fileAccept||inputFileSrvc.getFileAccept(scope.fileType))&&element.attr("accept",accept);var accept;var files=event.target.files,file=files[0],originalBusinessHandler=function(scope){if(_.isFunction(scope.fileChange)){var handler=scope.fileChange();if(_.isFunction(handler))return handler}return _.noop}(scope),isMultiple="multiple"===element.attr("multiple");file?isMultiple&&files.length>scope.maxFileCount?function(){nbAlertSrvc.error("Upload Failed. It's not allowed to upload more than "+scope.maxFileCount+" files at one time.");element.val("");cleanup()}():function(files,isMultiple){var fileValidations=[];_.each(files,(function(eachFile){fileValidations.push(function(file,isMultiple){return function(){var fileInfo=function(scope,file,accept){var shouldCheckFileHead="false"!==scope.fileCheckHead;return{type:scope.fileType,localMaxSize:parseInt(scope.maxSize),size:file.size,name:file.name,accept:accept,checkFileHead:shouldCheckFileHead,originalFile:file}}(scope,file,element.attr("accept"));var isParallel="true"===scope.parallelValidation;return inputFileSrvc.validateFile(fileInfo,isParallel,isMultiple).then((function(result){var errors=result.errors;return errors&&errors.length>0?isParallel&&isMultiple?$q.resolve({name:fileInfo.name,errorMsg:errors}):$q.reject(errors.join("; ")):$q.resolve()}))}}(eachFile,isMultiple))}));return function(arr){if("true"===scope.parallelValidation&&"multiple"===element.attr("multiple"))return $q.all(arr.map((function(item){return item()})));var sequence=$q.resolve();_.each(arr,(function(item){sequence=sequence.then(item)}));return sequence}(fileValidations)}(files,isMultiple).then((function(validationResult){originalBusinessHandler(files,event,validationResult);cleanup()}),(function(error){nbAlertSrvc.error(error);element.val("")})):function(files,event,originalBusinessHandler){originalBusinessHandler(files,event);cleanup()}(files,event,originalBusinessHandler)}))}));function cleanup(){"true"===element.attr("auto-create")&&element.remove()}}}}}(NetBrain);
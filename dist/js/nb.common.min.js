NetBrain.nbCommon=angular.module("nb.common",["templates-app"]);!function(NetBrain){var consts=NetBrain.ns("Common.Const");consts.NS_NAME="nb.Common";consts.ActionType={DrawMedia:"DrawMedia",DrawDevice:"DrawDevice",DrawDeviceAndIntfs:"DrawDeviceAndIntfs",DrawDeviceAndAlertNote:"DrawDeviceAndAlertNote",DrawDeviceGroup:"DrawDeviceGroup",DrawDeviceGroupDevice:"DrawDeviceGroupDevice",DrawSite:"DrawSite",DrawStencilItem:"DrawStencilItem",DrawPath:"DrawPath",DrawNeighbour:"DrawNeighbour",DrawJson:"DrawJson",DrawNodeByTopoLinks:"DrawNodeByTopoLinks",OpenPanel:"OpenPanel",DrawNode:"DrawNode",DrawMapWithOneIp:"DrawMapWithOneIp"};consts.DeviceGroupTypeName={RootTitle:"Device Group",Private:"My Device Groups",Shared:"Public",Policy:"Policy Device Group",System:"System"};consts.KeyCode={Ctrl:17,Shift:16,Alt:18,Del:46,L:76,R:82,C:67,T:84,B:66,M:77,S:83};consts.LegacySchema={Legacy:"Legacy",Media:"Media"}}(NetBrain);angular.module("templates-app",["controls/nb-accordion/nb-accordion-group.tpl.html","controls/nb-accordion/nb-accordion.tpl.html","controls/nb-checkbox/nb-checkbox.tpl.html","controls/nb-clear-button/nb-clear-button.tpl.html","controls/nb-dropdown/nb-dropdown-group.tpl.html","controls/nb-dropdown/nb-dropdown-option.tpl.html","controls/nb-dropdown/nb-dropdown.tpl.html","controls/nb-dropdown/nb-dropdown-same-select.tpl.html","controls/nb-dropdown/nb-editable-dropdown.tpl.html","controls/nb-filter-bar/nb-filter-bar.tpl.html","controls/nb-search-bar/nb-search-bar.tpl.html","controls/nb-listview/nb-listview-item.tpl.html","controls/nb-loader/nb-loader.tpl.html","controls/nb-popover/nb-popover.tpl.html","controls/nb-segmented/nb-segmented-option.tpl.html","controls/nb-segmented/nb-segmented.tpl.html","controls/nb-toolbar/nb-toolbar.tpl.html","controls/nb-float-button/nb-float-button.tpl.html"]);angular.module("controls/nb-accordion/nb-accordion-group.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-accordion/nb-accordion-group.tpl.html",'<div class="panel panel-default nb-accordion-group" ng-class="{active: active}" ng-click="click()">\n    <div class="panel-heading" role="tab" id="headingOne" ng-click="clickHeader()">\n\x3c!--        <i class="fa fa-sort-down"></i>--\x3e\n    </div>\n    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne" ng-class="{oin: (active !== false)}">\n        <div class="panel-body" ng-transclude>\n\n        </div>\n    </div>\n</div>')}]);angular.module("controls/nb-accordion/nb-accordion.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-accordion/nb-accordion.tpl.html",'<div class="panel-group nb-accordion" role="tablist" aria-multiselectable="true" ng-transclude>\n</div>')}]);angular.module("controls/nb-checkbox/nb-checkbox.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-checkbox/nb-checkbox.tpl.html",'<label class="nb-checkbox">\n    <input type=\'checkbox\' ng-model="value" ng-change="update()">\n    <span class="image">\n        <i class="fa fa-check"></i>\n        <i class="fa fa-square"></i>\n    </span>\n    <span ng-transclude></span>\n</label>')}]);angular.module("controls/nb-filter-bar/nb-filter-bar.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-filter-bar/nb-filter-bar.tpl.html",'<div class="form-group nb-filter-bar input-icon">\n    <input type="text" class="form-control" ng-model="inputValue" placeholder="{{placeholder}}">\n    <div class="icons icon-group">\n        <span class="icon_nb_search" ng-show="!ngModel.$modelValue"></span>\n<div class="icon_nb_close" ng-show="ngModel.$modelValue" ng-click="clear()" atag="filterBar:clearBtn"/>\n    </div>\n</div>')}]);angular.module("controls/nb-search-bar/nb-search-bar.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-search-bar/nb-search-bar.tpl.html",'<div class="form-group nb-search-bar input-icon">\n    <input type="text" class="form-control paddingRight" ng-model="inputValue" placeholder="{{placeholder}}" ui-keydown="{enter:\'onSearch()\'}">\n    <div class="icons icon-group">\n        <span class="icon_nb_search" ng-show="!inputValue" ng-click="onSearch()" atag="nbSearchBar:searchBtn"></span>\n<div class="icon_nb_close" ng-show="inputValue" ng-click="onClear()" atag="nbSearchBar:cleartBtn"/>\n    </div>\n</div>')}]);angular.module("controls/nb-clear-button/nb-clear-button.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-clear-button/nb-clear-button.tpl.html",'<div class="icon_nb_close" ng-show="ngModel.$modelValue" ng-click="clear()" />\n')}]);angular.module("controls/nb-dropdown/nb-dropdown-group.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-dropdown/nb-dropdown-group.tpl.html",'<li class="nb-dropdown-group">\n    <div>{{nbDropdownGroupLabel}}</div>\n    <ul ng-transclude>\n\n    </ul>\n</li>')}]);angular.module("controls/nb-dropdown/nb-dropdown-option.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-dropdown/nb-dropdown-option.tpl.html",'<li class="nb-dropdown-option" ng-disabled="isDisabled">\n    <a ng-click="selected($event,true)" ng-class="{selected: _selected, grouped: ngDropdownGroup}" ng-transclude ng-disabled="isDisabled"></a>\n</li>\n')}]);angular.module("controls/nb-dropdown/nb-dropdown.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-dropdown/nb-dropdown.tpl.html",'<div class="btn-group dropdown" ng-cloak>\n    <button type="button" class="btn btn-dropdown dropdown-body dropdown-body-custom" data-toggle="dropdown" ng-disabled="isDisabled" atag="nbDropdown:dropdownBtn">\n        <span ng-show="!option" class="dropdown-placeholder">{{nbDropdownPlaceholder || \' \'}}</span>\n        <span ng-show="option" class="dropdown-selection"></span>\n    </button>\n    <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false" ng-disabled="isDisabled" atag="nbDropdown:caretBtn">\n        <span class="caret"></span>\n        <span class="sr-only">Toggle Dropdown</span>\n    </button>\n    <ul class="dropdown-menu dropdown-menu-custom" uib-dropdown-menu role="menu" ng-transclude atag="nbDropdown:memu">\n    </ul>\n</div>\n')}]);angular.module("controls/nb-dropdown/nb-dropdown-same-select.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-dropdown/nb-dropdown-same-select.tpl.html",'<div class="btn-group dropdown" ng-cloak>\n    <button type="button" class="btn btn-dropdown dropdown-body dropdown-body-custom" data-toggle="dropdown" ng-disabled="isDisabled" atag="nbDropdown:dropdownBtn">\n        <span ng-show="!option" class="dropdown-placeholder">{{nbDropdownPlaceholder || \' \'}}</span>\n        <span ng-show="option" class="dropdown-selection"></span>\n    </button>\n    <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false" ng-disabled="isDisabled" atag="nbDropdown:caretBtn">\n        <div class="icon-container"><span class="icon_nb_arrow_down"></span></div>    </button>\n    <ul class="dropdown-menu" uib-dropdown-menu role="menu" ng-transclude atag="nbDropdown:memu">\n    </ul>\n</div>\n')}]);angular.module("controls/nb-dropdown/nb-editable-dropdown.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-dropdown/nb-editable-dropdown.tpl.html",'<div class="input-group dropdown" atag="nbEditDropdown:dropdown">\n    <input type="{{inputType}}" class="form-control dropdown-editable-input" ng-model="inputValue" placeholder="{{nbDropdownPlaceholder || \' \'}}" ng-disabled="isDisabled" >\n    <div class="input-group-btn">\n        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" ng-disabled="isDisabled" atag="nbEditDropdown:caretBtn">\n            <span class="caret"></span>\n        </button>\n        <ul class="dropdown-menu dropdown-editable-menu" uib-dropdown-menu role="menu" ng-transclude atag="nbEditDropdown:memu">\n        </ul>\n    </div>\n</div>\n')}]);angular.module("controls/nb-listview/nb-listview-item.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-listview/nb-listview-item.tpl.html",'<button class="ng-listview-item" ng-click="click()" ng-class="{selected: selected()}" ng-transclude>\n\n</button>')}]);angular.module("controls/nb-loader/nb-loader.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-loader/nb-loader.tpl.html",'<div class="head" />\n<div class="circle" />\n')}]);angular.module("controls/nb-popover/nb-popover.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-popover/nb-popover.tpl.html",'<div class="popover nb-popover" role="tooltip">\n  <div class="arrow"></div>\n  <div style="position:relative;">\n    <div class="handles">\n      <div dir="t" draggable="true" ></div>\n      <div dir="b" draggable="true" ></div>\n      <div dir="l" draggable="true" ></div>\n      <div dir="r" draggable="true" ></div>\n    </div>\n    <div class="popover-content" ng-transclude></div>\n  </div>\n</div>')}]);angular.module("controls/nb-segmented/nb-segmented-option.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-segmented/nb-segmented-option.tpl.html",'<button class="btn nb-segmented-option" ng-click="selected(true)" ng-class="{selected: selected()}">\n    <span class="outer" ng-style="style">\n        <span class="inner" ng-transclude></span>\n    </span>\n</button>\n')}]);angular.module("controls/nb-segmented/nb-segmented.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-segmented/nb-segmented.tpl.html",'<div class="nb-segmented btn-group" role="group" ng-transclude>\n</div>')}]);angular.module("controls/nb-toolbar/nb-toolbar.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-toolbar/nb-toolbar.tpl.html",'<button class="btn multi-select" type="button" data-toggle="button" aria-pressed="false" autocomplete="off">\n    <img src="assets/img/Multiselect_Button_20x20.png"/>\n</button>\n<nb-divider></nb-divider>\n<button class="btn fit-to-window" type="button">\n    <img src="assets/img/Fit_To_Window_Button_20x20.png"/>\n</button>\n<nb-divider></nb-divider>\n<button class="btn zoom-in" type="button" ng-click="zoomIn();" ng-disabled="data.zoom===data.max">\n    <i class="glyphicon glyphicon-plus"></i>\n</button>\n<div ui-slider="{orientation: \'vertical\', range: \'min\'}" min="{{data.min}}" max="{{data.max}}" step="1" ng-model="data.zoom"></div>\n<button class="btn zoom-out" type="button" ng-click="zoomOut();" ng-disabled="data.zoom===data.min">\n    <i class="glyphicon glyphicon-minus"></i>\n</button>\n<div class="pct-readout">{{data.zoom}}%</div>\n')}]);angular.module("controls/nb-float-button/nb-float-button.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("controls/nb-float-button/nb-float-button.tpl.html",'<div class="float-button-container" ng-click="onClick()" ng-show="showRight && liveAccessPermission">\n<div class="float-button-content">\n<div class="float-button-title">Contact NetBrain</div>\n<div ng-if="position == \'right\'"><i class="icon_nb_contact_netbrain_20" style="vertical-align: baseline"></i></div></div>\n</div>\n')}]);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(window){function nbQappTreeMgr(settings,options){var me=this;this._settings={};this._tree=[];this._nodes={};this._search="";this._isSearchDirty=!1;this._counter={start:1,end:2e9,value:1};this.constant=nbQappTreeMgr.Constant;this.handle={};dst=this._settings,src=options,Object.keys(nbQappTreeMgr.Constant.nodeAttrBindings).forEach((function(attr){!{}.hasOwnProperty.call(src,nbQappTreeMgr.Constant.nodeAttrBindings[attr])?dst[attr]=attr:dst[attr]=src[nbQappTreeMgr.Constant.nodeAttrBindings[attr]]}));var dst,src;!function(dst,src){Object.keys(nbQappTreeMgr.Constant.configs).forEach((function(attr){!{}.hasOwnProperty.call(src,attr)?dst[attr]=nbQappTreeMgr.Constant.configs[attr]:dst[attr]=src[attr]}));Object.keys(nbQappTreeMgr.Constant.handles).forEach((function(attr){!{}.hasOwnProperty.call(src,attr)?dst[attr]=dst[attr]&&nbQappTreeMgr.Constant.handles[attr]:dst[attr]=src[attr]}))}(this._settings,settings);Object.keys(nbQappTreeMgr.Constant.handles).forEach((function(handleName){me.handle[handleName]=function(){var node;switch(handleName){case"onSelectNode":if((node=arguments[0]).$edit)return!1;me.select(node.id);break;case"onUpdateNodeName":node=arguments[0];var isChanged=arguments[1];if(!node.$edit)return!1;if(!isChanged&&!node.newCat){node.name=node.name.trim();node.$edit=!1;return!1}break;case"onSelectAction":node=arguments[0]}if(me._settings[handleName]){var args=[].slice.call(arguments);return me._settings[handleName].apply(me,args)}return!1}}))}window.nbQappTreeMgr=nbQappTreeMgr;nbQappTreeMgr.Constant={nodeAttrBindings:{id:"idAttribute",pid:"parentIdAttribute",name:"labelAttribute",child:"childrenAttribute",expended:"expandedAttribute"},configs:{enableSearch:!1,enableCalcNodeNumber:!1,enableSort:!0,enableDispFileNode:!0},handles:{onInitNode:null,onUpdateNodeName:null,onSelectAction:null,onSelectNode:null,onSort:null,isFolder:null,isRoot:null},nodeStatus:{normal:0,edit:1,del2:-2,add2:-3,del:2,add:3},ex:{Sprintf_Exception:"sprintf error",MultiRoot:"nodes have more than 1 root node.",TreeNodeIsNull:"tree node array is null",NoRoot:"nodes have no root node.",NodeNotHaveProperty:'node "{0}" doesn\'t have property: {1}',NodeIdCollaps:"node's {0} {1} collaps",NodeIdLength:"length of node's {0} must > 0",zzLast:null},template:{tmp1:'<div ng-if="node[\'$isDisplay\']" style="min-width: 100%; white-space: nowrap; display:inline-block;">            <div style="white-space: nowrap; display:inline-block; position: relative;" class="ivh-tree-node ivh-node-row" ng-click="node[\'$_tree\'][\'handle\'][\'onSelectNode\'](node)" ng-class="{selected: (node[\'$selected\'])}" data-gid="{{::node[\'$id\']}}">                <span ivh-treeview-toggle class="node-icon">                    <span ng-if="::!node[\'$isFolder\']">                        <span style="opacity: 0;" class="icon_nb_tree_expand"></span>                        <span style="margin: -5px 0 0 0;" class="nb-parser-img-file"></span>                    </span>                    <span ng-if="node[\'$isFolder\'] && node[\'$expended\']">                        <span ng-style="{\'opacity\': (node[\'$hasDispChild\']) ? 1 : 0}" class="icon_nb_tree_collapse"></span>                        <span style="margin: -5px 0 0 0;" class="nb-parser-img-folder-open"></span>                    </span>                    <span ng-if="node[\'$isFolder\'] && !(node[\'$expended\'])">                        <span ng-style="{\'opacity\': (node[\'$hasDispChild\']) ? 1 : 0}" class="icon_nb_tree_expand"></span>                        <span style="margin: -5px 0 0 0;" class="nb-parser-img-folder-close"></span>                    </span>                </span>                <span title="{{node[\'$name\']}}" ng-if="!node[\'$edit\']" style="cursor: pointer;" spellcheck="false" class="nbUiGridCellWithMenuCell" ng-bind-html="node[\'$name\'] | nbParserTreeHighlightFilter: !node[\'$edit\'] && node[\'$_tree\'][\'_search\']"></span>                <input type="text" ng-if="node[\'$edit\']" id="editTree{{::node[\'$id\']}}" ng-model="node[\'$name\']" nb-on-update-text-directive="node[\'$_tree\'][\'handle\'][\'onUpdateNodeName\'](node, nbTextChanged, nbOldValue)" style="width: 100px; height: 24px; font-size: 12px;"/>                <span ng-if="node[\'$_tree\'][\'_settings\'][\'enableCalcNodeNumber\'] && node[\'$child\'] && node[\'$dispNo\']"  class="nbUiGridCellWithMenuCell">                    &nbsp;({{node[\'$fileNo\']}})                </span>                <div ng-if="node[\'$menu\'].length > 0" class="btn-group dropdown" style="position: absolute; top: 0px; right: 0px;">                    <span style="cursor: pointer;" class="nb-pl-msdisplay" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i style="margin-top: 2px; background-color: white;" class="icon_nb_action_menu nb-parser-icon"></i></span>                    <ul class="dropdown-menu dropdown-menu-custom" uib-dropdown-menu role="menu" style="font-size: 12px; top: 24px; right: 0;left: inherit;">                        <li ng-if="!action.hide" class="nb-select-option" ng-click="node[\'$_tree\'][\'handle\'][\'onSelectAction\'](node, action);" action-index="$index" ng-repeat="action in node[\'$menu\']" ng-style="{\'border-top\':(action[\'split\']) ? \'1px solid #cccccc\' : \'none\'}">                            <a>{{::action.title}}</a>                        </li>                    </ul>                </div>            </div>            <div ivh-treeview-children class="ivh-treeview-twistie-expanded"></div>        </div>'}};nbQappTreeMgr.Traverse=function(curNode,func,funcArgs){if(!0===func(curNode,funcArgs))return!0;if(curNode&&curNode.$child)for(var i=0;i<curNode.$child.length;i++)if(!0===nbQappTreeMgr.Traverse(curNode.$child[i],func,funcArgs))return!0;return!1};nbQappTreeMgr.prototype.checkInputNode=function(){};nbQappTreeMgr.sprintf=function(){if(0===arguments.length)throw new Error(nbQappTreeMgr.Constant.ex.Sprintf_Exception);var index=1;var arg=arguments;return arguments[0].replace(/\{\d*\}/g,(function(){if(arg.length>index)return String(arg[index]);throw new Error(nbQappTreeMgr.Constant.ex.Sprintf_Exception)}))};nbQappTreeMgr.prototype.getNO=function(){var no=this._counter;(no.value>no.end||no.value<no.start)&&(no.value=no.start);return no.value++};nbQappTreeMgr.prototype.initNode=function(oriNodes,retArray){var node=null;var nodeArr=[];var oriNode=null;var props={$selected:!1,$fileNo:0,$display:!0,$status:nbQappTreeMgr.Constant.nodeStatus.normal,$index:-1,$showMenu:!1,$menu:[],$edit:!1,$dispNo:!0};var arrProps=Object.keys(props);var arrNodeBindings=Object.keys(nbQappTreeMgr.Constant.nodeAttrBindings);function TreeNode(treeMgr){var meObj=this;this.$_tree=treeMgr||null;this.$_parent=null;this.$sid=treeMgr.getNO();arrProps.forEach((function(ele){meObj[ele]=props[ele]}));arrNodeBindings.forEach((function(ele){Object.defineProperty(meObj,"$"+ele,{get:function(){return this[treeMgr._settings[ele]]},set:function(value){this[treeMgr._settings[ele]]=value}})}));this.$isFolder=!treeMgr._settings.isFolder||treeMgr.handle.isFolder(oriNode);Object.defineProperty(meObj,"$hasDispChild",{get:function(){return this.$child&&this.$child.some((function(ele){return ele.$isFolder?ele.$display:ele.$display&&ele.$_tree._settings.enableDispFileNode}))}});Object.defineProperty(meObj,"$isParentExpended",{get:function(){return!this.$_parent||this.$_parent.$expended}});Object.defineProperty(meObj,"$isDisplay",{get:function(){var ret=this.$display;this.$isFolder||this.$_tree._settings.enableDispFileNode||(ret=!1);return ret}});Object.defineProperty(meObj,"nodePath",{get:function(){return treeMgr.getFullName(this,!1)}})}var oriNodeArr="[object Array]"===Object.prototype.toString.call(oriNodes)?oriNodes:[oriNodes];for(var i=0;i<oriNodeArr.length;i++){oriNode=oriNodeArr[i];this.checkInputNode(oriNode);(node=new TreeNode(this)).$child=node.$isFolder&&[]||null;node.$status=nbQappTreeMgr.Constant.nodeStatus.add;for(var attr in oriNode)({}).hasOwnProperty.call(oriNode,attr)&&(node[attr]=oriNode[attr]);nodeArr.push(node)}return retArray?nodeArr:0===nodeArr.length?null:1===nodeArr.length?nodeArr[0]:nodeArr};nbQappTreeMgr.prototype.clear=function(){var me=this;this._tree.splice(0,this._tree.length);Object.keys(this._nodes).forEach((function(attr){delete me._nodes[attr]}))};nbQappTreeMgr.prototype.$filtNodes=function(nodeMap,rootNodes){rootNodes.forEach((function(ele){ele.$isValid=!0}));var arrId=Object.keys(nodeMap);arrId.forEach((function(attr){!function(nodeMap2,node){if(!node.$isValid){var curNode=node;var nodeArr=[];var isValid=!1;for(;;){nodeArr.push(curNode);if(curNode.$isValid){isValid=!0;break}if(!(curNode=nodeMap2[curNode.$pid]))break}isValid&&nodeArr.forEach((function(ele){ele.$isValid=!0}))}}(nodeMap,nodeMap[attr])}));arrId.forEach((function(attr){nodeMap[attr].$isValid||delete nodeMap[attr]}));return nodeMap};nbQappTreeMgr.prototype.init=function(nodeArr){var me=this;if(!nodeArr)throw new Error(nbQappTreeMgr.Constant.ex.TreeNodeIsNull);me.clear();var rootNode=[];var nodeMap={};me.initNode(nodeArr,!0).forEach((function(ele){var node=ele;if(void 0===node.$id||null===node.$id||0===String(node.$id).length)throw new Error(nbQappTreeMgr.sprintf(nbQappTreeMgr.Constant.ex.NodeIdLength,"$id"));nodeMap[node.$id]=node}));Object.keys(nodeMap).forEach((function(attr){me._settings.isRoot?me.handle.isRoot(nodeMap[attr])&&rootNode.push(nodeMap[attr]):nodeMap[nodeMap[attr].$pid]||rootNode.push(nodeMap[attr])}));if(nodeArr.length>0&&0===rootNode.length)throw new Error(nbQappTreeMgr.Constant.ex.NoRoot);rootNode.forEach((function(ele){me._tree.push(ele)}));nodeMap=me.$filtNodes(nodeMap,rootNode);Object.keys(nodeMap).forEach((function(attr){var cEle=nodeMap[attr];me._nodes[cEle.$sid]=cEle;var ele=nodeMap[cEle.$pid];if(ele){ele.$child||(ele.$child=[]);ele.$child.push(cEle);cEle.$psid=ele.$sid}}));this._search="";this._isSearchDirty=!0;this.$refresh(!0);return this._tree};nbQappTreeMgr.prototype.$refresh=function(isInit){var me=this;var notInit=!isInit;function calcFileNumber(meB,node,isPart){if(isPart){if(node.$child||!node.$display)return;var changeNumber=0;Math.abs(node.$status)===nbQappTreeMgr.Constant.nodeStatus.del?changeNumber=-1:Math.abs(node.$status)===nbQappTreeMgr.Constant.nodeStatus.add&&(changeNumber=1);if(0===changeNumber)return;var curNode=meB._nodes[node.$psid];for(;curNode;){curNode.$fileNo+=changeNumber;if(!curNode.$psid)return;curNode=meB._nodes[curNode.$psid]}}else!function(meA,node){if(!node.$child&&node.$display&&Math.abs(node.$status)!==nbQappTreeMgr.Constant.nodeStatus.del){var curNode=meA._nodes[node.$psid];for(;curNode;){curNode.$fileNo+=1;if(!curNode.$psid)return;curNode=meA._nodes[curNode.$psid]}}}(meB,node)}function delNodeInTree(me4,node){var delNode=function(me3,node){var ret=null;var curNode=node;for(;curNode;){if(curNode.$status!==nbQappTreeMgr.Constant.nodeStatus.del){if(curNode.$status===nbQappTreeMgr.Constant.nodeStatus.del2){ret=null;break}break}ret=curNode;curNode.$status=nbQappTreeMgr.Constant.nodeStatus.del2;curNode=me3._nodes[curNode.$psid]}return ret}(me4,node);if(delNode){var pNode=me4._nodes[delNode.$psid];for(var i=0;i<pNode.$child.length;i++)if(pNode.$child[i].$id===delNode.$id){pNode.$child.splice(i,1);break}}}var keys=Object.keys(this._nodes);keys.forEach((function(attr){var node=me._nodes[attr];var pNode=me._nodes[node.$psid];pNode&&(node.$_parent=pNode);!function(me5,node){if(!(node.$index>=0||Math.abs(node.$status)===nbQappTreeMgr.Constant.nodeStatus.del)){var nodeArr=[];var curNode=node;for(;;){nodeArr.push(curNode);if(curNode.$index>=0)break;if(!(curNode=me5._nodes[curNode.$psid]))break}nodeArr.reverse();var startIndex=nodeArr[0].$index<0?0:nodeArr[0].$index;for(var i=0;i<nodeArr.length;i++)nodeArr[i].$index=startIndex+i}}(me,node)}));if(notInit&&this._settings.enableSearch)if(this._isSearchDirty){keys.forEach((function(attr){var ele=me._nodes[attr];ele.$display=!me._search||ele.$name.toLowerCase().indexOf(me._search.toLowerCase())>=0}));keys.forEach((function(attr){var ele=me._nodes[attr];for(;ele&&ele.$display&&(ele=me._nodes[ele.$psid])&&!ele.$display;)ele.$display=!0}))}else keys.forEach((function(attr){var ele=me._nodes[attr];if(Math.abs(ele.$status)===nbQappTreeMgr.Constant.nodeStatus.add){var oriDisplay=ele.$display;ele.$display=!me._search||ele.$name.toLowerCase().indexOf(me._search.toLowerCase())>=0;!oriDisplay&&ele.$display||(ele.$status=nbQappTreeMgr.Constant.nodeStatus.normal)}}));if(this._settings.enableCalcNodeNumber)if(this._isSearchDirty){keys.forEach((function(attr){me._nodes[attr].$fileNo=0}));keys.forEach((function(attr){calcFileNumber(me,me._nodes[attr])}))}else keys.forEach((function(attr){calcFileNumber(me,me._nodes[attr],!0)}));this._isSearchDirty=!1;if(notInit){keys.forEach((function(attr){var ele=me._nodes[attr];ele&&delNodeInTree(me,ele)}));keys.forEach((function(attr){var ele=me._nodes[attr];if(ele)switch(Math.abs(ele.$status)){case nbQappTreeMgr.Constant.nodeStatus.del:delete me._nodes[attr]}}))}keys=Object.keys(this._nodes);this._settings.enableSort&&keys.forEach((function(attr){var ele=me._nodes[attr];ele&&function(me2,node){var curNode=node;var pNode=me2._nodes[curNode.$psid];for(;curNode;){if(curNode.$status!==nbQappTreeMgr.Constant.nodeStatus.add)return;curNode.$status=nbQappTreeMgr.Constant.nodeStatus.add2;pNode&&pNode.$child.length>=2&&pNode.$child.sort((function(node1,node2){var ret=me2.handle.onSort(node1,node2);return!1===ret?node1.$isFolder!==node2.$isFolder?node1.$child?-1:1:node2.$name.toLowerCase()>node1.$name.toLowerCase()?-1:1:ret}));pNode=(curNode=me2._nodes[curNode.$psid])&&me2._nodes[curNode.$psid]||null}}(me,ele)}));keys.forEach((function(attr){var ele=me._nodes[attr];switch(Math.abs(ele.$status)){case nbQappTreeMgr.Constant.nodeStatus.add:ele.$status=nbQappTreeMgr.Constant.nodeStatus.normal;me.handle.onInitNode(ele)}}))};nbQappTreeMgr.prototype.search=function(strArg){if(this._search!==strArg){this._search=strArg;this._isSearchDirty=!0;this.$refresh()}};nbQappTreeMgr.prototype.editName=function(id){var node=this.getNodeById(id);node&&(node.$edit=!0)};nbQappTreeMgr.prototype.rename=function(id,newName){var node=this.getNodeById(id);if(node){node.$name=newName;this._settings.enableSearch&&(node.$status=nbQappTreeMgr.Constant.nodeStatus.add);this.$refresh()}};nbQappTreeMgr.prototype.select=function(id,withoutExpended){var me=this;var selectNode=me.getNodeById(id);selectNode&&Object.keys(this._nodes).forEach((function(attr){me._nodes[attr]===selectNode?me._nodes[attr].$selected=!0:me._nodes[attr].$selected=!1}));!withoutExpended&&selectNode&&me.expend(selectNode.id)};nbQappTreeMgr.prototype.expend=function(id){var node=this.getNodeById(id);var curNode=node;var arrNodes=[];if(curNode)for(;;){curNode!==node&&arrNodes.push(curNode);if(!curNode.$psid)break;curNode=this._nodes[curNode.$psid]}arrNodes.reverse();arrNodes.forEach((function(ele){ele.$expended=!0}))};nbQappTreeMgr.prototype.getSelectedNode=function(){var me=this;var ret=null;Object.keys(this._nodes).some((function(attr){if(me._nodes[attr].$selected){ret=me._nodes[attr];return!0}return!1}));return ret};nbQappTreeMgr.prototype.addNode=function(node){var pNode=this.getNodeById(node[this._settings.pid]);if(pNode&&pNode.$child){var curNode=this.initNode(node);curNode.$psid=pNode.$sid;pNode.$child.push(curNode);this._nodes[curNode.$sid]=curNode;this.$refresh();return curNode}return null};nbQappTreeMgr.prototype.deleteNodeById=function(id){var node=this.getNodeById(id);return this.deleteNode(node)};nbQappTreeMgr.prototype.deleteNode=function(node){var curNode=this._nodes[node.$sid];if(curNode){nbQappTreeMgr.Traverse(curNode,(function(argCurNode){argCurNode.$status=nbQappTreeMgr.Constant.nodeStatus.del}),null);this.$refresh();return curNode}return null};nbQappTreeMgr.prototype.createCatTree=function(){var me=this;var nodes=[];var newNode,tmpNode;Object.keys(me._nodes).forEach((function(attr){if(tmpNode=me._nodes[attr]){newNode={};Object.keys(tmpNode).forEach((function(attr2){"$"!==attr2.charAt(0)&&attr2!==me._settings.child&&(newNode[attr2]=tmpNode[attr2])}));nodes.push(newNode)}}));return nodes};nbQappTreeMgr.prototype.getNodeById=function(id){var me=this;var node=null;var nodeId=id&&id.$id||id||null;nodeId&&(nodeId!==id&&Object.keys(this._nodes).some((function(attr){if(me._nodes[attr]===id){node=me._nodes[attr];return!0}return!1}))||Object.keys(this._nodes).some((function(attr){if(String(me._nodes[attr].$id)===String(nodeId)){node=me._nodes[attr];return!0}return!1})));return node};nbQappTreeMgr.prototype.getNodeByPath=function(path){for(var ele in this._nodes)if(this._nodes[ele].parserPath===path||ele===path)return this._nodes[ele];return null};nbQappTreeMgr.prototype.getNodeByName=function(pid,name){var curNode=null;var pNode=this.getNodeById(pid)||null;pNode&&pNode.$child.some((function(ele){if(ele.$name===name){curNode=ele;return!0}return!1}));return curNode};nbQappTreeMgr.prototype.getNodesByName=function(){return _.find};nbQappTreeMgr.prototype.cloneNodeById=function(id){var curNode=this.getNodeById(id);var ret={};if(curNode)for(var attr in curNode)({}).hasOwnProperty.call(curNode,attr)&&("$child"===attr||attr===this._settings.child?ret[attr]=curNode[attr]&&[]||null:0===attr.indexOf("$_")||(ret[attr]=curNode[attr]));else ret=null;return ret};nbQappTreeMgr.prototype.refreshNode=function(oldNodeId,nodeArr,onlyChild){var me=this;var oldNode=me.getNodeById(oldNodeId)||null;var pNode=oldNode&&me._nodes[oldNode.$psid]||null;var rootNode=[];if(oldNode&&pNode){var nodeMap={};me.initNode(nodeArr,!0).forEach((function(ele){var node=ele;if(void 0===node.$id||null==node.$id||0===String(node.$id).length)throw new Error(nbQappTreeMgr.sprintf(nbQappTreeMgr.Constant.ex.NodeIdLength,"$id"));nodeMap[node.$id]=node}));if(onlyChild){nodeMap[oldNode.$id]=oldNode;rootNode.push(oldNode)}else Object.keys(nodeMap).forEach((function(attr){nodeMap[attr].$pid&&nodeMap[nodeMap[attr].$pid]||rootNode.push(nodeMap[attr])}));if(nodeArr.length>0&&0===rootNode.length)throw new Error(nbQappTreeMgr.Constant.ex.NoRoot);if(rootNode.length>1)throw new Error(nbQappTreeMgr.Constant.ex.MultiRoot);nbQappTreeMgr.Traverse(oldNode,(function(curNode){curNode.$status=nbQappTreeMgr.Constant.nodeStatus.del}),null);if(rootNode.length>0){onlyChild&&(oldNode.$status=nbQappTreeMgr.Constant.nodeStatus.normal);me.$filtNodes(nodeMap,rootNode);var arrId=Object.keys(nodeMap);arrId.forEach((function(attr){if(nodeMap[attr].$pid){var ele=nodeMap[nodeMap[attr].$pid];if(ele){ele.$child.push(nodeMap[attr]);nodeMap[attr].$psid=ele.$sid}}}));arrId.forEach((function(attr){me._nodes[nodeMap[attr].$sid]=nodeMap[attr]}));if(!onlyChild){pNode.$child.push(rootNode[0]);rootNode[0].$psid=pNode.$sid}}this.$refresh()}};nbQappTreeMgr.prototype.refreshChildren=function(id,nodeArr){this.refreshNode(id,nodeArr,!0)};nbQappTreeMgr.prototype.getParentById=function(id){var curNode=this.getNodeById(id);return curNode&&this._nodes[curNode.$psid]||null};nbQappTreeMgr.prototype.getRoot=function(){var me=this;var root=null;Object.keys(this._nodes).some((function(attr){if(!me._nodes[attr].$psid){root=me._nodes[attr];return!0}return!1}));return root};nbQappTreeMgr.prototype.getFullName=function(node,withSelf){var curNode=node;var name=withSelf&&curNode.$name||"";for(;curNode.$psid;){if(!(curNode=this._nodes[curNode.$psid]))return"";name=name.length>0?curNode.$name+" > "+name:curNode.$name}return name};nbQappTreeMgr.prototype.getFullNameArray=function(node,withSelf){var nodeArr=[];var curNode=node;withSelf&&nodeArr.push({id:curNode.$id,name:curNode.$name});for(;curNode.$psid;){if(!(curNode=this._nodes[curNode.$psid]))return"";nodeArr.push({id:curNode.$id,name:curNode.$name})}nodeArr.reverse();return nodeArr};nbQappTreeMgr.prototype.searchInFolder=function(node,searchFn,searchArg){var nodes=[];nbQappTreeMgr.Traverse(node,(function(curNode,arg){searchFn(curNode,arg)&&nodes.push(curNode)}),searchArg);nodes.length&&nodes[0]===node&&nodes.shift();return nodes};nbQappTreeMgr.prototype.getNextChildName=function(node,baseName){var base=baseName||"New Node";var nameMap={};node.$child.forEach((function(ele){nameMap[ele.$name]=!0}));var index=1;for(;nameMap[base+index];)index++;return base+index};nbQappTreeMgr.prototype.isN1HavingN2=function(node1,node2){if(node1===node2)return!1;var curNode=node2;for(;;){if(node1===curNode)return!0;if(!curNode.$psid)break;curNode=this._nodes[curNode.$psid]}return!1};nbQappTreeMgr.prototype.isRootNode=function(node){return 0===node.$index};nbQappTreeMgr.prototype.isFolder=function(node){return node.$isFolder};nbQappTreeMgr.prototype.renameNode=nbQappTreeMgr.prototype.rename;nbQappTreeMgr.prototype.cloneNode=nbQappTreeMgr.prototype.cloneNodeById;nbQappTreeMgr.prototype.focus=function(id){var curNode="object"===_typeof(id)?id:this.getNodeById(id);if(curNode){var treeNodeId="editTree"+curNode.id;if(!document.getElementById(treeNodeId))throw new Error("could not find dom object by id attribute");document.getElementById(treeNodeId).focus()}};nbQappTreeMgr.prototype.updateAllNode=function(objAttr){for(var attr in this._nodes)({}).hasOwnProperty.call(this._nodes,attr)&&angular.merge(this._nodes[attr],objAttr)};nbQappTreeMgr.prototype.filterNode=function(filterParam){return _.filter(this._nodes,filterParam)};nbQappTreeMgr.prototype.updateNode=function(id,objAttr){var node=this.getNodeById(id);node&&angular.merge(node,objAttr)}}(window);!function(){angular.module("nb.common").factory("nb.common.nbSelectPropertyMgr",SelectPropertyMgr);SelectPropertyMgr.$inject=["$q","$log","nb.systemmodel.deviceSchemaMgrSrvc","nb.systemmodel.deviceTypeMgrSrvc","nb.netbrain.httpDeviceLiveDataSrvc","nb.snapshot.httpSnapshotSrvc","nb.netbrain.httpObjectGroupSrvc"];function SelectPropertyMgr($q,$log,deviceSchemaMgrSrvc,deviceTypeMgrSrvc,httpDeviceLiveDataSrvc,httpSnapshotSrvc,httpObjectGroupSrvc){function getDeviceSchemas(){return deviceSchemaMgrSrvc.getDisplayedDeviceSchemasInDataView().map((function(schemaObj){var schemaType=schemaObj.getType();var devSchema={ID:schemaObj.getID(),displayName:schemaObj.getDisplayName(),isSchema:!0,shortDisplayname:schemaObj.getShortDisplayName(),type:schemaType};if("list"===schemaType){"object"===schemaObj.getSubtype()&&(devSchema.isSchemaTable=!0)}return devSchema}))}function getIntfSchemas(){return deviceSchemaMgrSrvc.getDisplayedIntfSchemasInDataView().map((function(schemaObj){return{ID:schemaObj.getID(),displayName:schemaObj.getDisplayName(),isSchema:!0,shortDisplayname:schemaObj.getShortDisplayName(),type:schemaObj.getType()}}))}function getAllDataTablesPromise(){var deferred=$q.defer();var lsDataTables=[];var routeTable={displayName:"Route Table",dataType:DeviceDataType.RouteTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(routeTable);var arpTable={displayName:"ARP Table",dataType:DeviceDataType.ArpTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(arpTable);var macTable={displayName:"MAC Table",dataType:DeviceDataType.MacTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(macTable);var cdpTable={displayName:"NDP Table",dataType:DeviceDataType.CdpTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(cdpTable);var stpTable={displayName:"STP Table",dataType:DeviceDataType.StpTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(stpTable);httpSnapshotSrvc.getNctTableNames().then((function(lsNctNames){lsNctNames.ncts.forEach((function(nctName){lsDataTables.push({displayName:nctName,dataType:DeviceDataType.NctTable,dataName:nctName,vrf:"",isTable:!0,isNctTable:!0})}));deferred.resolve(lsDataTables)}),(function(reason){$log.error("Error in selectGeneralPropertyMgr!");deferred.reject(reason)}));return deferred.promise}function getConfigFile(){return{displayName:"Config File",dataType:DeviceDataType.Config,dataName:"",vrf:"",isConfigFile:!0}}return{getDeviceSchemas:getDeviceSchemas,getIntfSchemas:getIntfSchemas,getAllDataTables_promise:getAllDataTablesPromise,getAll_promise:function(isDeviceProperties,devIdOptional,devTypeOptional,isGetAll){var deferred=$q.defer();var lsSchemas=[];if(isGetAll){!function(lsSchemas,deferred){lsSchemas.push(getConfigFile());var deviceSchemas=getDeviceSchemas();deviceSchemas.forEach((function(m){m.isDeviceSchema=!0}));var intfSchemas=getIntfSchemas();intfSchemas.forEach((function(m){m.isIntfSchema=!0}));lsSchemas=(lsSchemas=lsSchemas.concat(deviceSchemas)).concat(intfSchemas);getAllDataTablesPromise().then((function(lsDataTables){deferred.resolve(lsSchemas.concat(lsDataTables))}),(function(reason){deferred.reject(reason)}))}(lsSchemas,deferred);return deferred.promise}if(devIdOptional){deviceTypeMgrSrvc.isSupportConfigFile(devTypeOptional)&&lsSchemas.push(getConfigFile());lsSchemas=isDeviceProperties?lsSchemas.concat(getDeviceSchemas()):lsSchemas.concat(getIntfSchemas());(function(devId,devType){var deferred=$q.defer();var lsDataTables=[];if(deviceTypeMgrSrvc.isSupportMacTable(devType)){var macTable={displayName:"MAC Table",dataType:DeviceDataType.MacTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(macTable)}if(deviceTypeMgrSrvc.isSupportCdpTable(devType)){var cdpTable={displayName:"NDP Table",dataType:DeviceDataType.CdpTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(cdpTable)}if(deviceTypeMgrSrvc.isSupportStpTable(devType)){var stpTable={displayName:"STP Table",dataType:DeviceDataType.StpTable,dataName:"",vrf:"",isTable:!0,isNctTable:!1};lsDataTables.push(stpTable)}var promiseGetNctCates=httpObjectGroupSrvc.NCTCategoriesByDeviceId(devId);var promiseTableCates=httpDeviceLiveDataSrvc.getRouteArpTableCategoriesByDeviceId(devId,null,null);var lsPromise=[promiseGetNctCates,promiseTableCates];$q.all(lsPromise).then((function(lsRet){var lsNcts=lsRet[0];lsNcts&&lsNcts.length>0&&lsNcts.map((function(nctObj){var currNct={displayName:nctObj,dataType:DeviceDataType.NctTable,dataName:nctObj,isTable:!0,isNctTable:!0};lsDataTables.push(currNct);return nctObj}));var tableCates=lsRet[1];deviceTypeMgrSrvc.isSupportRoutingTable(devType)&&tableCates&&tableCates.routeTable&&tableCates.routeTable.length>0&&lsDataTables.push({isTable:!0,isNctTable:!1,displayName:"Route Table",dataType:DeviceDataType.RouteTable,dataName:""});deviceTypeMgrSrvc.isSupportArpTable(devType)&&tableCates&&tableCates.arpTable&&tableCates.arpTable.length>0&&lsDataTables.push({isTable:!0,isNctTable:!1,displayName:"ARP Table",dataType:DeviceDataType.ArpTable,dataName:""});deferred.resolve(lsDataTables)}),(function(reason){deferred.reject(reason)}));return deferred.promise})(devIdOptional,devTypeOptional).then((function(lsDataTables){deferred.resolve(lsSchemas.concat(lsDataTables))}),(function(reason){deferred.reject(reason)}))}else{lsSchemas.push(getConfigFile());lsSchemas=isDeviceProperties?lsSchemas.concat(getDeviceSchemas()):lsSchemas.concat(getIntfSchemas());getAllDataTablesPromise().then((function(lsDataTables){deferred.resolve(lsSchemas.concat(lsDataTables))}),(function(reason){deferred.reject(reason)}))}return deferred.promise}}}}();!function(){NbAlignSrvc.$inject=["$timeout","$q"];angular.module("nb.common").factory("nb.common.nbAlignSrvc",NbAlignSrvc);var Spots={Center:0,Top:1,TopRight:2,Right:3,RightBottom:4,Bottom:5,BottomLeft:6,Left:7,LeftTop:8};var defaultOption={spot:Spots.Center,space:5,rectify:{left:0,top:0}};var offsetGetters={leftGetters:[getCenterOffsetLeft,getCenterOffsetLeft,getRightOffsetLeft,getRightOffsetLeft,getRightOffsetLeft,getCenterOffsetLeft,getLeftOffsetLeft,getLeftOffsetLeft,getLeftOffsetLeft],topGetters:[getCenterOffsetTop,getTopOffsetTop,getTopOffsetTop,getCenterOffsetTop,getBottomOffsetTop,getBottomOffsetTop,getBottomOffsetTop,getCenterOffsetTop,getTopOffsetTop]};return;function NbAlignSrvc($timeout,$q){return{align:function(){var args=arguments;var deffered=$q.defer();return $timeout((function(){return _align.apply(null,args).then((function(){return deffered.resolve()}))})).then((function(){return deffered.promise}))},Spots:Spots};function _align(target,reference,option){var offset=function(target,reference,option){var spot=option.spot||Spots.Center;var leftGetter=offsetGetters.leftGetters[spot];var topGetter=offsetGetters.topGetters[spot];return{left:leftGetter(target,reference,option),top:topGetter(target,reference,option)}}(target=$(target),reference=$(reference),option=function(option){option=_.extend({},defaultOption,option);var rectify=_.extend({},defaultOption.rectify,option.rectify);option.rectify=rectify;return option}(option));var referenceOffset=reference.offset()||{top:0,left:0};offset.left+=referenceOffset.left;offset.top+=referenceOffset.top;offset.left+=option.rectify.left;offset.top+=option.rectify.top;target.offset(offset);return $q.resolve()}}function getLeftOffsetLeft(target,reference,option){return option.space}function getCenterOffsetLeft(target,reference){return(reference.width()-target.width())/2}function getRightOffsetLeft(target,reference,option){return reference.width()-target.width()-option.space}function getTopOffsetTop(target,reference,option){return option.space}function getCenterOffsetTop(target,reference){return(reference.height()-target.height())/2}function getBottomOffsetTop(target,reference,option){return reference.height()-target.height()-option.space}}(NetBrain);var NB_CONFIRM_OK=0;var NB_CONFIRM_YES=1;var NB_CONFIRM_NO=2;var NB_CONFIRM_CANCEL=3;var NB_CONFIRM_CHECK=4;var NB_ICON_INFORMATION="INFO";var NB_ICON_WARNING="WARNING";var NB_ICON_ERROR="ERROR";var NB_ICON_QUESTION="QUESTION";!function(){angular.module("nb.common").factory("nb.common.nbAlertSrvc",NbAlertSrvc);NbAlertSrvc.$inject=["$q","$timeout","$uibModal"];function NbAlertSrvc($q,$timeout,$uibModal){var modalDefaults={backdrop:"static",keyboard:!1,windowClass:"nb-common-message",templateUrl:"modules/nbCommon/views/nbAlert.html",controller:"nb.common.nbAlertCtrl"};var showModal=function(customModalOptions){var _dialogOptions=customModalOptions;var customizedModalOptions={};_.each(modalDefaults,(function(val,key){customizedModalOptions[key]=val;_dialogOptions[key]&&(customizedModalOptions[key]=_dialogOptions[key])}));customizedModalOptions.resolve={dialogOptions:function(){return _dialogOptions}};return $uibModal.open(customizedModalOptions).result};return window.alertSrvc={alert:alert,notification:notification,confirm:function(option){option=makeLegacyOption(arguments);var defaultOption={title:"Confirmation",iconType:NB_ICON_QUESTION,buttons:[{id:NB_CONFIRM_YES,label:"Yes"},{id:NB_CONFIRM_NO,label:"No"}]};return showModal(_.extend({},defaultOption,option)).then((function(btn){return btn===NB_CONFIRM_YES?$q.resolve():$q.reject(btn)}))},warning:warning,warnning:warning,error:function(option){option=makeLegacyOption(arguments);var defaultOption={title:"Error",iconType:NB_ICON_ERROR,buttons:[{id:NB_CONFIRM_YES,label:"OK"}]};return showModal(_.extend({},defaultOption,option))},triConfirm:function(title,message,btnContent,cancelCallback){var deferred=$q.defer();showModal({title:title,message:message,buttons:[{id:NB_CONFIRM_YES,label:btnContent.OK||"Yes"},{id:NB_CONFIRM_NO,label:btnContent.No||"No"},{id:NB_CONFIRM_CANCEL,label:btnContent.Cancel||"Cancel"}]}).then((function(button){button===NB_CONFIRM_YES?deferred.resolve(!0):button===NB_CONFIRM_NO?deferred.resolve(!1):button===NB_CONFIRM_CANCEL&&_.isFunction(cancelCallback)&&cancelCallback()}));return deferred.promise},embedMapAlert:alert,test:(opt={message:"message"},tests={testAll:function(){return tests.alert().then(tests.notification).then(tests.confirm).then(tests.warning).then(tests.error)},alert:function(){return alertSrvc.alert(opt)},notification:function(){return alertSrvc.notification(opt)},confirm:function(){return alertSrvc.confirm(opt)},warning:function(){return alertSrvc.warning(opt)},error:function(){return alertSrvc.error(opt)}})};var opt,tests;function alert(option){if(option.type){var fn=alertSrvc[option.type];return"function"==typeof fn?fn(option):void 0}return notification(option)}function notification(option){option=makeLegacyOption(arguments);var defaultOption={title:"Notification",iconType:NB_ICON_INFORMATION,buttons:[{id:NB_CONFIRM_YES,label:"OK"}]};return showModal(_.extend({},defaultOption,option))}function warning(option){option=makeLegacyOption(arguments);var defaultOption={title:"Warning",iconType:NB_ICON_WARNING,buttons:[{id:NB_CONFIRM_YES,label:"OK"}]};return showModal(_.extend({},defaultOption,option))}function makeLegacyOption(data){return 2===data.length?{message:data[0],iconType:data[1]}:1===data.length&&angular.isString(data[0])?{message:data[0]}:1===data.length&&data[0]instanceof Error?{message:String(data[0]).replace(/^Error:/,"").trim()}:data[0]}}}(NetBrain);!function(){angular.module("nb.common").factory("nb.common.nbGridUtilSrvc",nbGridUtilSrvc);nbGridUtilSrvc.$inject=[];function nbGridUtilSrvc(){return{resizeGrid:function(){}}}}(NetBrain);NetBrain,angular.module("nb.common").service("nb.common.nbSelectPropertyModalSrvc",["$uibModal",function($uibModal){var modalOptions={backdrop:"static",keyboard:!1,windowClass:"selectPropertyPopup",templateUrl:"modules/nbCommon/views/nbSelectPropertyModal.html",controller:"nb.common.nbSelectPropertyModalCtrl"};this.showModal=function(argParamsObj){modalOptions.resolve={args:function(){return argParamsObj}};return $uibModal.open(modalOptions).result}}]);!function(){angular.module("nb.common").service("nb.common.nbToastr",nbToastr);nbToastr.$inject=["$sanitize"];function nbToastr($sanitize){var _option={timeOut:5e3,positionClass:"toast-bottom-right",closeButton:!0};var _cssStyle={opacity:.95};this.success=function(message,option,cssStyle){option&&(_option=_.extend({},_option,option));cssStyle&&(_cssStyle=_.extend({},_cssStyle,cssStyle));var messageElem=toastr.success($sanitize(message),"",_option);messageElem&&messageElem.css(_cssStyle)};this.error=function(message,option,cssStyle){option&&(_option=_.extend({},_option,option));cssStyle&&(_cssStyle=_.extend({},_cssStyle,cssStyle));var messageElem=toastr.error($sanitize(message),"",_option);messageElem&&messageElem.css(_cssStyle)};this.info=function(message,option,cssStyle){option&&(_option=_.extend({},_option,option));cssStyle&&(_cssStyle=_.extend({},_cssStyle,cssStyle));toastr.info($sanitize(message),"",_option).css(_cssStyle)};this.warning=function(message,option,cssStyle){option&&(_option=_.extend({},_option,option));cssStyle&&(_cssStyle=_.extend({},_cssStyle,cssStyle));toastr.warning($sanitize(message),"",_option).css(_cssStyle)}}}(NetBrain);NetBrain,angular.module("nb.common").service("nb.common.nbAddToDeviceGroupModalSrvc",["$uibModal",function($uibModal){var modalOptions={templateUrl:"modules/nbCommon/views/addToDeviceGroupPopup.html",controller:"nb.common.addToDeviceGroupPopupCtrl",windowClass:"addToDeviceGroupPopup",backdrop:!1};this.showModal=function(lsDevIds,deviceGroupData){modalOptions.resolve={args:function(){return{lsDevIds:lsDevIds,deviceGroupData:deviceGroupData}}};return $uibModal.open(modalOptions).result}}]);!function(NetBrain){angular.module("nb.common").factory("nb.common.nbDragDropSrvc",nbDragDropSrvc);nbDragDropSrvc.$inject=["$q","$log","$timeout","$rootScope","nb.common.nbAlertSrvc","nb.topo.httpExternNbrSrvc","nb.qmap.autoLinkOptionSrvc","nb.netbrain.dataViewCacheSrvc","nb.qmap.mapManagerSrvc","nb.uiframework.urlStateMgr","nb.ng.utilitySrvc","nb.datamodel.httpSiteSrvc","nb.netbrain.httpMediaSrvc","nb.uiframework.mainUISrvc","nb.dataview.applyDataViewSrvc","nb.qmap.updateMapSrvc","nb.topo.httpTopoLinkTypesSrvc","nb.qmap.httpMapSrvc","nb.search.httpGlobalSearchSrvc"];function nbDragDropSrvc($q,$log,$timeout,$rootScope,nbAlertSrvc,httpExternNbrSrvc,autoLinkOptionSrvc,dataViewCacheSrvc,mapManagerSrvc,urlStateMgr,utilitySrvc,httpSiteSrvc,httpMediaSrvc,mainUISrvc,applyDataViewSrvc,updateMapSrvc,httpTopoLinkTypesSrvc,httpMapSrvc,httpGlobalSearchSrvc){var services={drawDevice:drawDevice,drawDeviceAndAlertNote:drawDeviceAndAlertNote,drawDeviceAndIntfs:drawDeviceAndIntfs,drawStencilItem:drawStencilItem,drawSite:drawSite,drawDeviceGroup:drawDeviceGroup,drawMedia:drawMedia,drawPath:drawPath,updatePath:updatePath,drawNeighbor:drawNeighbor,drawJson:drawJson,drawNodeJson:drawNodeJson,drawNodeByTopoLinks:drawNodeByTopoLinks,drawNode:drawNode,drawMapWithOneIp:drawMapWithOneIp,openPanel:openPanel,drawVisualSpaceDiagram:drawVisualSpaceDiagram};function distinctDevices(dragDataObj){var i=0;if(null!=dragDataObj&&null!=dragDataObj.actionData&&dragDataObj.actionData&&dragDataObj.actionData.length>1)for(;i<dragDataObj.actionData.length;){for(var j=0;j<i;j++)if(dragDataObj.actionData[i].id===dragDataObj.actionData[j].id){dragDataObj.actionData.splice(i,1);break}i++}}function drawDeviceToMap(netmap,dragDataObj,event){var deferred=$q.defer();var appPro=[];getNetmapOperator(netmap).then((function(netMapOperator){var dragDeviceCount={x:0,y:0};distinctDevices(dragDataObj);var dragDevices=dragDataObj.actionData;if(dragDevices&&!(dragDevices.length<=0)){angular.forEach(dragDevices,(function(dragDevice){var ptLocation=netMapOperator.dropPosition(dragDeviceCount,event);dragDevice.ptLocation=ptLocation;dragDeviceCount.x++}));var chunkNum=Math.ceil(dragDevices.length/5e5);for(var chunk=0;chunk<chunkNum;chunk++){var startIdx=5e5*chunk;var tempEndIdx=5e5*(chunk+1);var endIdx=tempEndIdx>dragDevices.length?dragDevices.length:tempEndIdx;var deviceChunks=dragDevices.slice(startIdx,endIdx);appPro.push(netMapOperator.dropDeviceByDragDeviceData(deviceChunks,event,null,httpExternNbrSrvc,autoLinkOptionSrvc,dataViewCacheSrvc,nbAlertSrvc,applyDataViewSrvc))}$q.all(appPro).then((function(){deferred.resolve()}))}}));return deferred.promise}function buildBbrInfoList(nbrLinkList,ids,lsIntfObjIds){var nbrInfoList=[];_.each(ids,(function(item){if(_.contains(item.intf.belongToTopoType,item.topoTypeId)){var findNbrIntfsItem=_.find(nbrLinkList.nbrIntfs,(function(findItem){return findItem.intf.intfKeyObj.value==item.intf.intfKeyObj.value}));if(findNbrIntfsItem){item=findNbrIntfsItem;var deviceName=_.find(lsIntfObjIds,(function(obj){return obj.ID==item.intf.devId})).name;if(item.nbrs.length>0){var nbrInfo=item.nbrs[0];nbrInfo.id=item.intf.devId;nbrInfo.devId=item.intf.devId;nbrInfo.name=deviceName;nbrInfo.intf=item.intf;nbrInfoList.push(nbrInfo)}else if(item.speNbrs.length>0){(tmpNbrInfo={id:item.intf.devId,devId:item.intf.devId,name:deviceName,intf:item.intf,nbrId:null,nbrDevId:null,nbrName:null,nbrIntf:null,topoTypeId:item.speNbrs[0].topoTypeId}).mediaId=item.speNbrs[0].mediaId;tmpNbrInfo.mediaInfo=item.speNbrs[0].mediaInfo;tmpNbrInfo.nbrDevId=item.speNbrs[0].mediaId;tmpNbrInfo.isP2P=item.speNbrs[0].isP2P;if(item.speNbrs[0].topoTypeId===NetBrain.Map.Const.TopoLinkType.L2Topology){tmpNbrInfo.mediaId=null;tmpNbrInfo.mediaInfo=null}nbrInfoList.push(tmpNbrInfo)}}else{var tmpNbrInfo;(tmpNbrInfo={id:item.intf.devId,devId:item.intf.devId,name:deviceName,intf:item.intf,nbrId:null,nbrDevId:null,nbrName:null,nbrIntf:null,topoTypeId:item.topoTypeId}).mediaId=item.intf.devId+item.intf.intfKeyObj.value+"MuteLAN";tmpNbrInfo.mediaInfo={mediaName:"",mediaType:"MuteLan"};if(item.topoTypeId===NetBrain.Map.Const.TopoLinkType.L2Topology){tmpNbrInfo.mediaId=null;tmpNbrInfo.mediaInfo=null}nbrInfoList.push(tmpNbrInfo)}}}));return nbrInfoList}function drawUnknownIpToMap(netmap,dragDataObj,event){var deferred=$q.defer();var unknownIps=dragDataObj.unknownIp;getNetmapOperator(netmap).then((function(netMapOperator){var dragDeviceCount={x:0,y:0};_.each(unknownIps,(function(unknownIp){unknownIp.ptLocation=netMapOperator.dropPosition(dragDeviceCount,event);var imageList;if(netmap){var qmap=netmap.getParentQmap();qmap&&(imageList=[qmap.getDefaultIconByDevType(1036)])}netMapOperator.addUnknownIpForOneIp(unknownIp.ip,getUnknownId(unknownIp.ip),unknownIp.ptLocation,imageList)}));deferred.resolve(dragDataObj)}));return deferred.promise}function drawDeviceAndIntfsToMap(netmap,dragDataObj,event){var deferred=$q.defer();getNetmapOperator(netmap).then((function(netMapOperator){var lsDevObjIds=_.uniq(_.map(dragDataObj.actionData,(function(item){return{id:item.ID}})));if(lsDevObjIds&&!(lsDevObjIds.length<=0)){var dragDeviceCount={x:0,y:0};_.each(lsDevObjIds,(function(dragDevice){var ptLocation=netMapOperator.dropPosition(dragDeviceCount,event);dragDevice.ptLocation=ptLocation;dragDeviceCount.x++}));netMapOperator.dropDeviceByDragDeviceData(lsDevObjIds,event,null,httpExternNbrSrvc,null,dataViewCacheSrvc,nbAlertSrvc,applyDataViewSrvc).then((function(){var intfIds=[];var ids=[];var lsIntfObjIds=_.filter(dragDataObj.actionData,(function(item){return item.intfId}));_.each(lsIntfObjIds,(function(intf){var findLink=netMapOperator.getLinksByDeviceIdAndInftId(intf.ID,intf.intfId);if(findLink&&findLink.length>0)return!0;intfIds.push(intf.intfId)}));if(0==intfIds.length){deferred.resolve();return deferred.promise}autoLinkOptionSrvc.autolinkOption().then((function(topoIds){dragDataObj.forceTopoIds&&dragDataObj.forceTopoIds.length>0&&(topoIds=dragDataObj.forceTopoIds);httpTopoLinkTypesSrvc.getAllTopoLinkTypes().then((function(data){var checkedTopoTypes=_.filter(data,(function(item){return _.contains(topoIds,item.ID)}));var checkedIntfTypes=[];_.each(checkedTopoTypes,(function(item){checkedIntfTypes=_.union(checkedIntfTypes,_.pluck(item.interfaceTypes,"interfaceType"))}));checkedIntfTypes=_.uniq(checkedIntfTypes);httpExternNbrSrvc.getInterfacesByIdsAndTypes(intfIds,checkedIntfTypes).then((function(intfs){_.each(intfs,(function(intf){_.each(checkedTopoTypes,(function(topoTypeItem){ids.push({intf:intf,topoTypeId:topoTypeItem.ID})}))}));httpExternNbrSrvc.getNbrIntfsByIntfId(ids).then((function(nbrLinkList){var nbrInfoList=buildBbrInfoList(nbrLinkList,ids,lsIntfObjIds);var allDeviceIds=_.map(netMapOperator.getAllDevcies(),(function(dev){return dev.key}));if(0===(nbrInfoList=_.filter(nbrInfoList,(function(nbrInfo){return _.contains(allDeviceIds,nbrInfo.devId)||_.contains(allDeviceIds,nbrInfo.nbrDevId)}))).length){deferred.resolve();return deferred.promise}netMapOperator.extendNeighbors(nbrInfoList,!0,!0).then((function(){deferred.resolve()}))}))}))}))}))}))}}));return deferred.promise}function drawDeviceAndAlertNote(dragDataObj,event){return getNetMap(dragDataObj).then((function(netmap){return updateMapSrvc.canUpdateCurrentMap().then((function(){return drawDeviceToMap(netmap,{actionData:dragDataObj.actionData.keys,actionType:NetBrain.Common.Const.ActionType.DrawDevice,defaultSelectedDataViewGroupId:null,isSiteDevices:!0},event).then((function(){getNetmapOperator(netmap).then((function(netMapOperator){$timeout((function(){dragDataObj.actionData.keys=_.pluck(dragDataObj.actionData.keys,"id");netMapOperator.addDeviceNoteRefDevice(dragDataObj.actionData.keys,{title:"Golden Baseline Alert",content:dragDataObj.actionData.content,user:dragDataObj.actionData.userName,time:dragDataObj.actionData.time,noteFromType:NetBrain.Map.Const.NoteFromType.Normal})}),1e3)}))}))}))}))}function drawDevice(dragDataObj,event){return getNetMap(dragDataObj).then((function(netmap){return updateMapSrvc.canUpdateCurrentMap().then((function(){return drawDeviceToMap(netmap,dragDataObj,event)}))}))}function drawDeviceAndIntfs(dragDataObj,event){return getNetMap(dragDataObj).then((function(netmap){return updateMapSrvc.canUpdateCurrentMap().then((function(){var promises=[];dragDataObj.unknownIp&&promises.push(drawUnknownIpToMap(netmap,dragDataObj,event));dragDataObj.actionData.length&&promises.push(drawDeviceAndIntfsToMap(netmap,dragDataObj,event));return $q.all(promises)}))}))}function getUnknownId(ip){var ipStrArr=ip.split(".");var hex=_.map(ipStrArr,(function(str){return(~~str).toString(16)})).join("");var hexNum=parseInt(hex,16);var emptyGuid="00000000-0000-0000-0000-000000000000";return emptyGuid.substring(0,emptyGuid.length-(hexNum+"").toString().length)+hexNum}function drawStencilItem(dragDataObj,event){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){netMapOperator.drawStencilItem(dragDataObj,event)}))}))}))}function drawSite(dragDataObj,event){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){netMapOperator.drawSite(httpSiteSrvc,dragDataObj.actionData,event,httpExternNbrSrvc,autoLinkOptionSrvc,dataViewCacheSrvc,nbAlertSrvc,applyDataViewSrvc)}))}))}))}function drawMedia(dragDataObj,event){getNetMap(dragDataObj).then((function(netmap){netmap.getVisualSpaceInfo()||netmap.setVisualSpaceInfo({visualSpaceInstanceId:VisualSpaceConstant.defaultVisualSpaceInstanceId,visualSpaceName:VisualSpaceConstant.defaultVisualSpaceName},!0);updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){netMapOperator.drawMedia(httpMediaSrvc,dragDataObj.actionData,event)}))}))}))}function drawMapWithOneIp(drawData,event){httpGlobalSearchSrvc.getDevAndIntfByOneIp(drawData.actionData).then((function(intfs){console.warn(intfs);if(intfs.length>0){var intfIds=[];var noIntfs=[];_.each(intfs,(function(intf,index){if(intf.deviceId){_.find(intfIds,{ID:intf.deviceId,intfId:intf.interfaceId})||intfIds.push({ID:intf.deviceId,intfId:intf.interfaceId});_.find(intfIds,{ID:intf.switchDeviceId,intfId:intf.switchInterfaceId})||intfIds.push({ID:intf.switchDeviceId,intfId:intf.switchInterfaceId})}else noIntfs.push(drawData.actionData[index])}));_.isEmpty(noIntfs)||(drawData.unknownIp=[]);_.each(noIntfs,(function(noIntf){drawData.unknownIp.push({ip:noIntf.ip})}));drawData.actionData=intfIds;drawData.forceTopoIds=[NetBrain.Map.Const.TopoLinkType.L2Topology];services.drawDeviceAndIntfs(drawData,event)}else nbAlertSrvc.warning({message:"The selected entries no longer exist."})}))}function isDrawingGroup(lsNodes){for(var i=0;i<lsNodes.length;i++)if(!0===lsNodes[i].isGroup)return!0;return!1}function drawVisualSpaceDiagram(netmap,dragDataObj,event){var lstNode=dragDataObj.NodeList;var lstLink=dragDataObj.LinkList;if(0!=lstNode.length&&null!=netmap){var lstLinkNew=[];for(var i=0;i<lstLink.length;i++){var link=lstLink[i];var bExist=!1;for(var j=0;j<lstLinkNew.length;j++)if(lstLinkNew[j]._id===link._id&&lstLinkNew[j].from===link.from&&lstLinkNew[j].to===link.to&&lstLinkNew[j].direction===link.direction){bExist=!0;break}if(isLinkExist(netmap,link)){bExist=!0;break}bExist||lstLinkNew.push(link)}lstLink=lstLinkNew;updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){for(var i=0;i<lstNode.length;i++){var node=lstNode[i];NetBrain.Map.CompPrototypeFactory.buildCompPrototype(node);netMapOperator.drawVisualSpaceNode(node)}netMapOperator.addLinkLines(lstLink,!1);netmap.getCmdTarget().onLayeredDigraphLayout()}))}))}}function drawDeviceGroup(dragDataObj,event){dragDataObj.actionData&&0!==dragDataObj.actionData.length&&getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){for(var i=0;i<dragDataObj.actionData.length;i++)netMapOperator.drawDeviceGroup(dragDataObj.actionData[i])}))}))}))}function drawNeighborDevice(netmap,dragDataObj){updateMapSrvc.canUpdateCurrentMap().then((function(){getNetmapOperator(netmap).then((function(netMapOperator){var transactionName=NgUtil.getUniqueStr("drawNeighbor");var diagram=netmap.getGoJsDiagram();diagram.startTransaction(transactionName);netMapOperator.extendNeighborsWithDataViewsSegment(dragDataObj.actionData.nbrList,dragDataObj.actionData.dataViewsSegment,applyDataViewSrvc);netmap.setNetMapLegend();diagram.commitTransaction(transactionName)}))}))}function drawNeighbor(dragDataObj){dragDataObj.actionData&&getNetMap(dragDataObj).then((function(netmap){var scope=netmap.getCurrentScope();var defered=$q.defer();defered.promise.then((function(){var cache_defered=$q.defer();scope.$emit(NetBrain.Map.Event.AddNewMapPage,netmap.getParentQmap(),cache_defered);setTimeout((function(){cache_defered.promise.then((function(newNetMap){getNetMap(dragDataObj).then((function(netmap){drawNeighborDevice(netmap,dragDataObj)}))}),(function(){}),0)}))}));var segmentList=dragDataObj.actionData.dataViewsSegment.devDataViewSegmentList;for(var i=0;i<segmentList.length;i++)if(segmentList[i].devDataView){var devNodeData=segmentList[i].devDataView.devNodeData;if(devNodeData&&!netmap.setVisualSpaceInfo(devNodeData.visualSpaceInfo)){netmap.getCurrentScope().$emit(NetBrain.Map.Event.ConfirmAddNewMapPage,netmap.getParentQmap(),defered,"");return}}drawNeighborDevice(netmap,dragDataObj)}))}function drawPathToMap(netmap,dragDataObj,mapInfo){var drawMapDataListArray=dragDataObj.actionData.drawMapDataList;var hopsListArray=dragDataObj.actionData.hopsList;var mapId=mapInfo&&mapInfo.mapId||mapManagerSrvc.getActiveMap().getDocId();var mapPageId=mapInfo&&mapInfo.mapPageId||mapManagerSrvc.getActivePage().getDocId();var index=0;function drawNotes(){$rootScope.$broadcast("updateMapViewFunc",{mapInfo:{mapId:mapId,mapPageId:mapPageId},drawMapFunctions:getDrawMapFunctions(drawMapDataListArray)})}function getDrawMapFunctions(drawMapDataList){var result=[];_.each(drawMapDataList,(function(item){var arr=item;_.each(arr,(function(innerItem){result=result.concat(innerItem.functions)}))}));return result}$rootScope.$broadcast("beginMapPathTransaction",mapInfo||{});!function next(){var val=hopsListArray[index];index++;if(val){val.mapId=mapId;val.mapPageId=mapPageId;val.isFromMapPath=!0;$rootScope.$broadcast("hopListChangeFromPathResultPanel",val);return next()}$rootScope.$broadcast("endMapPathTransaction",mapInfo||{},drawNotes)}()}function drawPath(dragDataObj,mapInfo){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){drawPathToMap(netmap,dragDataObj,mapInfo)}))}))}function updatePath(netMapOperator,compPath){if(netMapOperator&&compPath){compPath.category=NetBrain.Map.CategoryMgr.PathNew;NetBrain.Map.CompPrototypeFactory.buildCompPrototype(compPath);var oldPath=netMapOperator.getPathByPathId(compPath.pathId);if(!oldPath)return;var oldPathData=oldPath.data;if(!oldPathData)return;var pathColor=oldPathData.getColor();compPath.setColor(pathColor);oldPathData.isLivePath()&&compPath.setType(NetBrain.Map.Const.LinkType.Dash);compPath.setDiff(oldPathData.getDiff());netMapOperator.updatePath(compPath)}}function openPanel(dragDataObj){return getNetMap(dragDataObj).then((function(){openPanelByType(dragDataObj)}))}function generateLinkKey(link){return[link.from,link.to,link.fromText,link.toText].join("|")}function isLinkExist(netmap,link){var linkKey=generateLinkKey(link);var links=netmap._getAllLinksByFilter((function(currentLink){return generateLinkKey(currentLink)===linkKey}));return links&&links.length>0}function drawNodeToMap(netmap,dragDataObj,event){0==netmap._diagram.nodes.count&&!0;dragDataObj.visualSpaceInstanceId;getNetmapOperator(netmap).then((function(netMapOperator){var dragData={actionData:[],actionType:dragDataObj.actionType,isSiteDevices:dragDataObj.isSiteDevices};dragDataObj.actionData.forEach((function(item){dragData.actionData.push({id:item.key,devNodeData:{id:item.key,visualSpaceInfo:{visualSpaceInstanceId:dragDataObj.visualSpaceInstanceId},nodeIdentify:{nbPathSchema:item.nbPathSchema,nbPathValue:item.nbPathValue}}})}));drawDeviceToMap(netmap,dragData,event)}))}function getIntfInfoForLink(node,currLink){var fromNodeKey=currLink.from;var toNodeKey=currLink.to;if(node.dataViewData&&node.dataViewData.intfInfoList){for(var i=0;i<node.dataViewData.intfInfoList.length;i++){var currIntfInfo=node.dataViewData.intfInfoList[i];if(currIntfInfo.intf&&currIntfInfo.intf.intfKeyObj&&currIntfInfo.intf.intfKeyObj.value){var intfKeyValue=currIntfInfo.intf.intfKeyObj.value;if(0===intfKeyValue.indexOf(fromNodeKey)&&intfKeyValue.length>fromNodeKey.length&&"/"===intfKeyValue.charAt(fromNodeKey.length)||0===intfKeyValue.indexOf(toNodeKey)&&intfKeyValue.length>toNodeKey.length&&"/"===intfKeyValue.charAt(toNodeKey.length))return currIntfInfo}}return null}}function modifyGoJsTemplate(netmap,diagram,dictGoJsTemplates){if(dictGoJsTemplates){var dictNodeTmpl=dictGoJsTemplates.nodeTemplates;var dictLinkTmpl=dictGoJsTemplates.linkTemplates;var dictGroupTmpl=dictGoJsTemplates.groupTemplates;var fnLocationParse=function(data,node){return NetBrain.Map.GoDiagramPositionUtil.zoomPositionParse(diagram,data)};var fnPointStringify=function(pt,data){return NetBrain.Map.GoDiagramPositionUtil.zoomPositionStringify(diagram,pt,data)};var scope=netmap.currentScopeRef;var $=go.GraphObject.make;var lsNodeCates=Object.keys(dictNodeTmpl);lsNodeCates.forEach((function(nodeCate){var $=go.GraphObject.make;var nodeTmpl=eval(dictNodeTmpl[nodeCate]);diagram.nodeTemplateMap.add(nodeCate,nodeTmpl)}));var lsLinkCates=Object.keys(dictLinkTmpl);lsLinkCates.forEach((function(linkCate){var $=go.GraphObject.make;var linkTmpl=eval(dictLinkTmpl[linkCate]);diagram.linkTemplateMap.add(linkCate,linkTmpl)}));var lsGroupCates=Object.keys(dictGroupTmpl);lsGroupCates.forEach((function(groupCate){var $=go.GraphObject.make;var groupTmpl=eval(dictGroupTmpl[groupCate]);diagram.groupTemplateMap.add(groupCate,groupTmpl)}))}}function drawNode(dragDataObj,event){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){drawNodeToMap(netmap,dragDataObj,event)}))}))}function openPanel(dragDataObj,event){return getNetMap(dragDataObj).then((function(netmap){openPanelByType(dragDataObj)}))}function openPanelByType(dragDataObj){$rootScope.$emit(viewFrameEvent.toggleTopPanel,dragDataObj.panelType,dragDataObj.option)}function drawJson(dragDataObj){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){netmap._netmapJsWrapper.pageData.linkDataArray=dragDataObj.actionData.linkDataArray;netmap._netmapJsWrapper.pageData.nodeDataArray=dragDataObj.actionData.nodeDataArray;netmap.doOpen(netmap._netmapJsWrapper.pageData);netmap.setActive(!0);netmap.setReadOnly(!1);netmap.refreshMapViewOptionVisible();netmap.setNetMapLegend();$timeout((function(){netmap.setModify(!0)}))}))}))}function drawNodeJson(dragDataObj){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){_drawEachNodeJson(netmap,dragDataObj)}))}))}function drawNodeByTopoLinks(dragDataObj){getNetMap(dragDataObj).then((function(netmap){updateMapSrvc.canUpdateCurrentMap().then((function(){_renderMap(netmap,dragDataObj)}))}))}function _renderMap(netmap,actionData){getNetmapOperator(netmap).then((function(netMapOperator){var actionDataId=actionData.actionDataId;var args=actionData.actionData;actionDataId?httpMapSrvc.getMapAction(actionDataId).then((function(raw){if(raw){args=JSON.parse(raw);httpMapSrvc.deleteMapAction(actionDataId);var dataViewsSegmentIn=_buildDataViewsSegmentInParameters(args);dataViewCacheSrvc.getDataViewsSegment(null,dataViewsSegmentIn).then((function(dataViewsSegmentOut){if(null!=dataViewsSegmentOut){args.dataViewsSegment=dataViewsSegmentOut;_render(args,netMapOperator)}}))}}),(function(){})):_render(args,netMapOperator)}));function _render(args,netMapOperator){if(args.renderType===NetBrain.Map.Const.RenderMapType.byLinks){args.neighborLinks&&args.neighborLinks.length>0&&netMapOperator.extendNeighborsWithDataViewsSegment(args.neighborLinks,args.dataViewsSegment);_.each(args.dataViewsSegment.devDataViewSegmentList,(function(item){_.find(args.neighborLinks,(function(obj){return obj.devId===item.devId||obj.nbrDevId===item.devId}))||netMapOperator.dropDeviceByDataView(item.devDataView)}));netMapOperator.forceDirectedLayoutNew()}else args.renderType===NetBrain.Map.Const.RenderMapType.byNodes&&netMapOperator.addDevices(httpExternNbrSrvc,args.neighborNodes,"L3_Topo_Type").then((function(){netMapOperator.forceDirectedLayoutNew()}))}}function _buildDataViewsSegmentInParameters(actionData){var dataViewsSegmentIn=new window.DataViewsSegment;for(var nbrIndex in actionData.neighborLinks)if(Object.prototype.hasOwnProperty.call(actionData.neighborLinks,nbrIndex)){var info=actionData.neighborLinks[nbrIndex];dataViewsSegmentIn.addDev(info.id);null!=info.intf&&null!=info.intf.intfKeyObj&&dataViewsSegmentIn.addIntf(info.id,info.intf.intfKeyObj,info.topoTypeId);dataViewsSegmentIn.addDev(info.nbrId);null!=info.nbrIntf&&null!=info.nbrIntf.intfKeyObj&&dataViewsSegmentIn.addIntf(info.nbrId,info.nbrIntf.intfKeyObj,info.topoTypeId)}for(var i in actionData.nodes)if(Object.prototype.hasOwnProperty.call(actionData.nodes,i)){var deviceId=actionData.nodes[i];dataViewsSegmentIn.addDev(deviceId)}return dataViewsSegmentIn}function _drawEachNodeJson(netmap,dragDataObj){var newNodeIds=[];var netMapOperator=netmap.getNetmapOperator();var needLayout=!0===dragDataObj.needLayout;var diagram=netmap.getGoJsDiagram();var viewportBounds=diagram.viewportBounds;var documentBounds=diagram.documentBounds;var startX=Math.max(viewportBounds.x,documentBounds.x);var startY=Math.max(viewportBounds.y,documentBounds.y);var width=Math.max(Math.min(viewportBounds.width,documentBounds.width),800);var height=Math.max(Math.min(viewportBounds.height,documentBounds.height),600);netmap.setActive(!0);netmap.setReadOnly(!1);var scope=netmap.getCurrentScope();var defered=$q.defer();if(!_.isEmpty(dragDataObj.actionData.nodeDataArray)){var nodeTemp=dragDataObj.actionData.nodeDataArray[0];if(!nodeTemp.devNodeData||!nodeTemp.devNodeData.hasOwnProperty("visualSpaceInfo"))for(var i=1;i<dragDataObj.actionData.nodeDataArray.length&&(!(nodeTemp=dragDataObj.actionData.nodeDataArray[i]).devNodeData||!nodeTemp.devNodeData.hasOwnProperty("visualSpaceInfo"));++i);netmap.setVisualSpaceInfo(nodeTemp.devNodeData.visualSpaceInfo)?function(){var transactionName=NgUtil.getUniqueStr("doAddNodeJsonToMap");netMapOperator.startTransaction(transactionName);_.each(dragDataObj.actionData.nodeDataArray,(function(node){NetBrain.Map.CompPrototypeFactory.buildCompPrototype(node);if(netmap._model.findNodeDataForKey(node.key)){if(NetBrain.Map.CategoryMgr.isNetworkDevice(node.category)){netmap._centerNode(node);netMapOperator.highlightNode(node)}}else{if(needLayout){var x=startX+Math.random()*width;var y=startY+Math.random()*height;node.location=x+" "+y}netMapOperator.addDevice(node);newNodeIds.push(node.key)}}));var addLinks=[];_.each(dragDataObj.actionData.linkDataArray,(function(link){NetBrain.Map.CompPrototypeFactory.buildCompPrototype(link);netMapOperator.addLinkLine(link)&&addLinks.push(link)}));needLayout&&newNodeIds.length>0&&netMapOperator.forceDirectedLayoutNew(newNodeIds);netmap.refreshMapViewOptionVisible();netMapOperator.commitTransaction(transactionName);_.each(addLinks,(function(link){var diagramLink=netmap.getGoJsDiagram().findLinkForData(link);diagramLink&&diagramLink.invalidateRoute&&diagramLink.invalidateRoute()}))}():scope.$emit(NetBrain.Map.Event.ConfirmAddNewMapPage,netmap.getParentQmap(),defered,"")}defered.promise.then((function(){var cache_defered=$q.defer();scope.$emit(NetBrain.Map.Event.AddNewMapPage,netmap.getParentQmap(),cache_defered);setTimeout((function(){cache_defered.promise.then((function(newNetMap){_drawEachNodeJson(newNetMap,dragDataObj)}),(function(){}),0)}))}))}function getNetMap(dragDataObj){var deferred=$q.defer();!function(){var isDeskTopPage=mainUISrvc.isDesktop();var netmap=mapManagerSrvc.getActivePage();var options;var key;if(isDeskTopPage&&!netmap){var mapArgs={id:Guid(),callBack:function(){$timeout((function(){netmap=mapManagerSrvc.getActivePage();if(dragDataObj.topoType){var defaultMapAutoLinkOptionList=[dragDataObj.topoType];netmap.setMapAutoLinkOptionList(defaultMapAutoLinkOptionList)}deferred.resolve(netmap)}),300)}};utilitySrvc.setLocalStorage("CreateMap"+mapArgs.id,{});$rootScope.$emit("NewMap",null,mapArgs)}else if(null==netmap||dragDataObj.forceCreateNewMap||mapManagerSrvc.getActiveMap()&&mapManagerSrvc.getActiveMap().getMapType()&&2===mapManagerSrvc.getActiveMap().getMapType()){key=Guid();options={isCreateNew:!0,urlKey:key};dragDataObj.forceCreateNewMap=!1;utilitySrvc.setLocalStorage(key,dragDataObj);urlStateMgr.openMap(options)}else{isDeskTopPage&&$rootScope.$emit(NetBrain.NetworkOS.Const.UIFramework.Events.ShowMainContentArea,"floating-map");deferred.resolve(netmap)}}();return deferred.promise}function getNetmapOperator(netmap){var deferred=$q.defer();!function eachGet(){var netmapOperator=netmap.getNetmapOperator();null==netmapOperator?$timeout(eachGet,400):deferred.resolve(netmapOperator)}();return deferred.promise}return services}}(NetBrain);NetBrain,angular.module("nb.common").service("nb.common.nbTipSrvc",["$document","$compile","$rootScope","$timeout",function($document,$compile,$rootScope,$timeout){var me=this;var defaultOptions={position:{right:"6px",top:"105px"},autoClose:!0,autoCloseDelay:3e3,hasCloseBtn:!1,customClass:"mapCusTip",appendTo:"Map"};me.open=function(options){options=_.extend({},defaultOptions,options);var id="nb-tip-"+(new Date).getTime();var scope=$rootScope.$new();options.scope&&(scope=options.scope);scope.callBack=options.callBack;scope.tipID=id;scope.tipInfo=options.tipInfo;scope.customClass=options.customClass;scope.position=options.position;scope.textMode=!0;scope.closeTip=me.close;me.closeCallback=options.closeCallback;var element=angular.element('<div class="nb-tip" id="{{tipID}}" ng-class="customClass" ng-style="position"><p class="nb-tip-text" ng-if="textMode">{{tipInfo}}</p></div>');if(options.hasCloseBtn){element.addClass("has-close-btn");element.prepend("<span class='icon_nb_close' ng-click=\"closeTip('"+id+"')\"></span>")}if(options.template){scope.textMode=!1;var content=angular.element(options.template);element.append(content)}element=$compile(element)(scope);options.defaultHide&&element.hide();("Map"===options.appendTo?angular.element(".mapMainFrameContent"):options.appendTo&&"body"!==options.appendTo?angular.element("body").find(options.appendTo):angular.element("body")).append(element);if(!1!==options.autoClose){var delay=options.autoCloseDelay;var canceler=timeoutClose(delay,id);var hasLeaveHandler=!1;element.mouseenter((function(){$timeout.cancel(canceler);if(!hasLeaveHandler){hasLeaveHandler=!0;element.mouseleave((function(){2===canceler.$$state.status&&(canceler=timeoutClose(delay,id))}))}}))}return id};function timeoutClose(delay,id){return $timeout((function(){me.close(id)}),delay)}me.close=function(tipID){var element=$document.find("#"+tipID);if(element){element.remove();_.isFunction(me.closeCallback)&&me.closeCallback()}};me.closeAllTip=function(){var element=$document.find(".nb-tip");element&&element.remove()};me.hide=function(tipId){getEl(tipId).hide()};me.show=function(tipId){getEl(tipId).show()};function getEl(id){return $document.find("#"+id)}}]);NetBrain,angular.module("nb.common").service("nb.common.nbCalculationTipSrvc",["$document","$compile","$rootScope",function($document,$compile,$rootScope){var options={title:""};this.showCalculationTip=function(op){var scope=$rootScope.$new();var mask='<div id="CalculatingMask" style="position: absolute;top:0;left: 0;width:100%;height:100%;background-color: rgba(0,0,0,0.4);z-index: 999;color:#f5f5f5;text-align: center;padding-top: 47vh;"><img src="img/Assets/Loader_Head_76x86.png" class="netbrainLoader-Head"><img src="img/Assets/Loader_Circle_145x72.png" class="netbrainLoader-Circle"><span style="font-size: 5em;">'+_.extend({},options,op).title+"</span><br></div>";$("body").append($compile(mask)(scope))};this.closeCalculationTip=function(){$("#CalculatingMask").remove()}}]);NetBrain,angular.module("nb.common").service("nb.common.nbSelectQappModalSrvc",["$uibModal",function($uibModal){var modalOptions={backdrop:"static",windowClass:"nbSelectQappModal",templateUrl:"modules/nbCommon/views/nbSelectQappModal.html",controller:"nb.common.nbSelectQappModalCtrl"};this.showModal=function(_options){modalOptions.resolve={options:function(){return _options}};return $uibModal.open(modalOptions).result}}]);!function(NetBrain){angular.module("nb.common").factory("nb.common.cacheSrvc",cacheSrvc);cacheSrvc.$inject=["$q","$rootScope","$timeout","nb.ng.offlineCacheSrvc","nb.deviceDetail.httpDeviceDetailSrvc","nb.datamodel.httpSiteSrvc"];function cacheSrvc($q,$rootScope,$timeout,offlineCacheSrvc,httpDeviceDetailSrvc,httpSiteSrvc){var vm={};vm.initCacheConfig=function(){offlineCacheSrvc.initStores([{name:"ConfigFile",getUpdateOn:function(item){return item.uploadDate},generateId:function(item){return item},freshChecker:function(arr){var params={sourceType:NetBrain.DeviceDetail.DataFolder.CurrentBaseline,taskId:"",dataType:1,devIds:arr};return httpDeviceDetailSrvc.getDetailLastUpdateTime(params)}},{name:"SiteInfo",getUpdateOn:function(item){return item.operateInfo.operateTime},generateId:function(item){return item},freshChecker:function(arr){return httpSiteSrvc.getSitesLastUpdateTime(arr)}},{name:"InterfaceInfo",getUpdateOn:function(){return""},generateId:function(item){return item.intfKeyObj.value+"_"+item.intfKeyObj.schema}},{name:"DesignReader",level:"Tenant",getUpdateOn:function(){return""},generateId:function(item){return item}}])};vm.resetFreshFlags=function(){offlineCacheSrvc.resetFreshFlags()};return vm}}(NetBrain);!function(NetBrain){angular.module("nb.common").factory("nb.common.cacheConfigSrvc",cacheConfigSrvc);cacheConfigSrvc.$inject=["$q","$rootScope","$timeout","nb.ng.offlineCacheSrvc","nb.deviceDetail.httpDeviceDetailSrvc"];function cacheConfigSrvc($q,$rootScope,$timeout,offlineCacheSrvc,httpDeviceDetailSrvc){var vm={};var configKeyword=navigator.userAgent;function getSingleData(devId){var params=function(devId){return{sourceType:NetBrain.DeviceDetail.DataFolder.CurrentBaseline,devId:devId,withData:!0}}(devId);var ret=httpDeviceDetailSrvc.getConfigFileDataList(params);ret.then((function(objResult){objResult&&objResult.content&&(objResult.content=function(str,pwd){if(str){if(null==pwd||pwd.length<=0)return"";var prand="";for(var i2=0;i2<pwd.length;i2++)prand+=pwd.charCodeAt(i2).toString();var sPos=Math.floor(prand.length/5);var mult=parseInt(prand.charAt(sPos)+prand.charAt(2*sPos)+prand.charAt(3*sPos)+prand.charAt(4*sPos)+prand.charAt(5*sPos));var incr=Math.ceil(pwd.length/2);var modu=Math.pow(2,31)-1;if(mult<2)return null;var salt=Math.round(1e9*Math.random())%1e8;prand+=salt;for(;prand.length>10;)prand=(parseInt(prand.substring(0,10))+parseInt(prand.substring(10,prand.length))).toString();prand=(mult*prand+incr)%modu;var encChr="";var encStr="";for(var i=0;i<str.length;i++){encChr=parseInt(str.charCodeAt(i)^Math.floor(prand/modu*255));encStr+=encChr<16?"0"+encChr.toString(16):encChr.toString(16);prand=(mult*prand+incr)%modu}salt=salt.toString(16);for(;salt.length<8;)salt="0"+salt;return encStr+=salt}return""}(objResult.content,configKeyword))}));return ret}vm.cacheDatas=function(devIds){_.each(devIds,(function(devId){vm.getData(devId)}))};vm.getData=function(devId){var ret=offlineCacheSrvc.getStore(NetBrain.NG.Const.StoreCategory.ConfigFile).get(devId,getSingleData);ret.then((function(objResult){objResult.content=function(str,pwd){if(null==str||str.length<8)return"";if(null==pwd||pwd.length<=0)return"";var prand="";for(var i3=0;i3<pwd.length;i3++)prand+=pwd.charCodeAt(i3).toString();var sPos=Math.floor(prand.length/5);var mult=parseInt(prand.charAt(sPos)+prand.charAt(2*sPos)+prand.charAt(3*sPos)+prand.charAt(4*sPos)+prand.charAt(5*sPos));var incr=Math.round(pwd.length/2);var modu=Math.pow(2,31)-1;var salt=parseInt(str.substring(str.length-8,str.length),16);str=str.substring(0,str.length-8);prand+=salt;for(;prand.length>10;)prand=(parseInt(prand.substring(0,10))+parseInt(prand.substring(10,prand.length))).toString();prand=(mult*prand+incr)%modu;var encChr2="";var encStr2="";for(var i=0;i<str.length;i+=2){encChr2=parseInt(parseInt(str.substring(i,i+2),16)^Math.floor(prand/modu*255));encStr2+=String.fromCharCode(encChr2);prand=(mult*prand+incr)%modu}return encStr2}(objResult.content,configKeyword)}));return ret};return vm}}(NetBrain);!function(){angular.module("nb.common").factory("nb.common.cacheSiteInfoSrvc",cacheSiteInfoSrvc);cacheSiteInfoSrvc.$inject=["$q","$rootScope","$timeout","nb.ng.offlineCacheSrvc","nb.datamodel.httpSiteSrvc"];function cacheSiteInfoSrvc($q,$rootScope,$timeout,offlineCacheSrvc,httpSiteSrvc){var vm={};function getSingleData(siteId){return httpSiteSrvc.getSitePropertiesBySiteID(siteId,!1)}vm.cacheDatas=function(siteIds){_.each(siteIds,(function(siteId){vm.getData(siteId)}))};vm.getData=function(siteId){return offlineCacheSrvc.getStore(NetBrain.NG.Const.StoreCategory.SiteInfo).get(siteId,getSingleData)};return vm}}(NetBrain);!function(){angular.module("nb.common").factory("nb.common.cacheInterfaceInfoSrvc",cacheInterfaceInfoSrvc);cacheInterfaceInfoSrvc.$inject=["$q","$rootScope","$timeout","nb.ng.offlineCacheSrvc","nb.topo.httpTopoSrvc"];function cacheInterfaceInfoSrvc($q,$rootScope,$timeout,offlineCacheSrvc,httpTopoSrvc){var vm={};function getSingleData(intf){return httpTopoSrvc.getIfObj(intf)}vm.cacheDatas=function(intfs){_.each(intfs,(function(intf){vm.getData(intf)}))};vm.getData=function(intf){return offlineCacheSrvc.getStore(NetBrain.NG.Const.StoreCategory.InterfaceInfo).get(intf,getSingleData)};return vm}}(NetBrain);!function(){angular.module("nb.common").factory("nb.common.cacheDesignReaderSrvc",cacheDesignReaderSrvc);cacheDesignReaderSrvc.$inject=["$q","$rootScope","$timeout","nb.ng.offlineCacheSrvc","nb.netbrain.httpDesignReaderSrvc"];function cacheDesignReaderSrvc($q,$rootScope,$timeout,offlineCacheSrvc,httpDesignReaderSrvc){var vm={};function getTreeJson(subType){return httpDesignReaderSrvc.getTreeJson(subType)}vm.cacheDatas=function(subTypes){_.each(subTypes,(function(subType){vm.getData(subType)}))};vm.getData=function(subType){return offlineCacheSrvc.getStore(NetBrain.NG.Const.StoreCategory.DesignReader).get(subType,getTreeJson)};return vm}}(NetBrain);!function(){angular.module("nb.common").service("nb.common.nbTextEditorSrvc",NbTextEditorSrvc);NbTextEditorSrvc.$inject=["$rootScope","$uibModal"];function NbTextEditorSrvc($rootScope,$uibModal){this.showTextEditorModal=function(params){var modalTextEditorOptions={templateUrl:"modules/nbCommon/views/nbTextEditorPopup.html",controller:"nb.common.nbTextEditorPopupCtrl",backdrop:"static",keyboard:!1,resolve:{args:function(){return params}}};$uibModal.open(modalTextEditorOptions).result.then((function(dataContentNew){angular.isDefined(dataContentNew)&&$rootScope.$broadcast("script changed",dataContentNew)}),(function(){}))};this._getAceSession=function(ace){return ace&&ace.getSession()||null};this.getAceSelection=function(ace){var session=this._getAceSession(ace);return session&&session.selection.getRange()||null};this._setAceContent=function(ace,content){var session=this._getAceSession(ace);return session&&session.doc.setValue(content||"")};this._getAceContent=function(ace){var session=this._getAceSession(ace);return session&&session.doc.getValue()||null};this.getAttr=function(dataModel,attr){if(dataModel&&dataModel.__attrs)return dataModel.__attrs[attr]};this.setAttr=function(dataModel,attr,value){if(dataModel){dataModel.__attrs||(dataModel.__attrs={});dataModel.__attrs[attr]=value}};this.registerAcee=function(dataModel,ace){var me=this;dataModel.ace=ace;dataModel.acePlaceHolder&&this.$setPlaceHolder(ace,dataModel.acePlaceHolder,dataModel);dataModel.model.scripting=dataModel.content;this._setAceContent(ace,dataModel.content);dataModel.ace.setShowPrintMargin(!1);ace.session.on("changeScrollLeft",(function(scrollLeft){me.setAttr(dataModel,"scrollLeft",scrollLeft)}));ace.session.on("changeScrollTop",(function(scrollTop){me.setAttr(dataModel,"scrollTop",scrollTop)}))};this.setSelection=function(dataModel,range){var aceSess=this._getAceSession(dataModel.ace);aceSess&&aceSess.selection.setSelectionRange(range,!1)};this.getScroll=function(dataModel){return{sLeft:this.getAttr(dataModel,"scrollLeft"),sTop:this.getAttr(dataModel,"scrollTop")}};this.setScroll=function(dataModel,sLeft,sTop){var aceSess=this._getAceSession(dataModel.ace);if(aceSess){void 0!==sLeft&&aceSess.setScrollLeft(sLeft);void 0!==sTop&&aceSess.setScrollTop(sTop)}};this.keepOldScroll=function(dataModel,sLeft,sTop){var fnOp=dataModel.fnOptions;fnOp&&fnOp.scroll&&this.setScroll(dataModel,sLeft,sTop)};this.$setPlaceHolder=function(ace,placeHolder,dataModel,isRefresh){var editor=ace;function update(){var shouldShow=!editor.session.getValue().length;var node=editor.renderer.emptyMessageNode;if(!shouldShow&&node){editor.renderer.scroller.removeChild(editor.renderer.emptyMessageNode);editor.renderer.emptyMessageNode=null}else if(shouldShow){if(node&&node.textContent!==dataModel.acePlaceHolder){editor.renderer.scroller.removeChild(editor.renderer.emptyMessageNode);editor.renderer.emptyMessageNode=null}(node=editor.renderer.emptyMessageNode=document.createElement("div")).textContent=dataModel.acePlaceHolder||"placeholder";node.className="ace_invisible ace_emptyMessage";node.style.padding="0 9px";editor.renderer.scroller.appendChild(node)}}isRefresh||editor.on("input",update);setTimeout(update,100)};this.refreshPlaceHolder=function(dataModel,placeHolder){placeHolder&&(dataModel.acePlaceHolder=placeHolder);dataModel.ace&&this.$setPlaceHolder(dataModel.ace,dataModel.acePlaceHolder,dataModel,!0)};this.init=function(dataModel){var langTools=window.ace.require("ace/ext/language_tools");var aceKeywords=[];"python"===dataModel.aceOptions.mode&&(aceKeywords="and,del,from,not,while,as,elif,global,or,with,assert,else,if,pass,yield,break,except,import,print,class,exec,in,raise,continue,finally,is,return,,def,for,lambda,try".split(","));var tangideCompleter={identifierRegexps:[/[a-zA-Z_0-9\.\$\-\u00A2-\uFFFF]/],getCompletions:function(editor,session,pos,prefix,callback){var ID_REGEX=/[a-zA-Z_0-9\.\$\-\u00A2-\uFFFF]/;var sessionVar=editor.getSession();var posVar=editor.getCursorPosition();if(-1!==function(text,pos2,regex){regex=regex||ID_REGEX;var buf=[];for(var i=pos2-1;i>=0&&regex.test(text[i]);i--)buf.push(text[i]);return buf.reverse().join("")}(sessionVar.getLine(posVar.row),posVar.column).indexOf(".")){callback(null,[].map((function(qtag){return{name:qtag.caption,value:qtag.value,meta:qtag.meta}})))}else{var result2=[];aceKeywords.length&&aceKeywords.forEach((function(ele){result2.push({meta:"python",caption:ele,value:ele})}));!function(tagList){callback(null,tagList.map((function(qtag){return{name:qtag.caption,value:qtag.value,meta:qtag.meta}})))}(result2)}}};"textnb"===dataModel.aceOptions.mode||"text"===dataModel.aceOptions.mode?langTools.setCompleters([]):langTools.addCompleter(tangideCompleter)};this.refresh=function(dataModel){this.getContent(dataModel)};this.setContent=function(dataModel,content){var sLeft=this.getAttr(dataModel,"scrollLeft");var sTop=this.getAttr(dataModel,"scrollTop");dataModel.content=content;this._setAceContent(dataModel.ace,content);this.keepOldScroll(dataModel,sLeft,sTop)};this.getContent=function(dataModel){var ctnt=this._getAceContent(dataModel.ace);ctnt&&(dataModel.content=ctnt);return dataModel.content}}}(NetBrain);!function(){var defaultOption={predicate:!0,interval:1e3,callback:_.noop,continueWhenError:!1};angular.module("nb.common").factory("nb.common.nbIntervalSrvc",nbIntervalSrvc);nbIntervalSrvc.$inject=["$q","$timeout"];return;function nbIntervalSrvc($q,$timeout){return{setInterval:function(){return function(option){var firstRunOn,lastRunOn,runCounts=0,tryTimes=0;var stopped=!1;var intervalData={};!function(){Object.defineProperty(intervalData,"firstRunOn",{get:function(){return firstRunOn}});Object.defineProperty(intervalData,"lastRunOn",{get:function(){return lastRunOn}});Object.defineProperty(intervalData,"runCounts",{get:function(){return runCounts}});Object.defineProperty(intervalData,"tryTimes",{get:function(){return tryTimes}});Object.defineProperty(intervalData,"stopped",{get:function(){return stopped}});Object.defineProperty(intervalData,"option",{get:function(){return option.originalOption}})}();var currentOption;var timeoutId;setNext();return function(){stopped=!0;$timeout.cancel(timeoutId)};function setNext(){if(!stopped){prepareCurrentOption();timeoutId=$timeout(run,currentOption.interval)}}function run(){tryTimes++;prepareCurrentOption();predicate=currentOption.predicate,(_.isFunction(predicate)?predicate():predicate)?$q.resolve().then(doCallback).then(setNext).catch(handleError):setNext();var predicate}function doCallback(){!function(){lastRunOn=new Date;0===runCounts&&(firstRunOn=lastRunOn);runCounts++}();try{return currentOption.callback(intervalData)}catch(err){return $q.reject(err)}}function handleError(err){console.error(err);currentOption.continueWhenError?setNext():stopped=!0}function prepareCurrentOption(){currentOption=function(option){var currentOption=_.extend({},defaultOption,{callback:option.callback,interval:option.interval},option.originalOption);_.isNumber(currentOption.interval)||throwError("interval must be a number");_.isFunction(currentOption.callback)||throwError("callback must be a function");return currentOption}(option)}}(prepareRealOption.apply(null,arguments))}};function prepareRealOption(){var realOption={};var args=arguments.length;if(1===args){var param=arguments[0];_.isFunction(param)?parseCallback(param,realOption):parseOption(param,realOption)}else if(args>=2){parseCallback(arguments[0],realOption);!function(interval2,realOption){_.isNumber(interval2)||throwInvalidArguments();realOption.interval=interval2}(arguments[1],realOption);args>=3&&parseOption(arguments[2],realOption)}else throwInvalidArguments();return realOption}function parseCallback(callback,realOption){_.isFunction(callback)||throwInvalidArguments();realOption.callback=callback}function parseOption(option,realOption){_.isObject(option)||throwInvalidArguments();realOption.originalOption=option}function throwInvalidArguments(){throwError("take a see carefully on the use help")}function throwError(err){throw new Error(err)}}}(NetBrain);NetBrain,angular.module("nb.common").service("nb.common.nbLoadingSrvc",["$uibModal",function($uibModal){this.exportLoading={open:function(option){return $uibModal.open({templateUrl:"modules/nbCommon/views/exportLoadingModal.html",controller:"nb.common.exportLoadingCtrl",windowClass:"exportLoadingModal",size:"sm",backdrop:"static",resolve:{option:option||{}}})}}}]);!function(NetBrain){angular.module("nb.common").factory("nb.common.systemSettingSrvc",SystemSettingSrvc);SystemSettingSrvc.$inject=["$q","nb.netbrain.httpSystemSettingSrvc"];function SystemSettingSrvc($q,httpSystemSettingSrvc){var cacheValue;function _getSystemSetting(key){var defer=$q.defer();cacheValue?defer.resolve(cacheValue):httpSystemSettingSrvc.getSystemSetting(key).then((function(value){value&&(cacheValue=JSON.parse(value));defer.resolve(cacheValue)}),(function(ex){defer.reject(ex);return defer.promise}));return defer.promise}return{getSystemSetting:_getSystemSetting,getCLICommandFilter:function(){return _getSystemSetting("CLICommandFilter")}}}}(NetBrain);!function(netBrain){angular.module("nb.common").factory("nb.common.nbNonModalDialogSrvc",nbNonModalDialogSrvc);nbNonModalDialogSrvc.$inject=["$q","$rootScope","dialogService","nb.common.nbAlertSrvc"];function nbNonModalDialogSrvc($q,$rootScope,dialogService,nbAlertSrvc){var exports={};var num=0;exports.showNonModalDialog=function(options){if(options.limitLen&&!(~num&Math.pow(2,options.limitLen)-1))return nbAlertSrvc.error({message:"The number of this dialogue cannot exceed "+options.limitLen+"."});num=1+(num<<1);var miniTaskPopUpOptions={containment:options.dialogOptions.body||".main-content-container",appendTo:options.dialogOptions.body||".main-content-container",width:523,minWidth:523,height:options.dialogOptions.height,minHeight:options.dialogOptions.minHeight,autoOpen:!1,modal:!1,async:!0,resizable:options.dialogOptions.resizable||!1,draggable:{cancel:options.dialogOptions.cancelEle||".miniTaskUtil",containment:options.dialogOptions.body||".main-content-container"},beforeClose:function(event){if(27!==event.keyCode)return!0;var VDOM=angular.element(event.target).find("#"+options.dialogId);if(1==VDOM.length){var newId=VDOM.attr("id");var Vscope=VDOM.scope();exports.closeNonModalDialogBefore(newId,Vscope);return!1}}};miniTaskPopUpOptions=_.extend(miniTaskPopUpOptions,options.dialogOptions);var id=options.dialogId;var template=miniTaskPopUpOptions.template||"runbookDialogTemplate_modal.html";dialogService.open(id,template,options,miniTaskPopUpOptions);if(options.dialogOptions.async){var deferd=$q.defer();options.dialogOptions.async=deferd;return deferd.promise}return $q.resolve()};exports.closeNonModalDialog=function(dialogId,fn){num>>=1;dialogService.close(dialogId);_.isFunction(fn)&&fn.apply(null,arguments)};exports.closeNonModalDialogBefore=function(id,$scope){$scope.model.dialogOptions.async&&$scope.model.dialogOptions.async.reject&&$scope.model.dialogOptions.async.reject();exports.closeNonModalDialog(id)};return exports}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.aboutCtrl",aboutCtrl);aboutCtrl.$inject=["$scope","$filter","$uibModalInstance","nb.ng.systemSrvc","nb.ng.licenseSrvc"];function aboutCtrl($scope,$filter,$uibModalInstance,systemSrvc,licenseSrvc){systemSrvc.getVersionInfo().then((function(releaseInfo){$scope.version=JSON.parse(JSON.stringify(releaseInfo));$scope.version&&$scope.version.ProductVersion&&"7.1a"===$scope.version.ProductVersion.substr(0,4)&&($scope.version.ProductVersion="7.1a");$scope.version.Date=$scope.version.Date.split("-")[0];$scope.version.Date=DateUtil.format(new Date($scope.version.Date),"yyyy-MM-dd");$scope.copyYear=DateUtil.format($scope.version.Date,"yyyy");systemSrvc.getPatchVersionInfo().then((function(pathInfo){$scope.PatchVersionInfo=JSON.parse(JSON.stringify(pathInfo));if($scope.PatchVersionInfo.SoftwareVersion===$scope.version.SoftwareVersion){$scope.PatchVersionInfo.version=$scope.PatchVersionInfo.PatchVersion;if(""!==$scope.PatchVersionInfo.PatchInstalledDate){$scope.PatchVersionInfo.installedDate=$scope.PatchVersionInfo.PatchInstalledDate.split("-")[0];$scope.PatchVersionInfo.installedDate=DateUtil.format(new Date($scope.PatchVersionInfo.installedDate),"yyyy-MM-dd")}}}))}));systemSrvc.getKCVersionInfo().then((function(KCVersionInfo){$scope.KCVersionInfo=JSON.parse(JSON.stringify(KCVersionInfo))}));licenseSrvc.getLicense(!1).then((function(resultLicense){$scope.licenseID="Unactivated";resultLicense&&($scope.licenseID=resultLicense.isActivate?resultLicense.licenseId:"Unactivated")}));$scope.close=function(){$uibModalInstance.dismiss("cancel")}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.nbAlertCtrl",AlertCtrl);AlertCtrl.$inject=["$scope","$uibModal","$sanitize","$uibModalInstance","$sce","dialogOptions"];function AlertCtrl($scope,$uibModal,$sanitize,$uibModalInstance,$sce,dialogOptions){$scope.title=dialogOptions.title;$scope.showText=dialogOptions.showText;try{$scope.message=$sce.trustAsHtml($sanitize(dialogOptions.message))}catch(e){$scope.message=$sce.trustAsHtml(dialogOptions.message)}$scope.buttons=dialogOptions.buttons;$scope.iconType=dialogOptions.iconType;$scope.ok_button=null;$scope.yes_button=null;$scope.no_button=null;$scope.cancel_button=null;$scope.check_button=null;angular.forEach($scope.buttons,(function(button){button.id===NB_CONFIRM_OK?$scope.ok_button=button:button.id===NB_CONFIRM_YES?$scope.yes_button=button:button.id===NB_CONFIRM_NO?$scope.no_button=button:button.id===NB_CONFIRM_CANCEL?$scope.cancel_button=button:button.id===NB_CONFIRM_CHECK&&($scope.check_button=button)}));$scope.closeDialog=function(reason){$uibModalInstance.close(reason)}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.nbTextEditorPopupCtrl",NbTextEditorPopupCtrl);NbTextEditorPopupCtrl.$inject=["$scope","$uibModalInstance","nb.common.nbTextEditorSrvc","args"];function NbTextEditorPopupCtrl($scope,$uibModalInstance,nbTextEditorSrvc,args){$scope.popupTitle=args.title;$scope.init=function(){$scope.nbDataObj={ace:null,acePlaceHolder:"python script",model:{scripting:null},aceOptions:{onLoad:function(_ace){nbTextEditorSrvc.registerAcee($scope.nbDataObj,_ace);nbTextEditorSrvc.setContent($scope.nbDataObj,$scope.nbDataObj.content)},useWrapMode:!1,showGutter:!0,theme:"chrome",mode:"python",advanced:{fontSize:12,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}},oldRange:null};null!=args&&_.extend($scope.nbDataObj,args);nbTextEditorSrvc.init($scope.nbDataObj)};$scope.onCancel=function(){$uibModalInstance.dismiss("cancel")};$scope.onSave=function(){$uibModalInstance.close($scope.nbDataObj.content)};$scope.init()}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.nbSelectPropertyModalCtrl",SelectPropertyModalCtrl);SelectPropertyModalCtrl.$inject=["$scope","$rootScope","$uibModal","$uibModalInstance","nb.common.nbSelectPropertyMgr","args","nb.systemmodel.httpDeviceSchemaSrvc","nb.systemmodel.deviceSchemaMgrSrvc","nb.common.nbAlertSrvc","$filter","ivhTreeviewMgr"];function SelectPropertyModalCtrl($scope,$rootScope,$uibModal,$uibModalInstance,nbSelectPropertyMgr,args,httpDeviceSchemaSrvc,deviceSchemaMgrSrvc,nbAlertSrvc,$filter,ivhTreeviewMgr){$scope.isNoteLabel=args.isNoteLabel;$scope.canOnlySelectSimpleDataType=args.canOnlySelectSimpleDataType;$scope.isDataUnitFromQapp=args.isDataUnitFromQapp;$scope.lsDataUnitFromQapp=args.lsDataUnitFromQapp;$scope.isSelectedPropertyRef=!1;$scope.selectedNodeType={curNodeType:VisualSpaceConstant.legacySchemaKeyword,isLegacyDevice:!0,isLegacyDeviceHasRef:!1};$scope.selectedNodeIncludeRefSchema=!1;$scope.currentCategoryIncludedSelected=!1;$scope.legacyRefSchemaId="legacyRefSchema";$scope.legacyRefList=[];$scope.legacyCategoryDropdownIndexStep=0;args.selectedNodeType&&($scope.selectedNodeType=args.selectedNodeType);$scope.currentSelectedProperties=[];$scope.allGenericSchemaDisplayNames=args.allDeviceGenericSchemaDisplayNames;if(args.isDataUnitFromQapp){$scope.DataUnitType=DataUnitType;if(args.preSelectedDataUnitUId&&args.preSelectedDataUnitUId.length>0)for(var i=0;i<$scope.lsDataUnitFromQapp.length;i++)args.preSelectedDataUnitUId.indexOf($scope.lsDataUnitFromQapp[i].uId)>-1&&($scope.lsDataUnitFromQapp[i].isSelected=!0);$scope.lsDataUnitFromQapp.sort((function(p1,p2){return p1.name.localeCompare(p2.name)}))}$scope.isDeviceProperty=args.isDeviceProperty;$scope.isInterfaceProperty=args.isInterfaceProperty;$scope.intfSchemaId=args.intfSchemaId;$scope.deviceId=args.deviceId;$scope.deviceType=args.deviceType;$scope.currSchemaId=$scope.isDeviceProperty?$scope.selectedNodeType.curNodeType.id:$scope.intfSchemaId;$scope.isGeneralProperty=!$scope.deviceId;var preSelectedPropertyId=args.preSelectedPropertyId&&args.preSelectedPropertyId!=[]?args.preSelectedPropertyId:[];$scope.lsSelectedProperty=[];$scope.filterTarget={filterText:"",searchText:""};$scope.treeOptions={enableTwoWayBinding:!0,enableAutoSelect:!1,idAttribute:"ID",childrenAttribute:"children",expandToDepth:-1,enableMultipleSelect:!1,nodeClickCallback:function(node){$scope.lsSelectedProperty=[];node.selected&&$scope.lsSelectedProperty.push(node)},labelTemplate:function(node,trvw,labelScope){return"<span>"+$filter("nbHighlight")(node.displayName,$scope.filterTarget.filterText)+"</span>"}};$scope.propertyCategories=$scope.canOnlySelectSimpleDataType?[{name:($scope.isDeviceProperty?"Device":"Interface")+" Property",id:0}]:[{name:($scope.isDeviceProperty?"Device":"Interface")+" Property",id:0},{name:"Device Data",id:1},{name:"NCT Table",id:2}];$scope.initLegacyCategoryList=function(){if($scope.selectedNodeType.isLegacyDeviceHasRef){$scope.propertyCategories=[{name:($scope.isDeviceProperty?"Device":"Interface")+" Property",id:0},{name:"Reference Schema",id:1}];if(!$scope.canOnlySelectSimpleDataType){$scope.propertyCategories.push({name:"Device Data",id:2});$scope.propertyCategories.push({name:"NCT Table",id:3})}}};$scope.setPropertyCategories=function(){$scope.propertyCategories=[{name:($scope.isDeviceProperty?"Device":"Interface")+" Property",id:0}];if($scope.selectedNodeType.isLegacyDevice&&!$scope.canOnlySelectSimpleDataType){$scope.propertyCategories.push({name:"Device Data",id:1});$scope.propertyCategories.push({name:"NCT Table",id:2})}else{var selectedNodeTypeProperpty=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId];var propertyCategoriesIndex=1;if($scope.isDeviceProperty&&Object.prototype.hasOwnProperty.call(selectedNodeTypeProperpty,"refSchemas")){$scope.propertyCategories.push({name:"Reference Schema",id:propertyCategoriesIndex++});$scope.selectedNodeIncludeRefSchema=!0}if(Object.prototype.hasOwnProperty.call(selectedNodeTypeProperpty,"children"))for(var ii=0;ii<selectedNodeTypeProperpty.children.length;ii++)$scope.propertyCategories.push({name:selectedNodeTypeProperpty.children[ii].displayName,id:propertyCategoriesIndex++})}};$scope.dictProperties={devProp:[],intfProp:[],devData:[],nctTable:[],legacyRefList:[]};$scope.lsProperties=[];$scope.needShowsInTreeView=function(){return!!($scope.selectedNodeType&&($scope.isDeviceProperty||$scope.isInterfaceProperty)&&$scope.selectedNodeType.isLegacyDevice&&$scope.selectedNodeType.isLegacyDeviceHasRef&&1==$scope.displayPropertyCategory||$scope.selectedNodeType&&!$scope.selectedNodeType.isLegacyDevice)};$scope.onSelectPropertyCategory=function(cateId){$scope.displayPropertyCategory=cateId;$scope.isSelectedPropertyRef=!1;if(!$scope.selectedNodeType||$scope.selectedNodeType&&$scope.selectedNodeType.isLegacyDevice)if(($scope.isDeviceProperty||$scope.isInterfaceProperty)&&$scope.selectedNodeType.isLegacyDeviceHasRef)switch(cateId){case 0:$scope.lsProperties=$scope.isDeviceProperty?$scope.dictProperties.devProp:$scope.dictProperties.intfProp;break;case 1:$scope.lsProperties=$scope.dictProperties.legacyRefList;$scope.isSelectedPropertyRef=!0;break;case 2:$scope.lsProperties=$scope.dictProperties.devData;break;case 3:$scope.lsProperties=$scope.dictProperties.nctTable;break;default:nbAlertSrvc.alert("Error in nbSelectPropertyModalCtrl")}else switch(cateId){case 0:$scope.lsProperties=$scope.isDeviceProperty?$scope.dictProperties.devProp:$scope.dictProperties.intfProp;break;case 1:$scope.lsProperties=$scope.dictProperties.devData;break;case 2:$scope.lsProperties=$scope.dictProperties.nctTable;break;default:nbAlertSrvc.alert("Error in nbSelectPropertyModalCtrl")}else{var defaultPropertyCategory=$scope.selectedNodeIncludeRefSchema?2:1;$scope.isSelectedPropertyRef=!1;switch(cateId){case 0:$scope.lsProperties=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId].props;break;case 1:if($scope.selectedNodeIncludeRefSchema){$scope.lsProperties=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId].refSchemas;$scope.isSelectedPropertyRef=!0}else $scope.lsProperties=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId].children[cateId-defaultPropertyCategory].children;break;default:$scope.lsProperties=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId].children[cateId-defaultPropertyCategory].children}$scope.lsProperties||($scope.lsProperties=[])}$scope.currentSelectedProperties=angular.copy($scope.lsProperties)};function checkIncludingSelectedNode(treeData){if(!$scope.currentCategoryIncludedSelected&&treeData&&treeData.length>0)for(var ii=0;ii<treeData.length;ii++){if(treeData[ii].ID===preSelectedPropertyId[0]){$scope.currentCategoryIncludedSelected=!0;$scope.selectedNodeType.isLegacyDevice&&(treeData[ii].selected=!0);break}!$scope.currentCategoryIncludedSelected&&treeData[ii].children&&treeData[ii].children.length>0&&checkIncludingSelectedNode(treeData[ii].children)}}$scope.checkSelectedCategoryForSDN=function(){var currentSchema=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId];var currentSchemaProps=currentSchema.props;if(currentSchemaProps){$scope.currentCategoryIncludedSelected=!1;checkIncludingSelectedNode(currentSchemaProps);if($scope.currentCategoryIncludedSelected)return 0}if($scope.selectedNodeIncludeRefSchema){$scope.currentCategoryIncludedSelected=!1;checkIncludingSelectedNode(currentSchema.refSchemas);if($scope.currentCategoryIncludedSelected)return 1}var indexStep=$scope.selectedNodeIncludeRefSchema?2:1;var childrenProperties=currentSchema.children;if(childrenProperties&&childrenProperties.length>0)for(var j=0;j<childrenProperties.length;j++){$scope.currentCategoryIncludedSelected=!1;checkIncludingSelectedNode(currentSchema.children[j].children);if($scope.currentCategoryIncludedSelected)return j+indexStep}return 0};$scope.initData=function(){var initCategory=0;if($scope.selectedNodeType&&!$scope.selectedNodeType.isLegacyDevice){var selectedNodeTypeProperpty=$scope.allGenericSchemaDisplayNames[$scope.currSchemaId];$scope.dictProperties.devProp=selectedNodeTypeProperpty;$scope.setPropertyCategories();if(preSelectedPropertyId&&preSelectedPropertyId.length>0){var selectedCategoryIndex=$scope.checkSelectedCategoryForSDN(selectedNodeTypeProperpty,preSelectedPropertyId);initCategory=selectedCategoryIndex||0}$scope.onSelectPropertyCategory(initCategory);$scope.displayPropertyCategory=initCategory;ivhTreeviewMgr.deselectAll($scope.lsProperties,$scope.treeOptions);preSelectedPropertyId&&preSelectedPropertyId.length>0&&ivhTreeviewMgr.select($scope.lsProperties,preSelectedPropertyId[0],$scope.treeOptions);$scope.isDataReady=!0}else{$scope.legacyCategoryDropdownIndexStep=0;if($scope.selectedNodeType&&$scope.selectedNodeType.isLegacyDevice&&$scope.selectedNodeType.isLegacyDeviceHasRef){$scope.dictProperties.legacyRefList=$scope.allGenericSchemaDisplayNames[$scope.legacyRefSchemaId];$scope.legacyCategoryDropdownIndexStep=1;$scope.initLegacyCategoryList();$scope.currentCategoryIncludedSelected=!1;checkIncludingSelectedNode($scope.dictProperties.legacyRefList);$scope.currentCategoryIncludedSelected&&(initCategory=1)}httpDeviceSchemaSrvc.getAllDeviceSchemasFilter(!1).then((function(jsList){deviceSchemaMgrSrvc.initDeviceSchemaObjList(jsList);nbSelectPropertyMgr.getAll_promise($scope.isDeviceProperty,$scope.deviceId,$scope.deviceType).then((function(lsProps){lsProps.sort((function(p1,p2){return p1.displayName.localeCompare(p2.displayName)}));$scope.isInterfaceProperty&&($scope.lsPreSelectIntfSchemaIds=preSelectedPropertyId);lsProps.forEach((function(prop){if($scope.isDeviceProperty&&prop.isSchema){if(preSelectedPropertyId.indexOf(prop.ID)>-1){$scope.lsSelectedProperty.push(prop);prop.isSelected=!0;initCategory=0}$scope.dictProperties.devProp.push(prop)}if(prop.isTable&&!prop.isNctTable){if(preSelectedPropertyId.indexOf(prop.dataType)>-1||preSelectedPropertyId.indexOf(prop.displayName)>-1){$scope.lsSelectedProperty.push(prop);prop.isSelected=!0;initCategory=1+$scope.legacyCategoryDropdownIndexStep}prop.children&&prop.children.forEach((function(childProp){if(preSelectedPropertyId.indexOf(childProp.dataType)>-1||preSelectedPropertyId.indexOf(childProp.displayName)>-1){$scope.lsSelectedProperty.push(childProp);childProp.isSelected=!0;initCategory=1+$scope.legacyCategoryDropdownIndexStep;prop.children.forEach((function(childProp2){childProp2.expanded=!0}))}}));$scope.dictProperties.devData.push(prop)}if(prop.isNctTable){if(preSelectedPropertyId.indexOf(prop.dataName)>-1){$scope.lsSelectedProperty.push(prop);prop.isSelected=!0;initCategory=2+$scope.legacyCategoryDropdownIndexStep}$scope.dictProperties.nctTable.push(prop)}if(prop.isConfigFile){if(preSelectedPropertyId.indexOf(prop.dataType)>-1){$scope.lsSelectedProperty.push(prop);prop.isSelected=!0;initCategory=2+$scope.legacyCategoryDropdownIndexStep}$scope.dictProperties.nctTable.push(prop)}}));if(!$scope.isGeneralProperty)for(var ii=0;ii<$scope.dictProperties.devData.length;ii++){var currProperty=$scope.dictProperties.devData[ii];if(currProperty.children&&(currProperty.dataType===DeviceDataType.RouteTable||currProperty.dataType===DeviceDataType.ArpTable)){var lsSubTables=angular.copy(currProperty.children);delete currProperty.children;currProperty.hasChildren=!0;for(var j=0;j<lsSubTables.length;j++){lsSubTables[j].isChild=!0;$scope.dictProperties.devData.splice(1+ii++,0,lsSubTables[j])}}}})).then((function(){$scope.onSelectPropertyCategory(initCategory);$scope.displayPropertyCategory=initCategory;$scope.isDataReady=!0}))}))}};args.isDataUnitFromQapp||$scope.initData();$scope.toggleExpansionByTableType=function(tableType){$scope.lsProperties.forEach((function(property){property.dataType===tableType&&(property.expanded=!property.expanded)}))};function getFilterData(query){var newTreeData=angular.copy($scope.currentSelectedProperties);!function filterData(children,query){for(var ii=0;ii<children.length;ii++){var tree=children[ii];var isMatchNode=!1;-1!=tree.displayName.toLowerCase().indexOf(query.toLowerCase())&&(isMatchNode=!0);var subChildren=tree.children;if(subChildren&&0!==subChildren.length){filterData(subChildren,query);isMatchNode||0!==subChildren.length||children.splice(ii--,1)}else isMatchNode||children.splice(ii--,1)}}(newTreeData,query);return newTreeData}$scope.onFilterFired=function(){$scope.filterTarget.filterText=$scope.filterTarget.searchText;if($scope.filterTarget.filterText&&$scope.filterTarget.filterText.length>0){if($scope.isDataReady&&$scope.selectedNodeType&&$scope.needShowsInTreeView()){$scope.lsProperties=getFilterData($scope.filterTarget.filterText);ivhTreeviewMgr.validate($scope.lsProperties,$scope.treeOptions)}$scope.lsProperties.forEach((function(prop){prop.isChild&&(prop.expanded=!0)}))}else{$scope.lsProperties=$scope.currentSelectedProperties;$scope.lsProperties.forEach((function(prop){(prop.isChild||prop.hasChildren)&&(prop.expanded=!1)}))}};$scope.isSelectionNeeded=function(){return!$scope.lsSelectedProperty||0===$scope.lsSelectedProperty.length};$scope.isOkBtnDisabled=function(){if($scope.isSelectionNeeded())return!0;if($scope.lsSelectedProperty&&$scope.lsSelectedProperty.length>0){if($scope.isNoteLabel&&(!$scope.lsSelectedProperty[0].type||"list"===$scope.lsSelectedProperty[0].type||"object"===$scope.lsSelectedProperty[0].type))return!0;if($scope.canOnlySelectSimpleDataType&&!(varType=$scope.lsSelectedProperty[0].type,"string"===varType||"bool"===varType||"int"===varType||"double"===varType||"float"===varType))return!0}var varType;return!1};$scope.isTreeViewNeeded=function(){return $scope.isInterfaceProperty&&0===$scope.displayPropertyCategory};$scope.onOK=function(){$scope.lsSelectedProperty[0].isRefLink=$scope.isSelectedPropertyRef;$uibModalInstance.close($scope.lsSelectedProperty[0])};$scope.onCancel=function(){$uibModalInstance.dismiss()}}}();!function(NetBrain){angular.module("nb.common").controller("nb.common.addToDeviceGroupPopupCtrl",AddToDeviceGroupPopupCtrl);AddToDeviceGroupPopupCtrl.$inject=["$timeout","$scope","$uibModal","$uibModalInstance","nb.datamodel.httpDeviceGroupSrvc","nb.netbrain.httpDeviceSrvc","nb.ng.userSrvc","nb.systemmodel.httpDeviceIconSrvc","nb.datamodel.linkGroupSrvc","nb.ng.permissionSrvc","args"];function AddToDeviceGroupPopupCtrl($timeout,$scope,$uibModal,$uibModalInstance,httpDeviceGroupSrvc,httpDeviceSrvc,userSrvc,httpDeviceIconSrvc,linkGroupSrvc,permissionSrvc,args){var shareResourceManagementPermission=permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.sharedResourceManagement);var sharePolicyPermission=permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.sharePolicyMgmt);$scope.selectedDG=null;$scope.selectedDeviceIds=args.lsDevIds;$scope.deviceGroupData=args.deviceGroupData;$scope.lsDevices=[];$scope.deviceGroupTreeData=[];$scope.init=function(){httpDeviceGroupSrvc.getAllDeviceGroupInfo().then((function(lsDGInfo){var publicDeviceGroup=[];var privateDeviceGroup=[];var policyDeviceGroup=[];for(var i=0;i<lsDGInfo.length;i++){var dgInfo=lsDGInfo[i];0==dgInfo.Type&&shareResourceManagementPermission?publicDeviceGroup.push({id:dgInfo.ID,name:dgInfo.Name,type:2,deviceType:dgInfo.Type}):1==dgInfo.Type&&dgInfo.UserGuid===userSrvc.getUserID()?privateDeviceGroup.push({id:dgInfo.ID,name:dgInfo.Name,type:2,deviceType:dgInfo.Type}):4==dgInfo.Type&&sharePolicyPermission&&policyDeviceGroup.push({id:dgInfo.ID,name:dgInfo.Name,type:2,deviceType:dgInfo.Type})}$scope.deviceGroupTreeData.push({id:"private",name:"My Device Groups",type:1,children:privateDeviceGroup});shareResourceManagementPermission&&$scope.deviceGroupTreeData.push({id:"public",name:"Public",type:1,children:publicDeviceGroup});sharePolicyPermission&&$scope.deviceGroupTreeData.push({id:"policy",name:"Policy Device Group",type:4,children:policyDeviceGroup});$scope.deviceGroupTreeData.push({id:"new_device",isEvent:!0,name:"New Device Group...",action:function(){$scope.onAddToNewDeviceGroup()}});$scope.deviceGroupTreeOptions.treeObj.updateTree()}));httpDeviceSrvc.getSimpleDevicesByGuids(null,$scope.selectedDeviceIds).then((function(data){null!=data&&data.length>0&&data.forEach((function(item){var typeImg=httpDeviceIconSrvc.getIconStreamURIBy2Id(item.subType,item.oid);$scope.lsDevices.push({ID:item.ID,name:item.name,typeImg:typeImg,subType:item.subType,vendor:item.vendor,model:item.model,mgmtIP:item.mgmtIP})}))}))};$scope.gridOptions={data:"lsDevices",showHeader:!1,multiSelect:!1,enableSelection:!0,modifierKeysToMultiSelect:!1,enableFullRowSelection:!0,enableRowHeaderSelection:!1,enableColumnMenus:!1,keepLastSelected:!0,selectedItems:[],columnDefs:[{field:"name",displayName:"Device Name",cellTemplate:'<div class="ui-grid-cell-contents"><img ng-src="{{ row.entity.typeImg }}" style="vertical-align: middle;margin-left:0px; width:16px;" /><span>{{ COL_FIELD }}</span></div>'}],onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.selection.on.rowSelectionChanged($scope,(function(row){$scope.selectedModel=angular.copy(row.entity)}))}};$scope.deviceGroupTreeOptions={defaultSelectedState:!1,selectedAttribute:"selected",validate:!0,expandToDepth:1,labelAttribute:"name",labelTemplate:function(node,trvw){return"<span ng-disabled="+(1==node.type)+">"+node.name+"</span>"},childrenAttribute:"children",className:"nb-device-group-tree",expandedAttribute:"expended",enableMultipleSelect:!1,enableUnselect:!1,nodeClickCallback:function(node,trvw){if(1!=node.type){$scope.selectedDG=node.id;node.name}else{$scope.selectedDG="";"Select Device Group"}node.isEvent&&node.action()},iconTemplate:function(node,trvw){return 1==node.type?'<div class="icon_nb_folder"></div>':'<div class="icon_nb_tree_devicegroup"></div>'},enableNodeDropdown:{isDisplay:function(node,trvw){return!1}}};$scope.setViewDropDownValue=function(title){$timeout((function(){$(".add-to-device-group-tree .tree-select-title").html(title);$(".add-to-device-group-tree .tree-select-title").attr("title",title)}),5)};$scope.onAddToNewDeviceGroup=function(){var dg=new NetBrain.LinkGroup($scope.deviceGroupData||{});dg.setDevices($scope.lsDevices||[]);linkGroupSrvc.linkGroupDialog({isCreateNew:!0,deviceGroup:dg.getData()}).then((function(){$scope.onCancel()}))};$scope.onCancel=function(argCloseReason){$uibModalInstance.dismiss(null!==argCloseReason?argCloseReason:"Cancel Button Clicked!")};$scope.onOK=function(){httpDeviceGroupSrvc.addToDeviceGroup(null,$scope.selectedDG,_.pluck($scope.lsDevices,"ID")).then((function(data){null!=data&&$uibModalInstance.close()}))};$scope.init()}}(NetBrain);!function(netbrain){angular.module("nb.common").controller("nb.common.nbSelectQappModalCtrl",nbSelectQappModalCtrl);nbSelectQappModalCtrl.$inject=["$scope","$timeout","$uibModalInstance","nb.ng.nbHttp","options"];function nbSelectQappModalCtrl($scope,$timeout,$uibModalInstance,nbHttp,options){$scope.filterOption={filterWord:""};$scope.options=angular.extend({},{title:"Select Qapp",delay:!1},options||{});function formatTreeData(formatSource,state){var copySource;if(!angular.isArray(formatSource))return formatSource;var result=[];copySource=angular.copy(formatSource);var root=_.find(copySource,(function(item){return null===item.parentId}));if(root){!function setChildren(parent,source){if(angular.isArray(parent))angular.forEach(parent,(function(parentVal){parentVal.children=_.filter(copySource,{parentId:parentVal.id});if(parentVal.children.length>0){state&&$timeout((function(){parentVal.expended=!0}),300);parentVal.children=_.sortBy(parentVal.children,(function(item){return item.name.toLowerCase()}));setChildren(parentVal.children,source)}else parentVal.children=[]}));else{parent.children=_.filter(copySource,{parentId:parent.id});if(!(parent.children.length>0)){parent.children=[];return}state&&$timeout((function(){parent.expended=!0}),300);parent.children=_.sortBy(parent.children,"id");setChildren(parent.children,source)}}(root,formatSource);result=result.concat(root)}return result}!function(){$scope.treeDataLoaded=!1;nbHttp.get("qapp/qappcategory/qappCategoryTree/false",{ev:$scope.options&&$scope.options.excludeVersions||[]},{avoidBlockUI:$scope.options.delay}).then((function(data){$scope.treeDataLoaded=!0;if(data){$scope.treeDataSource=data;$scope.treeData=formatTreeData(data)}else{$scope.treeDataSource=[];$scope.treeData=[];$scope.selectedTreeNode={}}}))}();function nodeClickCallback(node){$scope.selectedTreeNode=node}$scope.treeOption=angular.extend({},{validate:!0,expandToDepth:2,idAttribute:"id",parentIdAttribute:"parentId",enableTwoWayBinding:!1,labelAttribute:"name",childrenAttribute:"children",expandedAttribute:"expended",enableLabelExpand:!1,iconTemplate:function(node,trvw){return trvw.isLeaf(node)&&node.isQapp?'<i class="qapp-icon-12"></i>':'<i class="icon_nb_folder"></i>'},labelTemplate:function(node){var reg=new RegExp((str=$scope.filterOption.filterWord)?str.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"):str,"gi");var str;return node.name.replace(reg,(function(match){return'<i class="filter-highlight">'+match+"</i>"}))},nodeClickCallback:nodeClickCallback,nodeDblClickCallback:function(node){if(node.isQapp){$scope.selectedTreeNode=node;$scope.setSelectedTree()}}},options||{});$scope.setSelectedTree=function(){null!=$scope.selectedTreeNode&&$scope.selectedTreeNode.isQapp&&$uibModalInstance.close($scope.selectedTreeNode)};$scope.closeModal=function(){$uibModalInstance.dismiss()};$scope.filterData=function(params){params.clear&&($scope.filterOption.filterWord="");if($scope.treeDataSource&&angular.isArray($scope.treeDataSource)){$scope.treeData=formatTreeData(function(dataSource,keyword){var result=[];dataSource.forEach((function(node){if((!node.children||angular.isArray(node.children)&&0===node.children.length)&&(!keyword||node.name.toLowerCase().indexOf(keyword.toLowerCase())>-1)&&result.indexOf(node)<0){result.push(node);!function addNodeParent(node,source){if(node.parentId){var parentNode=_.filter($scope.treeDataSource,{id:node.parentId});if(parentNode&&parentNode[0]&&-1===source.indexOf(parentNode[0])){parentNode[0].expended=!0;source.push(parentNode[0]);addNodeParent(parentNode[0],source)}}}(node,result)}}),this);return result}($scope.treeDataSource,$scope.filterOption.filterWord),!0);$scope.treeData.length>0&&$timeout((function(){nodeClickCallback($scope.treeData[0])}),100)}}}}(NetBrain);!function(NetBrain){angular.module("nb.common").controller("nb.common.loginPopupCtrl",LoginPopupCtrl);LoginPopupCtrl.$inject=["$scope","$timeout","$log","$location","$state","$rootScope","$parse","$window","$uibModalInstance","nb.ng.userSrvc","nb.ng.httpAuthSrvc","nb.ng.utilitySrvc","nb.ng.callbackSrvc","nb.ng.sessionSrvc","nb.ng.multiTabEventSrvc","reloginObj","$uibModal"];function LoginPopupCtrl($scope,$timeout,$log,$location,$state,$rootScope,$parse,$window,$uibModalInstance,userSrvc,httpAuthSrvc,utilitySrvc,callbackSrvc,sessionSrvc,multiTabEventSrvc,reloginObj,$uibModal){$scope.form={password:""};$scope.title=reloginObj.message;$scope.appType=reloginObj.type;$scope.userName="system"===$scope.appType?utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginUserName.system):utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginUserName.mainUi);$scope.loginAuth="system"===$scope.appType?utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginAuth.system):utilitySrvc.getLocalStorage(NetBrain.NG.LocalStorageDefine.loginAuth.mainUi);$scope.loginErrors={PWD_EXPIRED:"100070",NEED_MORE_INFO:"100054",NEED_LOGOUT:"100071",BROWSER_LOGGED:"100074",INCORRECT_PASSWORD:"100012"};$scope.isForce="no";$scope.reLogin=function(){$scope.loginAuth&&4===$scope.loginAuth.type?$scope.submitSSO():$scope.submitForm()};$scope.submitSSO=function(){$scope.ssoReloginStatus=!0;utilitySrvc.openTarget(httpAuthSrvc.getSsoUrl($scope.loginAuth,$scope.appType,!0))};$scope.ssoComplete=function(){$uibModalInstance.close(!0)};$scope.submitForm=function(){var serverMessage=$parse("form.$error.serverMessage");!angular.isUndefined($scope.userName)&&$scope.userName&&""!==$scope.userName||$rootScope.$emit(systemEvent.mainSessionTimeout);angular.isUndefined($scope.form.password)||""===$scope.form.password?serverMessage.assign($scope,"Please input your password."):httpAuthSrvc.reLogin($scope.userName,$scope.form.password,$scope.loginAuth,$scope.appType,$scope.isForce).then((function(response){multiTabEventSrvc.trigger(MultiTabEvent.closeRelogin);$uibModalInstance.close(response);$scope.$root.$broadcast(UserEvent.RELOGIN)}),(function(error){var reason=error?error.error:"unknown";var desc=error.error_description?error.error_description:"Failed to log in due to internal service issue.";switch(reason){case $scope.loginErrors.NEED_LOGOUT:var splitDesc=desc.split(",");desc=splitDesc.length>1?splitDesc[1]:splitDesc[0];desc+=' Click "Log In" to force log in.';$scope.isForce="kick_login";serverMessage.assign($scope,desc);break;case $scope.loginErrors.INCORRECT_PASSWORD:desc="Incorrect password.";serverMessage.assign($scope,desc);break;case $scope.loginErrors.PWD_EXPIRED:var forceResetPassword=reason;var params=desc.split(",");var userId=params[0],pwdPolicy={minimumLength:params[1],expiredInDays:params[2],complexityRequirement:params[3],pwdNotSameAsUserName:params[4],pwdCantSameWithPrevious:parseInt(params[5]),userName:$scope.form.userName,password:$scope.form.password};$scope.resetUserPassword(userId,pwdPolicy,forceResetPassword);break;default:serverMessage.assign($scope,desc);$scope.form.password=""}}))};$scope.enterToSubmit=function(event){13===event.keyCode&&$scope.submitForm()};multiTabEventSrvc.on(MultiTabEvent.closeRelogin,(function(){$uibModalInstance.close(!0)}));$scope.modalClose=function(){return $uibModalInstance.close(null)};$scope.resetUserPassword=function(uId,pwdPolicy,reason){$scope.passwordModal=$uibModal.open({templateUrl:"loginResetPasswordDialog.html",controller:"nb.ng.loginResetPasswordDialogCtrl",windowClass:"userPasswordDialog",backdrop:"static",resolve:{resolveData:function(){return{userId:uId,reason:reason,passwordPolicy:pwdPolicy}}}});$scope.passwordModal.result.then((function(newPwd){$scope.form.password=newPwd;$scope.submitForm()}))}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.ssoReloginTipDialogCtrl",ssoReloginTipDialogCtrl);ssoReloginTipDialogCtrl.$inject=["$scope","$timeout","$log","$location","$state","$rootScope","$parse","$window","$uibModalInstance","nb.ng.userSrvc","nb.ng.httpAuthSrvc","nb.ng.utilitySrvc","nb.ng.callbackSrvc","nb.ng.sessionSrvc","nb.ng.multiTabEventSrvc","reloginObj","$uibModal"];function ssoReloginTipDialogCtrl($scope,$timeout,$log,$location,$state,$rootScope,$parse,$window,$uibModalInstance,userSrvc,httpAuthSrvc,utilitySrvc,callbackSrvc,sessionSrvc,multiTabEventSrvc,reloginObj,$uibModal){$scope.form={password:""};$scope.userName=reloginObj.userName;$scope.complete=function(){$uibModalInstance.close(null)};$scope.occurred=function(){$uibModalInstance.close(null)};$scope.modalClose=function(){$uibModalInstance.close(null)}}}(NetBrain);!function(NetBrain){angular.module("nb.common").controller("nb.common.nbTimeRangeDialogCtrl",selectTimeRange);selectTimeRange.$inject=["$uibModalInstance","$scope","resolveDate","lastTimeRange","nb.common.nbAlertSrvc"];function selectTimeRange($uibModalInstance,$scope,resolveDate,lastTimeRange,nbAlertSrvc){var current=new Date;var fromDate=new Date;fromDate.setDate(fromDate.getDate()-30);var fromTime=current;var toDate=current;var toTime=current;$scope.timeRange={fromDate:resolveDate&&new Date(resolveDate.start)||fromDate,fromTime:resolveDate&&new Date(resolveDate.start)||fromTime,toDate:resolveDate&&new Date(resolveDate.end)||toDate,toTime:resolveDate&&new Date(resolveDate.end)||toTime};$scope.slogan=resolveDate.slogan||"";var maxDays=resolveDate.maxDays||30;$scope.onOk=function(){var range=function(){var from=new Date;from.setFullYear($scope.timeRange.fromDate.getFullYear(),$scope.timeRange.fromDate.getMonth(),$scope.timeRange.fromDate.getDate());from.setHours($scope.timeRange.fromTime.getHours(),$scope.timeRange.fromTime.getMinutes());var to=new Date;to.setFullYear($scope.timeRange.toDate.getFullYear(),$scope.timeRange.toDate.getMonth(),$scope.timeRange.toDate.getDate());to.setHours($scope.timeRange.toTime.getHours(),$scope.timeRange.toTime.getMinutes());return{from:from,to:to}}();if(isNaN(range.from)&&isNaN(range.to)){var current=new Date;$scope.timeRange.fromDate=current||fromDate;$scope.timeRange.fromTime=current||fromTime;$scope.timeRange.toDate=current||toDate;$scope.timeRange.toTime=current||toTime;nbAlertSrvc.error({message:"The start time and end time must be valid time."})}else if(isNaN(range.from)){current=new Date;$scope.timeRange.fromDate=current||fromDate;$scope.timeRange.fromTime=current||fromTime;nbAlertSrvc.error({message:"The start time must be a valid time."})}else if(isNaN(range.to)){current=new Date;$scope.timeRange.toDate=current||toDate;$scope.timeRange.toTime=current||toTime;nbAlertSrvc.error({message:"The end time must be a valid time."})}else{var days=(range.to.getTime()-range.from.getTime())/864e5;var now=new Date;if(range.from>now){nbAlertSrvc.error({message:"The start time must be earlier than the current time."});return}days<=maxDays?range.to>=range.from?$uibModalInstance.close(range):nbAlertSrvc.error({message:"The end time cannot be earlier than the start time."}):nbAlertSrvc.error({message:"The selected time period cannot exceed "+maxDays+" days."})}};$scope.onCancel=function(){$uibModalInstance.dismiss(lastTimeRange)}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.exportLoadingCtrl",exportLoadingCtrl);exportLoadingCtrl.$inject=["$scope","$uibModalInstance","option"];function exportLoadingCtrl($scope,$uibModalInstance,option){$scope.title=option.title||"Preparing for download...";$scope.cancelText=option.cancelText||"Cancel";$scope.onCancelExporting=function(){option.cancelHandler&&option.cancelHandler();$uibModalInstance.dismiss($scope)}}}(NetBrain);NetBrain,angular.module("nb.common").filter("nbHighlight",["$sce",function($sce){return function(text,phrase){var escapeChar=function(str){var ret=str;[["(&)","&amp;"],["(<)","&lt;"]].forEach((function(item){ret=ret.replace(new RegExp(item[0],"gi"),item[1])}));return ret};if(null!=text){text=text.toString();if(phrase){phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var regexp=new RegExp("("+phrase+")","gi");var array=[];var result;for(;result=regexp.exec(text);){result.lastIndex=regexp.lastIndex;array.push({startIndex:result.index,endIndex:regexp.lastIndex})}if(array.length>0){var lastEndIndex=0;var textReuslt="";for(var i=0;i<array.length;i++){array[i].startIndex!==lastEndIndex&&(textReuslt+=escapeChar(text.substring(lastEndIndex,array[i].startIndex)));textReuslt+='<span class="filter-highlight">'+escapeChar(text.substring(array[i].startIndex,array[i].endIndex))+"</span>";lastEndIndex=array[i].endIndex;i===array.length-1&&array[i].endIndex!==text.length&&(textReuslt+=escapeChar(text.substring(array[i].endIndex)))}text=textReuslt}else text=escapeChar(text)}else text=escapeChar(text);return $sce.trustAsHtml(text)}}}]).filter("nbHighlightTree",["$sce",function($sce){return function(text,phrase){var escapeChar=function(str){var ret=str;[].forEach((function(item){ret=ret.replace(new RegExp(item[0],"gi"),item[1])}));return ret};if(null!=text){text=text.toString();if(phrase){phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var regexp=new RegExp("("+phrase+")","gi");var array=[];var result;for(;result=regexp.exec(text);){result.lastIndex=regexp.lastIndex;array.push({startIndex:result.index,endIndex:regexp.lastIndex})}if(array.length>0){var lastEndIndex=0;var textReuslt="";for(var i=0;i<array.length;i++){array[i].startIndex!==lastEndIndex&&(textReuslt+=escapeChar(text.substring(lastEndIndex,array[i].startIndex)));textReuslt+='<span class="filter-highlight">'+escapeChar(text.substring(array[i].startIndex,array[i].endIndex))+"</span>";lastEndIndex=array[i].endIndex;i===array.length-1&&array[i].endIndex!==text.length&&(textReuslt+=escapeChar(text.substring(array[i].endIndex)))}text=textReuslt}else text=escapeChar(text)}else text=escapeChar(text);return $sce.trustAsHtml(text)}}}]).filter("nbHighlightAndKeepWhitespace",["$sce",function($sce){return function(text,phrase){if(text){if(phrase){phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");text=text.replace(new RegExp("("+phrase+")","gi"),'<span class="filter-highlight">$1</span>')}text=text.replace(/ {2}/g,"&nbsp;&nbsp;");return $sce.trustAsHtml(text)}}}]).filter("nbHighlightMapBased",["$sce",function($sce){return function(text,phrase){if(text){if(phrase){var strs=(phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).split(/\s+/);var pattern=new RegExp("("+strs.join("\\S*\\s+")+")","gi");text=text.replace(pattern,'<span class="filter-highlight">$1</span>')}return $sce.trustAsHtml(text)}}}]).filter("nbHighlightOnlyOne",["$sce",function($sce){return function(text,phrase){if(text){if(phrase){phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");text=text.replace(new RegExp("("+phrase+")","i"),'<span class="filter-highlight">$1</span>')}return $sce.trustAsHtml(text)}}}]).filter("nbHighlightEx",["$sce","nb.ng.utilitySrvc",function($sce,util){return function(text,phrase,ipsInSubnet){if(text&&phrase){var subPhrases=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").match(/(?:[^\s,|"]+|"[^"]*")+/g);var escapedText=text.replace(/[-\/\\^$*+?.()[\]{}]/g,"\\$&");var subText=(text||"").split(",");subPhrases=_.sortBy(subPhrases,(function(item){return-1*item.length}));_.each(subText,(function(text3,index){if(ipsInSubnet&&ipsInSubnet.length>0&&util.isIpOrIpMask(text3)){var ip=text3.split("/")[0];ipsInSubnet.indexOf(ip)>-1&&(subPhrases=subPhrases.concat([ip]))}_.each(subPhrases,(function(subPhrase){if(void 0!==subPhrase&&" "!==subPhrase&&function(filterStr,text2){var lowerFilterStr=filterStr.toLowerCase();if(text2.toLowerCase().indexOf(lowerFilterStr)>=0)return!0;var notHighlightArray=["mgmt","vendor","model"];for(var i=0;i<notHighlightArray.length;i++)if(lowerFilterStr.indexOf(notHighlightArray[i])>=0)return!1;return!/:$/.test(filterStr)}(subPhrase,escapedText)){/^".*"$/.test(subPhrase)&&(subPhrase=subPhrase.replace(/\"/g,""));"\\^"===subPhrase.substr(0,2)&&(subPhrase=subPhrase.substr(2));"\\$"===subPhrase.substr(subPhrase.length-2,2)&&(subPhrase=subPhrase.substr(0,subPhrase.length-2));subPhrase=subPhrase.replace('"',"");text3=text3.replace(new RegExp("("+subPhrase+")","gi"),'<span class="$class">$1</span>')}}));text3=text3.replace(/\$class/gi,"filter-highlight");subText[index]=text3}));return $sce.trustAsHtml(subText.join(" ,"))}}}]).filter("nbSortTableBy",[function(){return function(items,columnNameIndex,reverse){var filtered=[];angular.forEach(items,(function(item){filtered.push(item)}));filtered.sort((function(a,b){return a.rowData[columnNameIndex]>b.rowData[columnNameIndex]?1:-1}));reverse&&filtered.reverse();return filtered}}]).filter("nbPropsFilter",[function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach((function(item){var itemMatches=!1;for(var i=0;i<keys.length;i++){var prop=keys[i];var text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}))}else out=items;return out}}]).filter("validateEmail",[function(){return function(value){return _.isEmpty(value)||/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i.test(value)}}]).filter("textAreaValueToHtmlKeepWhiteSpace",["$sce",function($sce){return function(input){if(!input)return"";input=(input=input.replace(/\n/g,"<br>")).replace(/ /g,"&nbsp;");return $sce.trustAsHtml(input)}}]).filter("nbFormatAndHighlight",["$sce",function($sce){return function(text,phrase){var txt;(angular.isString(text)||angular.isNumber(text))&&(txt=String(text));null==text&&(txt="");var strPhrase=phrase?phrase.trim().replace(/([\*\.\?\+\$\^\[\]\(\)\{\}\|\\])/g,(function(c){return"\\"+c})):null;txt=strPhrase?txt.replace(new RegExp("("+strPhrase+")","gi"),'\n\r1span style="background-color: yellow; color: black;"\n\r2$1\n\r1/span\n\r2').replace(/(<|>|&)/g,(function(char){switch(char){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return char}})).replace(/(\n\r1|\n\r2)/g,(function(str){switch(str){case"\n\r1":return"<";case"\n\r2":return">";default:return str}})):txt.replace(/(<|>|&)/g,(function(char){switch(char){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return char}}));return $sce.trustAsHtml(txt)}}]).filter("parseDate",[function(){return function(strValue){return strValue?angular.isDate(strValue)?strValue:new Date(strValue):strValue}}]).filter("fileSizeUnit",(function(){return function(size){var sizeUnit;if(size>1024){var sizeK=Math.round(size/1024);if(sizeK>1024){var sizeM=Math.round(size/1024/1024);if(sizeM>1024){var sizeG=Math.round(size/1024/1024/1024);sizeUnit=sizeG>1024?Math.round(size/1024/1024/1024/1024)+"T":sizeG+"G"}else sizeUnit=sizeM+"M"}else sizeUnit=sizeK+"K"}else sizeUnit=size+"B";return sizeUnit}})).filter("personListFilter",(function(){return function(personList,arg){var tempPersonList=[];if(personList.length>0)for(var i=0;i<personList.length;i++)(personList[i].name.toLowerCase().indexOf(arg.toLowerCase())>=0||personList[i].email.toLowerCase().indexOf(arg.toLowerCase())>=0)&&tempPersonList.push(personList[i]);return tempPersonList}})).filter("htmlEncodeByRegExp",[function(){return function(strValue){return strValue?Utility.htmlEncodeByRegExp(strValue):""}}]).filter("currentDate",["$filter",function($filter){return function(){return $filter("date")(new Date,"yyyy-MM-dd")}}]).filter("currentTime",["$filter",function($filter){return function(){return $filter("date")(new Date,"yyyy-MM-dd HH:mm:ss")}}]);!function(){Date.prototype.toAgo=function(){var timeSpan=Date.now()-this.valueOf();if(timeSpan<second)return"< 1s";return[getDays(timeSpan)," ",getHours(timeSpan),":",getMinutes(timeSpan),":",getSeconds(timeSpan)].join("")};Date.prototype.toSpecialToday=function(todayFormator,otherDayFormator){var _isToday=(date=this,today=new Date,ngDateFilter(today,dateFormator)===ngDateFilter(date,dateFormator));var date,today;var formator=_isToday?todayFormator:otherDayFormator;return formator?ngDateFilter(this,formator):_isToday?this.toLocaleDateString():this.toLocaleTimeString()};var ngDateFilter=null;var dateFormator="yyyyMMdd";var second=1e3;var minute=60*second;var hour=60*minute;var day=24*hour;var commonModule=angular.module("nb.common");var injects=["dateFilter"];configs=[{name:"nbDate",template:"toLocaleDateString"},{name:"nbTime",template:"toLocaleTimeString"},{name:"nbDateTime",template:"toLocaleString"},{name:"nbAgo",template:"toAgo"},{name:"nbSpecialToday",template:"toSpecialToday"}],_.each(configs,(function(config){!function(config){var filterFactory=function(template){var factory=function(dateFilter){return function(formatTemplate,dateFilter){ngDateFilter||(ngDateFilter=dateFilter);return function(dateTime){if(dateTime){_.isString(dateTime)&&(dateTime=new Date(dateTime));var args=Array.prototype.slice.call(arguments,1);return dateTime[formatTemplate].apply(dateTime,args)}}}(template,dateFilter)};factory.$inject=injects;return factory}(config.template);commonModule.filter(config.name,filterFactory)}(config)}));var configs;return;function getDays(timeSpan){var days=Math.floor(timeSpan/day);if(days){var unit="day";days>1&&(unit+="s");return days+unit}return""}function getSeconds(timeSpan){return getTimeUnit(timeSpan,second,minute)}function getMinutes(timeSpan){return getTimeUnit(timeSpan,minute,hour)}function getHours(timeSpan){return getTimeUnit(timeSpan,hour,day)}function getTimeUnit(timeSpan,current,upper){return function(n,length){var nStr=n.toString();if(nStr.length>=length)return nStr;var arr=Array(length-nStr.length);arr.push(nStr);return arr.join("0")}(Math.floor(timeSpan%upper/current),2)}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}NetBrain,angular.module("nb.common").filter("visibleColumnsFilter",(function(){return function(data,grid,query){var matches=[];if(void 0===query||""===query)return data;query=query.toLowerCase();for(var i=0;i<data.length;i++)for(var j=0;j<grid.columnDefs.length;j++){var dataItem=data[i];var fieldName=grid.columnDefs[j].field;if("object"!==_typeof(dataItem[fieldName])&&"function"!=typeof dataItem[fieldName]&&void 0!==dataItem[fieldName]&&dataItem[fieldName].toString().toLowerCase().indexOf(query)>-1){matches.push(dataItem);break}}return matches}})).filter("selectedColumnsFilter",(function(){return function(data,columns,query){var matches=[];if(void 0===query||""===query)return data;query=query.toLowerCase();for(var i=0;i<data.length;i++)for(var j=0;j<columns.length;j++){var dataItem=data[i];var fieldName=columns[j];if("object"!==_typeof(dataItem[fieldName])&&"function"!=typeof dataItem[fieldName]&&void 0!==dataItem[fieldName]&&dataItem[fieldName].toString().toLowerCase().indexOf(query)>-1){matches.push(dataItem);break}}return matches}})).filter("strictMatchColumnsFilter",(function(){return function(data,columns,query){if(void 0===query||""===query)return data;var matches=[];query=query.toLowerCase();for(var i=0;i<data.length;i++)for(var j=0;j<columns.length;j++){var dataItem=data[i];var fieldName=columns[j];if("object"!==_typeof(dataItem[fieldName])&&"function"!=typeof dataItem[fieldName]&&void 0!==dataItem[fieldName]&&dataItem[fieldName].toString().toLowerCase()==query){matches.push(dataItem);break}}return matches}})).filter("complexColumnsFilter",(function(){return function(data,columns,query){var matches=[];if(void 0===query||""===query)return data;query=query.toLowerCase();var keyArray;_.each(data,(function(item){$.each(columns,(function(i,col){keyArray=col.split(".");var currentValue=function getObjectValue(objData,objKeys){if(!objKeys.length)return objData;var data=objData[objKeys[0]];if(data){var keys=objKeys.slice(1);return getObjectValue(data,keys)}return data}(item,keyArray);if(currentValue&&!_.isObject(currentValue)&&!_.isFunction(currentValue)&&currentValue.toString().toLowerCase().indexOf(query)>-1){matches.push(item);return!1}return!0}))}));return matches}})).filter("interfaceGridColumnsFilter",(function(){return function(data,columns,query){var matches=[];if(void 0===query||""===query)return data;query=query.toLowerCase();for(var i=0;i<data.length;i++)for(var j=0;j<columns.length;j++){var dataItem=data[i];var fieldName=columns[j];if("function"==typeof dataItem[fieldName]||void 0===dataItem[fieldName])break;if("object"===_typeof(dataItem[fieldName])&&angular.isDefined(dataItem[fieldName].text)&&dataItem[fieldName].text.toLowerCase().indexOf(query)>-1){matches.push(dataItem);break}if(dataItem[fieldName].toString().toLowerCase().indexOf(query)>-1){matches.push(dataItem);break}}return matches}})).filter("findSeatedUsers",(function(){return function(users){var matches=[];for(var i=0;i<users.length;i++){var user=users[i];user.DomainId&&matches.push(user)}return matches}}));!function(){angular.module("nb.common").directive("nbCheckbox",Checkbox);Checkbox.$inject=[];function Checkbox(){return{require:"ngModel",replace:!0,transclude:!0,scope:{},link:function(scope,element,attrs,model){scope.value=void 0;scope.checkbox=$(element).find("input");model.$render=function(){scope.value=model.$viewValue;scope.checkbox.prop("indeterminate",void 0===scope.value)};scope.update=function(){model.$setViewValue(scope.value)}},templateUrl:"controls/nb-checkbox/nb-checkbox.tpl.html"}}}(NetBrain);NetBrain,angular.module("nb.common").directive("nbDropdown",["$timeout","$parse",function($timeout,$parse){return{restrict:"E",transclude:!0,scope:{nbDropdownPlaceholder:"@",nbHide:"@",dropdownDisabled:"=",width:"@",height:"@",simpleStyle:"=",optionsRenderFinishEventId:"="},require:["ngModel","nbDropdown"],priority:1,replace:!0,link:{post:function(scope,element,attrs,ctrls){scope.editable=void 0!==attrs.editable;scope.ngModel=ctrls[0];scope.nbDropdown=ctrls[1];scope.inputValue=scope.ngModel.$modelValue;scope.inputType="true"===scope.nbHide?"password":"text";scope.validator={};scope.width&&(element[0].style.width=scope.width);scope.height&&(element[0].style.height=scope.height);scope.$watch("dropdownDisabled",(function(){scope.simpleStyle||$timeout((function(){scope.isDisabled=scope.dropdownDisabled;scope.$apply()}))}));if(scope.simpleStyle){scope.optionsRenderFinish=function(){scope.inputValue=scope.ngModel.$modelValue;var match=null;scope.options.forEach((function(option){var dropDownItem=angular.copy(option.nbDropdownData);var modelVal=angular.copy(scope.ngModel.$modelValue);_.isEqual(modelVal,dropDownItem)?match=option:option._selected=!1}));match&&scope.nbDropdown.select(match)};scope.$on(scope.optionsRenderFinishEventId,scope.optionsRenderFinish);scope.$watch((function(){return scope.ngModel.$modelValue}),(function(){scope.optionsRenderFinish()}));if(scope.editable){scope.$watch((function(){scope.inputType="true"===scope.nbHide?"password":"text";return scope.inputValue}),(function(){scope.ngModel.$setViewValue(scope.inputValue)}));element.attr("validator")&&(scope.validator=scope.$parent[element.attr("validator")])}}else $timeout((function(){scope.$watch((function(){return scope.ngModel.$modelValue}),(function(){scope.inputValue=scope.ngModel.$modelValue;$timeout((function(){var match=null;scope.options.forEach((function(option){var dropDownItem=angular.copy(option.nbDropdownData);var modelVal=angular.copy(scope.ngModel.$modelValue);_.isEqual(modelVal,dropDownItem)?match=option:option._selected=!1}));scope.nbDropdown.select(match)}),200)}));if(scope.editable){scope.$watch((function(){scope.inputType="true"===scope.nbHide?"password":"text";return scope.inputValue}),(function(){scope.ngModel.$setViewValue(scope.inputValue)}));element.attr("validator")&&(scope.validator=scope.$parent[element.attr("validator")])}}))}},controller:function($scope,$element){$scope.options=[];var selectionBlock=$element.find("span.dropdown-selection");this.select=function(option){if($scope.option!==option){$scope.option&&$scope.option.selected(null,!1);$scope.option=option;if(option){option.selected(null,!0);if(!$scope.editable){selectionBlock.html(option.getSelectedRepresentation());selectionBlock.attr("title",option.getSelectedText())}$scope.ngModel.$setViewValue(option.nbDropdownData)}}};this.add=function(option){$scope.options.push(option)}},templateUrl:function(tElement){return tElement.attr("tpl")?"controls/nb-dropdown/"+tElement.attr("tpl"):"controls/nb-dropdown/nb-"+(void 0!==tElement.attr("editable")?"editable-":"")+"dropdown.tpl.html"}}}]);NetBrain,angular.module("nb.common").directive("nbDropdownGroup",[function(){return{require:["^nbDropdown"],restrict:"E",transclude:!0,replace:!0,scope:{nbDropdownGroupLabel:"@"},templateUrl:"controls/nb-dropdown/nb-dropdown-group.tpl.html"}}]);!function(){angular.module("nb.common").directive("nbDropdownOption",["$compile","$timeout",function($compile,$timeout){return{require:["nbDropdownOption","^nbDropdown","^ngModel","?^ngDropdownGroup"],restrict:"E",transclude:!0,replace:!0,scope:{nbDropdownData:"=",optionDisabled:"&",simpleStyle:"="},link:function(scope,element,attrs,ctrls){scope.nbDropdown=ctrls[1];scope.ngModel=ctrls[2];scope.ngDropdownGroup=ctrls[3];scope.nbDropdown.add(scope);scope._selected=!1;scope.$watch("optionDisabled",(function(){scope.simpleStyle?scope.isDisabled=scope.optionDisabled():$timeout((function(){scope.isDisabled=scope.optionDisabled()}))}))},controller:function($scope,$element){$scope.getSelectedRepresentation=function(){return $element.find("[ng-transclude]").html()};$scope.getSelectedText=function(){return $element.find("[ng-transclude]").text().trim()};$scope.selected=function(event,value){if(!$scope.isDisabled){if(void 0!==value&&$scope._selected!==value){$scope._selected=value;$scope.nbDropdown.select($scope)}return $scope._selected}if(event){event.preventDefault();event.stopPropagation()}}},templateUrl:"controls/nb-dropdown/nb-dropdown-option.tpl.html"}}]);angular.module("nb.common").directive("nbRepeatFinish",(function(){return{link:function(scope,element,attr){1==scope.$last&&attr.nbRepeatFinish&&scope.$emit(attr.nbRepeatFinish)}}}))}(NetBrain);NetBrain,angular.module("nb.common").directive("nbDropdownSeparator",[function(){return{require:["^nbDropdown","ngChange"],restrict:"E",transclude:!0,replace:!0,template:'<li class="nb-dropdown-separator"></li>',scope:!1}}]);NetBrain,angular.module("nb.common").directive("nbLoader",(function(){return{templateUrl:"controls/nb-loader/nb-loader.tpl.html"}}));NetBrain,angular.module("nb.common").directive("nbBreadcrumbDirective",[function(){return{restrict:"EA",scope:{id:"@",folderClicked:"&",val:"="},template:'<ul class="breadcrumb"><li style="float: left; cursor: pointer;margin:-1px 10px 0px -10px;" ng-if="showTopNav"><span class="dropdown divider"><div class="dropdown-toggle" data-toggle="dropdown"><img src="img/Assets/Left_Double_Arrows_20x20.png"/></div><ul class="dropdown-menu" uib-dropdown-menu><li ng-repeat="f in displayNavMenu"><a ng-if="0 == f.nodeType" ng-click="selectBreadcrumbNode(f)">{{f.name}}</a></li></ul></span></li><li style="float: left; cursor: pointer;" ng-repeat="folder in displayFolders"><a ng-click="selectBreadcrumbNode(folder)" ng-attr-title="{{folder.name}}" style="float: left; cursor: pointer;max-width:90px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">{{folder.name}}</a><span class="dropdown divider" ng-if="toggleArrow(folder)"><div class="dropdown-toggle" data-toggle="dropdown" ><img src="img/Assets/Right_Arrow_Blue_10x20.png"/></div><ul class="dropdown-menu" uib-dropdown-menu><li ng-repeat=\'f in folder.child\'><a ng-if="0 == f.nodeType" ng-click="selectBreadcrumbNode(f)" ng-style="{fontWeight: (f.ID === displayFolders[$parent.$parent.$index+1].ID) ? \'bold\' : \'normal\'}">{{f.name}}</a></li></ul></span></li></ul>',replace:!0,compile:function(){return function($scope,$elem,$attr){$scope.folderLevel=0;$scope.displayFolderLevel=$attr.displayFolderLevel||2;$scope.showTopNav=!1;$scope.displayFolders=[];$scope.displayNavMenu=[];$scope.selectBreadcrumbNode=function(obj){$scope.folderClicked({obj:obj})};$scope.toggleArrow=function(folder){if(folder.child)for(var i=0;i<folder.child.length;i++)if(0===folder.child[i].nodeType)return!0;return!1};$scope.$watch("val",(function(value){if(void 0!==value){$scope.folderLevel=value.length;$scope.displayFolders=[];$scope.displayNavMenu=[];if($scope.folderLevel<=$scope.displayFolderLevel){$scope.showTopNav=!1;$scope.displayFolders=value}else{$scope.showTopNav=!0;for(var i=$scope.displayFolderLevel;i--;)$scope.displayFolders.push(value[value.length-i-1]);for(var j=value.length-$scope.displayFolderLevel;j--;)$scope.displayNavMenu.push(value[j])}}}))}}}}]);NetBrain,angular.module("nb.common").directive("nbClickOutsideDirective",["$document","$rootScope","$timeout",function($document,$rootScope,$timeout){return{restrict:"A",scope:!1,link:function($scope,elem,attr){var classList=void 0!==attr.outsideIfNot?attr.outsideIfNot.replace(", ",",").split(","):[];var timer=null;classList.forEach((function(elem2,index){classList[index]=elem2.trim()}));void 0!==attr.id&&classList.push(attr.id);var $body=$("body");$scope.$on("$destroy",(function(){timer&&$timeout.cancel(timer);$body.off("click",docClickHander);attr.clickOutsideHide&&$body.off("mousedown",mousedownHander)}));$body.on("click",docClickHander);attr.clickOutsideHide&&$body.on("mousedown",mousedownHander);function docClickHander(e){timer&&$timeout.cancel(timer);timer=$timeout((function(){if(e.target){var element,i=0;for(element=e.target;element;element=element.parentNode){var id=element.id;var classNames=element.className;if("string"==typeof classNames&&void 0!==id)for(i=0;i<classList.length;i++)if(id.indexOf(classList[i])>-1||classNames.indexOf(classList[i])>-1)return}if(attr.clickOutside){if("true"===attr.notClickInSelf&&elem.find(e.target).length>0)return;$scope.$eval(attr.clickOutside)}attr.clickOutsideHide&&elem.hide()}}))}function mousedownHander(e){0===elem.find(e.target).length&&elem.hide()}}}}]);NetBrain,angular.module("nb.common").directive("nbDraggable",["$log",function($log){return{restrict:"A",scope:!1,replace:!1,link:function(scope,element,attr){var el=element[0];var callback=null;var parentScope=scope;el.draggable=!0;if(""!==attr.nbDraggable){callback=parentScope[attr.nbDraggable];for(;null==callback&&parentScope.$parent;){parentScope=parentScope.$parent;callback=parentScope[attr.nbDraggable]}}el.addEventListener("dragstart",(function(event){callback?callback(scope,event):$log.log("no callback method");return!1}),!1);el.addEventListener("dragend",(function(){}))}}}]);!function(){angular.module("nb.common").directive("nbDropdownDataType",DropdownDataType);DropdownDataType.$inject=["nb.snapshot.httpSnapshotSrvc","$q","nb.ng.licenseSrvc","nb.sdn.httpSdnSrvc","nb.admin.httpChangeAnalysisSettingSrvc","ivhTreeviewMgr"];function DropdownDataType(httpSnapshotSrvc,$q,licenseSrvc,httpSdnSrvc,httpCASettingSrvc,ivhTreeviewMgr){return{restirct:"AE",scope:{nodeClick:"=?",disabled:"=?",placeHolder:"=?",refresh:"=?"},template:"<nb-dropdown-tree-directive tree-data='dataTypeTree' tree-options='dataTypeTreeOptions' placeholder='{{placeholder}}'disabled='disabled'></nb-dropdown-tree-directive>",compile:function(){return{pre:function(scope){var ENUM_LEVEL={ROOT:"root",LEAF:"leaf"};var ENUM_CATEGORY={BUILTIN:"built-in",NCT:"nct",TECH:"tech"};var ENUM_TYPE={CONFIG:"config",SYS_TABLE:"sysTable",NCT_TABLE:"nctTable"};var builtInTable=[{ID:"config",name:"Configuration File",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"routeTable",name:"Route Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"arpTable",name:"ARP Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"macTable",name:"MAC Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"cdpTable",name:"NDP Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"stpTable",name:"STP Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1},{ID:"bgpNbrTable",name:"BGP Advertised-route Table",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.BUILTIN,selected:!1}];_.pluck(builtInTable,"name");scope.placeholder=scope.placeHolder;scope.$watch("placeHolder",(function(){scope.placeholder=scope.placeHolder}));scope.refresh=initDropdownTree;scope.form={caEnabled:!1,systemTable:[],nctTable:[],techData:[]};scope.dataTypeTreeOptions={defaultSelectedState:!1,useCheckboxes:!0,expandToDepth:1,labelAttribute:"name",idAttribute:"ID",childrenAttribute:"items",selectedAttribute:"selected",expandedAttribute:"expanded",enableMultipleSelect:!0,enableTwoWayBinding:!0,needWatchPlaceHolder:!0,customizedTitle:!0,nodeClickCallback:function(node){1==scope.dataTypeTree[0].selected?scope.nodeClick(node,!0):scope.nodeClick(node);switch(node.category){case ENUM_CATEGORY.BUILTIN:updateBuiltIn(node);break;case ENUM_CATEGORY.NCT:updateNCT(node);break;case ENUM_CATEGORY.TECH:!function(node){var index;if(node.level===ENUM_LEVEL.ROOT){if((index=_.findIndex(scope.form.techData,(function(tech){return tech.techInd==node.techId})))>=0)scope.form.techData.splice(index,1);else{(index=_.findIndex(scope.form.techData,(function(tech){return tech.techId===node.techId})))>=0&&scope.form.techData.splice(index,1);scope.form.techData.push({techId:node.techId,techName:node.name,systemTable:_.map(node.items,"name")})}}}(node)}}};function initDropdownTree(){scope.dataTypeTree=[{ID:"AllDataTypes",name:"All Data Types",selected:!1,level:ENUM_LEVEL.ROOT,items:[{ID:"liveOption",name:"Built-in Live Data",selected:!1,category:ENUM_CATEGORY.BUILTIN,level:ENUM_LEVEL.ROOT,items:[{ID:"config",name:"Configuration File",level:ENUM_LEVEL.LEAF,type:ENUM_TYPE.CONFIG,category:ENUM_CATEGORY.BUILTIN,selected:!1},{ID:"routeTable",name:"Route Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1},{ID:"arpTable",name:"ARP Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1},{ID:"macTable",name:"MAC Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1},{ID:"cdpTable",name:"NDP Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1},{ID:"stpTable",name:"STP Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1},{ID:"bgpNbrTable",name:"BGP Advertised-route Table",level:ENUM_LEVEL.LEAF,category:ENUM_CATEGORY.BUILTIN,type:ENUM_TYPE.SYS_TABLE,selected:!1}]},{ID:"otherNctTable",name:"NCT Table",category:ENUM_CATEGORY.NCT,level:ENUM_LEVEL.ROOT,selected:!1,items:[]}]}];httpSnapshotSrvc.getNctTableNames(null).then((function(data){if(data&&data.ncts&&data.ncts.length>0)for(var j=0;j<data.ncts.length;j++)if(-1==isPathNCT(data.ncts[j].pathNCTTable)){scope.dataTypeTree[0].items[1]||(scope.dataTypeTree[0].items[1]={ID:"otherNctTable",name:"NCT Table",category:ENUM_CATEGORY.NCT,level:ENUM_LEVEL.ROOT,selected:!1,items:[]});scope.dataTypeTree[0].items[1].items.push({ID:data.ncts[j],name:data.ncts[j],category:ENUM_CATEGORY.NCT,type:ENUM_TYPE.NCT_TABLE,level:ENUM_LEVEL.LEAF,selected:!1})}})).finally((function(){httpCASettingSrvc.getChangeAnalysisSetting().then((function(data){(angular.isUndefined(data)||0==data.length)&&(scope.dataTypeTree=[]);if(angular.isDefined(data)){scope.form=angular.copy(data);!0===data.configurationFile?scope.dataTypeTree[0].items[0].items[0].selected=!0:scope.dataTypeTree[0].items[0].items[0].selected=!1;if(data.systemTable.length>0){var newItems=scope.dataTypeTree[0].items[0].items.filter((function(value,index,arr){if("Configuration File"==value.name&&1==value.selected)return!0;if(data.systemTable.includes(value.name)){arr[index].selected=!0;return!0}}));scope.dataTypeTree[0].items[0].items=newItems}else{var systemTableIndex=_.findIndex(scope.dataTypeTree[0].items,(function(item){return"Built-in Live Data"==item.name}));if(scope.dataTypeTree[0].items[systemTableIndex].items[0].selected){var config=scope.dataTypeTree[0].items[systemTableIndex].items[0];var temp=[];temp.push(config);scope.dataTypeTree[0].items[systemTableIndex].items=temp}else scope.dataTypeTree[0].items.splice(systemTableIndex,1)}if(data.nctTable.length>0){var nctIndex=_.findIndex(scope.dataTypeTree[0].items,(function(item){return"NCT Table"==item.name}));var newNCT=scope.dataTypeTree[0].items[nctIndex].items.filter((function(value,index,arr){if(data.nctTable.includes(value.name)){arr[index].selected=!0;return!0}}));scope.dataTypeTree[0].items[nctIndex].items=newNCT}else{var nctTableIndex=_.findIndex(scope.dataTypeTree[0].items,(function(item){return"NCT Table"==item.name}));scope.dataTypeTree[0].items.splice(nctTableIndex,1)}if(0==scope.dataTypeTree[0].items.length){scope.dataTypeTree=[];scope.placeholder="No Data Type Enabled"}else scope.nodeClick(scope.dataTypeTree[0])}}),(function(){})).then((function(){ivhTreeviewMgr.validate(scope.dataTypeTree,scope.CASettingTreeOptions)}))}))}initDropdownTree();function isPathNCT(item,array){return _.findIndex(array,(function(o){return o.name==item}))}function addOrRemoveTable(table,node,func){if(node.level===ENUM_LEVEL.LEAF){var index=table.indexOf(node.name);index>=0?table.splice(index,1):table.push(node.name)}node.level===ENUM_LEVEL.ROOT&&node.items.length>0&&node.items.forEach((function(item){func(item)}))}function updateBuiltIn(node){node.level!==ENUM_LEVEL.LEAF||"config"!==node.ID?addOrRemoveTable(scope.form.systemTable,node,updateBuiltIn):scope.form.configurationFile?scope.form.configurationFile=!1:scope.form.configurationFile=!0}function updateNCT(node){addOrRemoveTable(scope.form.nctTable,node,updateNCT)}}}},controllerAs:"dtCtrl"}}}(NetBrain);angular.module("nb.common").directive("nbDroppable",["nb.common.nbDragDropSrvc","nb.path.httpPathSrvc",function(nbDragDropSrvc,httpPathSrvc){var dragType={DrawMedia:nbDragDropSrvc.drawMedia,DrawDevice:nbDragDropSrvc.drawDevice,DrawDeviceGroup:nbDragDropSrvc.drawDeviceGroup,DrawSite:nbDragDropSrvc.drawSite,DrawStencilItem:nbDragDropSrvc.drawStencilItem,DrawNode:nbDragDropSrvc.drawNode,DrawPath:nbDragDropSrvc.drawPath,DrawMapWithOneIp:nbDragDropSrvc.drawMapWithOneIp};return{restrict:"A",scope:!1,replace:!1,link:function(scope,element,attr){var el=element[0];var callback=null;var parentScope=scope;if(""!==attr.nbDroppable){callback=parentScope[attr.nbDroppable];for(;null==callback&&parentScope.$parent;){parentScope=parentScope.$parent;callback=parentScope[attr.nbDroppable]}}el.addEventListener("dragenter",(function(){}),!1);el.addEventListener("dragover",(function(event){if(document.URL.toLowerCase().indexOf("map.html")>0&&document.URL.toLowerCase().indexOf("maptype=2")>0){event.preventDefault?event.preventDefault():event.returnValue=!1;event.stopPropagation();return!1}if("dropzone"===event.target.className)return!1;event.preventDefault?event.preventDefault():event.returnValue=!1;event.stopPropagation();return!1}),!1);el.addEventListener("drop",(function(event){if(document.URL.toLowerCase().indexOf("map.html")>0&&document.URL.toLowerCase().indexOf("maptype=2")>0){event.preventDefault?event.preventDefault():event.returnValue=!1;event.stopPropagation()}else try{var dragData=JSON.parse(event.dataTransfer.getData("text"));dragType[dragData.actionType]?"DrawPath"===dragData.actionType?httpPathSrvc.getPathTempLastHistory(dragData.pathTempId).then((function(path){httpPathSrvc.getAllPathHops(path.ID).then((function(data){var drawMapDataList=[];_.each(data,(function(d){d.drawMapDataList&&(drawMapDataList=drawMapDataList.concat(d.drawMapDataList))}));var drawData={actionData:{drawMapDataList:drawMapDataList,hopsList:data},actionType:NetBrain.Common.Const.ActionType.DrawPath};dragType[dragData.actionType](drawData,event)}))})):dragType[dragData.actionType](dragData,event):callback&&callback(dragData,event);event.preventDefault?event.preventDefault():event.returnValue=!1;event.stopPropagation()}catch(ex){}}),!1);el.addEventListener("dragleave",(function(){}),!1)}}}]);NetBrain,angular.module("nb.common").directive("nbMenuPositionDirective",(function(){return{restrict:"A",link:function(scope,element,attrs){if(attrs.nbMenuPositionDirective){var treeContent=$(attrs.nbMenuPositionDirective);if(treeContent&&treeContent.length){var treeTop=treeContent[0].scrollTop;var offsetTop=element[0].offsetTop;element[0].style.top=offsetTop-treeTop+"px"}}}}}));NetBrain,angular.module("nb.common").directive("nbHeightAdjusterDirective",["$window",function($window){return{restrict:"A",link:function(scope,element,attr){scope.onHeightResize=function(){var sourceDiv=attr.heightSource;var adjustedHeight=(sourceDiv=sourceDiv?angular.element(sourceDiv):angular.element($window)).height()-attr.nbHeightAdjusterDirective;element.css({height:adjustedHeight})};angular.element($window).bind("resize",(function(){scope.onHeightResize()}));scope.onHeightResize()}}}]);NetBrain,angular.module("nb.common").directive("nbMultiSelectedTree",["$compile",function($compile){return{restrict:"E",terminal:!0,scope:{root:"@",fieldid:"@",isRoot:"@",fieldlabel:"@",fieldchildren:"@",val:"=?",fetch:"=?",selected:"=",selectCallback:"="},link:function(scope,element){var _setChecks=function(node){if(!0===node.checked){var children=node[scope.fieldchildren];node.iSelectedChildren=children?children.length:1;if(node.parentNode){var parentNode=node.parentNode;if(!0!==parentNode.checked){parentNode.iSelectedChildren++;parentNode.checked="indeterminate";!function _setParentCheckNum(node){var children=node[scope.fieldchildren];children&&node.iSelectedChildren>=children.length&&(node.checked=!0);if(node.parentNode){var parentNode=node.parentNode;!0===node.checked&&parentNode.iSelectedChildren++;parentNode.checked="indeterminate";_setParentCheckNum(parentNode)}}(parentNode)}}}};var _setParents=function _setParents(node){if(null!=node&&void 0!==node){node.iSelectedChildren=0;var children=node[scope.fieldchildren];angular.forEach(children,(function(child){if(!child.parentNode){child.parentNode=node;child.iSelectedChildren=0;child[scope.fieldchildren]&&_setParents(child);_setChecks(child)}}))}};scope.checkParent=function(node){if(node.parentNode){node.parentNode.checked="indeterminate";scope.checkParent(node.parentNode)}};scope.onCheckChange=function(node){scope.val.children&&scope.checkChildren(scope.val);scope.val.checked&&_setChecks(scope.val);scope.val.checked||function(node){if(!1===node.checked){node.iSelectedChildren=0;if(node.parentNode){var parentNode=node.parentNode;if(!0===parentNode.checked||"indeterminate"===parentNode.checked){parentNode.iSelectedChildren--;parentNode.checked="indeterminate";!function _setParentUncheckNum(node){0===node.iSelectedChildren&&(node.checked=!1);if(node.parentNode){var parentNode=node.parentNode;!1===node.checked&&parentNode.iSelectedChildren>0&&parentNode.iSelectedChildren--;parentNode.checked="indeterminate";_setParentUncheckNum(parentNode)}}(parentNode)}}}}(scope.val);var selectedNodes=scope.findChecked(node.rootScope.val);scope.selectCallback&&scope.selectCallback(selectedNodes)};scope.checkChildren=function(node){angular.forEach(node.children,(function(child){child.checked=scope.val.checked;child.children&&scope.checkChildren(child)}))};scope.findChecked=function(node,result){angular.isDefined(result)||(result=[]);!0!==node.checked||node.isGrouping||result.push(node);angular.forEach(node.children,(function(child){scope.findChecked(child,result)}));return result};scope.expand=function(val){val.show=!val.show;if(val.show&&val.hasChildren&&val.rootScope.fetch&&null==val.children){val.isLoading=!0;val.rootScope.fetch(val).then((function(fetchedItems){var items=[];angular.forEach(fetchedItems,(function(_fetchedItem){var hasChildren=_fetchedItem.hasChildren;var treeData=createTreeData(_fetchedItem.id,_fetchedItem.name,null,val.rootScope,hasChildren,!1,!1);treeData.checked=_fetchedItem.checked;items.push(treeData)}));_setChildren(val,items);_setParents(val);val.isLoading=!1}))}};scope.$watch("root",(function(root){if(root){initialiseRootScope(scope);scope.val=createTreeData(root,root,null,scope,!0,!0,!1)}}));function createTreeData(id,label,children,rootScope,hasChildren,isRoot,isGrouping){var treeData={isRoot:isRoot,rootScope:rootScope,hasChildren:hasChildren,_children:children,children:children,show:!1,isLoading:!1,isGrouping:isGrouping,filterText:null,getId:function(){return treeData[treeData.rootScope.fieldid]}};treeData[rootScope.fieldid]=id;treeData[rootScope.fieldlabel]=label;return treeData}function _refresh(treeData){var filteredItems=[];null!=treeData.filterText?angular.forEach(treeData._children,(function(item){0===function(treeData){return treeData[treeData.rootScope.fieldlabel]}(item).indexOf(treeData.filterText)&&filteredItems.push(item)})):filteredItems=treeData._children;treeData.children=filteredItems}function _setChildren(treeData,children){treeData._children=children;treeData.items=children;_refresh(treeData)}function initialiseRootScope(rootScope){rootScope.fieldid=angular.isDefined(rootScope.fieldid)?rootScope.fieldid:"id";rootScope.fieldlabel=angular.isDefined(rootScope.fieldlabel)?rootScope.fieldlabel:"label";rootScope.fieldchildren=angular.isDefined(rootScope.fieldchildren)?rootScope.fieldchildren:"items"}scope.$watch("val.filterText",(function(val){null!=val&&_refresh(scope.val)}));scope.$watch("val",(function(val){if(val&&angular.isDefined(val)){!function(val,scope2){if(!angular.isDefined(val.rootScope)){initialiseRootScope(scope2);val.rootScope=scope2;!function _recurse(node,rootScope){angular.isDefined(node.show)||(node.show=!1);angular.isDefined(node.checked)||(node.checked=!1);angular.isDefined(node.rootScope)||(node.rootScope=rootScope);node.getId=function(){return node[node.rootScope.fieldid]};var items=node[node.rootScope.fieldchildren];if(angular.isDefined(items)){node.hasChildren=!0;_setChildren(node,items);for(var i in items)({}).hasOwnProperty.call(items,i)&&_recurse(items[i],rootScope)}}(val,val.rootScope)}}(val,scope);_setParents(scope.val);var nt=val.isGrouping?"span":"ul";var template="";template+=val.isRoot?'<div class="multiSelectTree_treeView">':"";template+='<div class="multiSelectTree_treeItem">';template+='  <span ng-if="val.hasChildren && val.show" class="icon_nb_tree_collapse" ng-click="expand(val)" ></span>';template+='  <span ng-if="val.hasChildren && !val.show" class="icon_nb_tree_expand" ng-click="expand(val)" ></span>';template+='    <label class="nb-checkbox">';template+='    <input type="checkbox" ng-model="val.checked" ng-change="onCheckChange(val)" ng-checked="val.checked">';template+='    <span class="image">';template+='    <i ng-if="val.checked" class="fa fa-check"></i>';template+='    <i ng-if="val.checked ===\'indeterminate\'" class="fa fa-square"></i>';template+="    </span>     ";template+="    </label>     ";template+='  <a ng-if="val.hasChildren && !val.show" href="" ng-click="expand(val)" class="multiSelectTree_treeItemCollapse" title="{{ val.getId() }}">{{ val[val.rootScope.fieldlabel] }}</a>';template+='  <a ng-if="val.hasChildren && val.show" href="" ng-click="expand(val)" class="multiSelectTree_treeItemExpand" title="{{ val.getId() }}">{{ val[val.rootScope.fieldlabel] }}</a>';template+='  <span ng-if="!val.hasChildren" class="multiSelectTree_treeItemSingle" title="{{ val.getId() }}">{{ val[val.rootScope.fieldlabel]}}</span>';template+="  <"+nt+' ng-if="val.show" class="multiSelectTree_treeItemChildren">';template+='    <li ng-repeat="item in val.children track by item.getId()" class="multiSelectTree_treeItemChild_{{ item.hasChildren }}">';template+='      <nb-multi-selected-tree is-root="false" val="item" fetch="expandTree" fieldchildren="{{fieldchildren}}" fieldlabel="name" expand-tree="expandTree" select-callback="selectCallback"></tree>';template+="    </li>";template+="  </"+nt+">";template+='  <div class="multiSelectTree_treeItemLoading" ng-show="val.isLoading">Loading...</div>';template+="</div>";template+=val.isRoot?"</div>":"";var newElement=angular.element(template);$compile(newElement)(scope);element.replaceWith(newElement);element=newElement}}))}}}]);NetBrain,angular.module("nb.common").directive("nbMoveOrderDirective",[function(){return{restrict:"E",templateUrl:"modules/nbCommon/views/nbMoveOrderDirective.html",transclude:!0,scope:{list:"=",selectIndex:"="},link:function(scope){scope.$watch("selectIndex",(function(){scope.disableMoveToTop=!0;scope.disableMoveUp=!0;scope.disableMoveDown=!0;scope.disableMoveToBottom=!0;if(scope.selectIndex>0){scope.disableMoveToTop=!1;scope.disableMoveUp=!1}if(scope.selectIndex>=0&&scope.selectIndex<scope.list.length-1){scope.disableMoveDown=!1;scope.disableMoveToBottom=!1}}));scope.moveToTop=function(){if(!(scope.selectIndex<=0)){var resultList=[];resultList.push(scope.list[scope.selectIndex]);for(var i=0;i<scope.selectIndex;i++)resultList.push(scope.list[i]);for(var j=scope.selectIndex+1;j<scope.list.length;j++)resultList.push(scope.list[j]);scope.list=resultList;scope.selectIndex=0}};scope.moveToBottom=function(){if(!(scope.selectIndex<0||scope.selectIndex>=scope.list.length-1)){var resultList=[];resultList.push(scope.list[scope.selectIndex]);for(var i=scope.list.length-1;i>scope.selectIndex;i--)resultList.push(scope.list[i]);for(var j=scope.selectIndex-1;j>=0;j--)resultList.push(scope.list[j]);scope.list=resultList.reverse();scope.selectIndex=resultList.length-1}};scope.moveUp=function(){if(!(scope.selectIndex<=0)){var resultList=[];for(var i=0;i<scope.selectIndex-1;i++)resultList.push(scope.list[i]);resultList.push(scope.list[scope.selectIndex]);resultList.push(scope.list[scope.selectIndex-1]);for(var j=scope.selectIndex+1;j<scope.list.length;j++)resultList.push(scope.list[j]);scope.list=resultList;scope.selectIndex-=1}};scope.moveDown=function(){if(!(scope.selectIndex<0||scope.selectIndex>=scope.list.length-1)){var resultList=[];for(var i=0;i<scope.selectIndex;i++)resultList.push(scope.list[i]);resultList.push(scope.list[scope.selectIndex+1]);resultList.push(scope.list[scope.selectIndex]);for(var j=scope.selectIndex+2;j<scope.list.length;j++)resultList.push(scope.list[j]);scope.list=resultList;scope.selectIndex+=1}}}}}]);NetBrain,angular.module("nb.common").directive("nbVisibilityHiddenDirective",["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.nbVisibilityHiddenDirective,(function(value){$animate[value?"addClass":"removeClass"](element,"nb-visibility-hidden",{tempClasses:"nb-visibility-hidden-animate"})}))}}}]);NetBrain,angular.module("nb.common").directive("nbWidthAdjusterDirective",["$window",function($window){return{restrict:"A",link:function(scope,element,attr){scope.onResizeWidth=function(){var sourceDiv=attr.widthSource;var adjustedWidth=(sourceDiv=sourceDiv?angular.element(sourceDiv):angular.element($window)).width()-attr.nbWidthAdjusterDirective;element.css({width:adjustedWidth})};angular.element($window).bind("resize",(function(){scope.onResizeWidth()}))}}}]);NetBrain,angular.module("nb.common").directive("nbTableCellWithMenu",[function(){return{restrict:"E",replace:!0,scope:{rowEntity:"=",cellContent:"@",filterText:"@",actionMenu:"=",gridOptions:"="},template:'<div title="{{cellContent}}" ng-mouseenter="setShowMenu(true);"  ng-mouseleave="showMenuButton = false;menuSelected=false;"><div class="nbTableCellWithMenuCell" ng-bind-html="cellContent | nbHighlight: filterText"></div>  <div  ng-if="showMenuButton" class="nbTableCellDropdownMenuContainer" >    <img src="img/Assets/More_Actions_Button_20x20.png" ng-click="showDropdownMenu()")>    <ul  ng-if="menuSelected" class="nbTableCellDropdownMenu" id="propMenu"+{{cellContent}} nb-table-cell-menu-top-adjust>      <li style="padding-left:10px; list-style-type: none;" ng-click="selectAction(action)" class="menuItem" ng-repeat="action in actionMenu track by $index">        {{action.title}}      </li>    </ul>  </div>  </div>',link:function(scope){scope.parentScope=scope.$parent;scope.ngGrid=scope.gridOptions.ngGrid;scope.menuSelected=!1;scope.setShowMenu=function(show){scope.showMenuButton=show};scope.showDropdownMenu=function(){scope.menuSelected=!0};scope.selectAction=function(action){scope.showMenuButton=!1;scope.menuSelected=!1;var callbackFun=action.action;scope.parentScope.$eval(callbackFun)(scope.rowEntity)}}}}]).directive("nbTableCellMenuTopAdjust",[function(){return{restrict:"A",link:function(scope,element){var scrollTop=scope.ngGrid.$viewport.scrollTop();var offsetTop=element[0].offsetTop;element[0].style.top=offsetTop-scrollTop+"px"}}}]);NetBrain,angular.module("nb.common").directive("nbTreeWithMenuDirective",["$compile",function($compile){var parentScope=null;return{restrict:"EA",terminal:!0,scope:{maxnumberchildren:"@",displayFolderOnly:"@",root:"@",fieldid:"@",fieldlabel:"@",fieldchildren:"@",val:"=?",fetch:"=?",selected:"=",multi:"@",treeNodeSelect:"&",treeActionMenu:"=",nbMenuPositionDirective:"@",treeNodeDrag:"&",treeNodeDrop:"&"},link:function(scope,element){scope.fieldlabel&&(parentScope=scope.$parent);scope.dragStart=function(){scope.val.rootScope.treeNodeDrag({node:scope.val.ID})};scope.dropItem=function(){scope.val.rootScope.treeNodeDrop({node:scope.val.ID})};scope.expand=function(val){val.show=!val.show;if(val.isFolder&&val.rootScope.fetch&&null==val.children){val.isLoading=!0;val.rootScope.fetch(val.getId(),(function(fetchedItems){var items=[];var index=0;var fetchedItem=null;var label=null;var isFolder=!1;angular.forEach(fetchedItems,(function(_fetchedItem){fetchedItem=_fetchedItem[0];isFolder=_fetchedItem[1];index=fetchedItem.lastIndexOf("/")>-1?fetchedItem.lastIndexOf("/"):fetchedItem.lastIndexOf("\\");label=fetchedItem.substr(index+1);items.push(createTreeData(fetchedItem,label,null,val.rootScope,isFolder,!1,!1))}));_setChildren(val,items);val.isLoading=!1}))}};scope.setSelectNode=function(node){scope.val.rootScope.selected=node.getId();parentScope.nodeSelected&&(parentScope.nodeSelected.selected=!1);parentScope.nodeSelected&&parentScope.nodeSelected.editMode&&node.getId()!==parentScope.nodeSelected.getId()&&(parentScope.nodeSelected.editMode=!1);node.selected=!0;parentScope.nodeSelected=node;scope.val.rootScope.treeNodeSelect({node:node})};function _subDivideChildren(val,items){if(items.length>val.rootScope.maxnumberchildren){var groups=function _subDivideChildrenIntoGroups(rootScope,items,numberChars){var groups={};angular.forEach(items,(function(item){var prefix=angular.lowercase(_getLabel(item).substr(0,numberChars));prefix in groups||(groups[prefix]=[]);groups[prefix].push(item)}));angular.forEach(groups,(function(items3,group){if(items3.length>rootScope.maxnumberchildren&&numberChars<10){delete groups[group];var newGroups=_subDivideChildrenIntoGroups(rootScope,items3,numberChars+1);angular.forEach(newGroups,(function(items4,group3){groups[group3]=items4}))}}));return groups}(val.rootScope,items,1);var result=[];var label="";angular.forEach(groups,(function(items2,group){if(1===items2.length)result.push(items2[0]);else{label=group+"... ["+items2.length+" items]";result.push(createTreeData(val.id+"."+group,label,items2,val.rootScope,!0,!1,!0))}}));return result.sort((function(a,b){return _getLabel(a)-_getLabel(b)}))}return items}scope.$watch("root",(function(root){if(root){initialiseRootScope(scope);scope.val=createTreeData(root,root,null,scope,!0,!0,!1)}}));function createTreeData(id,label,children,rootScope,isFolder,isRoot,isGrouping){var treeData={isRoot:isRoot,rootScope:rootScope,isFolder:isFolder,_children:children,children:children,show:!0,checked:!1,isLoading:!1,isGrouping:isGrouping,filterText:null,getId:function(){return treeData[treeData.rootScope.fieldid]}};treeData[rootScope.fieldid]=id;treeData[rootScope.fieldlabel]=label;return treeData}function _refresh(treeData){var filteredItems=[];null!=treeData.filterText?angular.forEach(treeData._children,(function(item){0===_getLabel(item).indexOf(treeData.filterText)&&filteredItems.push(item)})):filteredItems=treeData._children;treeData.children=treeData.rootScope.maxnumberchildren>0?_subDivideChildren(treeData,filteredItems):filteredItems}function _getLabel(treeData){return treeData[treeData.rootScope.fieldlabel]}function _setChildren(treeData,children){treeData._children=children;_refresh(treeData)}function initialiseRootScope(rootScope){rootScope.maxnumberchildren=angular.isDefined(rootScope.maxnumberchildren)?parseInt(rootScope.maxnumberchildren):25e4;rootScope.fieldid=angular.isDefined(rootScope.fieldid)?rootScope.fieldid:"id";rootScope.fieldlabel=angular.isDefined(rootScope.fieldlabel)?rootScope.fieldlabel:"label";rootScope.fieldchildren=angular.isDefined(rootScope.fieldchildren)?rootScope.fieldchildren:"items";rootScope.multi=!!angular.isDefined(rootScope.multi)&&("true"===rootScope.multi||!0===rootScope.multi)}scope.selectMenu=function(){scope.showMenuSelect=scope.showMenuSelect;scope.menuSelected=!scope.menuSelected};scope.selectAction=function(folderId,action){scope.showMenuSelect=!1;scope.menuSelected=!1;var callbackFun=action.action;if(action.supportContentEditable){scope.editMode=!0;scope.callbackFunName=callbackFun;parentScope.nodeSelected&&(parentScope.nodeSelected.editMode=!0)}else parentScope.$eval(callbackFun)(folderId)};scope.updateFolderName=function(selectFolder){if(scope.callbackFunName){var newFolderName=selectFolder.name;var folderId=selectFolder.getId();parentScope.$eval(scope.callbackFunName)(folderId,newFolderName)}scope.editMode=!1;parentScope.nodeSelected&&(parentScope.nodeSelected.editMode=!1)};scope.$watch("val.filterText",(function(val){null!=val&&_refresh(scope.val)}));scope.$watch("val",(function(val){var template;var newElement;if(val&&angular.isDefined(val)){!function(val,scope2){if(!angular.isDefined(val.rootScope)){initialiseRootScope(scope2);val.rootScope=scope2;!function _recurse(node,rootScope){angular.isDefined(node.show)||(node.show=!1);node.selected&&(parentScope.nodeSelected=node);node.isFolder=void 0===node.nodeType||0===node.nodeType;node.rootScope=rootScope;node.getId=function(){return node[node.rootScope.fieldid]};node.getName=function(){return node[node.rootScope.fieldlabel]};var items=node[node.rootScope.fieldchildren];if(angular.isDefined(items)){_setChildren(node,items);for(var i in items)({}).hasOwnProperty.call(items,i)&&_recurse(items[i],rootScope)}}(val,val.rootScope)}}(val,scope);var nt=val.isGrouping?"span":"ul";template="";template+=val.isRoot?'<div class="treeView">':"";template+='<div class="treeWithMenu_treeItem">';template+='  <div class="treeWithMenu_treeItemRow" ng-class="{treeWithMenu_treeItemRow_selected:val.selected}" ng-mouseenter="showMenuSelect = true"  ng-mouseleave="showMenuSelect = false;menuSelected=false;" ng-click="setSelectNode(val)" nb-draggable="dragStart" nb-droppable="dropItem">';template+='  <span ng-if="val.isFolder && val.show" class="icon_nb_tree_collapse" ng-click="expand(val)" ></span>';template+='  <span ng-if="val.isFolder && !val.show" class="icon_nb_tree_expand" ng-click="expand(val)" ></span>';template+='  <span contenteditable="{{editMode === undefined? false: editMode}}" ng-if="val.isFolder && !val.show" class="treeWithMenu_treeItemCollapse" ng-class="{folderEditing: editMode}" title="{{ val[val.rootScope.fieldlabel] }}" ng-model="val[val.rootScope.fieldlabel]" on-update="updateFolderName(val)" spellcheck="false">{{ val[val.rootScope.fieldlabel] }}</span>';template+='  <span contenteditable="{{editMode === undefined? false: editMode}}" ng-if="val.isFolder && val.show" class="treeWithMenu_treeItemExpand" ng-class="{folderEditing: editMode}"  title="{{ val[val.rootScope.fieldlabel] }}" ng-model="val[val.rootScope.fieldlabel]" on-update="updateFolderName(val)" spellcheck="false">{{ val[val.rootScope.fieldlabel] }}</span>';template+='  <div ng-if="val.isFolder && (showMenuSelect) && treeActionMenu" class="treeWithMenu_treeItemRight" ng-click="selectMenu(val.getId())" >';template+='    <img src="img/Assets/More_Actions_Button_20x20.png" dropdown-toggle="" aria-haspopup="true" aria-expanded="true">';template+='    <ul ng-if="val.isFolder && (showMenuSelect && menuSelected)" class="treeWithMenu_treeItemFolderMenu" nb-menu-position-directive="{{nbMenuPositionDirective}}">';template+='      <li style="padding-left:20px; list-style-type: none;"  ng-click="selectAction(val.getId(), action)" class="treeWithMenu_treeItemFolderMenuItem" ng-repeat="action in treeActionMenu">';template+="        {{action.title}}";template+="      </li>";template+="    </ul>";template+="  </div>";template+="</div>";template+='  <span ng-if="!val.isFolder && !displayFolderOnly" style="cursor:pointer;"  class="treeWithMenu_treeItemSingle" ng-class="{treeWithMenu_treeItemSingle_selected: val.selected}" title="{{ val[val.rootScope.fieldlabel] }}" ng-click="setSelectNode(val)">{{ val[val.rootScope.fieldlabel]}}</span>';template+="  <"+nt+' ng-if="val.show" class="treeWithMenu_treeItemChildren">';template+='    <li style="padding-left:20px; list-style-type: none;" ng-repeat="item in val.children track by item.getId()" class="treeWithMenu_treeItemChild_{{ item.isFolder }}">';template+='      <nb-tree-with-menu-directive val="item" fetch="fetch" display-folder-only={{displayFolderOnly}} data-tree-action-menu="treeActionMenu" nb-menu-position-directive="{{nbMenuPositionDirective}}"></nb-t>';template+="    </li>";template+="  </"+nt+">";template+='  <div class="treeItemLoading" ng-show="val.isLoading">Loading...</div>';template+="</div>";template+=val.isRoot?"</div>":"";newElement=angular.element(template);$compile(newElement)(scope);element.replaceWith(newElement);element=newElement}else{template="";template+='<span style="padding-left:4px;"> No Data Views found. </span>';newElement=angular.element(template);$compile(newElement)(scope);element.replaceWith(newElement);element=newElement}}))}}}]);!function(){angular.module("nb.common").directive("openTwist",(function(){return{restrict:"E",template:'<span class="icon_nb_tree_collapse" ></span>'}}));angular.module("nb.common").directive("collapsedTwist",(function(){return{restrict:"E",template:'<span class="icon_nb_tree_expand" ></span>'}}))}(NetBrain);NetBrain,angular.module("nb.common").directive("nbModalHeader",(function(){return{restrict:"E",scope:{modalTitle:"@",modalClose:"=?",uiResizeEnabled:"@"},template:'<div class="modal-header" ng-class="{\'ui-resize-enabled\':uiResizeEnabled}"><div class="icon-container" ng-show="modalClose" ng-click="modalClose()"><span class="icon close"></span></div><h3 class="modal-title">{{modalTitle}} </h3></div>',replace:!0}}));NetBrain,angular.module("nb.common").directive("nbModalDraggable",(function(){return{restrict:"A",link:function(scope,element,attrs){var options={};attrs.dragCancel&&(options.cancel=attrs.dragCancel);element.parents(".modal-dialog").draggable(options)}}}));NetBrain,angular.module("nb.common").directive("nbIvhTreeviewNodeDirective",[function(){return{restrict:"A",require:"^ivhTreeview",template:'<div class="ivh-tree-node" ng-class="{nodeSelected: node.selected}" ng-mouseleave="node.menuSelected = false;" ng-click="selectNode($event, node)"><span ivh-treeview-toggle><span ng-if="node.expended"><span class="icon_nb_tree_collapse" ng-style="{\'opacity\': (node.childNumber > 0) ? 1 : 0}"></span><img src="img/folder.png" style="margin: -5px 0 0 7px;"/></span><span ng-if="!node.expended"><span class="icon_nb_tree_expand" ng-style="{\'opacity\': (node.childNumber > 0) ? 1 : 0}"></span><img src="img/folder-closed.png" style="margin: -5px 0 0 7px;"/></span></span><span contenteditable="{{true == node.editMode && !node.systemFolder}}" ng-click="node.clicked = true" class="ivh-treeview-node-label" ng-class="{\'editHighlight\': node.editMode && !node.systemFolder}" ng-model="node.name" nb-ivh-treeview-edit-directive spellcheck="false">{{trvw.label(node)}}</span><div ng-if="nbIvhRootNode!=node.name && node.treeActionMenu != undefined" class="ivhTreeMenuRight"><img src="img/Assets/More_Actions_Button_20x20.png" dropdown-toggle="" aria-haspopup="true" aria-expanded="true" nb-ivh-treeview-select-menu-directive><ul ng-show="true" class="treeWithMenu_treeItemFolderMenu" nb-menu-position-directive="{{nbMenuPositionDirective}}"><li style="padding-left:20px; list-style-type: none;" nb-ivh-treeview-select-action-directive action-index="$index" class="treeWithMenu_treeItemFolderMenuItem" ng-repeat="action in node.treeActionMenu" ng-style="{\'border-top\':(\'Delete Folder\' == action[\'title\']) ? \'1px solid #cccccc\' : \'none\'}">{{action.title}}</li></ul></div></div>',replace:!0,link:function(scope,elm,attrs,ivhTreeview){scope.selectNode=function(event,node){var ele=angular.element(event.target);(ele.hasClass("ivh-tree-node")||ele.hasClass("ivh-treeview-node-label"))&&ivhTreeview.onNodeClick(node)};scope.nbIvhRootNode=attrs.nbIvhTreeviewNodeDirective}}}]);NetBrain,angular.module("nb.common").directive("nbIvhTreeviewSelectActionDirective",[function(){return{restrict:"A",require:"^ivhTreeview",scope:{actionIndex:"="},link:function(scope,element){var node=scope.$parent.node;element.bind("click",(function(){if(node.selectAction){var idx=scope.actionIndex+0;node.selectAction(node,node.treeActionMenu[idx])}}))}}}]);NetBrain,angular.module("nb.common").directive("nbIvhTreeviewSelectMenuDirective",[function(){return{restrict:"A",require:"^ivhTreeview",link:function(scope,element){var node=scope.node;element.bind("click",(function(){node.selectMenu&&node.selectMenu(node)}))}}}]);NetBrain,angular.module("nb.common").directive("nbIvhTreeviewEditDirective",["$timeout","nb.ng.utilitySrvc",function($timeout,utilitySrvc){return{restrict:"A",link:function(scope,elm,attrs){scope.node=scope.$parent.node;elm.bind("blur",(function(){$timeout((function(){scope.$apply((function(){if(scope.node&&scope.node.renameFolder){var result=utilitySrvc.decodeEntities(elm.html());scope.node.renameFolder(scope.node.ID,result,scope.node)}}))}),1)}));attrs.$observe("contenteditable",(function(newValue){"true"!==newValue||scope.node.systemFolder||$timeout((function(){var range=document.createRange();range.selectNodeContents(elm[0]);var sel=window.getSelection();if(range.toString()!==sel.toString()){sel.removeAllRanges();sel.addRange(range)}}),1)}))}}}]);NetBrain,angular.module("nb.common").directive("nbIvhTreeviewNodeActionDirective",[function(){return{restrict:"A",require:"^ivhTreeview",link:function(scope,element){var node=scope.$parent.node;element.bind("click",(function(){1===node.nodeType&&node.treeLeafActions&&node.selectLeafAction(node,node.treeLeafActions[0]);node.nodeActions&&node.selectNodeAction(node,node.nodeActions[0])}))}}}]);NetBrain,angular.module("nb.common").directive("nbGridEditDirective",["$timeout",function($timeout){return{restrict:"A",link:function(scope,elm,attrs){scope.node=scope.$parent.row.entity;attrs.$observe("contenteditable",(function(newValue){"true"===newValue&&$timeout((function(){var range=document.createRange();range.selectNodeContents(elm[0]);var sel=window.getSelection();if(range.toString()!==sel.toString()){sel.removeAllRanges();sel.addRange(range)}}),1)}))}}}]);NetBrain,angular.module("nb.common").directive("nbUiGridCellWithMenuDirective",[function(){return{restrict:"E",replace:!0,scope:{menuOptions:"=",menuOptionDisplayField:"@",menuClickCallback:"=",imgPathLabel:"@",nbUiGridCellMenuPositionAdjustClass:"=",hasNoMenu:"=",filterText:"=",gridScrollTop:"=",gridScrollLeft:"=",row:"=",displayField:"@",COL_FIELD:"=colField"},template:'<div class="ui-grid-cell-contents nbUiGridCellWithMenuDirective" ng-mouseenter="grid.appScope.showMenuButton = true">   <div title="{{COL_FIELD}}" class="nbUiGridCell">       <img ng-if="row.entity[imgPathLabel]" ng-src="{{row.entity[imgPathLabel]}}" width="16px"/>       <span ng-model="row.entity[displayField]" spellcheck="false" class="nbUiGridCellWithMenuCell" ng-bind-html="COL_FIELD | nbHighlight: filterText"></span>       <div  ng-show="row.showMenuButton && !row.hasNoMenu" class="nbUiGridCellDropdownMenuContainer" >           <img src="img/Assets/More_Actions_Button_20x20.png" ng-click="row.showMenuDropdown = !row.showMenuDropdown">           <ul  ng-if="row.showMenuDropdown" class="nbUiGridCellCellDropdownMenu" nb-ui-grid-cell-menu-top-adjust grid-scroll-top="gridScrollTop" grid-scroll-left="gridScrollLeft" nb-ui-grid-cell-menu-position-adjust="gridPositionElementClass" >               <li class="menuItem" ng-repeat="option in menuOptions" ng-click="menuClickCallback(row.entity, option)">                   {{option[menuOptionDisplayField]}}               </li>           </ul>       </div>   </div></div>',link:function(){}}}]).directive("nbUiGridCellMenuTopAdjust",[function(){return{restrict:"A",scope:{gridScrollTop:"=?",gridScrollLeft:"=?"},link:function(scope,element){adjustTop();adjustLeft();function adjustTop(){var scrollTop=scope.gridScrollTop;scrollTop=-scrollTop;element[0].style.marginTop=scrollTop-6+"px"}scope.$watch("gridScrollTop",(function(){adjustTop()}));function adjustLeft(){var scrollLeft=scope.gridScrollLeft;scrollLeft=-scrollLeft;element[0].style.marginLeft=scrollLeft+"px"}scope.$watch("gridScrollLeft",(function(){adjustLeft()}))}}}]).directive("nbUiGridCellMenuPositionAdjust",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element){$timeout((function(){!function(){if(scope.nbUiGridCellMenuPositionAdjustClass){var parentT=$(element).parents(scope.nbUiGridCellMenuPositionAdjustClass).eq(0);var pHeight=parentT.height();var targetPosition=$(element).offset().top;var targetHeight=$(element).height();var pPosition=parentT.offset().top;targetPosition-pPosition>pHeight-targetHeight&&$(element).css("top",-targetHeight+"px")}}()}),300)}}}]);NetBrain,angular.module("nb.common").directive("nbMouseoverMenuDirective",["$compile",function($compile){return{restrict:"A",scope:!0,replace:!1,priority:1e3,compile:function(element){$(element).attr("dropdown","");$(element).attr("dropdown-append-to-body","");$(element).attr("is-open","isMouseoverMenuShow");var toggleBtn=$(element).children(".dropdown-toggle");var toggleMenu=$(element).children(".dropdown-menu");toggleBtn.attr("ng-mouseenter","toggleMouseoverMenu(true, $event)");toggleBtn.attr("ng-mouseleave","toggleMouseoverMenu(false, $event)");toggleMenu.css({"z-index":9999});$(element).removeAttr("nb-mouseover-menu-directive");return function(scope,element2){$compile(element2)(scope);scope.toggleMouseoverMenu=function(isShow){scope.isMouseoverMenuShow=isShow}}}}}]);!function(){angular.module("nb.common").directive("nbListMenuDirective",["$timeout",function($timeout){return{scope:{selectMode:"=",selectedItems:"=",filterText:"="},restrict:"E",replace:!0,transclude:!0,template:'<div class="nb-list-menu-directive"><ul ng-transclude atag="domainAdmin:domainCreatePopup:selectDevicePopup:deviceTypes"></ul></div>',controller:function($scope,$element,$attrs){this.selectedItems=[];this.itemToggleCheck=function(itemScopeId,item,isActive,isEvent){var isSingleMode="single"===$scope.selectMode;if(isSingleMode){this.selectedItems=[];isActive&&this.selectedItems.push({id:itemScopeId,item:angular.copy(item)})}else{var index=this.selectedItems.map((function(item2){return item2.id})).indexOf(itemScopeId);index>-1&&!isActive?this.selectedItems.splice(index,1):index<0&&isActive&&this.selectedItems.push({id:itemScopeId,item:angular.copy(item)})}$scope.selectedItems||($scope.selectedItems=[]);for(;$scope.selectedItems.length>0;)$scope.selectedItems.pop();this.selectedItems.map((function(item3){return item3.item})).forEach((function(item4){$scope.selectedItems.push(item4)}));$scope.$broadcast("itemToggled",itemScopeId,isEvent,isSingleMode)};$scope.$watch("filterText",(function(newText){$timeout((function(){$scope.$broadcast("filterTextChanged",newText,$attrs.filterText)}))}))}}}]);angular.module("nb.common").directive("nbListMenuOption",["$timeout","$compile",function($timeout){return{replace:!0,restrict:"E",scope:{optionItem:"=",isActive:"=",isDisabled:"=",isAvoidFilter:"="},transclude:!0,template:'<li ng-class="{active: isSelected, hide: isHide, disabled: isDisabled}" class="nb-list-menu-option" ng-transclude atag="domainAdmin:domainCreatePopup:selectDevicePopup:deviceTypeItem"></li>',require:"^^nbListMenuDirective",link:function(scope,element,attrs,ctrl,transFn){var isActiveWatcher;transFn(scope.$parent,(function(clone){var tag=element;tag.empty();tag.append(clone)}));scope.isSelected=!!scope.isActive&&scope.isActive;scope.isHide=!1;$(element).bind("click",(function(){scope.isDisabled||$timeout((function(){scope.isSelected=!scope.isSelected;ctrl.itemToggleCheck(scope.$id,scope.optionItem,scope.isSelected,!0)}))}));var toggleActiveWatcher=function(isSelected){isActiveWatcher();scope.isActive=isSelected;$timeout((function(){isActiveWatcher=scope.$watch("isActive",(function(newValue,oldValue){if(null!=newValue&&newValue!==oldValue){scope.isSelected=newValue;ctrl.itemToggleCheck(scope.$id,scope.optionItem,scope.isSelected,!1)}}))}))};var itemToggleWatcher=scope.$on("itemToggled",(function(event,id,isEvent,isSingleMode){if(scope.$id!==id){if(isSingleMode&&scope.isSelected){scope.isSelected=!1;toggleActiveWatcher(scope.isSelected)}}else isEvent&&toggleActiveWatcher(scope.isSelected)}));var filterStringWatcher=scope.$on("filterTextChanged",(function(event,text,filterTextName){scope[filterTextName]=text;if(!0!==scope.isAvoidFilter&&null!=text){var index=$(element).text().trim().toLowerCase().indexOf(text.toLowerCase());scope.isHide=index<=-1}}));isActiveWatcher=scope.$watch("isActive",(function(newValue,oldValue){if(null!=newValue&&(newValue!==oldValue||newValue)){scope.isSelected=newValue;ctrl.itemToggleCheck(scope.$id,scope.optionItem,scope.isSelected,!1)}}));scope.$on("$destroy",(function(){itemToggleWatcher();filterStringWatcher();isActiveWatcher()}))}}}]);angular.module("nb.common").directive("nbListMenuOutSelected",(function(){return{restrict:"A",replace:!1,require:"?^nbListMenuDirective",link:function(scope,element){scope.$watch("group.isOutSelected",(function(nv){nv?element.addClass("outSelectedHighlight"):element.removeClass("outSelectedHighlight")}))}}}))}(NetBrain);NetBrain,angular.module("nb.common").directive("floating",["$document",function($document){return{restrict:"EA",replace:!1,link:function(scope,element){element.bind("mousedown",(function(event){var filterClass=["modal-header","modal-title","ngMapOperHideFrame","panelHead","titleBar","title","floating"];var target=event.target;var bindLocation=function(e){var origPageY=e.pageY;var origPageX=e.pageX;var origY=element.position().top;var origX=element.position().left;element.bind("mousemove",(function(e2){element.css({top:origY+e2.pageY-origPageY,left:origX+e2.pageX-origPageX})}));$document.find("body").bind("mousemove."+scope.$id,(function(e3){element.css({top:origY+e3.pageY-origPageY,left:origX+e3.pageX-origPageX})}));$document.find("body").addClass("unselectable")};for(var i in filterClass)angular.element(target).hasClass(filterClass[i])&&bindLocation(event)}));$document.find("body").bind("mouseup",(function(){$document.find("body").removeClass("unselectable");$document.find("body").unbind("mousemove."+scope.$id)}));element.bind("mouseup",(function(){element.unbind("mousemove");$document.find("body").unbind("mousemove."+scope.$id);$document.find("body").removeClass("unselectable")}))}}}]);!function(){angular.module("nb.common").factory("nb.common.ContextMenuService",(function(){return{element:null,menuElement:null}}));angular.module("nb.common").directive("nbContextMenuDirective",["$document","nb.common.ContextMenuService",function($document,ContextMenuService){return{restrict:"A",scope:{callback:"&nbContextMenuDirective",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose"},link:function($scope,$element,$attrs){var opened=!1;function close(menuElement){menuElement.css({display:"none"});opened&&$scope.closeCallback(menuElement);opened=!1}$element.bind("contextmenu",(function(event){event.preventDefault();if(!$scope.disabled()){if("function"==typeof $scope.$parent.preventContext&&$scope.$parent.preventContext())return;null!==ContextMenuService.menuElement&&close(ContextMenuService.menuElement);ContextMenuService.menuElement=angular.element(document.getElementById($attrs.target));ContextMenuService.element=event.target;event.preventDefault();$scope.$apply((function(){$scope.callback({$event:event})}));$scope.$apply((function(){!function(event,menuElement){if(0!==menuElement.length){var doc=$document[0].documentElement;var docLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),docTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elementWidth=menuElement[0].scrollWidth,elementHeight=menuElement[0].scrollHeight;var docWidth=doc.clientWidth+docLeft,docHeight=doc.clientHeight+docTop,totalWidth=elementWidth+event.pageX,totalHeight=elementHeight+event.pageY,left=Math.max(event.pageX-docLeft,0),top=Math.max(event.pageY-docTop,0);totalWidth>docWidth&&(left-=totalWidth-docWidth);totalHeight>docHeight&&(top-=totalHeight-docHeight);menuElement.css("top",top+"px");menuElement.css("left",left+"px");menuElement.css({display:"block"});opened=!0}}(event,ContextMenuService.menuElement)}))}}));function handleKeyUpEvent(event){!$scope.disabled()&&opened&&27===event.keyCode&&$scope.$apply((function(){close(ContextMenuService.menuElement)}))}function handleClickEvent(event){if(opened&&(2!==event.button||event.target!==ContextMenuService.element)){if($(event.target).next().children()[0]&&$($(event.target).next().children()[0]).hasClass("ng-scope"))return;$scope.$apply((function(){close(ContextMenuService.menuElement)}))}}$document.bind("keyup",handleKeyUpEvent);$document.bind("click",handleClickEvent);$document.bind("contextmenu",handleClickEvent);$scope.$on("$destroy",(function(){$document.unbind("keyup",handleKeyUpEvent);$document.unbind("click",handleClickEvent);$document.unbind("contextmenu",handleClickEvent)}))}}}])}(NetBrain);!function(){angular.module("nb.common").directive("nbContextMenu",NbContextMenu);NbContextMenu.$inject=["$rootScope","$compile","$sce","$log","$document","$timeout","nb.ng.utilitySrvc"];function NbContextMenu($rootScope,$compile,$sce,$log,$document,$timeout,utilitySrvc){return{restrict:"A",scope:{data:"=nbContextMenuData",key:"=nbContextMenuKey",getMenuItems:"&nbContextMenu"},link:function(scope,ele){var localScope=scope.localScope={};var menuId=NgUtil.getGUID();var menu=null;localScope.renderTemplate=function(template){return $sce.trustAs("html",template)};localScope.doAction=function(item,event){angular.isFunction(item.action)&&item.action(scope.data,event)};localScope.rendMenuItem=function(isLast){isLast&&$timeout((function(){var defaultPosition={left:localScope.event.pageX,top:localScope.event.pageY};utilitySrvc.setMenuPosition(menu,defaultPosition)}))};eventName="left"===scope.key?"click":"contextmenu",$(ele).on(eventName,(function(event){event.preventDefault();event.stopPropagation();$timeout((function(){!function(event){if(!menu){!function(){(menu=$compile('<ul id="'+menuId+'" class="dropdown-menu" uib-dropdown-menu     ng-show="localScope.contextMenuItems.length>1">     <li ng-class="item.class" ng-click="localScope.doAction(item, $event)" ng-repeat="item in localScope.contextMenuItems" ng-init="localScope.rendMenuItem($last)">       <a ng-bind-html="localScope.renderTemplate(item.template)"></a>    </li></ul>')(scope)).id=menuId;angular.element(document.body).append(menu)}();!function(){$document.bind("click",menuCloseChecker);$document.bind("contextmenu",menuCloseChecker);scope.cancelOtherMenuShowWatcher=$rootScope.$on("system::menushow",(function(event,data){data.menuId!==menu.id&&close()}))}()}!function(event){localScope.contextMenuItems=scope.getMenuItems();if(!(localScope.contextMenuItems.length<1)){$rootScope.$broadcast("system::menushow",{menuId:menuId});localScope.event=event;menu.show()}}(event)}(event)}))}));var eventName;return;function close(){!function(){$document.unbind("click",menuCloseChecker);$document.unbind("contextmenu",menuCloseChecker);scope.cancelOtherMenuShowWatcher()}();menu.remove();menu=null}function menuCloseChecker(){close()}}}}}(NetBrain);NetBrain,angular.module("nb.common").directive("nbIvhTreeviewWithLeafDirective",[function(){return{restrict:"A",require:"^ivhTreeview",template:'<div><div ng-if="node.nodeType == 0" class="ivh-tree-node" ng-class="{nodeSelected: node.selected}" ng-mouseleave="node.menuSelected = false;" ng-click="selectNode($event, node)"><span ivh-treeview-toggle><span ng-if="node.expended"><span class="icon_nb_tree_collapse" ng-style="{\'opacity\': (node.childNumber > 0) ? 1 : 0}"></span><img ng-if="!node.icon" src="img/folder.png" style="margin: -5px 2px 0 5px;"/><img ng-if="node.icon" ng-src="{{node.icon}}" style="margin: -5px 2px 0 5px;width:16px;height:16px;"/></span><span ng-if="!node.expended"><span class="icon_nb_tree_expand" ng-style="{\'opacity\': (node.childNumber > 0) ? 1 : 0}"></span><img ng-if="!node.icon" src="img/folder-closed.png" style="margin: -5px 2px 0 5px;"/><img ng-if="node.icon" ng-src="{{node.icon}}" style="margin: -5px 2px 0 5px;width:16px;height:16px;"/></span></span><span contenteditable="{{true == node.editMode}}" class="ivh-treeview-node-label" ng-class="{\'editHighlight\': node.editMode}" ng-model="node.name" nb-ivh-treeview-edit-directive spellcheck="false">{{trvw.label(node)}}</span><div class="ivhTreeMenuRight" ng-if="node.treeActionMenu != undefined && node.treeActionMenu.length > 0 && !node.nodeActions"><img src="img/Assets/More_Actions_Button_20x20.png" dropdown-toggle="" aria-haspopup="true" aria-expanded="true" style="margin-right:0.3em;" nb-ivh-treeview-select-menu-directive><ul ng-show="node.menuSelected" class="treeWithMenu_treeItemFolderMenu" nb-menu-position-directive="{{nbMenuPositionDirective}}"><li style="padding-left:20px; list-style-type: none;" nb-ivh-treeview-select-action-directive action-index="$index" class="treeWithMenu_treeItemFolderMenuItem" ng-repeat="action in node.treeActionMenu" ng-style="{\'border-top\':(\'Delete Folder\' == action[\'title\']) ? \'1px solid #cccccc\' : \'none\'}">{{action.title}}</li></ul></div><img ng-if="node.nodeActions" src="img/Assets/Close_Button_16x16.png" class="deleteNodeImage" nb-ivh-treeview-node-action-directive /></div><div ng-if="node.nodeType == 1" class="ivh-tree-node"  ng-class="{nodeSelected: node.selected}" ng-click="selectNode($event, node)" ng-mouseenter="node.showDeleteNode = (!disableDeleteBtn && node.treeLeafActions && node.treeLeafActions.length > 0);"  ng-mouseleave="node.showDeleteNode = false;node.menuSelected = false;" >  <img ng-if="!node.icon" src="img/file.png" style="margin: -5px 0 0 14px;"/> <img ng-if="node.icon" ng-src="{{node.icon}}" style="margin: -5px 0 0 14px;"/> <span class="ivh-treeview-node-label" title="{{node.name}}" >{{trvw.label(node)}}</span><img ng-if="node.showDeleteNode" src="img/Assets/Close_Button_16x16.png" class="deleteNodeImage" nb-ivh-treeview-node-action-directive /><div class="ivhTreeMenuRight" ng-if="node.treeActionMenu != undefined && node.treeActionMenu.length > 0 && !node.nodeActions"><img src="img/Assets/More_Actions_Button_20x20.png" dropdown-toggle="" aria-haspopup="true" aria-expanded="true" style="margin-right:0.3em;" nb-ivh-treeview-select-menu-directive><ul ng-show="node.menuSelected" class="treeWithMenu_treeItemFolderMenu" nb-menu-position-directive="{{nbMenuPositionDirective}}"><li style="padding-left:20px; list-style-type: none;" nb-ivh-treeview-select-action-directive action-index="$index" class="treeWithMenu_treeItemFolderMenuItem" ng-repeat="action in node.treeActionMenu" ng-style="{\'border-top\':(\'Delete Folder\' == action[\'title\']) ? \'1px solid #cccccc\' : \'none\'}">{{action.title}}</li></ul></div></div></div>',replace:!0,link:function(scope,elm,attrs,ivhTreeview){scope.selectNode=function(event,node){var ele=angular.element(event.target);(ele.hasClass("ivh-tree-node")||ele.hasClass("ivh-treeview-node-label"))&&ivhTreeview.onNodeClick(node)};scope.nbIvhRootNode=attrs.nbIvhTreeviewWithLeafDirective;scope.disableDeleteBtn="true"===attrs.disableDeleteBtn}}}]);!function(){angular.module("nb.common").directive("nbGroupContainerDirective",GroupContainerDirective);GroupContainerDirective.$inject=[];function GroupContainerDirective(){return{restrict:"A",scope:!1,priority:0,compile:function(){return{pre:function(){},post:function(scope,ele,attr){ele[0].style.position="relative";ele[0].style.padding="15px";ele[0].style.border="1px solid lightgray";ele[0].style.borderRadius="3px";var label=document.createElement("label");label.innerHTML=attr.nbGroupContainerDirective;label.style.position="absolute";label.style.marginTop="-23px";label.style.paddingLeft="5px";label.style.paddingRight="5px";label.style.backgroundColor="white";ele.prepend(label)}}}}}}(NetBrain);!function(){angular.module("nb.common").directive("nbCarouselSliderDirective",nbCarouselSliderDirective);nbCarouselSliderDirective.$inject=["$timeout"];function nbCarouselSliderDirective($timeout){function checkBtnVisible(ele,orientation){var slidingArea=$(ele).find(".sliding-area"),bkBtn=$(ele).find(".slider-backward-btn"),fwBtn=$(ele).find(".slider-forward-btn"),bkBtnShow=!1,fwBtnShow=!1;if("horizontal"===orientation){var scrollLeft=slidingArea[0].scrollLeft;fwBtnShow=slidingArea[0].scrollWidth>scrollLeft+slidingArea[0].offsetWidth;bkBtnShow=scrollLeft>0}if("vertical"===orientation){var scrollTop=slidingArea[0].scrollTop;fwBtnShow=slidingArea[0].scrollHeight>scrollTop+slidingArea[0].offsetHeight;bkBtnShow=scrollTop>0}bkBtn.css({opacity:bkBtnShow?1:0,cursor:bkBtnShow?"pointer":"default"});fwBtn.css({opacity:fwBtnShow?1:0,cursor:fwBtnShow?"pointer":"default"})}return{restrict:"A",scope:{},transclude:!0,template:'<div class="slider-backward-btn"><i class="icon-lg" ng-click="callSliding(\'back\')"></i></div><div class="sliding-area" ng-transclude></div><div class="slider-forward-btn"><i class="icon-lg" ng-click="callSliding(\'forward\')"></i></div>',compile:function(){return{pre:function(){},post:function(scope,element,attr){$timeout((function(){var pluswidth="0";({}).hasOwnProperty.call(attr,"pluswidth")&&(pluswidth=attr.pluswidth);!function(element,orientation,pluswidth){pluswidth=parseInt(pluswidth);isNaN(pluswidth)&&(pluswidth=0);if("vertical"===orientation){var btnHeight=$(element).find(".slider-backward-btn").height();$(element).find(".sliding-area").css({height:$(element).height()-2*btnHeight,overflow:"hidden"})}else{$(element).find(".sliding-area").css({width:$(element).width()-64+pluswidth,overflow:"hidden"});$(element).find(".sliding-area").children().css({display:"inline-block",verticalAlign:"top"})}}(element,attr.orientation,pluswidth);"vertical"===attr.orientation?function(element){var backBtn=$(element).find(".slider-backward-btn");var forwardBtn=$(element).find(".slider-forward-btn");backBtn.css({width:"100%",textAlign:"center"});forwardBtn.css({width:"100%",textAlign:"center"});backBtn.find("i").addClass("icon_nb_arrow_up");forwardBtn.find("i").addClass("icon_nb_arrow_down")}(element):function(element){var backBtn=$(element).find(".slider-backward-btn");var forwardBtn=$(element).find(".slider-forward-btn");$(element).css({whiteSpace:"nowrap"});$(element).children().css({verticalAlign:"top",display:"inline-block"});backBtn.find("i").addClass("icon_nb_arrow_left");forwardBtn.find("i").addClass("icon_nb_arrow_right");var paddingTop=$(element).height()/2-backBtn.find("i").height()/2;backBtn.css({height:"100%",paddingTop:paddingTop});forwardBtn.css({height:"100%",paddingTop:paddingTop})}(element);scope.callSliding=function(direction){!function(element,orientation,direction,pace){var intPace=parseInt(pace);isNaN(intPace)&&(intPace=0);var vPace="forward"===direction?intPace:-intPace;var slidingEle=$(element).find(".sliding-area");var animateOptions={duration:"fast",complete:function(){checkBtnVisible(element,orientation)}};if("vertical"===orientation){var scrollTop=$(slidingEle).scrollTop();$(slidingEle).animate({scrollTop:scrollTop+vPace},animateOptions)}else{var scrollLeft=$(slidingEle).scrollLeft();$(slidingEle).animate({scrollLeft:scrollLeft+vPace},animateOptions)}}(element,attr.orientation,direction,attr.pace||100)};checkBtnVisible(element,attr.orientation)}));var onceVisibleWatcher=scope.$watch((function(){return $(element).is(":visible")}),(function(isVisible){if(isVisible){$timeout((function(){checkBtnVisible(element,attr.orientation)}),500);onceVisibleWatcher()}}))}}}}}}(NetBrain);!function(){angular.module("nb.common").directive("nbButtonDropdown",nbButtonDropdown);nbButtonDropdown.$inject=[];function nbButtonDropdown(){return{restrict:"E",scope:!1,transclude:!0,template:'<div class="btn-group"><ng-transclude></ng-transclude></div>',compile:function(){return{pre:function(){}}}}}}(NetBrain);!function(){angular.module("nb.common").directive("nbGridColumnPatch",nbGridColumnPatch);nbGridColumnPatch.$inject=["gridUtil","$timeout"];function nbGridColumnPatch(gridUtil,$timeout){return{require:"uiGrid",scope:!1,restrict:"A",link:function(scope,element,attrs,uiGridCtrl){var resizeGrid=null;function resetGridCanvasWidth(){var headerCanvas=angular.element(element).find(".ui-grid-render-container-body .ui-grid-header-canvas"),headerCellWrapper=angular.element(element).find(".ui-grid-render-container-body .ui-grid-header-cell-wrapper"),gridCanvas=angular.element(element).find(".ui-grid-render-container-body .ui-grid-canvas");angular.element(element).find(".ui-grid-render-container-body .ui-grid-header-viewport").width()==headerCanvas.width()?gridCanvas.css("width","100%"):headerCanvas.width()>headerCellWrapper.width()?gridCanvas.width(headerCanvas.width()-10):gridCanvas.width(headerCellWrapper.width())}uiGridCtrl.grid.api.colResizable.on.columnSizeChanged(scope,(function(){resetGridCanvasWidth()}));angular.element(element).resize((function(){resizeGrid&&clearTimeout(resizeGrid);resizeGrid=setTimeout((function(){resetGridCanvasWidth()}),500)}));resizeGrid=setTimeout((function(){resetGridCanvasWidth()}),500)}}}}(NetBrain);!function(){angular.module("nb.common").directive("nbGridAutoResizeDirective",nbGridAutoResizeDirective);nbGridAutoResizeDirective.$inject=["gridUtil","$timeout"];function nbGridAutoResizeDirective(gridUtil,$timeout){return{require:"uiGrid",scope:!1,restrict:"A",link:function(scope,element,attrs,uiGridCtrl){scope.$watch((function(){return $(element).is(":visible")}),(function(isVisible){isVisible&&$timeout((function(){var newGridHeight=gridUtil.elementHeight(element);var newGridWidth=gridUtil.elementWidth(element);uiGridCtrl.grid.gridHeight=newGridHeight;uiGridCtrl.grid.gridWidth=newGridWidth;uiGridCtrl.grid.refresh()}),100)}))}}}}(NetBrain);NetBrain,angular.module("nb.common").directive("nbOnUpdateDirective",["$timeout",function($timeout){return{restrict:"A",require:"?ngModel",replace:!1,transclude:!1,link:function(scope,elm,attrs,ngModel){if(ngModel){ngModel.$render=function(){elm.html(ngModel.$viewValue||"")};elm.bind("keydown",(function(e){if(13===e.keyCode){e.keyCode=0;return!1}return!0}));elm.bind("blur",(function(e){if(13===e.keyCode||"keyup"!==e.type){var curValue=$(elm[0]).text();if(0===(curValue=curValue.trim()).length){elm[0].innerHTML=elm[0].nbOldValue;elm[0].focus()}else 13===e.keyCode&&"keyup"===e.type?elm[0].blur():scope.$apply((function(){scope.$parent.nbTextChanged=elm[0].nbOldValue!==curValue;ngModel.$setViewValue(curValue);$timeout((function(){ngModel.$setViewValue(curValue);scope.$eval(attrs.nbOnUpdateDirective,scope.$parent)}),101)}))}}));elm.bind("keyup",(function(e){if(elm.nbEleTm){clearTimeout(elm.nbEleTm);elm.nbEleTm=null}elm.nbEleTm=setTimeout((function(){if(13===e.keyCode){var curValue=$(elm[0]).text();if(0===(curValue=curValue.trim()).length){elm[0].innerHTML=elm[0].nbOldValue;elm[0].focus()}else elm[0].blur()}}),500)}));attrs.$observe("contenteditable",(function(newValue){"true"===newValue?$timeout((function(){elm[0].nbOldValue=$(elm[0]).text();elm[0].nbOldValue=elm[0].nbOldValue.trim();var range=document.createRange();range.selectNodeContents(elm[0]);var sel=window.getSelection();if(range.toString()!==sel.toString()){sel.removeAllRanges();sel.addRange(range)}}),1):"false"===newValue&&$timeout((function(){elm[0].nbOldValue=""}),1)}))}}}}]).directive("nbOnUpdateTextDirective",["$timeout",function($timeout){return{restrict:"A",replace:!1,transclude:!1,link:function(scope,elm,attrs){elm.bind("blur",(function(){var curValue=$(elm[0]).val();curValue=curValue.trim();$timeout((function(){elm[0].nbOldValue&&(elm[0].nbOldValue=elm[0].nbOldValue.replace(/[\\\/\:\*\?”\<\>\|\$]/g,""));scope.$parent.nbTextChanged=elm[0].nbOldValue!==curValue;scope.$parent.nbOldValue=elm[0].nbOldValue;scope.$eval(attrs.nbOnUpdateTextDirective,scope.$parent)}))}));elm.bind("focus",(function(){elm[0].nbOldValue=$(elm[0]).val()}))}}}]);angular.module("nb.common").directive("nbClearButton",(function(){return{require:["ngModel"],restrict:"E",transclude:!0,replace:!0,scope:{},link:function(scope,element,attrs,ctrls){scope.ngModel=ctrls[0]},controller:function($scope){$scope.clear=function(){$scope.ngModel.$setViewValue("")}},templateUrl:"controls/nb-clear-button/nb-clear-button.tpl.html"}}));angular.module("nb.common").directive("nbFilterBar",(function(){return{restrict:"E",transclude:!0,scope:{placeholder:"@"},require:["ngModel"],templateUrl:"controls/nb-filter-bar/nb-filter-bar.tpl.html",replace:!0,link:function(scope,element,attrs,ctrls){scope.ngModel=ctrls[0];scope.inputValue=scope.ngModel.$modelValue;scope.$watch((function(){return scope.ngModel.$modelValue}),(function(){scope.inputValue=scope.ngModel.$modelValue}));scope.$watch((function(){return scope.inputValue}),(function(){scope.ngModel.$setViewValue(scope.inputValue)}));scope.clear=function(){scope.inputValue=""}},controller:function(){}}}));angular.module("nb.common").directive("nbSearchBar",(function(){return{restrict:"E",transclude:!0,scope:{placeholder:"@",onClear:"&",onSearch:"&"},require:["ngModel"],templateUrl:"controls/nb-search-bar/nb-search-bar.tpl.html",replace:!0,link:function(scope,element,attrs,ctrls){scope.ngModel=ctrls[0];scope.inputValue=scope.ngModel.$modelValue;scope.$watch((function(){return scope.ngModel.$modelValue}),(function(){scope.inputValue=scope.ngModel.$modelValue}));scope.$watch((function(){return scope.inputValue}),(function(){scope.ngModel.$setViewValue(scope.inputValue)}))},controller:function(){}}}));!function(){angular.module("nb.common").directive("nbTreeviewDirective",NbTreeviewDirective);NbTreeviewDirective.$inject=["$compile","$timeout","$document","$sce","$q","$log","ivhTreeviewMgr","ivhTreeviewBfs"];function NbTreeviewDirective($compile,$timeout,$document,$sce,$q,$log,ivhTreeviewMgr,ivhTreeviewBfs){var directive={restrict:"A",scope:{data:"=nbTreeviewDirective",options:"=",atag:"@"},replace:!0,templateUrl:"modules/nbCommon/views/nbTreeviewDirective.html",controller:Controller,controllerAs:"nbTreeview",bindToController:!0,compile:function(){return{pre:function(scope,ele,attr){var self=scope.nbTreeview;scope.$on("$destroy",(function(){self.treeviewOptions=null;self=null;scope=null}));scope.isWatchData=null!=attr.watchData;self.treeviewOptions=function(userOptions){userOptions.showNodeNum=userOptions.showNodeNum||0;userOptions.nodeTitle=userOptions.nodeTitle||void 0;var nodeTpl=0===userOptions.showNodeNum?"<nb-treeview-node-tpl></nb-treeview-node-tpl>":"<nb-treeview-node-tpl-extend></nb-treeview-node-tpl-extend>";userOptions.nodeTpl=userOptions.nodeTpl||nodeTpl;userOptions.labelTemplate="function"==typeof userOptions.labelTemplate?userOptions.labelTemplate:void 0;userOptions.iconTemplate="function"==typeof userOptions.iconTemplate?userOptions.iconTemplate:void 0;userOptions.checkTreeNodeVisible=userOptions.checkTreeNodeVisible||void 0;userOptions.defaultSelectedState=userOptions.defaultSelectedState||!1;userOptions.enableMultipleSelect=_.isFunction(userOptions.enableMultipleSelect)?userOptions.enableMultipleSelect:!0===userOptions.enableMultipleSelect;userOptions.enableAutoSelect=!1!==userOptions.enableAutoSelect;userOptions.enableLabelExpand=!1!==userOptions.enableLabelExpand;userOptions.isDraggable=!0===userOptions.isDraggable;userOptions.enableTwoWayBinding=!0===userOptions.enableTwoWayBinding;userOptions.enableNodeDropdown=_.isObject(userOptions.enableNodeDropdown)?userOptions.enableNodeDropdown:void 0;userOptions.enableSearchBar=_.isObject(userOptions.enableSearchBar)?userOptions.enableSearchBar:void 0;userOptions.enableLocationBar=!0===userOptions.enableLocationBar;userOptions.enableUnselected=!1!==userOptions.enableUnselected;userOptions.expandToDepth=_.isNumber(userOptions.expandToDepth)?userOptions.expandToDepth:1;userOptions.idAttribute=userOptions.idAttribute||"ID";userOptions.labelAttribute=userOptions.labelAttribute||"label";userOptions.locationLabelAttribute=userOptions.locationLabelAttribute||userOptions.labelAttribute;userOptions.selectedAttribute=userOptions.selectedAttribute||"selected";userOptions.childrenAttribute=userOptions.childrenAttribute||"children";userOptions.lazyLoadingAttribute=userOptions.lazyLoadingAttribute||void 0;userOptions.editableAttribute=userOptions.editableAttribute||"editable";userOptions.indeterminateAttribute=userOptions.indeterminateAttribute||"__ivhTreeviewIndeterminate";userOptions.expandedAttribute=userOptions.expandedAttribute||"__ivhTreeviewExpanded";userOptions.labelTitleAttribute=userOptions.labelTitleAttribute||"label";userOptions.disableCheckboxAttribute=userOptions.disableCheckboxAttribute||"disableCheckbox";userOptions.nodeClickCallback=_.isFunction(userOptions.nodeClickCallback)?userOptions.nodeClickCallback:void 0;userOptions.lazyLoadingCallback=_.isFunction(userOptions.lazyLoadingCallback)?userOptions.lazyLoadingCallback:void 0;userOptions.editableCallback=_.isFunction(userOptions.editableCallback)?userOptions.editableCallback:void 0;return userOptions}(self.options);self.options.checkboxChanged&&(self.checkboxChanged=self.options.checkboxChanged);if(self.treeviewOptions.enableNodeDropdown){self.dropdownItems=[];var template="<ul "+(self.atag?'atag = "'+self.atag+'"':"")+' id="nb-treeview-dropdown-'+scope.$id+'" class="dropdown-menu nb-treeview-dropdown '+self.options.className+'-menu"><li ng-click="nbTreeview.callDropdownAction(item, $event)" ng-repeat="item in nbTreeview.dropdownItems" ng-class="item.class"><a showDropDown="{{item.showDropDown}}" ng-bind-html="::nbTreeview.renderTemplate(item.template)"></a></li></ul>';var dropdownEle=$compile(template)(scope);angular.element(document.body).append(dropdownEle);ele.on("scroll",(function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))}));$document.bind("click",handleClickEvent);$document.bind("contextmenu",handleClickEvent);scope.$on("$destroy",(function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))}))}self.treeviewOptions.enableSearchBar&&"submit"===self.treeviewOptions.enableSearchBar.method&&$(ele).on("keypress",".search-bar input",(function(event){13===event.keyCode&&"submit"===self.treeviewOptions.enableSearchBar.method&&"function"==typeof self.treeviewOptions.enableSearchBar.action&&$timeout((function(){self.searchTree(event.target.value)}))}));_.isFunction(self.treeviewOptions.editableCallback)&&$(ele).on("keypress",(function(event){var target=$(event.target);var c=event.keyCode;!target.hasClass("node-label-editable")||13!==c&&27!==c||$timeout((function(){var scope2=angular.element(target).scope();var promise=self.treeviewOptions.editableCallback(scope2.node,scope2.trvw,target[0].value.trim(),event);function docAfterEnterClickHandler(event2){!$(event2.target).is(target[0])&&_.isFunction(self.treeviewOptions.editableCallback)&&$timeout((function(){var promise2=self.treeviewOptions.editableCallback(scope2.node,scope2.trvw,target[0].value.trim(),event);promise2&&promise2.then&&promise2.then((function(result2){if(!result2){var scope3=angular.element(target).scope();target.val(scope3.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}}),(function(){var scope4=angular.element(target).scope();target.val(scope4.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}))}))}if(promise&&_.isFunction(promise.then)){$(document.body).off("click.nbTreeDocClickHandler");promise.then((function(result){if(result)$(document.body).off("click.nbTreeDocClickHandler");else{target.val(scope2.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}}),(function(reason){var scope=angular.element(target).scope();scope&&target.val(scope.node[self.treeviewOptions.labelAttribute]);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}))}else $(document.body).off("click.nbTreeDocClickHandler")}))}))},post:function(scope,ele){var self=scope.nbTreeview;self.treeviewOptions.enableSearchBar&&self.treeviewOptions.enableSearchBar.icon&&setTimeout((function(){ele.find(".search-bar .nb-filter-bar .icons span").removeClass().addClass(self.treeviewOptions.enableSearchBar.icon)}))}}}},MENU_OPEN=!1,SCOPE_ID="",CURRENT_ACTION_BTN=null,CURRENT_NODE_OBJ=null;Controller.$inject=["$scope","$element"];function Controller($scope,$element){var self=this;self.query="";self.locationquery="";self.trvw=null;self.searchResults=[];self.countTotal=0;self.countIndex=0;self.locationpreviousquery="";self.matchNodes=[];self.refreshDropdownItems=function(node,trvw){var dropdownFn=$scope.nbTreeview.treeviewOptions.enableNodeDropdown.dropdownItems;_.isFunction(dropdownFn)&&($scope.nbTreeview.dropdownItems=dropdownFn(node,trvw))};var finded;var mached=!1;var parents=[];self.isTreeItemVisible=function(node,trvw){if(node.isFieldset||node.isEvent)return!1;!$scope.nbTreeview.options.expandFirstChildNode||finded&&mached||function(node){finded||(finded=function findFirstdata(node){node.ID&&parents.push({id:node.ID,name:node.name});if(0===node.nodeType){var result=_.find(node.child,{nodeType:1});if(result)return result;var folders=_.where(node.child,{nodeType:0});for(var i=0;i<folders.length;i++){var r=findFirstdata(folders[i]);if(r){folders[i].ID&&parents.push({id:folders[i].ID,name:folders[i].name});return r}}return null}return node}(node));if(finded&&!mached&&node&&node.child){node.ID&&node.name&&_.find(parents,{id:node.ID,name:node.name})&&(node.expanded=!0);for(var i=0;i<node.child.length;i++){var child=node.child[i];if(finded.nodeType===child.nodeType&&finded.name===child.name&&finded.description===child.description&&finded.childNumber===child.childNumber){mached=!0;break}}}}(node);return"function"==typeof self.treeviewOptions.checkTreeNodeVisible?self.treeviewOptions.checkTreeNodeVisible(node,trvw):"boolean"!=typeof self.treeviewOptions.checkTreeNodeVisible||self.treeviewOptions.checkTreeNodeVisible};$scope.$on("$destroy",(function(){directive=null;$scope.nbTreeview=null;finded=null;self.data=null;self.options=null;parents=null;CURRENT_ACTION_BTN=null;CURRENT_NODE_OBJ=null}));self.clearLocation=function(){ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);self.locationpreviousquery=null;self.trvw.locationQuery=self.locationpreviousquery};self.callDropdownAction=function(item,event){"function"==typeof item.action&&item.action(CURRENT_NODE_OBJ,self.trvw,event)};self.collectionAllNode=function(treeData,queryText){if(treeData.length>0)for(var i=0;i<treeData.length;i++){if(-1!==treeData[i][self.treeviewOptions.locationLabelAttribute].toLowerCase().indexOf(queryText.toLowerCase())){treeData[i][self.treeviewOptions.expandedAttribute]=!0;self.matchNodes.push(treeData[i]);ExpandAllParentNodeByLocationAttribute(treeData[i][self.treeviewOptions.locationLabelAttribute])}treeData[i].children&&treeData[i].children.length>0&&self.collectionAllNode(treeData[i].children,queryText)}};var currentScrollInterval=null;self.findNextNode=function(queryText){currentScrollInterval&&clearInterval(currentScrollInterval);ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);_.isEmpty(queryText)?self.matchNodes=[]:self.countIndex===self.matchNodes.length?self.countIndex=1:self.countIndex++;if(!(0===self.matchNodes.length||self.countIndex<1)){ivhTreeviewMgr.expandTo(self.data,self.matchNodes[self.countIndex-1],self.treeviewOptions);self.matchNodes[self.countIndex-1].selected=!0;self.allMatchEle=$element.find(".ivh-treeview-node-label.node-label span:has('.filter-highlight')");var currentEle=self.allMatchEle[self.countIndex-1];currentEle?currentEle.scrollIntoView(!1):currentScrollInterval=setInterval((function(){self.allMatchEle=$element.find(".ivh-treeview-node-label.node-label span:has('.filter-highlight')");var currentEle=self.allMatchEle[self.countIndex-1];if(currentEle){currentEle.scrollIntoView(!1);clearInterval(currentScrollInterval);currentScrollInterval=null}}),100)}};$scope.$on("tabSwitchSearchEmpty",(function(){self.locationpreviousquery="";self.trvw.locationQuery="";self.locationquery="";self.countTotal=""}));self.locationNode=function(event,queryText){if(13===event.keyCode)if(self.locationpreviousquery!==queryText){self.matchNodes=[];self.collectionAllNode(self.data,queryText);self.countTotal=self.matchNodes.length;self.DuplicateNodeCount=0;if(self.countTotal>0){self.locationpreviousquery=queryText;self.trvw.locationQuery=self.locationpreviousquery;self.countIndex=0;$timeout((function(){var _len=self.matchNodes.length>15?15:self.matchNodes.length;for(var k=0;k<_len;k++)ivhTreeviewMgr.expandTo(self.data,self.matchNodes[k],self.treeviewOptions);$timeout((function(){self.findNextNode(queryText)}))}))}else self.clearLocation()}else{self.findNextNode(queryText);self.locationpreviousquery=queryText;self.trvw.locationQuery=self.locationpreviousquery}};function ExpandAllParentNodeByLocationAttribute(LocationAttribute){LocationAttribute&&ivhTreeviewBfs(self.data,{childrenAttribute:"children"},(function(n,prs){n[self.treeviewOptions.locationLabelAttribute]===LocationAttribute&&angular.forEach(prs,(function(p){p[self.treeviewOptions.expandedAttribute]=!0}))}))}self.searchQueryChange=function(){"watch"===self.treeviewOptions.enableSearchBar.method&&"function"==typeof self.treeviewOptions.enableSearchBar.action&&self.searchTree(self.query);""===self.query&&$timeout((function(){!function(){self.query="";self.searchResults=[]}()}))};self.showEditable=function(node){return!!node[self.treeviewOptions.editableAttribute]};self.getTemplateLabel=function(node,trvw,isPlain){var customLabel=self.treeviewOptions.labelTemplate,label=self.treeviewOptions.labelAttribute;node[label]||(label="name");if(isPlain)return trvw.label(node);var node_clone=angular.copy(node);node[label]&&(node_clone[label]=Utility.htmlEncodeByRegExp(node[label]));return customLabel?$sce.trustAs("html",customLabel(node_clone,trvw,$scope)):$sce.trustAs("html",trvw.label(node_clone))};self.searchTree=function(queryText){var promise=self.treeviewOptions.enableSearchBar.action;_.isFunction(promise)&&$q.when(promise(queryText)).then((function(results){self.searchResults=results}),(function(){$log.error("failed to search nb treeview")}))};self.getTemplateIcon=function(node,trvw){var customIcon=self.treeviewOptions.iconTemplate;return customIcon?$sce.trustAs("html",customIcon(node,trvw)):null};self.getLabelTitle=function(node){return node[self.treeviewOptions.labelTitleAttribute]};self.showCheckBox=function(node,trvw){return _.isFunction(self.treeviewOptions.enableMultipleSelect)?self.treeviewOptions.enableMultipleSelect(node,trvw):self.treeviewOptions.enableMultipleSelect};self.showToggleArrow=function(node,trvw){if(!trvw.isLeaf(node)){var children=node[self.treeviewOptions.childrenAttribute]||[];var isVisible=!0;for(var i=0;i<children.length&&!(isVisible=_.isFunction(self.treeviewOptions.checkTreeNodeVisible)?self.treeviewOptions.checkTreeNodeVisible(children[i],trvw):!_.isBoolean(self.treeviewOptions.checkTreeNodeVisible)||self.treeviewOptions.checkTreeNodeVisible);i++);return isVisible}if(self.treeviewOptions.lazyLoadingAttribute){var flag=self.treeviewOptions.lazyLoadingAttribute;return _.isString(flag)?node[flag]:!!_.isFunction(flag)&&!0===flag(node,trvw)}return!1};self.selectNode=function(node,trvw,event,overwrite){node[self.treeviewOptions.selectedAttribute]=void 0!==overwrite?overwrite:!self.treeviewOptions.enableUnselect||!node[self.treeviewOptions.selectedAttribute];node&&$scope.$emit("nbFolderTreeview.folderSelected",node);if($(event.target).hasClass("node-label-editable"))event.stopPropagation();else{var isMultiple=self.showCheckBox(node,trvw);var callback=self.treeviewOptions.nodeClickCallback;var pre=node[self.treeviewOptions.selectedAttribute];if(isMultiple)if(self.treeviewOptions.enableAutoSelect)trvw.select(node,pre);else if(isMultiple){var checked=!1;var checkbox=$(event.target).closest(".ivh-node-row").find(".node-checkbox input");checkbox.length>0&&(checked=!checkbox[0].checked);node[self.treeviewOptions.selectedAttribute]=checked}else trvw.select(node,pre);else{try{ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions)}catch(e){}nbTreeSelect(self.data,node,self.treeviewOptions,pre)}(callback||angular.noop)(node,trvw,event);$scope.isWatchData&&$scope.$emit("nbTreeview.nodeSelected");self.treeviewOptions.enableLabelExpand&&self.toggleNode(node,trvw,event,!0)}};self.dblclickNode=function(node,trvw,event){var callback=self.treeviewOptions.nodeDblClickCallback;callback&&callback(node,trvw,event)};self.dragNodeStart=function(dragScope,event){self.options.onDragStart&&self.options.onDragStart(dragScope.$parent.node,event)};self.selectFilteredNode=function(node,trvw){var isMultiple=self.showCheckBox(node,trvw);var callback=self.treeviewOptions.nodeClickCallback;var pre=node[self.treeviewOptions.selectedAttribute];if(isMultiple)trvw.select(node,!pre);else{ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);nbTreeSelect(self.data,node,self.treeviewOptions,!pre)}(callback||angular.noop)(node,trvw)};self.toggleNode=function(node,trvw,event,isPropagation){isPropagation||event.stopPropagation();if(self.treeviewOptions.lazyLoadingAttribute&&!node.loaded){var flagProp=self.treeviewOptions.lazyLoadingAttribute;(_.isString(flagProp)?node[flagProp]:!!_.isFunction(flagProp)&&flagProp(node,trvw))&&self.treeviewOptions.lazyLoadingCallback?$q.when(self.treeviewOptions.lazyLoadingCallback(node,trvw)).then((function(){trvw.toggleExpanded(node)})):trvw.toggleExpanded(node)}else{var expanded=trvw.isExpanded(node);var showNodeNum=self.treeviewOptions.showNodeNum;self.loadNum=100;if(0===showNodeNum&&!expanded&&node.children&&node.children.length>self.loadNum){self.allNodes=node.children;node.children=[];self.nodeArray=node.children;self.loadLargeTreeNode()}trvw.toggleExpanded(node)}};self.loadLargeTreeNode=function(){var nodeArray=self.nodeArray;var allNodes=self.allNodes;var loadNum=self.loadNum;self.shiftFixArrayElement(nodeArray,allNodes,loadNum);allNodes.length>0&&(allNodes.length>loadNum?$timeout(self.loadLargeTreeNode,100):self.shiftFixArrayElement(nodeArray,allNodes,allNodes.length))};self.shiftFixArrayElement=function(pushArray,shiftArray,shiftNum){for(var i=0;i<shiftNum;i++)pushArray.push(shiftArray.shift())};self.checkboxChanged=function(node,trvw,event){event.stopPropagation();self.treeviewOptions.enableAutoSelect?trvw.select(node,event.target.checked):node[self.treeviewOptions.selectedAttribute]=event.target.checked;(self.treeviewOptions.nodeClickCallback||angular.noop)(node,trvw,event);$scope.isWatchData&&$scope.$emit("nbTreeview.nodeSelected")};self.isDisplayDropdown=function(node,trvw){var isDisplay=self.treeviewOptions.enableNodeDropdown?self.treeviewOptions.enableNodeDropdown.isDisplay:void 0;return"function"==typeof isDisplay?isDisplay(node,trvw):"boolean"==typeof isDisplay&&isDisplay};self.openDropdown=function(node,event,trvw){event.preventDefault();node.dropTree||node.contextCreateMode||$(document.body).click();if(2!==event.button||self.isDisplayDropdown(node,trvw)){event.stopPropagation();$(event.target).is(CURRENT_ACTION_BTN)?$timeout((function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))})):$timeout((function(){$(CURRENT_ACTION_BTN).closest(".ivh-node-row").removeClass("dropdown-active");var targetNodeRow=$(event.target).closest(".ivh-node-row");targetNodeRow.addClass("dropdown-active");self.refreshDropdownItems(node,trvw);CURRENT_ACTION_BTN=targetNodeRow[0];CURRENT_NODE_OBJ=node;SCOPE_ID=$scope.$id;$timeout((function(){var menuEle=angular.element(document.querySelector("#nb-treeview-dropdown-"+SCOPE_ID));!function(event,actionMenuEle){actionMenuEle.css({display:"block"});var targetLeft=$(event.target).offset().left;var targetTop=$(event.target).offset().top;var doc=$document[0].documentElement;var docLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),docTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elementWidth=actionMenuEle[0].scrollWidth,elementHeight=actionMenuEle[0].scrollHeight;if(2===event.button){targetLeft=event.clientX+elementWidth;targetTop=event.clientY}var heightCha=0;if($(event.target).hasClass("node-dropdown-arrow")||$(event.target).hasClass("icon_nb_action_menu")){heightCha=20;targetLeft=$(event.target).closest(".node-dropdown-arrow").offset().left+3;targetTop=$(event.target).closest(".node-dropdown-arrow").offset().top}var docWidth=doc.clientWidth+docLeft,docHeight=doc.clientHeight+docTop,totalWidth=elementWidth+targetLeft,totalHeight=elementHeight+targetTop+heightCha,left=Math.max(targetLeft-docLeft-elementWidth,0),top=Math.max(targetTop-docTop+heightCha,0);totalWidth>docWidth&&(left-=totalWidth-docWidth);totalHeight>docHeight&&(top=top-elementHeight-heightCha);actionMenuEle.css("top",top+"px");actionMenuEle.css("left",left+"px");MENU_OPEN=!0}(event,menuEle)}))}))}};self.renderTemplate=function(template){return $sce.trustAs("html",template)};self.initEditableContent=function(node,trvw,divEle){divEle[0].value=self.getTemplateLabel(node,trvw,!0);$timeout((function(){divEle.select();$(document.body).one("click.nbTreeDocClickHandler",docClickHandler)}));function docClickHandler(event){!$(event.target).is(divEle[0])&&_.isFunction(self.treeviewOptions.editableCallback)&&$timeout((function(){var scope=angular.element(divEle).scope();if(scope){var promise=self.treeviewOptions.editableCallback(node,trvw,divEle[0].value.trim(),event);promise&&promise.then&&promise.then((function(result){if(!result){divEle.val(scope.node[self.treeviewOptions.labelAttribute]);$timeout((function(){divEle.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docClickHandler)}))}}),(function(){divEle.val(scope.node[self.treeviewOptions.labelAttribute]);$timeout((function(){divEle.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docClickHandler)}))}))}}))}};function nbTreeSelect(tree,node,opts,isSelected){var ng=angular;if(arguments.length>2&&"boolean"==typeof opts){isSelected=opts;opts={}}opts=ng.extend({},opts);((isSelected=!ng.isDefined(isSelected)||isSelected)?function(node2){node2[this.selectedAttribute]=!0;node2[this.indeterminateAttribute]=!1}.bind(opts):function(node2){node2[this.selectedAttribute]=!1;node2[this.indeterminateAttribute]=!1}.bind(opts))(node)}}function close(actionMenuEle){actionMenuEle.css({display:"none"});$(CURRENT_ACTION_BTN).closest(".ivh-node-row").removeClass("dropdown-active");MENU_OPEN=!1;CURRENT_ACTION_BTN=null;CURRENT_NODE_OBJ=null}function handleClickEvent(event){$timeout((function(){var actionMenuEle=$("#nb-treeview-dropdown-"+SCOPE_ID);MENU_OPEN&&!$(event.target).is(CURRENT_ACTION_BTN)&&close(actionMenuEle);actionMenuEle=null}))}return directive}}(NetBrain);!function(){angular.module("nb.common").directive("nbTreeview",nbTreeview);nbTreeview.$inject=["$compile","$timeout","$document","$sce","$q","$log"];function nbTreeview($compile,$timeout,$document,$sce,$q,$log){var directive={restrict:"A",scope:{data:"=nbTreeview",options:"=",atag:"@"},replace:!1,controller:Controller};Controller.$inject=["$scope","$element"];function initOptions(userOptions){userOptions.idAttribute=userOptions.idAttribute||"id";userOptions.labelAttribute=userOptions.labelAttribute||"label";userOptions.childrenAttribute=userOptions.childrenAttribute||"children";userOptions.selectedAttribute=userOptions.selectedAttribute||"selected";userOptions.expandToDepth=userOptions.expandToDepth||0;!1===userOptions.selectable?userOptions.selectable=!1:userOptions.selectable=!0;userOptions.treeObj={};return userOptions}function Controller($scope,$element){var self=this,options=initOptions($scope.options),$event=null,isClickCallback=null;var tree=new InfiniteTree({el:$element[0],data:$scope.data,layout:"div",idAttribute:options.idAttribute,droppable:{isDraggable:function(node){return"function"==typeof options.isDraggable?options.isDraggable(node):options.isDraggable},accept:function(event,option){var node=conversionNode(option.node);options.onDragStart(node[0],event);return!0}},childrenAttribute:options.childrenAttribute,expandToDepth:options.expandToDepth,selectable:options.selectable,noDataText:" ",rowRenderer:defaultRenderer,shouldSelectNode:function(node){if($event&&($($event.target).is(".icon_nb_tree_collapse")||$($event.target).is(".icon_nb_tree_expand")||$($event.target).is(".infinite-tree-toggler")))return!1;if(isClickCallback==node[options.idAttribute]){isClickCallback=null;return!0}if(options.dropdownTree&&options.useCheckboxes){tree.checkNode(node);options.checkedCallBack&&options.checkedCallBack(node);return!1}options.nodeClickCallback&&options.nodeClickCallback(node,$event);return!node.state.selected},loadNodes:function(parentNode,next){options.lazyLoadingCallback(parentNode).then((function(data){var selectedId=null;if(parentNode.children.length>0){selectedId=parentNode.children[0][options.idAttribute];options.treeObj.removeNodeById(selectedId)}next(null,data,(function(){options.useCheckboxes&&parentNode.state.checked&&tree.checkNode(parentNode,!0);selectedId&&options.treeObj.selectNode(selectedId)}))}))}});$element.bind("contextmenu",(function(event){removeActionMenu();var tree_item=$(event.target).closest(".infinite-tree-item"),node_id=tree_item.attr("data-id");if(tree_item&&node_id){showActionMenu(tree.getNodeById(node_id),tree_item.find(".icon_nb_action_menu")[0],event.pageX)}}));$element.on("mouseover",(function(event){var tree_item=$(event.target).closest(".infinite-tree-item"),node_id=tree_item.attr("data-id");if(tree_item&&node_id){var treeScroll=$element.find(".infinite-tree-scroll"),treeContent=$element.find(".infinite-tree-content");if(treeContent.width()-treeScroll.width()>0){var right=treeContent.width()-treeScroll.width()-treeScroll.scrollLeft()+8+"px";tree_item.find(".infinite-tree-dropdown-arrow").css("right",right)}}}));tree.on("click",(function(event){$event=event;if($(event.target).is(".icon_nb_action_menu")||$(event.target).is(".infinite-tree-dropdown-arrow")){var node_id=$(event.target).closest(".infinite-tree-item").attr("data-id");showActionMenu(node=tree.getNodeById(node_id),event.target);event.stopPropagation()}else if($(event.target).is(".checkbox")){node_id=$(event.target).closest(".infinite-tree-item").attr("data-id");var node=tree.getNodeById(node_id);tree.checkNode(node);options.checkedCallBack&&options.checkedCallBack(node);event.stopPropagation()}}));tree.on("clusterDidChange",(function(){updateCheckboxState()}));tree.on("doubleClick",(function(event){var tree_item=$(event.target).closest(".infinite-tree-item"),node_id=tree_item.attr("data-id");if(tree_item&&node_id&&options.nodeDblClickCallback){var node=tree.getNodeById(node_id);options.nodeDblClickCallback(node)}event.stopPropagation()}));options.treeObj.updateTree=function(callback){setTimeout((function(){tree.getRootNode();tree.loadData($scope.data);callback&&callback()}),0)};options.treeObj.scrollTop=function(index){tree.scrollTop(index)};options.treeObj.getNodeById=function(id){return tree.getNodeById(id)};options.treeObj.openNodeById=function(id){var node=tree.getNodeById(id);tree.openNode(node)};options.treeObj.removeNodeById=function(id){var node=tree.getNodeById(id);tree.removeNode(node)};options.treeObj.removeAllNodes=function(){var rootNode=tree.getRootNode();tree.removeChildNodes(rootNode)};options.treeObj.moveNodeToById=function(nodeId,parentNodeId,index){var node=tree.getNodeById(nodeId),parentNode=tree.getNodeById(parentNodeId);tree.moveNodeTo(node,parentNode)};options.treeObj.addNodes=function(newNodes,nodeId,index){var node=tree.getNodeById(nodeId);node.state.open||tree.openNode(node);null==index&&(index=node[options.childrenAttribute].length);Array.isArray(newNodes)||(newNodes=[newNodes]);tree.addChildNodes(newNodes,index,node)};options.treeObj.clear=function(){tree.clear()};options.treeObj.selectNode=function(id,noScroll,noClickCallback){var node=tree.getNodeById(id);noScroll||tree.scrollToNode(node);noClickCallback||(isClickCallback=id);node.state.selected||tree.selectNode(node)};options.treeObj.scrollToNode=function(id){var node=tree.getNodeById(id);tree.scrollToNode(node)};options.treeObj.updateNode=function(id,data){var node=tree.getNodeById(id);node&&tree.updateNode(node,data)};options.treeObj.filter=function(predicate,option){option||(option={});tree.filter(predicate,option)};options.treeObj.unfilter=function(){tree.unfilter()};options.treeObj.getCheckedNodes=function(callback,bAllNode,filterCallback){checkedNodes=[];var params={data:conversionNode(tree.getRootNode()[options.childrenAttribute]),childrenAttr:options.childrenAttribute,idAttr:options.idAttribute,labelAttr:options.labelAttribute,bAllNode:bAllNode},worker=getCheckWorker();filterCallback&&(params.filterCallback=filterCallback.toString());worker.addEventListener("message",(function(e){callback(e.data.checkedNodes,e.data.checkedID,e.data.checkedLabel);worker.terminate()}),!1);worker.postMessage(params)};options.treeObj.checkAllNodes=function(isChecked){checkAllNodes(tree.getRootNode()[options.childrenAttribute],isChecked)};options.treeObj.checkedNodesById=function(ids,callback){checkedNodes=[];var params={data:$scope.data,ids:ids,childrenAttr:options.childrenAttribute,idAttr:options.idAttribute,labelAttr:options.labelAttribute},worker=checkNodesWorker();worker.addEventListener("message",(function(e){var param=e.data;tree.loadData(param.data);callback&&callback(param.checkedNodes,param.checkedLabels);worker.terminate()}),!1);worker.postMessage(params)};options.treeObj.expandToNodeById=function(nodeId,callback){expandToNode(tree.getNodeById(nodeId),callback)};options.treeObj.getAllNodes=function(){return tree.getRootNode()[options.childrenAttribute]};options.treeObj.conversionNode=function(node){return conversionNode(node)};function conversionNode(node){return JSON.parse(tree.toString(node))}function expandToNode(node,callback){var parentNode=node.parent;if(!parentNode.state.open&&parentNode[options.idAttribute]){tree.openNode(parentNode);setTimeout((function(){expandToNode(parentNode,callback)}),0)}else callback&&callback()}function getScriptPath(foo){return window.URL.createObjectURL(new Blob([foo.toString().match(/^\s*function\s*\(\s*\)\s*\{(([\s\S](?!\}$))*[\s\S])/)[1]],{type:"text/javascript"}))}function checkNodesWorker(){return new Worker(getScriptPath((function(){self.checkedNodesArr=[];self.checkedLabels=[];self.addEventListener("message",(function(e){var params=e.data;self.data=params.data;self.childrenAttr=params.childrenAttr;self.ids={};self.idAttr=params.idAttr;self.labelAttr=params.labelAttr;var ids=params.ids;for(var i=0;i<ids.length;i++)self.ids[ids[i]]=1;!function checkedNodes(data,parentNode,checked){var checkedCount=0,indeterminate=!1;for(var i=0;i<data.length;i++){var node=data[i];node.state||(node.state={});if(self.ids[node[self.idAttr]]){self.checkedNodesArr.push(node);self.checkedLabels.push(node[self.labelAttr])}if(self.ids[node[self.idAttr]]||checked){node.state.checked=!0;node.state.indeterminate=!1;node[self.childrenAttr]&&node[self.childrenAttr].length>0&&checkedNodes(node[self.childrenAttr],node,!0);checkedCount++}else if(node[self.childrenAttr]&&node[self.childrenAttr].length>0){var checkedBolean=checkedNodes(node[self.childrenAttr],node);if(checkedBolean){checkedCount++;"indeterminate"===checkedBolean&&(indeterminate=!0)}}}if(parentNode){if(0!==checkedCount){if(checkedCount>0&&checkedCount<data.length||indeterminate){parentNode.state.indeterminate=!0;parentNode.state.checked=!0;return"indeterminate"}parentNode.state.indeterminate=!1;parentNode.state.checked=!0;return!0}parentNode.state.indeterminate=!1;parentNode.state.checked=!1}return!1}(self.data);self.postMessage({data:self.data,checkedNodes:self.checkedNodesArr,checkedLabels:self.checkedLabels})}),!1)})))}function getCheckWorker(){var worker=new Worker(getScriptPath((function(){function pushCheckedNodes(node,filterCallback){if(self.filterCallback){if(self.filterCallback(node)){self.backdata.checkedLabel.push(node[self.labelAttr]);self.backdata.checkedID.push(node[self.idAttr]);self.backdata.checkedNodes.push(node)}}else{self.backdata.checkedLabel.push(node[self.labelAttr]);self.backdata.checkedID.push(node[self.idAttr]);self.backdata.checkedNodes.push(node)}}function getCheckedNodes(group,filterCallback){for(var i=0;i<group.length;i++){!0===group[i].state.checked&&!0!==group[i].state.indeterminate&&pushCheckedNodes(group[i],filterCallback);group[i][self.childrenAttr]&&group[i][self.childrenAttr].length>0&&((!self.bAllNode||!0!==group[i].state.checked&&!0!==group[i].state.indeterminate)&&(self.bAllNode||!0!==group[i].state.indeterminate)||getCheckedNodes(group[i][self.childrenAttr]))}}self.addEventListener("message",(function(e){var params=e.data,data=params.data;self.backdata={checkedLabel:[],checkedID:[],checkedNodes:[]};self.childrenAttr=params.childrenAttr;self.bAllNode=params.bAllNode;self.idAttr=params.idAttr;self.labelAttr=params.labelAttr;params.filterCallback&&eval("self.filterCallback="+params.filterCallback);getCheckedNodes(data);self.postMessage(self.backdata);self.backdata=null}),!1)})));return worker}function group(data){var result=[];var groupItem;for(var i=0;i<data.length;i++){if(i%500==0){null!=groupItem&&result.push(groupItem);groupItem=[]}groupItem.push(data[i])}result.push(groupItem);return result}var checkedTimeout=null;function checkAllNodes(nodes,isChecked,callback){checkedTimeout&&clearTimeout(checkedTimeout);if(nodes&&nodes.length>0){var groups=group(nodes);for(var i=0;i<groups.length;i++)window.setTimeout(function(){var group=groups[i];return function(){checkNodes(group,isChecked)}}(),1)}callback&&(checkedTimeout=setTimeout((function(){callback()}),500))}function checkNodes(group,isChecked){for(var i=0;i<group.length;i++){var node=group[i];"string"==typeof node?(node=tree.getNodeById(node))&&tree.checkNode(node,isChecked):tree.checkNode(node,isChecked)}}function delHtmlTag(str){return str.replace(/<[^>]+>/g,"")}function defaultRenderer(node,treeOptions){var state=node.state,togglerClass=state.open?"icon_nb_tree_collapse":"icon_nb_tree_expand",marinLeft=15*state.depth,visible="hidden",selectClass=node.state.selected?"infinite-tree-selected":"",dropDownArrow="",labelWidth=$element.width()-40,iconTpl="",checkboxTpl="",draggable=treeOptions.droppable.isDraggable(node),nodeLabel=node[options.labelAttribute],nodeLabelTitle=nodeLabel;if(!1===node.state.filtered)return"";state.depth>4?labelWidth-=40:labelWidth-=marinLeft;node[options.childrenAttribute]&&node[options.childrenAttribute].length>0&&(visible="visible");if(options.lazyLoadingAttribute&&options.lazyLoadingAttribute(node)){visible="visible";node.loadOnDemand=!0}options.labelTemplate&&(nodeLabelTitle=delHtmlTag(nodeLabel=options.labelTemplate(node)));options.enableNodeDropdown&&options.enableNodeDropdown.isDisplay(node)&&(dropDownArrow='<span class="infinite-tree-dropdown-arrow"><i class="icon_nb_action_menu"></i></span>');node[options.selectedAttribute]&&setTimeout((function(){node[options.selectedAttribute]=!1;tree.selectNode(node)}),0);if(options.iconTemplate){var iconTemplate=options.iconTemplate(node);iconTemplate&&(iconTpl='<div class="infinite-tree-icon">'+iconTemplate+"</div>")}if(options.useCheckboxes){checkboxTpl='<input type="checkbox" '+(node.state.checked?"checked":"")+" "+(node.state.indeterminate?"data-indeterminate":"")+' style="display: inline-block; margin:6px 2px 0px 2px" class="checkbox">'}labelWidth<20?labelWidth="calc(100% - 80px);":labelWidth+="px";return['<div draggable="'+draggable+'" data-id="'+node[options.idAttribute]+'" atag="'+node[options.labelAttribute]+'" a-level="'+state.depth+'" class="infinite-tree-item '+selectClass+'" style="margin-left:'+marinLeft+'px">','   <a style="visibility:'+visible+'" class="infinite-tree-toggler">','       <i class="'+togglerClass+'"></i>',"   </a>",checkboxTpl,iconTpl,'   <span style="width:'+labelWidth+'" class="infinite-tree-title" title="'+nodeLabelTitle+'">'+nodeLabel+"</span>",dropDownArrow,"</div>"].join("\r\n")}function resetActionMenuPosition(element,ul,pageX){var targetTop=$(element).offset().top,$elementHeight=$(element).height(),top=targetTop+$elementHeight+2,left=$(element).offset().left-ul.width()-5;left<0&&(left=0);pageX&&(left=pageX);top+ul.height()>$(document.body).height()&&(top=targetTop-ul.height()-$elementHeight+5);ul.css({left:left+"px",top:top+"px",visibility:"visible"})}function showActionMenu(node,element,pageX){if(options.enableNodeDropdown){var items=[],ul=$("<ul>").addClass("infinite-action-menu");options.enableNodeDropdown.dropdownItems&&(items=options.enableNodeDropdown.dropdownItems(node));angular.forEach(items,(function(item){var li=$("<li>");item.class?li.addClass(item.class):li.click((function(event){$(".infinite-action-menu").remove();$element.find(".infinite-menu-select").removeClass("infinite-menu-select");event.stopPropagation();item.action(node)})).html(item.template);ul.append(li)}));if(items.length>0){$(element).closest(".infinite-tree-item").addClass("infinite-menu-select");$(document.body).append(ul);resetActionMenuPosition(element,ul,pageX)}}}function updateCheckboxState(){var checkboxes=tree.contentElement.querySelectorAll('input[type="checkbox"]');for(var i=0;i<checkboxes.length;++i){var checkbox=checkboxes[i];checkbox.hasAttribute("data-indeterminate")?checkbox.indeterminate=!0:checkbox.indeterminate=!1}}function removeActionMenu(){$(".infinite-action-menu").remove();$element.find(".infinite-menu-select").removeClass("infinite-menu-select")}function init(){$element.css("height","100%");$element.find(".infinite-tree-scroll").scroll((function(){$(".infinite-action-menu").length>0&&removeActionMenu()}));$("body").click((function(){removeActionMenu()}))}$scope.$on("$destroy",(function(){var node=tree.getSelectedNode();node&&node[options.idAttribute]&&(node.state.selected=!1);tree.clear()}));init()}return directive}}(NetBrain);!function(){angular.module("nb.common").directive("nbTreeviewDirectiveExtend",nbTreeviewDirectiveExtend);nbTreeviewDirectiveExtend.$inject=["$compile","$timeout","$document","$sce","$q","$log","ivhTreeviewMgr","ivhTreeviewBfs"];function nbTreeviewDirectiveExtend($compile,$timeout,$document,$sce,$q,$log,ivhTreeviewMgr,ivhTreeviewBfs){var directive={restrict:"A",scope:!0,replace:!0,templateUrl:"modules/nbCommon/views/nbTreeviewDirective.html",controller:Controller,controllerAs:"nbTreeview",bindToController:!0,compile:function(){return{pre:function(scope,ele,attr){scope.nbTreeview.data=scope.$parent.treeData||scope.$parent.$parent.sdnt.sdnDataTree;scope.nbTreeview.options=scope.$parent.treeOptions||scope.$parent.$parent.sdnt.ivhTreeOptions;var self=scope.nbTreeview;scope.$on("$destroy",(function(){self.treeviewOptions=null;scope.nbTreeview=null}));scope.isWatchData=null!=attr.watchData;self.treeviewOptions=function(userOptions){userOptions.showNodeNum=userOptions.showNodeNum||0;userOptions.nodeTitle=userOptions.nodeTitle||void 0;var nodeTpl=0===userOptions.showNodeNum?"<nb-treeview-node-tpl></nb-treeview-node-tpl>":"<nb-treeview-node-tpl-extend></nb-treeview-node-tpl-extend>";userOptions.nodeTpl=userOptions.nodeTpl||nodeTpl;userOptions.labelTemplate="function"==typeof userOptions.labelTemplate?userOptions.labelTemplate:void 0;userOptions.iconTemplate="function"==typeof userOptions.iconTemplate?userOptions.iconTemplate:void 0;userOptions.checkTreeNodeVisible=userOptions.checkTreeNodeVisible||void 0;userOptions.defaultSelectedState=userOptions.defaultSelectedState||!1;userOptions.enableMultipleSelect=_.isFunction(userOptions.enableMultipleSelect)?userOptions.enableMultipleSelect:!0===userOptions.enableMultipleSelect;userOptions.enableAutoSelect=!1!==userOptions.enableAutoSelect;userOptions.enableLabelExpand=!1!==userOptions.enableLabelExpand;userOptions.isDraggable=!0===userOptions.isDraggable;userOptions.enableTwoWayBinding=!0===userOptions.enableTwoWayBinding;userOptions.enableNodeDropdown=_.isObject(userOptions.enableNodeDropdown)?userOptions.enableNodeDropdown:void 0;userOptions.enableSearchBar=_.isObject(userOptions.enableSearchBar)?userOptions.enableSearchBar:void 0;userOptions.enableLocationBar=!0===userOptions.enableLocationBar;userOptions.enableUnselected=!1!==userOptions.enableUnselected;userOptions.expandToDepth=_.isNumber(userOptions.expandToDepth)?userOptions.expandToDepth:1;userOptions.idAttribute=userOptions.idAttribute||"ID";userOptions.labelAttribute=userOptions.labelAttribute||"label";userOptions.locationLabelAttribute=userOptions.locationLabelAttribute||userOptions.labelAttribute;userOptions.selectedAttribute=userOptions.selectedAttribute||"selected";userOptions.childrenAttribute=userOptions.childrenAttribute||"children";userOptions.lazyLoadingAttribute=userOptions.lazyLoadingAttribute||void 0;userOptions.editableAttribute=userOptions.editableAttribute||"editable";userOptions.indeterminateAttribute=userOptions.indeterminateAttribute||"__ivhTreeviewIndeterminate";userOptions.expandedAttribute=userOptions.expandedAttribute||"__ivhTreeviewExpanded";userOptions.labelTitleAttribute=userOptions.labelTitleAttribute||"label";userOptions.disableCheckboxAttribute=userOptions.disableCheckboxAttribute||"disableCheckbox";userOptions.nodeClickCallback=_.isFunction(userOptions.nodeClickCallback)?userOptions.nodeClickCallback:void 0;userOptions.lazyLoadingCallback=_.isFunction(userOptions.lazyLoadingCallback)?userOptions.lazyLoadingCallback:void 0;userOptions.editableCallback=_.isFunction(userOptions.editableCallback)?userOptions.editableCallback:void 0;return userOptions}(self.options);self.options.checkboxChanged&&(self.checkboxChanged=self.options.checkboxChanged);if(self.treeviewOptions.enableNodeDropdown){self.dropdownItems=[];var template="<ul "+(self.atag?'atag = "'+self.atag+'"':"")+' id="nb-treeview-dropdown-'+scope.$id+'" class="dropdown-menu nb-treeview-dropdown"><li ng-click="nbTreeview.callDropdownAction(item, $event)" ng-repeat="item in nbTreeview.dropdownItems" ng-class="item.class"><a ng-bind-html="::nbTreeview.renderTemplate(item.template)"></a></li></ul>';var dropdownEle=$compile(template)(scope);ele.append(dropdownEle);ele.on("scroll",(function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))}));$document.bind("click",handleClickEvent);$document.bind("contextmenu",handleClickEvent);scope.$on("$destroy",(function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))}))}self.treeviewOptions.enableSearchBar&&"submit"===self.treeviewOptions.enableSearchBar.method&&$(ele).on("keypress",".search-bar input",(function(event){13===event.keyCode&&"submit"===self.treeviewOptions.enableSearchBar.method&&"function"==typeof self.treeviewOptions.enableSearchBar.action&&$timeout((function(){self.searchTree(event.target.value)}))}));_.isFunction(self.treeviewOptions.editableCallback)&&$(ele).on("keypress",(function(event){var target=$(event.target);var c=event.keyCode;!target.hasClass("node-label-editable")||13!==c&&27!==c||$timeout((function(){var scope2=angular.element(target).scope();var promise=self.treeviewOptions.editableCallback(scope2.node,scope2.trvw,target[0].value.trim(),event);if(promise&&_.isFunction(promise.then)){$(document.body).off("click.nbTreeDocClickHandler");promise.then((function(result){if(result)$(document.body).off("click.nbTreeDocClickHandler");else{target.val(scope2.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",(function docAfterEnterClickHandler(event2){!$(event2.target).is(target[0])&&_.isFunction(self.treeviewOptions.editableCallback)&&$timeout((function(){var promise2=self.treeviewOptions.editableCallback(scope2.node,scope2.trvw,target[0].value.trim(),event);promise2&&promise2.then&&promise2.then((function(result2){if(!result2){var scope3=angular.element(target).scope();target.val(scope3.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}}),(function(){var scope4=angular.element(target).scope();target.val(scope4.node.name);$timeout((function(){target.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docAfterEnterClickHandler)}))}))}))}))}))}}))}else $(document.body).off("click.nbTreeDocClickHandler")}))}))},post:function(scope,ele){var self=scope.nbTreeview;self.treeviewOptions.enableSearchBar&&self.treeviewOptions.enableSearchBar.icon&&setTimeout((function(){ele.find(".search-bar .nb-filter-bar .icons span").removeClass().addClass(self.treeviewOptions.enableSearchBar.icon)}))}}}},MENU_OPEN=!1,SCOPE_ID="",CURRENT_ACTION_BTN=null,CURRENT_NODE_OBJ=null;Controller.$inject=["$scope","$element"];function Controller($scope,$element){$scope.nbTreeview.data=$scope.$parent.treeData||$scope.$parent.$parent.sdnt.sdnDataTree;$scope.nbTreeview.options=$scope.$parent.treeOptions||$scope.$parent.$parent.sdnt.ivhTreeOptions;$scope.$on("$destroy",(function(){$scope.nbTreeview=null}));var self=this;self.query="";self.locationquery="";self.trvw=null;self.searchResults=[];self.countTotal=0;self.countIndex=0;self.locationpreviousquery="";self.matchNodes=[];self.refreshDropdownItems=function(node,trvw){var dropdownFn=$scope.nbTreeview.treeviewOptions.enableNodeDropdown.dropdownItems;_.isFunction(dropdownFn)&&($scope.nbTreeview.dropdownItems=dropdownFn(node,trvw))};var finded;var mached=!1;var parents=[];self.isTreeItemVisible=function(node,trvw){!$scope.nbTreeview.options.expandFirstChildNode||finded&&mached||function(node){finded||(finded=function findFirstdata(node){node.ID&&parents.push({id:node.ID,name:node.name});if(0===node.nodeType){var result=_.find(node.child,{nodeType:1});if(result)return result;var folders=_.where(node.child,{nodeType:0});for(var i=0;i<folders.length;i++){var r=findFirstdata(folders[i]);if(r){folders[i].ID&&parents.push({id:folders[i].ID,name:folders[i].name});return r}}return null}return node}(node));if(finded&&!mached&&node&&node.child){node.ID&&node.name&&_.find(parents,{id:node.ID,name:node.name})&&(node.expanded=!0);for(var i=0;i<node.child.length;i++){var child=node.child[i];if(finded.nodeType===child.nodeType&&finded.name===child.name&&finded.description===child.description&&finded.childNumber===child.childNumber){mached=!0;break}}}}(node);return"function"==typeof self.treeviewOptions.checkTreeNodeVisible?self.treeviewOptions.checkTreeNodeVisible(node,trvw):"boolean"!=typeof self.treeviewOptions.checkTreeNodeVisible||self.treeviewOptions.checkTreeNodeVisible};$scope.$on("$destroy",(function(){directive=null;$scope.nbTreeview=null;finded=null;self.data=null;self.options=null;parents=null;CURRENT_ACTION_BTN=null;CURRENT_NODE_OBJ=null}));self.clearLocation=function(){ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);self.locationpreviousquery=null;self.trvw.locationQuery=self.locationpreviousquery};self.callDropdownAction=function(item,event){"function"==typeof item.action&&item.action(CURRENT_NODE_OBJ,self.trvw,event)};self.collectionAllNode=function(treeData,queryText){if(treeData.length>0)for(var i=0;i<treeData.length;i++){if(-1!==treeData[i][self.treeviewOptions.locationLabelAttribute].toLowerCase().indexOf(queryText.toLowerCase())){treeData[i][self.treeviewOptions.expandedAttribute]=!0;self.matchNodes.push(treeData[i]);ExpandAllParentNodeByLocationAttribute(treeData[i][self.treeviewOptions.locationLabelAttribute])}treeData[i].children&&treeData[i].children.length>0&&self.collectionAllNode(treeData[i].children,queryText)}};var currentScrollInterval=null;self.findNextNode=function(queryText){currentScrollInterval&&clearInterval(currentScrollInterval);ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);_.isEmpty(queryText)?self.matchNodes=[]:self.countIndex===self.matchNodes.length?self.countIndex=1:self.countIndex++;if(!(0===self.matchNodes.length||self.countIndex<1)){ivhTreeviewMgr.expandTo(self.data,self.matchNodes[self.countIndex-1],self.treeviewOptions);self.matchNodes[self.countIndex-1].selected=!0;self.allMatchEle=$element.find(".ivh-treeview-node-label.node-label span:has('.filter-highlight')");var currentEle=self.allMatchEle[self.countIndex-1];currentEle?currentEle.scrollIntoView(!1):currentScrollInterval=setInterval((function(){self.allMatchEle=$element.find(".ivh-treeview-node-label.node-label span:has('.filter-highlight')");var currentEle=self.allMatchEle[self.countIndex-1];if(currentEle){currentEle.scrollIntoView(!1);clearInterval(currentScrollInterval);currentScrollInterval=null}}),100)}};$scope.$on("tabSwitchSearchEmpty",(function(){self.locationpreviousquery="";self.trvw.locationQuery="";self.locationquery="";self.countTotal=""}));self.locationNode=function(event,queryText){if(13===event.keyCode)if(self.locationpreviousquery!==queryText){self.matchNodes=[];self.collectionAllNode(self.data,queryText);self.countTotal=self.matchNodes.length;self.DuplicateNodeCount=0;if(self.countTotal>0){self.locationpreviousquery=queryText;self.trvw.locationQuery=self.locationpreviousquery;self.countIndex=0;$timeout((function(){var _len=self.matchNodes.length>15?15:self.matchNodes.length;for(var k=0;k<_len;k++)ivhTreeviewMgr.expandTo(self.data,self.matchNodes[k],self.treeviewOptions);$timeout((function(){self.findNextNode(queryText)}))}))}else self.clearLocation()}else{self.findNextNode(queryText);self.locationpreviousquery=queryText;self.trvw.locationQuery=self.locationpreviousquery}};function ExpandAllParentNodeByLocationAttribute(LocationAttribute){LocationAttribute&&ivhTreeviewBfs(self.data,{childrenAttribute:"children"},(function(n,prs){n[self.treeviewOptions.locationLabelAttribute]===LocationAttribute&&angular.forEach(prs,(function(p){p[self.treeviewOptions.expandedAttribute]=!0}))}))}self.searchQueryChange=function(){"watch"===self.treeviewOptions.enableSearchBar.method&&"function"==typeof self.treeviewOptions.enableSearchBar.action&&self.searchTree(self.query);""===self.query&&$timeout((function(){!function(){self.query="";self.searchResults=[]}()}))};self.showEditable=function(node){return!!node[self.treeviewOptions.editableAttribute]};self.getTemplateLabel=function(node,trvw,isPlain){var customLabel=self.treeviewOptions.labelTemplate,label=self.treeviewOptions.labelAttribute;node[label]||(label="name");return isPlain?trvw.label(node):customLabel?$sce.trustAs("html",customLabel(node,trvw,$scope)):$sce.trustAs("html",trvw.label(node))};self.searchTree=function(queryText){var promise=self.treeviewOptions.enableSearchBar.action;_.isFunction(promise)&&$q.when(promise(queryText)).then((function(results){self.searchResults=results}),(function(){$log.error("failed to search nb treeview")}))};self.getTemplateIcon=function(node,trvw){var customIcon=self.treeviewOptions.iconTemplate;return customIcon?$sce.trustAs("html",customIcon(node,trvw)):null};self.getLabelTitle=function(node){return node[self.treeviewOptions.labelTitleAttribute]};self.showCheckBox=function(node,trvw){return _.isFunction(self.treeviewOptions.enableMultipleSelect)?self.treeviewOptions.enableMultipleSelect(node,trvw):self.treeviewOptions.enableMultipleSelect};self.showToggleArrow=function(node,trvw){if(!trvw.isLeaf(node)){var children=node[self.treeviewOptions.childrenAttribute]||[];var isVisible=!0;for(var i=0;i<children.length&&!(isVisible=_.isFunction(self.treeviewOptions.checkTreeNodeVisible)?self.treeviewOptions.checkTreeNodeVisible(children[i],trvw):!_.isBoolean(self.treeviewOptions.checkTreeNodeVisible)||self.treeviewOptions.checkTreeNodeVisible);i++);return isVisible}if(self.treeviewOptions.lazyLoadingAttribute){var flag=self.treeviewOptions.lazyLoadingAttribute;return _.isString(flag)?node[flag]:!!_.isFunction(flag)&&!0===flag(node,trvw)}return!1};self.currentNode=null;self.selectNode=function(node,trvw,event,overwrite){node&&$scope.$emit("nbFolderTreeview.folderSelected",node);if($(event.target).hasClass("node-label-editable"))event.stopPropagation();else{var isMultiple=self.showCheckBox(node,trvw);var callback=self.treeviewOptions.nodeClickCallback;var pre=node[self.treeviewOptions.selectedAttribute];if(isMultiple)if(self.treeviewOptions.enableAutoSelect)trvw.select(node,pre);else if(isMultiple){var checked=!1;var checkbox=$(event.target).closest(".ivh-node-row").find(".node-checkbox input");checkbox.length>0&&(checked=!checkbox[0].checked);node[self.treeviewOptions.selectedAttribute]=checked}else trvw.select(node,pre);else try{if(self.currentNode&&!event.ctrlKey){self.currentNode[self.treeviewOptions.selectedAttribute]=!1;node[self.treeviewOptions.selectedAttribute]=!0}}catch(e){}self.currentNode=node;(callback||angular.noop)(node,trvw,event);$scope.isWatchData&&$scope.$emit("nbTreeview.nodeSelected");self.treeviewOptions.enableLabelExpand&&self.toggleNode(node,trvw,event,!0)}};self.dblclickNode=function(node,trvw,event){var callback=self.treeviewOptions.nodeDblClickCallback;callback&&callback(node,trvw,event)};self.dragNodeStart=function(dragScope,event){self.options.onDragStart&&self.options.onDragStart(dragScope.$parent.node,event)};self.selectFilteredNode=function(node,trvw){var isMultiple=self.showCheckBox(node,trvw);var callback=self.treeviewOptions.nodeClickCallback;var pre=node[self.treeviewOptions.selectedAttribute];if(isMultiple)trvw.select(node,!pre);else{ivhTreeviewMgr.deselectAll(self.data,self.treeviewOptions);!function(tree,node,opts,isSelected){var ng=angular;if(arguments.length>2&&"boolean"==typeof opts){isSelected=opts;opts={}}opts=ng.extend({},opts);((isSelected=!ng.isDefined(isSelected)||isSelected)?function(node2){node2[this.selectedAttribute]=!0;node2[this.indeterminateAttribute]=!1}.bind(opts):function(node2){node2[this.selectedAttribute]=!1;node2[this.indeterminateAttribute]=!1}.bind(opts))(node)}(self.data,node,self.treeviewOptions,!pre)}(callback||angular.noop)(node,trvw)};self.toggleNode=function(node,trvw,event,isPropagation){isPropagation||event.stopPropagation();if(self.treeviewOptions.lazyLoadingAttribute&&!node.loaded){var flagProp=self.treeviewOptions.lazyLoadingAttribute;(_.isString(flagProp)?node[flagProp]:!!_.isFunction(flagProp)&&flagProp(node,trvw))&&self.treeviewOptions.lazyLoadingCallback?$q.when(self.treeviewOptions.lazyLoadingCallback(node,trvw)).then((function(){trvw.toggleExpanded(node)})):trvw.toggleExpanded(node)}else{var expanded=trvw.isExpanded(node);var showNodeNum=self.treeviewOptions.showNodeNum;self.loadNum=100;if(0===showNodeNum&&!expanded&&node.children&&node.children.length>self.loadNum){self.allNodes=node.children;node.children=[];self.nodeArray=node.children;self.loadLargeTreeNode()}trvw.toggleExpanded(node)}};self.loadLargeTreeNode=function(){var nodeArray=self.nodeArray;var allNodes=self.allNodes;var loadNum=self.loadNum;self.shiftFixArrayElement(nodeArray,allNodes,loadNum);allNodes.length>0&&(allNodes.length>loadNum?setTimeout(self.loadLargeTreeNode,100):self.shiftFixArrayElement(nodeArray,allNodes,allNodes.length))};self.shiftFixArrayElement=function(pushArray,shiftArray,shiftNum){for(var i=0;i<shiftNum;i++)pushArray.push(shiftArray.shift())};self.checkboxChanged=function(node,trvw,event){event.stopPropagation();self.treeviewOptions.enableAutoSelect?trvw.select(node,event.target.checked):node[self.treeviewOptions.selectedAttribute]=event.target.checked;(self.treeviewOptions.nodeClickCallback||angular.noop)(node,trvw,event);$scope.isWatchData&&$scope.$emit("nbTreeview.nodeSelected")};self.isDisplayDropdown=function(node,trvw){var isDisplay=self.treeviewOptions.enableNodeDropdown?self.treeviewOptions.enableNodeDropdown.isDisplay:void 0;return"function"==typeof isDisplay?isDisplay(node,trvw):"boolean"==typeof isDisplay&&isDisplay};self.openDropdown=function(node,event,trvw){event.preventDefault();if(2!==event.button||self.isDisplayDropdown(node,trvw)){event.stopPropagation();$("#nb-treeview-dropdown-"+SCOPE_ID).css("visibility","hidden");if($(event.target).is(CURRENT_ACTION_BTN))$timeout((function(){close($("#nb-treeview-dropdown-"+SCOPE_ID))}));else{$(CURRENT_ACTION_BTN).removeClass("dropdown-active");var targetNodeRow=$(event.target).closest(".ivh-node-row");targetNodeRow.addClass("dropdown-active");self.refreshDropdownItems(node,trvw);CURRENT_ACTION_BTN=targetNodeRow[0];CURRENT_NODE_OBJ=node;SCOPE_ID=$scope.$id;$timeout((function(){!function(event,actionMenuEle,ele){var target=$(event.target),left="initial",top=target.offset().top-ele.offset().top+20+ele.scrollTop(),actionHeight=actionMenuEle.height();top+actionHeight+50>ele.scrollTop()+ele.height()&&(top=top-actionHeight-25);2===event.button&&((left=event.clientX-ele.offset().left)+actionMenuEle.width()+10>ele.width()?left="initial":left+="px");actionMenuEle.css({visibility:"visible",top:top+"px",left:left,right:"initial"==left?"11px":"initial"});MENU_OPEN=!0}(event,$("#nb-treeview-dropdown-"+SCOPE_ID),$element)}))}}};self.renderTemplate=function(template){return $sce.trustAs("html",template)};self.initEditableContent=function(node,trvw,divEle){divEle[0].value=self.getTemplateLabel(node,trvw,!0);$timeout((function(){divEle.select();$(document.body).one("click.nbTreeDocClickHandler",(function docClickHandler(event){!$(event.target).is(divEle[0])&&_.isFunction(self.treeviewOptions.editableCallback)&&$timeout((function(){var scope=angular.element(divEle).scope();if(scope){var promise=self.treeviewOptions.editableCallback(node,trvw,divEle[0].value.trim(),event);promise&&promise.then&&promise.then((function(result){if(!result){divEle.val(scope.node[self.treeviewOptions.labelAttribute]);$timeout((function(){divEle.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docClickHandler)}))}}),(function(){divEle.val(scope.node[self.treeviewOptions.labelAttribute]);$timeout((function(){divEle.select().focus();$(document.body).one("click.nbTreeDocClickHandler",docClickHandler)}))}))}}))}))}))}}function close(actionMenuEle){if(MENU_OPEN){actionMenuEle.css("visibility","hidden");$(CURRENT_ACTION_BTN).removeClass("dropdown-active");MENU_OPEN=!1;CURRENT_ACTION_BTN=null;CURRENT_NODE_OBJ=null}}function handleClickEvent(event){var actionMenuEle=$("#nb-treeview-dropdown-"+SCOPE_ID);$(event.target).is(CURRENT_ACTION_BTN)||close(actionMenuEle);actionMenuEle=null}return directive}}(NetBrain);angular.module("ivh.treeview").directive("ivhTreeviewNodeExtend",["ivhTreeviewCompiler","ivhTreeviewOptions",function(ivhTreeviewCompiler,ivhTreeviewOptions){return{restrict:"A",scope:{depth:"=ivhTreeviewDepth",showNodeNum:"="},require:"^ivhTreeviewExtend",compile:function(tElement){return ivhTreeviewCompiler.compile(tElement,(function(scope,element,attrs,trvw){scope.node=scope.$parent.child;var node=scope.node,pageNumObj={a1:1},totalRecord=0,lastPageNum=0;scope.pageNum=[1];scope.getChildren=function(page){var _node=trvw.children(node);if(_node[0]&&window.SELECTNODE&&_node[0].parentIds.join(",")==window.SELECTNODE.parentIds.join(",")){var searchNodePage=Math.ceil((window.SELECTNODE._nodeIndex+1)/scope.showNodeNum);if(1!=pageNumObj["a"+searchNodePage]){scope.pageNum.push(searchNodePage);pageNumObj["a"+searchNodePage]=1}}if(_node.length>0){totalRecord=Math.ceil(_node.length/scope.showNodeNum);lastPageNum=_node.length-(totalRecord-1)*scope.showNodeNum;_node=_node.slice(scope.showNodeNum*(page-1),scope.showNodeNum*page)}return _node};scope.trvw=trvw;scope.childDepth=scope.depth+1;trvw.expand(node,trvw.isInitiallyExpanded(scope.depth));scope.isShowMore=function(page){return!(1==pageNumObj["a"+(page+=1)]||page>totalRecord)};scope.more=function(page){page+=1;scope.pageNum.push(page);pageNumObj["a"+page]=1;scope.pageNum.sort((function(x,y){return x-y}))};scope.getMoreNum=function(page){var i=0;for(;page<totalRecord;){page++;if(1==pageNumObj["a"+page])break;i++}i*=scope.showNodeNum;page==totalRecord&&(i=i-scope.showNodeNum+lastPageNum);return i};scope.$on("$destroy",(function(){scope.getChildren=null;scope.getMoreNum=null;scope.more=null;scope.pageNum=null;scope.isShowMore=null;scope.child=null;scope.node=null;scope=null}))}))},template:ivhTreeviewOptions().nodeTpl}}]);angular.module("ivh.treeview").directive("ivhTreeviewChildrenExtend",(function(){return{restrict:"AE",template:['<ul ng-if="pageNum" ng-repeat="page in pageNum" class="ivh-treeview">','<li ng-repeat="child in getChildren(page)"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node-extend="child"','ivh-treeview-depth="childDepth">',"</li>",'<li ng-if="isShowMore(page)">','<a ng-click="more(page)" style="margin-left:15px;text-decoration:none;" href="javascript:;">---- More({{getMoreNum(page)}}) ----</a>',"</li>","</ul>"].join("\n")}}));angular.module("ivh.treeview").factory("ivhTreeviewMgrExtend",["ivhTreeviewOptions",function(ivhTreeviewOptions){var ng=angular,exports=(ivhTreeviewOptions(),{});var findNode1=function findNode1(groups,parentIds,index,cb){if(index<groups.length){var nodes=groups[index];for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node.id==parentIds[0]){node.expanded=node.__ivhTreeviewExpanded=!0;$("body").click();parentIds.shift();return findNode(node.children,parentIds,cb)}}setTimeout((function(){return findNode1(groups,parentIds,++index,cb)}))}else if(0==parentIds.length)return cb()};var findNode=function(tree,parentIds,cb){if(!(tree&&tree.length>0))return cb();var groups=function(data){var result=[];var groupItem;for(var i=0;i<data.length;i++){if(i%500==0){null!=groupItem&&result.push(groupItem);groupItem=[]}groupItem.push(data[i])}result.push(groupItem);return result}(tree);setTimeout((function(){return findNode1(groups,parentIds,0,cb)}))};exports.expandTo=function(tree,node,opts,isExpanded,callback){var parentIds=ng.copy(node.parentIds);return findNode(tree,parentIds,(function(n,p){callback();return exports}))};return exports}]);angular.module("ivh.treeview").directive("ivhTreeviewExtend",["ivhTreeviewMgr",function(ivhTreeviewMgr){return{restrict:"A",transclude:!0,scope:{childrenAttribute:"=ivhTreeviewChildrenAttribute",clickHandler:"=ivhTreeviewClickHandler",changeHandler:"=ivhTreeviewChangeHandler",defaultSelectedState:"=ivhTreeviewDefaultSelectedState",expandToDepth:"=ivhTreeviewExpandToDepth",idAttribute:"=ivhTreeviewIdAttribute",indeterminateAttribute:"=ivhTreeviewIndeterminateAttribute",expandedAttribute:"=ivhTreeviewExpandedAttribute",labelAttribute:"=ivhTreeviewLabelAttribute",nodeTpl:"=ivhTreeviewNodeTpl",selectedAttribute:"=ivhTreeviewSelectedAttribute",twistieCollapsedTpl:"=ivhTreeviewTwistieCollapsedTpl",twistieExpandedTpl:"=ivhTreeviewTwistieExpandedTpl",twistieLeafTpl:"=ivhTreeviewTwistieLeafTpl",useCheckboxes:"=ivhTreeviewUseCheckboxes",validate:"=ivhTreeviewValidate",visibleAttribute:"=ivhTreeviewVisibleAttribute"},controllerAs:"trvw",controller:["$scope","$element","$attrs","$transclude","ivhTreeviewOptions","filterFilter",function($scope,$element,$attrs,$transclude,ivhTreeviewOptions,filterFilter){var ng=angular,trvw=this;$scope.root=$scope.$parent.treeData||$scope.$parent.$parent.sdnt.sdnDataTree;$scope.userOptions=$scope.$parent.treeOptions||$scope.$parent.$parent.sdnt.ivhTreeOptions;var localOpts=ng.extend({},ivhTreeviewOptions(),$scope.userOptions);ng.forEach(["childrenAttribute","defaultSelectedState","expandToDepth","idAttribute","indeterminateAttribute","expandedAttribute","labelAttribute","nodeTpl","selectedAttribute","twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl","useCheckboxes","validate","visibleAttribute"],(function(attr){ng.isDefined($scope[attr])&&(localOpts[attr]=$scope[attr])}));$transclude((function(clone,scope){var transcludedNodeTpl="";angular.forEach(clone,(function(c){transcludedNodeTpl+=(c.innerHTML||"").trim()}));if(transcludedNodeTpl.length){scope;localOpts.nodeTpl=transcludedNodeTpl}}));trvw.opts=function(){return localOpts};var userOpts=$scope.userOptions||{};trvw.hasLocalTwistieTpls=!!(userOpts.twistieCollapsedTpl||userOpts.twistieExpandedTpl||userOpts.twistieLeafTpl||$scope.twistieCollapsedTpl||$scope.twistieExpandedTpl||$scope.twistieLeafTpl);trvw.children=function(node){var children=node[localOpts.childrenAttribute];return ng.isArray(children)?children:[]};trvw.label=function(node){return node[localOpts.labelAttribute]};trvw.hasFilter=function(){return ng.isDefined($scope.filter)};trvw.getFilter=function(){return $scope.filter||""};trvw.getNodeTpl=function(){return localOpts.nodeTpl};trvw.isVisible=function(node){var filter=trvw.getFilter();return!filter||!!filterFilter([node],filter).length};trvw.useCheckboxes=function(){return localOpts.useCheckboxes};trvw.select=function(node,isSelected){ivhTreeviewMgr.select($scope.root,node,localOpts,isSelected);trvw.onNodeChange(node,isSelected)};trvw.isSelected=function(node){return node[localOpts.selectedAttribute]};trvw.isSearch=function(node){return node.isSearch};trvw.toggleSelected=function(node){var isSelected=!node[localOpts.selectedAttribute];trvw.select(node,isSelected)};trvw.expand=function(node,isExpanded){ivhTreeviewMgr.expand($scope.root,node,localOpts,isExpanded)};trvw.isExpanded=function(node){return node[localOpts.expandedAttribute]};trvw.toggleExpanded=function(node){trvw.expand(node,!trvw.isExpanded(node))};trvw.isInitiallyExpanded=function(depth){return depth<(-1===localOpts.expandToDepth?1/0:localOpts.expandToDepth)};trvw.isLeaf=function(node){return 0===trvw.children(node).length};trvw.getNodeTpl=function(){return localOpts.nodeTpl};trvw.onNodeClick=function(node){($scope.clickHandler||angular.noop)(node,$scope.root)};trvw.onNodeChange=function(node,isSelected){($scope.changeHandler||angular.noop)(node,isSelected,$scope.root)};var pageNumObj={a1:1},totalRecord=0,lastPageNum=0;$scope.pageNum=[1];$scope.getChildren=function(page){var _node=$scope.root;if(_node.length>0){totalRecord=Math.ceil(_node.length/localOpts.showNodeNum);lastPageNum=_node.length-(totalRecord-1)*localOpts.showNodeNum;_node=_node.slice(localOpts.showNodeNum*(page-1),localOpts.showNodeNum*page)}return _node};$scope.isShowMore=function(page){return!(1==pageNumObj["a"+(page+=1)]||page>totalRecord)};$scope.getMoreNum=function(page){var i=0;for(;page<totalRecord;){page++;if(1==pageNumObj["a"+page])break;i++}i*=localOpts.showNodeNum;page==totalRecord&&(i=i-localOpts.showNodeNum+lastPageNum);return i};$scope.more=function(page){page+=1;$scope.pageNum.push(page);pageNumObj["a"+page]=1;$scope.pageNum.sort((function(x,y){return x-y}))};$scope.$on("$destroy",(function(){$scope.root=null;$scope.options=null;trvw=null;pageNumObj=null;totalRecord=null;lastPageNum=null;userOpts=null;null;localOpts=null;$scope=null}))}],link:function(scope,element,attrs){scope.trvw.opts().validate},template:['<ul ng-if="pageNum" ng-repeat="page in pageNum;" class="ivh-treeview">','<li ng-repeat="child in getChildren(page)"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node-extend="child"','ivh-treeview-depth="0">',"</li>",'<li ng-if="isShowMore(page)">','<a ng-click="more(page)" style="margin-left:15px;text-decoration:none;" href="javascript:;">---- More({{getMoreNum(page)}}) ----</a>',"</li>","</ul>"].join("\n")}}]);!function(){angular.module("nb.common").directive("nbTreeviewNodeTpl",NbTreeviewNodeTpl);NbTreeviewNodeTpl.$inject=[];function NbTreeviewNodeTpl(){return{restrict:"E",scope:!1,replace:!0,require:["^^nbTreeviewDirective","^^ivhTreeview"],templateUrl:"modules/nbCommon/views/nbTreeviewNodeTpl.html",link:function(scope,ele,attr,ctrls){var self=scope;var nbTreeview=ctrls[0];var opts=ctrls[1].opts();var indeterminateAttr=opts.indeterminateAttribute;var selectedAttr=opts.selectedAttribute;!function(){if(nbTreeview.treeviewOptions.enableMultipleSelect){self.$watch((function(){return self.node[selectedAttr]}),(function(newVal){$(ele).find("> .ivh-node-row > .node-checkbox > input").prop("checked",newVal)}));self.$watch((function(){return self.node[indeterminateAttr]}),(function(newVal){$(ele).find("> .ivh-node-row > .node-checkbox > input").prop("indeterminate",newVal)}))}}();self.showNodeNum=opts.showNodeNum;self.enableTwoWayBinding=opts.enableTwoWayBinding;self.checkboxChanged=nbTreeview.checkboxChanged;self.getTemplateLabel=nbTreeview.getTemplateLabel;self.getTemplateIcon=nbTreeview.getTemplateIcon;self.showCheckBox=nbTreeview.showCheckBox;self.showToggleArrow=nbTreeview.showToggleArrow;self.toggleNode=nbTreeview.toggleNode;self.isDisplayDropdown=nbTreeview.isDisplayDropdown;self.openDropdown=nbTreeview.openDropdown;self.isTreeItemVisible=nbTreeview.isTreeItemVisible;self.showEditable=nbTreeview.showEditable;self.selectNode=nbTreeview.selectNode;self.dblclickNode=nbTreeview.dblclickNode;self.dragNodeStart=nbTreeview.dragNodeStart;self.hasChildren=function(node){return!!(node.children&&node.children.length>0)};self.editInputClick=function(event){event.stopPropagation()};self.initEvent=function(node){"newfolder"!=node.type&&$(document.body).click();node.action(node)};self.getEventLabel=function(node){return node.name};self.isEvent=function(node){return node.isEvent};self.isFieldset=function(node){return node.isFieldset};self.initEditableContent=function(node,trvw2){var editableDiv=$(ele).find(".node-label-editable");nbTreeview.initEditableContent(node,trvw2,editableDiv)};self.getNodeTitle=function(node,trvw2){if(!_.isUndefined(nbTreeview.treeviewOptions.nodeTitle)){var n=nbTreeview.treeviewOptions.nodeTitle;return _.isFunction(n)?n.call(null,node,trvw2):n.toString()}return trvw2.label(node)};self.shouldDisableMultiCheckbox=function(node){return node[nbTreeview.treeviewOptions.disableCheckboxAttribute]}}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbTreeviewNodeTplExtend",nbTreeviewNodeTplExtend);nbTreeviewNodeTplExtend.$inject=[];function nbTreeviewNodeTplExtend(){return{restrict:"E",scope:!1,replace:!0,require:["^^nbTreeviewDirectiveExtend","^^ivhTreeviewExtend"],templateUrl:"modules/nbCommon/views/nbTreeviewNodeTpl.html",link:function(scope,ele,attr,ctrls){var self=scope;var nbTreeview=ctrls[0];ctrls[1];var opts=nbTreeview.options;var indeterminateAttr=opts.indeterminateAttribute;var selectedAttr=opts.selectedAttribute;!function(){if(nbTreeview.treeviewOptions.enableMultipleSelect){self.$watch((function(){return self.node[selectedAttr]}),(function(newVal){$(ele).find("> .ivh-node-row > .node-checkbox > input").prop("checked",newVal)}));self.$watch((function(){return self.node[indeterminateAttr]}),(function(newVal){$(ele).find("> .ivh-node-row > .node-checkbox > input").prop("indeterminate",newVal)}))}}();self.isDraggable=opts.isDraggable;self.showNodeNum=opts.showNodeNum;self.enableTwoWayBinding=opts.enableTwoWayBinding;self.checkboxChanged=nbTreeview.checkboxChanged;self.getTemplateLabel=nbTreeview.getTemplateLabel;self.getTemplateIcon=nbTreeview.getTemplateIcon;self.showCheckBox=nbTreeview.showCheckBox;self.showToggleArrow=nbTreeview.showToggleArrow;self.toggleNode=nbTreeview.toggleNode;self.isDisplayDropdown=nbTreeview.isDisplayDropdown;self.openDropdown=nbTreeview.openDropdown;self.isTreeItemVisible=nbTreeview.isTreeItemVisible;self.showEditable=nbTreeview.showEditable;self.selectNode=nbTreeview.selectNode;self.dragNodeStart=nbTreeview.dragNodeStart;self.initEditableContent=function(node,trvw2){var editableDiv=$(ele).find(".node-label-editable");nbTreeview.initEditableContent(node,trvw2,editableDiv)};self.editInputClick=function(event){event.stopPropagation()};self.getNodeTitle=function(node,trvw2){if(!_.isUndefined(nbTreeview.treeviewOptions.nodeTitle)){var n=nbTreeview.treeviewOptions.nodeTitle;return _.isFunction(n)?n.call(null,node,trvw2):n.toString()}return trvw2.label(node)};self.shouldDisableMultiCheckbox=function(node){return node[nbTreeview.treeviewOptions.disableCheckboxAttribute]};scope.$on("$destroy",(function(){self.initEditableContent=null;self.getNodeTitle=null;self.shouldDisableMultiCheckbox=null;self=null;scope.child=null;scope.node=null;ctrls[0].data=null}))}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbTreeviewSimpleNodeTpl",nbTreeviewSimpleNodeTpl);nbTreeviewSimpleNodeTpl.$inject=[];function nbTreeviewSimpleNodeTpl(){return{restrict:"E",scope:!1,replace:!0,require:["^^nbTreeviewDirective","^^ivhTreeview"],templateUrl:"modules/nbCommon/views/nbTreeviewSimpleNodeTpl.html",link:function(scope,ele,attr,ctrls){var self=scope;var nbTreeview=ctrls[0];var opts=ctrls[1].opts();self.showNodeNum=opts.showNodeNum;self.enableTwoWayBinding=opts.enableTwoWayBinding;self.checkboxChanged=nbTreeview.checkboxChanged;self.getTemplateLabel=nbTreeview.getTemplateLabel;self.getTemplateIcon=nbTreeview.getTemplateIcon;self.showCheckBox=nbTreeview.showCheckBox;self.showToggleArrow=nbTreeview.showToggleArrow;self.toggleNode=nbTreeview.toggleNode;self.isDisplayDropdown=nbTreeview.isDisplayDropdown;self.openDropdown=nbTreeview.openDropdown;self.isTreeItemVisible=nbTreeview.isTreeItemVisible;self.showEditable=nbTreeview.showEditable;self.selectNode=nbTreeview.selectNode;self.dblclickNode=nbTreeview.dblclickNode;self.dragNodeStart=nbTreeview.dragNodeStart;self.getNodeTitle=function(node,trvw2){if(!_.isUndefined(nbTreeview.treeviewOptions.nodeTitle)){var n=nbTreeview.treeviewOptions.nodeTitle;return _.isFunction(n)?n.call(null,node,trvw2):n.toString()}return trvw2.label(node)}}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("trvwHelper",TrvwHelper);TrvwHelper.$inject=[];function TrvwHelper(){return{restrict:"A",scope:!1,require:["^^nbTreeviewDirective","ivhTreeview"],link:function(scope,ele,attr,ctrls){var nbTreeview=ctrls[0];var trvw=ctrls[1];nbTreeview.trvw=trvw}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("trvwHelperExtend",TrvwHelperExtend);TrvwHelperExtend.$inject=[];function TrvwHelperExtend(){return{restrict:"A",scope:!1,require:["^^nbTreeviewDirectiveExtend","ivhTreeviewExtend"],link:function(scope,ele,attr,ctrls){var nbTreeview=ctrls[0];var trvw=ctrls[1];nbTreeview.trvw=trvw;scope.$on("$destroy",(function(){nbTreeview=null;trvw=null}))}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbGrid",NbGrid);NbGrid.$inject=[];function NbGrid(){return{restrict:"A",scope:!1,compile:function(){return{pre:function(scope,ele,attrs,uiGridCtrl){uiGridCtrl.grid.options=angular.extend({enableSelectionBatchEvent:!1,enableFullRowSelection:!0,enableRowHeaderSelection:!1,enableGridMenu:!1,modifierKeysToMultiSelect:!0,enableColumnResizing:!0,flatEntityAccess:void 0===uiGridCtrl.grid.options.flatEntityAccess||uiGridCtrl.grid.options.flatEntityAccess,fastWatch:void 0===uiGridCtrl.grid.options.fastWatch||uiGridCtrl.grid.options.fastWatch},uiGridCtrl.grid.options,{enableColumnMenus:!1});_.each(uiGridCtrl.grid.options.columnDefs||[],(function(def){def.width||(def.width="*");def.minWidth||(def.minWidth=80);def.maxWidth||(def.maxWidth=600)}));var enableHeaderBar=uiGridCtrl.grid.options.enableHeaderBar;$(ele).css({width:"100%"});enableHeaderBar||$(ele).css({height:"100%"});$(ele).bind("mousedown",(function(event){event.shiftKey&&event.preventDefault()}))},post:function(scope,ele,attr,uiGridCtrl){uiGridCtrl.grid.appScope.gridApi||(uiGridCtrl.grid.appScope.gridApi=uiGridCtrl.grid.api)}}},require:"?uiGrid",priority:0}}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(){angular.module("nb.common").filter("nbGridDefaultSearch",(function(){return function(rows,query,targetKeys){if(void 0===query||""===query){angular.forEach(rows,(function(row){row.visible||row.clearThisRowInvisible("filter",!1)}));return rows}query=query.toLowerCase();for(var i=0;i<rows.length;i++){var entity=angular.copy(rows[i].entity);var keys=targetKeys||Object.keys(entity);for(var j=0;j<keys.length;j++){var dataItem=entity[keys[j]];if("object"!==_typeof(dataItem)&&"function"!=typeof dataItem&&void 0!==dataItem){if(dataItem.toString().toLowerCase().indexOf(query)>-1){rows[i].clearThisRowInvisible("filter",!1);break}rows[i].setThisRowInvisible("filter",!1)}}}return rows}}));angular.module("nb.common").filter("nbGridDefaultFilter",(function(){return function(rows,query,grid){if(void 0===query||""===query){_.each(rows,(function(row){row.visible||row.clearThisRowInvisible("filter",!1)}));return rows}query=query.toLowerCase();var nonCustomizedCols=_.chain(grid.options.columnDefs).filter((function(col){return!col.isCustomizedTemplate})).map((function(col){return col.field})).value();_.each(rows,(function(row){var entity=angular.copy(row.entity);var keys=Object.keys(entity);for(var j=0;j<keys.length;j++)if(!(nonCustomizedCols.indexOf(keys[j])<0)){var dataItem=entity[keys[j]];if("object"!==_typeof(dataItem)&&"function"!=typeof dataItem&&void 0!==dataItem){if(dataItem.toString().toLowerCase().indexOf(query)>-1){row.clearThisRowInvisible("filter",!1);break}row.setThisRowInvisible("filter",!1)}}}));return rows}}));angular.module("nb.common").filter("nbGridHighlighter",NbGridHighlighter);angular.module("nb.common").filter("nbHighlighterWord",NbHighlighterWord);NbGridHighlighter.$inject=["$sce","$sanitize"];function NbGridHighlighter($sce,$sanitize){return function(text,phrase){if(!text)return"";text=$sanitize(text);if(phrase&&""!==phrase){phrase=Utility.htmlEncodeByRegExp(phrase).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");return $sce.trustAsHtml(text.toString().replace(new RegExp("("+phrase+")","gi"),'<span class="filter-highlight">$1</span>'))}return $sce.trustAsHtml(text.toString())}}NbHighlighterWord.$inject=["$sce","$sanitize"];function NbHighlighterWord($sce,$sanitize){return function(text,phrase){if(!text)return"";text=$sanitize(text);if(phrase&&""!==phrase){phrase=phrase.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");return $sce.trustAsHtml(text.toString().replace(new RegExp("(\\b"+phrase.split(" ").join("\\b|\\b")+"\\b)","gi"),'<span class="filter-highlight">$1</span>'))}return $sce.trustAsHtml(text.toString())}}}(NetBrain);!function(){angular.module("nb.common").directive("nbGridHeaderBar",NbGridHeaderBar);NbGridHeaderBar.$inject=["$compile"];function NbGridHeaderBar($compile){return{restrict:"A",scope:!1,require:"?uiGrid",compile:function(){return{pre:function(scope,ele,attr,uiGridCtrl){var enableHeaderBar=uiGridCtrl.grid.options.enableHeaderBar;var enableHeaderSearchBar=uiGridCtrl.grid.options.enableHeaderSearchBar;if(enableHeaderBar){var headerEle=$compile("<nb-grid-header-bar-directive></nb-grid-header-bar-directive>")(uiGridCtrl.grid.appScope);$(ele).before(headerEle);"full"===attr.nbGridHeaderBar?$(ele).css({height:"100%"}):$(ele).css({height:"calc(100% - 35px)"});if(enableHeaderSearchBar){uiGridCtrl.grid.gridSearchStr="";angular.forEach(uiGridCtrl.grid.options.columnDefs,(function(column){column.cellTemplate?column.isCustomizedTemplate=!0:column.cellTemplate='<div class="ui-grid-cell-contents" ng-attr-title="{{COL_FIELD}}" ng-bind-html="COL_FIELD | nbGridHighlighter: grid.gridSearchStr"></div>'}))}}}}}}}angular.module("nb.common").directive("nbGridHeaderBarDirective",NbGridHeaderBarDirective);NbGridHeaderBarDirective.$inject=["$sce","$filter","$timeout"];function NbGridHeaderBarDirective($sce,$filter,$timeout){return{restrict:"EA",scope:!0,replace:!0,templateUrl:"modules/nbCommon/views/nbGridHeaderBarDirective.html",compile:function(){return{pre:function(scope){var options=scope.gridApi.grid.options;scope.leftBtnGroup=[];scope.rightBtnGroup=[];scope.dropdownMenu=[];scope.selectDropdownOptions=null;scope.isSearchBarShow=!1;scope.isDropdownShow=!1;scope.searchIcon=options.headerSearchIcon||'<i class="icon_nb_search"></i>';scope.closeIcon=options.headerSearchCloseIcon;scope.searchPlaceHolder=options.headerSearchPlaceHolder||"Search...";_.isArray(options.headerBarBtnsOnLeft)&&(scope.leftBtnGroup=scope.leftBtnGroup.concat(options.headerBarBtnsOnLeft));_.isArray(options.headerBarBtnsOnRight)&&(scope.rightBtnGroup=scope.rightBtnGroup.concat(options.headerBarBtnsOnRight));void 0!==options.enableHeaderSearchBar&&!0!==options.enableHeaderSearchBar&&"function"!=typeof options.enableHeaderSearchBar||(scope.isSearchBarShow=!0);!0===options.enableHeaderDropdown&&(scope.isDropdownShow=!0)},post:function(scope,ele){var options=scope.gridApi.grid.options;scope.isSearchBarShow&&$(ele).find('input[ng-model="searchStr"]').on("keyup",(function(event){$timeout((function(){if(13===event.keyCode){scope.gridApi.grid.gridSearchStr=scope.searchStr;scope.onSearch()}else if(!scope.gridApi.grid.options.disableFilter){scope.gridApi.grid.gridSearchStr=scope.searchStr;$filter("nbGridDefaultFilter")(scope.gridApi.grid.rows,scope.searchStr,scope.gridApi.grid)}}))}));scope.updateDropdownMenu(options,!0);scope.gridApi.selection.on.rowSelectionChanged(scope,(function(row,event){scope.updateDropdownMenu(options,!1,event)}))}}},controller:function($scope){var self=$scope;self.searchStr="";self.showInputIcon=!0;self.totalCount=self.gridApi.grid.rows.length;self.gridApi.grid.api.core.on.rowsRendered(self.gridApi.grid.appScope,(function(){self.totalCount=self.gridApi.grid.rows.length}));self.updateDropdownMenu=function(gridOptions,isSetSelected,event){if(!_.isUndefined(gridOptions.headerDropdownMenu)){if(_.isArray(gridOptions.headerDropdownMenu))self.dropdownMenu=gridOptions.headerDropdownMenu;else if(_.isFunction(gridOptions.headerDropdownMenu)){var userDropdownMenu=gridOptions.headerDropdownMenu(self.gridApi.selection.getSelectedRows(),self.gridApi.grid,event);self.dropdownMenu=_.isArray(userDropdownMenu)?userDropdownMenu:[]}isSetSelected&&(self.selectDropdownOptions=self.dropdownMenu[0])}};self.renderHtml=function(html){void 0!==html&&html.indexOf("<")<0&&(html="</label>"+html+"</label>");return $sce.trustAs("html",html)};self.callDropdownAction=function(item,event){if("function"==typeof item.action){self.selectDropdownOptions=item;item.action(self.gridApi.selection.getSelectedRows(),self.gridApi.grid,event)}};self.callBtnAction=function(item,event){"function"==typeof item.action&&item.action(self.gridApi.selection.getSelectedRows(),self.gridApi.grid,event)};self.checkBtnDisplay=function(item,event){return"function"==typeof item.isDisplay?item.isDisplay(self.gridApi.selection.getSelectedRows(),self.gridApi.grid,event):"boolean"!=typeof item.isDisplay||item.isDisplay};self.onSearch=function(){var options=self.gridApi.grid.options;self.$parent.$parent||self.$parent.$parent.isTUNE||(self.searchStr="");_.isFunction(options.enableHeaderSearchBar)?options.enableHeaderSearchBar(self.gridApi.grid):$filter("nbGridDefaultSearch")(self.gridApi.grid.rows,self.searchStr);self.gridApi.core.queueGridRefresh()};self.stopSearch=function(){var options=self.gridApi.grid.options;self.searchStr="";_.isFunction(options.stopSearch)&&options.stopSearch(self.gridApi.grid)}}}}}(window.NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(){angular.module("nb.common").directive("nbGridInfiniteScroll",NbGridInfiniteScroll);NbGridInfiniteScroll.$inject=["$timeout"];function NbGridInfiniteScroll($timeout){return{restrict:"A",scope:!1,require:"?uiGrid",compile:function(){return{pre:function(scope,ele,attr,uiGridCtrl){var options=uiGridCtrl.grid.options;var type=_typeof(options.enableGridInfiniteScroll);if("object"===type||"function"===type){options.infiniteScrollDown=!0;options.infiniteScrollRowsFromEnd="object"===type&&options.enableGridInfiniteScroll.offset||20}},post:function(scope,ele,attr,uiGridCtrl){var gridApi=uiGridCtrl.grid.api;var options=uiGridCtrl.grid.options;var appScope=uiGridCtrl.grid.appScope;var type=_typeof(options.enableGridInfiniteScroll);if("object"===type||"function"===type){var callback="object"===type?options.enableGridInfiniteScroll.loadCallback||null:options.enableGridInfiniteScroll;var isNeedMore="object"===type&&options.enableGridInfiniteScroll.isNeedMore||function(){return!0};gridApi.infiniteScroll.on.needLoadMoreData(appScope,(function(event){gridApi.infiniteScroll.saveScrollPercentage();_.isFunction(callback)&&callback(uiGridCtrl.grid,event).then((function(){$timeout((function(){gridApi.infiniteScroll.dataLoaded(!1,isNeedMore(uiGridCtrl.grid,event)).then((function(){!function(options,gridApi){if(!0===options.useExternalSorting&&!1!==options.enableGridInfiniteScroll.autoSortAfterLoaded){var cols=gridApi.grid.getColumnSorting();cols&&cols.length>0&&_.each(cols,(function(col){col.sort&&gridApi.grid.sortColumn(col,col.sort.direction)}))}}(options,gridApi);!function(options,gridApi){!0===options.useExternalFiltering&&!1!==options.enableGridInfiniteScroll.autoFilteAfterLoaded&&gridApi.core.raise.filterChanged()}(options,gridApi)}))}))}))}))}}}}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbGridRowContextMenu",NbGridRowContextMenu);NbGridRowContextMenu.$inject=["$compile","$sce","$log","$document","$timeout","$rootScope"];function NbGridRowContextMenu($compile,$sce,$log,$document,$timeout,$rootScope){return{restrict:"A",scope:!1,require:"?uiGrid",compile:function(){return{pre:function(){},post:function(scope,ele,attr,uiGridCtrl){var MENU_OPEN=!1;var GRID_ID="";var CURRENT_ACTION_BTN=null;var atag=attr.atag;if(uiGridCtrl.grid.options.enableRowContextMenu){scope.rowContextMenuList=[];scope.renderTemplate=function(template){return $sce.trustAs("html",template)};scope.callContextMenuDropdown=function(item,event){if("function"==typeof item.action){var selectedRows=uiGridCtrl.grid.api.selection.getSelectedRows()||[];selectedRows.length>1?item.action(selectedRows,uiGridCtrl.grid,event):1===selectedRows.length&&item.action(selectedRows[0],uiGridCtrl.grid,event)}};var grid=uiGridCtrl.grid;GRID_ID=grid.id;!function(gridId,scope2){scope2.rowContextMenuList=[];var element=$compile("<ul "+(atag?'atag = "'+atag+':contextMenu"':"")+' ng-show="rowContextMenuList.length>0" id="row-context-menu-dropdown-'+gridId+'" class="dropdown-menu nb-grid-context-menu-dropdown" uib-dropdown-menu><li ng-click="callContextMenuDropdown(item, $event)"  ng-class="item.class" ng-repeat="item in rowContextMenuList" ng-hide="item.hide"><a ng-bind-html="::renderTemplate(item.template)"  ng-if="item.isCopy ==null || item.isCopy==false"></a><a ng-bind-html="::renderTemplate(item.template)"  ng-if="item.isCopy !=null && item.isCopy==true" clip-copy="getTextToCopy(item.event)"></a></li></ul>')(scope2);angular.element(document.body).append(element)}(grid.id,scope);var contextMenuEventBinder=scope.$watch((function(){return $(ele).is(":visible")}),(function(isVisible){if(isVisible){contextMenuEventBinder();$(ele).on("contextmenu",(function(event){event.preventDefault();event.stopPropagation();var rowEle=$(event.target).hasClass("ui-grid-row")?event.target:$(event.target).closest(".ui-grid-row")[0];rowEle&&$timeout((function(){var rowScope=angular.element(rowEle).scope();if(!rowScope.row.isSelected){grid.api.selection.clearSelectedRows();grid.api.selection.selectRow(rowScope.row.entity)}CURRENT_ACTION_BTN=rowEle;var items,selectedRows=grid.api.selection.getSelectedRows()||[];items=1===selectedRows.length&&_.isFunction(grid.options.rowActionMenuItems)?grid.options.rowActionMenuItems(rowScope.row,grid,event):grid.options.rowContextMenuItems(selectedRows,rowScope.grid,event);if(_.isArray(items)&&items.length>0){scope.rowContextMenuList=items;var menuEle=angular.element(document.querySelector("#row-context-menu-dropdown-"+grid.id));!function(event,actionMenuEle){actionMenuEle.css({display:"block"});$timeout((function(){var doc=$document[0].documentElement;var docLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),docTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elementWidth=actionMenuEle[0].scrollWidth,elementHeight=actionMenuEle[0].scrollHeight;var docWidth=doc.clientWidth+docLeft,docHeight=doc.clientHeight+docTop,totalWidth=elementWidth+event.pageX,totalHeight=elementHeight+event.pageY,left=Math.max(event.pageX-docLeft,0),top=Math.max(event.pageY-docTop,0);totalWidth>docWidth&&(left-=totalWidth-docWidth);totalHeight>docHeight&&(top-=totalHeight-docHeight);actionMenuEle.css("top",top+"px");actionMenuEle.css("left",left+"px");actionMenuEle.css({display:"block"});MENU_OPEN=!0;$rootScope.$emit(commonUiEvent.nbGridDropdownToggle,actionMenuEle[0].id);$("#grid-empty-context-menu-dropdown-"+GRID_ID).hide()}))}(event,menuEle)}}))}))}}));$timeout((function(){$(ele).find(".ui-grid-render-container .ui-grid-viewport").on("scroll",_.debounce((function(){MENU_OPEN&&close($("#row-context-menu-dropdown-"+GRID_ID))}),150))}));$document.bind("click",handleClickEvent);$document.bind("contextmenu",handleClickEvent);uiGridCtrl.grid.api.core.on.sortChanged(scope,(function(){close($("#row-context-menu-dropdown-"+GRID_ID))}));var toggleWatcher=$rootScope.$on(commonUiEvent.nbGridDropdownToggle,(function(event,id){$timeout((function(){id!=="row-context-menu-dropdown-"+GRID_ID&&close($("#row-context-menu-dropdown-"+GRID_ID))}))}));scope.$on("$destroy",toggleWatcher);grid.appScope.$on("$destroy",(function(){$document.unbind("click",handleClickEvent);$document.unbind("contextmenu",handleClickEvent);$(document.querySelector("#row-context-menu-dropdown-"+GRID_ID)).remove();toggleWatcher()}))}function close(actionMenuEle){actionMenuEle.css({display:"none"});MENU_OPEN=!1;CURRENT_ACTION_BTN=null}function handleClickEvent(event){$timeout((function(){var actionMenuEle=$("#row-context-menu-dropdown-"+GRID_ID);MENU_OPEN&&0===$(event.target).closest(CURRENT_ACTION_BTN).length&&close(actionMenuEle)}))}}}}}}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbGridRowMenu",NbGridRowMenu);NbGridRowMenu.$inject=["$compile","$log","$document","$timeout","$sce","$rootScope"];function NbGridRowMenu($compile,$log,$document,$timeout,$sce,$rootScope){return{restrict:"A",scope:!1,require:"?uiGrid",compile:function(){return{pre:function(scope,ele,attrs,uiGridCtrl){var MENU_OPEN=!1;var GRID_ID="";var CURRENT_ACTION_BTN=null;uiGridCtrl.PRE_HORI_POS=0;var atag=attrs.atag;if(uiGridCtrl.grid.options.enableRowActionMenu){scope.rowActionMenuList=[];scope.renderTemplate=function(template){return $sce.trustAs("html",template)};scope.callActionMenuDropdown=function(item,event){if("function"==typeof item.action){var selectedRows=uiGridCtrl.grid.api.selection.getSelectedRows()||[];selectedRows.length>1?item.action(selectedRows,uiGridCtrl.grid,event):item.action(uiGridCtrl.grid.selectedRowAction&&uiGridCtrl.grid.selectedRowAction.entity||selectedRows[0],uiGridCtrl.grid,event)}};uiGridCtrl.grid.toggleRowActionMenu=function(row,grid,event){CURRENT_ACTION_BTN=event.target;if(!row.isSelected){grid.api.selection.clearSelectedRows();grid.api.selection.selectRow(row.entity)}uiGridCtrl.grid.selectedRowAction=row;var items,selectedRows=grid.api.selection.getSelectedRows()||[];items=selectedRows.length>1&&_.isFunction(grid.options.rowContextMenuItems)?grid.options.rowContextMenuItems(selectedRows,grid,event):grid.options.rowActionMenuItems(row,grid,event);_.isArray(items)&&items.length>0&&$timeout((function(){scope.rowActionMenuList=items;var menuEle=angular.element(document.querySelector("#row-action-menu-dropdown-"+grid.id));!function(event,actionMenuEle){actionMenuEle.css({display:"block"});var targetLeft=$(event.target).offset().left+event.target.scrollWidth;var targetTop=$(event.target).offset().top+event.target.scrollHeight;var doc=$document[0].documentElement;var docLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),docTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elementWidth=actionMenuEle[0].scrollWidth,elementHeight=actionMenuEle[0].scrollHeight;var docWidth=doc.clientWidth+docLeft,docHeight=doc.clientHeight+docTop,totalWidth=targetLeft,totalHeight=elementHeight+targetTop,left=Math.max(targetLeft-docLeft-elementWidth,0),top=Math.max(targetTop-docTop,0);totalWidth>docWidth&&(left-=totalWidth-docWidth);totalHeight>docHeight&&(top-=totalHeight-docHeight+15);actionMenuEle.css("top",top+"px");actionMenuEle.css("left",left+"px");MENU_OPEN=!0;$rootScope.$emit(commonUiEvent.nbGridDropdownToggle,actionMenuEle[0].id)}(event,menuEle)}))};!function(gridId,scope2){scope2.rowActionMenuList=[];var element=$compile("<ul "+(atag?'atag = "'+atag+':actionMenu"':"")+' ng-show="rowActionMenuList.length>0" id="row-action-menu-dropdown-'+gridId+'" class="dropdown-menu nb-grid-action-menu-dropdown" uib-dropdown-menu><li ng-click="callActionMenuDropdown(item, $event)" ng-class="item.class" ng-repeat="item in rowActionMenuList" ng-hide="item.hide"><a ng-bind-html="::renderTemplate(item.template)"  ng-if="item.isCopy ==null || item.isCopy==false"></a><a ng-bind-html="::renderTemplate(item.template)"  ng-if="item.isCopy !=null && item.isCopy==true" clip-copy="getTextToCopy(item.event)"></a></li></ul>')(scope2);angular.element(document.body).append(element)}(uiGridCtrl.grid.id,scope);GRID_ID=uiGridCtrl.grid.id;$document.bind("click",handleClickEvent);$document.bind("contextmenu",handleClickEvent);uiGridCtrl.grid.api.core.on.sortChanged(scope,(function(){close($("#row-action-menu-dropdown-"+GRID_ID))}));var toggleWatcher=$rootScope.$on(commonUiEvent.nbGridDropdownToggle,(function(event,id){$timeout((function(){id!=="row-action-menu-dropdown-"+GRID_ID&&close($("#row-action-menu-dropdown-"+GRID_ID))}))}));uiGridCtrl.grid.appScope.$on("$destroy",(function(){$document.unbind("click",handleClickEvent);$document.unbind("contextmenu",handleClickEvent);$(document.querySelector("#row-action-menu-dropdown-"+GRID_ID)).remove();toggleWatcher()}))}function close(actionMenuEle){actionMenuEle.css({display:"none"});MENU_OPEN=!1;CURRENT_ACTION_BTN=null}scope.closeMenu=close;function handleClickEvent(event){var actionMenuEle=$("#row-action-menu-dropdown-"+GRID_ID);MENU_OPEN&&0===$(event.target).closest(CURRENT_ACTION_BTN).length&&close(actionMenuEle)}scope.getTextToCopy=function(event){if("function"==typeof event){return event(uiGridCtrl.grid.api.selection.getSelectedRows())}return""}},post:function(scope,ele,attrs,uiGridCtrl){if(uiGridCtrl.grid.options.enableRowActionMenu){uiGridCtrl.grid.api.selection.on.rowSelectionChanged(uiGridCtrl.grid.appScope,(function(){uiGridCtrl.grid.api.selection.getSelectedGridRows().length>1?$(ele).addClass("multiple-rows-selected"):$(ele).removeClass("multiple-rows-selected")}));uiGridCtrl.grid.api.core.on.rowsRendered(uiGridCtrl.grid.appScope,(function(){$timeout((function(){if($(ele).is(":visible")){var rows=$(ele).find(".ui-grid-render-container .ui-grid-row");var emptyCanvas=uiGridCtrl.grid.element.find(".grid-empty-canvas");emptyCanvas&&emptyCanvas.length;var isGroupHeaderActionMenu=uiGridCtrl.grid.options.enableGroupHeaderActionMenu;angular.forEach(rows,(function(row){if(!($(row).parents(".ui-grid-pinned-container").length>0||void 0!==isGroupHeaderActionMenu&&!isGroupHeaderActionMenu&&$(row).hasClass("ui-grid-tree-header-row"))){if($(row).find(".nb-grid-action-menu").length<=0){var rowScope=angular.element(row).scope();var actionMenuEle=$compile('<div class="nb-grid-action-menu"><i ng-click="grid.toggleRowActionMenu(row, grid, $event, rowRenderIndex)" class="icon_nb_action_menu"></i></div>')(rowScope);$(row).find("[ui-grid-row] .ui-grid-cell").last().after($compile(actionMenuEle)(rowScope))}$(row).find(".nb-grid-action-menu").css({right:0})}}))}}),500)}));$timeout((function(){$(ele).find(".ui-grid-render-container .ui-grid-viewport").on("scroll",_.debounce((function(){scope.closeMenu($("#row-action-menu-dropdown-"+uiGridCtrl.grid.id));var sl=$(this).scrollLeft();if(uiGridCtrl.PRE_HORI_POS!==sl){var rows=$(ele).find(".ui-grid-render-container .ui-grid-row");angular.forEach(rows,(function(row){$(row).find(".nb-grid-action-menu").css({right:0})}));uiGridCtrl.PRE_HORI_POS=sl}}),150))}))}}}}}}}(window.NetBrain);!function(netBrain){NetBrain.nbCommon.directive("nbGridEmptyContextMenu",NbGridEmptyContextMenu);NbGridEmptyContextMenu.$inject=["$rootScope","$compile","$sce","$document","$timeout","nb.ng.utilitySrvc"];function NbGridEmptyContextMenu($rootScope,$compile,$sce,$document,$timeout,utilitySrvc){return{restrict:"A",scope:!1,require:"?uiGrid",link:function(scope,ele,attr,uiGridCtrl){var grid=uiGridCtrl.grid;var atag=attr.atag;if(!grid.options.enableEmptyContextMenu)return;var localScope=scope.localScope={};var menuId="grid-empty-context-menu-dropdown-"+grid.id;var menu=null;localScope.renderTemplate=function(template){return $sce.trustAs("html",template)};localScope.doAction=function(item,event){angular.isFunction(item.action)&&item.action(grid,event)};!function(){(menu=$compile("<ul "+(atag?'atag = "'+atag+':emptyContextMenu"':"")+' id="'+menuId+'"class="dropdown-menu nb-grid-empty-context-menu-dropdown" uib-dropdown-menung-show="localScope.emptyContextMenuItems.length>1"><li ng-click="localScope.doAction(item, $event)" ng-class="item.class" ng-repeat="item in localScope.emptyContextMenuItems"><a ng-bind-html="localScope.renderTemplate(item.template)"></a></li></ul>')(scope)).id=menuId;angular.element(document.body).append(menu)}();$timeout((function(){var parent=$(ele).find(".ui-grid-canvas").parent().addClass("grid-with-empty-context");parent.on("contextmenu",openEmptyContextMenus);!function(parent){parent.css("padding-bottom","40px")}(parent)}));!function(){$document.bind("click",menuCloseChecker);$document.bind("contextmenu",menuCloseChecker);var cancelOtherMenuShowWatcher=$rootScope.$on("system::menushow",(function(event,data){data.menuId!==menu.id&&close()}));scope.$on("$destroy",(function(){$document.unbind("click",menuCloseChecker);$document.unbind("contextmenu",menuCloseChecker);cancelOtherMenuShowWatcher();menu.remove()}))}();return;function openEmptyContextMenus(event){var nodeClassList=event.target.classList;if(_.contains(nodeClassList,"ui-grid-viewport")){event.preventDefault();event.stopPropagation();!function(event){localScope.emptyContextMenuItems=grid.options.emptyContextMenuItems();var defaultPosition={left:event.pageX,top:event.pageY};$rootScope.$broadcast("system::menushow",{menuId:menuId});$timeout((function(){menu.show();grid.api.selection.clearSelectedRows()}));$timeout((function(){utilitySrvc.setMenuPosition(menu,defaultPosition)}));$("#row-context-menu-dropdown-"+grid.id).hide()}(event)}}function close(){menu.hide()}function menuCloseChecker(){close()}}}}}();!function(netBrain){NetBrain.nbCommon.directive("nbGridRowDblClick",NbGridRowDblClick);NbGridRowDblClick.$inject=["$rootScope"];function NbGridRowDblClick($rootScope){return{restrict:"A",scope:!1,require:"?uiGrid",link:function(scope,element,attr){var callback=function(){var callback2;var parentScope=scope;var attrName=attr.nbGridRowDblClick;for(;!callback2&&parentScope;){callback2=parentScope[attrName];parentScope=parentScope.$parent}return callback2}();angular.isFunction(callback)&&element.dblclick((function(event){event.preventDefault();$rootScope.$emit(commonUiEvent.nbGridDropdownToggle);var entity=(eventTarget=event.target,rowScope=function(eventTarget){var rowElement=function(eventTarget){var $ele=$(eventTarget);return $ele.hasClass("ui-grid-row")?eventTarget:$ele.closest(".ui-grid-row").get(0)}(eventTarget);return angular.element(rowElement).scope()}(eventTarget),rowScope&&rowScope.row.entity);var eventTarget,rowScope;entity&&callback(scope,entity,event)}));return}}}}();!function(){angular.module("nb.common").directive("nbDropdownTreeview",DropdownTree);DropdownTree.$inject=["$compile","$q"];function DropdownTree($compile,$q){var directive={scope:{treeOptions:"=",treeData:"=",disabled:"="},restrict:"EA",compile:function(){return{pre:function(scope,ele,attr){scope.treeOptions.enableUnselect=!1;scope.treeOptions.dropdownTree=!0;scope.treeOptions.checkedNodesById=function(ids){scope.treeOptions.treeObj.checkedNodesById(ids,(function(nodes,labels){setDropdownTitle(labels)}))};scope.treeOptions.className||(scope.treeOptions.className="");var dropdownTemp='<div id="dropdown-treeview-'+scope.$id+'" class="dropdown-menu dropdown-menu-custom nb-dropdown-tree-directive treeview-container '+scope.treeOptions.className+'" style="overflow:hidden;padding:0px 0px 3px 0px;"><div ng-if="treeOptions.loadingIconOnDisplayDropdown" ng-show="loadingTree" ng-disabled="true" class="text-center margin data-loading"><div class="background-box"></div><div class="ico-box"><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="tree-view-directive" nb-treeview="treeData" options="treeOptions" atag="nbDropdownTreeDirective:tree"></div></div>';var dropdownEle=$compile(dropdownTemp)(scope);$(dropdownEle).on("click",dropdownClickHandler);$(ele).find("button").on("click",btnClickHandler);$(document).on("mousedown",docClickHandler);$(document).on("click",docClickHandler);$(document.body).append(dropdownEle);scope.$on("$destroy",(function(){$(document).off("mousedown",docClickHandler);$(document).off("click",docClickHandler);$(ele).find("button").off("click",btnClickHandler);$(dropdownEle).off("click",dropdownClickHandler);$(document.body).children("#dropdown-treeview-"+scope.$id).remove()}));if(void 0!==scope.treeOptions.checkedCallBack){var userCallback=scope.treeOptions.checkedCallBack;scope.treeOptions.checkedCallBack=function(node){scope.treeOptions.treeObj.getCheckedNodes((function(nodes,ids,labels){setDropdownTitle(labels);userCallback(node,nodes,ids,labels)}),scope.treeOptions.enableCheckedAllNode,scope.treeOptions.checkFilter)}}else scope.treeOptions.checkedCallBack=function(node){scope.treeOptions.treeObj.getCheckedNodes((function(nodes,ids,labels){setDropdownTitle(labels)}),scope.treeOptions.enableCheckedAllNode,scope.treeOptions.checkFilter)};if(!scope.treeOptions.useCheckboxes){var clickCallback=scope.treeOptions.nodeClickCallback;scope.treeOptions.nodeClickCallback=function(node,event){setDropdownTitle([node[scope.treeOptions.labelAttribute||"name"]]);setTimeout((function(){$("body").click()}),10);clickCallback&&clickCallback(node)}}var watchTreeData=scope.$watch("treeData",(function(newVal,oldVal,scope2){if(newVal===oldVal);else if(scope2.titles){scope2.titles=[];scope.treeOptions.treeObj.updateTree()}}));var watchWidth=scope.$watch((function(){return $(ele).width()}),(function(newVal,oldVal){newVal&&oldVal&&newVal!==oldVal&&scope.setDropdownWidth()}));var watchTreeDataPlaceHolder=function(){};scope.treeOptions.needWatchPlaceHolder&&(watchTreeDataPlaceHolder=scope.$watch((function(){return attr.placeholder}),(function(){scope.setInitTitle(scope.treeData,scope.treeOptions,ele)})));scope.setInitTitle=function(data,options,ele2){var childAttr=options.childrenAttribute||"children";var selAttr=options.selectedAttribute||"selected";var labelAttr=options.labelAttribute||"label";var titleEle=$(ele2).find(".tree-select-title");scope.defaultTitle=angular.isDefined(attr.placeholder)?attr.placeholder:"Select";scope.titles=[];function getTitlesNode(root){if(_.isArray(root[childAttr]))_.forEach(root[childAttr],(function(subRoot){getTitlesNode(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}}var getTitles=null;getTitles=options.enableSetAllSelectedNodeTitle?function(node){if(node[selAttr]){scope.titles.indexOf(node[labelAttr])<0&&!node.avoidDropdownToggle&&scope.titles.push(node[labelAttr])}_.isArray(node[childAttr])&&_.forEach(node[childAttr],(function(subRoot){getTitlesNode(subRoot)}))}:options.enableSetNodeTitle?getTitlesNode:function getTitlesFolder(root){if(_.isArray(root[childAttr])&&!root[selAttr])_.forEach(root[childAttr],(function(subRoot){getTitlesFolder(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}};_.isArray(data)?_.forEach(data,(function(d){getTitles(d)})):getTitles(data);if(scope.titles.length>0){var fullTitle=scope.titles.join(", ");options.customizedTitle&&(fullTitle=scope.defaultTitle);titleEle.html(fullTitle);titleEle.prop("title",fullTitle)}else{titleEle.html(scope.defaultTitle);titleEle.prop("title",scope.defaultTitle)}};scope.setDropdownWidth=function(){var dropdownEle2=$("div#dropdown-treeview-"+scope.$id);dropdownEle2&&$(dropdownEle2).css({width:$(ele).width()>250?$(ele).width():250})};scope.setInitTitle(scope.treeData,scope.treeOptions,ele);function dropdownClickHandler(event){event.stopPropagation()}function btnClickHandler(event){$(".nb-sdn-panel-view-menu,.nb-sdn-panel-category-menu").hide();$(dropdownEle).css({width:$(ele).width()>250?$(ele).width():250});event.stopPropagation();if(!0!==scope.loadingTree){scope.loadingTree=!0;scope.treeOptions.loadingIconOnDisplayDropdown&&$(dropdownEle).find(".tree-view-directive").hide();(scope.treeOptions.beforeShowDropdownCallback||$q.resolve)(scope.treeOptions).then((function(){$(dropdownEle).find(".tree-view-directive").show();scope.loadingTree=!1}));var btn=$(event.target).closest(".nb-dropdown-tree-directive");var hasData=Array.isArray(scope.treeData)?scope.treeData.length>0:scope.treeData[scope.treeOptions.childrenAttribute||"children"].length>0;if(scope.treeData&&hasData||!0===scope.treeOptions.loadingIconOnDisplayDropdown){var dropdown=$(document.body).children("#dropdown-treeview-"+scope.$id);var maxHeight=parseInt(dropdown.css("max-height"));var clientHeight=$(document.body).height();var btnTop=btn.offset().top;var dropDownBottom=clientHeight-btnTop;clientHeight-btnTop-28<maxHeight?dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:"unset",bottom:dropDownBottom,left:btn.offset().left}):dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:btn.offset().top+28,left:btn.offset().left})}}}function docClickHandler(event){var targetTree=$(event.target).closest(".nb-dropdown-tree-directive.treeview-container");var targetId=targetTree.length>0?targetTree[0].id:"dropdown-treeview-XXXXX";var ids=_.map($(".nb-dropdown-tree-directive.treeview-container"),(function(ele3){return ele3.id}));$(event.target).attr("showDropDown")||_.each(ids,(function(id){id!==targetId&&$("#"+id).css({display:"none"})}))}function setDropdownTitle(labels){$(ele).find(".tree-select-title").html(labels.length>0?labels.join(", "):scope.defaultTitle);$(ele).find(".tree-select-title").prop("title",labels.length>0?labels.join(", "):scope.defaultTitle)}scope.$on("$destroy",(function(){watchTreeData();watchWidth();scope.treeOptions.needWatchPlaceHolder&&watchTreeDataPlaceHolder()}))},post:function(scope,ele){$(ele).on("click",clickHandler);$("#dropdown-treeview-"+scope.$id).css({width:$(ele).width()>250?$(ele).width():250});null!=scope.treeData&&scope.$on("nbTreeview.nodeSelected",(function(event){event.stopPropagation();scope.setInitTitle(scope.treeData,scope.treeOptions,ele)}));function clickHandler(e){var element;for(element=e.target;element;element=element.parentNode){var classNames=element.className;if("string"==typeof classNames&&(classNames.indexOf("treeview-container")>-1&&scope.treeOptions.enableMultipleSelect)){e.stopPropagation();return}}}scope.$on("$destroy",(function(){$(ele).off("click",clickHandler)}))}}},replace:!0,template:'<div class="btn-group dropdown nb-dropdown-tree-directive"><button class="btn btn-default dropdown-body dropdown-body-custom tree-select-title" ng-disabled="disabled"></button><button class="btn dropdown-toggle" ng-disabled="disabled"><div class="icon-container"><span class="icon_nb_arrow_down"></span></div></button></div>',controller:Controller};Controller.$inject=[];function Controller(){}return directive}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbDropdownTreeDirective",DropdownTree);DropdownTree.$inject=["$compile","$q"];function DropdownTree($compile,$q){var directive={scope:{treeOptions:"=",treeData:"=",disabled:"="},restrict:"EA",compile:function(){return{pre:function(scope,ele,attr){scope.treeOptions.enableUnselect=!1;scope.treeOptions.className||(scope.treeOptions.className="");var dropdownTemp='<div id="dropdown-treeview-'+scope.$id+'" class="dropdown-menu dropdown-menu-custom nb-dropdown-tree-directive treeview-container '+scope.treeOptions.className+'"><div ng-if="treeOptions.loadingIconOnDisplayDropdown" ng-show="loadingTree" ng-disabled="true" class="text-center margin data-loading"><div class="background-box"></div><div class="ico-box"><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="tree-view-directive" nb-treeview-directive="treeData" options="treeOptions" watch-data atag="nbDropdownTreeDirective:tree"></div></div>';var dropdownEle=$compile(dropdownTemp)(scope);$(dropdownEle).on("click",dropdownClickHandler);$(ele).find("button").on("click",btnClickHandler);$(document).on("mousedown",docClickHandler);$(document).on("click",docClickHandler);$(document.body).append(dropdownEle);scope.$on("$destroy",(function(){$(document).off("mousedown",docClickHandler);$(document).off("click",docClickHandler);$(ele).off("click",btnClickHandler);$(dropdownEle).off("click",dropdownClickHandler);$(document.body).children("#dropdown-treeview-"+scope.$id).remove()}));if(void 0!==scope.treeOptions.nodeClickCallback){var userCallback=scope.treeOptions.nodeClickCallback;scope.treeOptions.nodeClickCallback=function(node,trvw){(!node[scope.treeOptions.childrenAttribute]||node[scope.treeOptions.childrenAttribute].length<=0||!scope.treeOptions.enableLabelExpand)&&setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect);userCallback(node,trvw)}}else scope.treeOptions.nodeClickCallback=function(node,trvw){!trvw.isLeaf(node)&&scope.treeOptions.enableLabelExpand||setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect)};var watchTreeData=scope.$watch("treeData",(function(newVal,oldVal,scope2){if(newVal===oldVal);else if(scope2.titles){scope2.titles=[];scope2.setInitTitle(scope2.treeData,scope2.treeOptions,ele)}}));var watchWidth=scope.$watch((function(){return $(ele).width()}),(function(newVal,oldVal){newVal&&oldVal&&newVal!==oldVal&&scope.setDropdownWidth()}));var watchTreeDataPlaceHolder=function(){};scope.treeOptions.needWatchPlaceHolder&&(watchTreeDataPlaceHolder=scope.$watch((function(){return attr.placeholder}),(function(){scope.setInitTitle(scope.treeData,scope.treeOptions,ele)})));scope.setInitTitle=function(data,options,ele2){var childAttr=options.childrenAttribute||"children";var selAttr=options.selectedAttribute||"selected";var labelAttr=options.labelAttribute||"label";var titleEle=$(ele2).find(".tree-select-title");scope.defaultTitle=angular.isDefined(attr.placeholder)?attr.placeholder:"Select";scope.titles=[];function getTitlesNode(root){if(_.isArray(root[childAttr]))_.forEach(root[childAttr],(function(subRoot){getTitlesNode(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}}var getTitles=null;getTitles=options.enableSetAllSelectedNodeTitle?function(node){if(node[selAttr]){scope.titles.indexOf(node[labelAttr])<0&&!node.avoidDropdownToggle&&scope.titles.push(node[labelAttr])}_.isArray(node[childAttr])&&_.forEach(node[childAttr],(function(subRoot){getTitlesNode(subRoot)}))}:options.enableSetNodeTitle?getTitlesNode:function getTitlesFolder(root){if(_.isArray(root[childAttr])&&!root[selAttr])_.forEach(root[childAttr],(function(subRoot){getTitlesFolder(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}};_.isArray(data)?_.forEach(data,(function(d){getTitles(d)})):getTitles(data);if(scope.titles.length>0){var fullTitle=scope.titles.join(", ");options.customizedTitle&&(fullTitle=scope.defaultTitle);titleEle.html(fullTitle);titleEle.prop("title",fullTitle)}else{titleEle.html(scope.defaultTitle);titleEle.prop("title",scope.defaultTitle)}};scope.setDropdownWidth=function(){var dropdownEle2=$("div#dropdown-treeview-"+scope.$id);dropdownEle2&&$(dropdownEle2).css({width:$(ele).width()>250?$(ele).width():250})};scope.setInitTitle(scope.treeData,scope.treeOptions,ele);function dropdownClickHandler(event){var target=$(event.target);var s=angular.element(target).scope();if(s.node){if(s.node.avoidDropdownToggle)return;var children=s.node[scope.treeOptions.childrenAttribute||"children"];var dropdown=$(document.body).children("#dropdown-treeview-"+scope.$id);children&&!(children.length<=0)||scope.treeOptions.enableMultipleSelect||scope.treeOptions.enableLabelExpand||dropdown.css({display:"none"})}}function btnClickHandler(event){$(".nb-sdn-panel-view-menu,.nb-sdn-panel-category-menu").hide();$(dropdownEle).css({width:$(ele).width()>250?$(ele).width():250});event.stopPropagation();if(!0!==scope.loadingTree){scope.loadingTree=!0;scope.treeOptions.loadingIconOnDisplayDropdown&&$(dropdownEle).find(".tree-view-directive").hide();(scope.treeOptions.beforeShowDropdownCallback||$q.resolve)(scope.treeOptions).then((function(){$(dropdownEle).find(".tree-view-directive").show();scope.loadingTree=!1}));var btn=$(event.target).closest(".nb-dropdown-tree-directive");var hasData=Array.isArray(scope.treeData)?scope.treeData.length>0:scope.treeData[scope.treeOptions.childrenAttribute||"children"].length>0;if(scope.treeData&&hasData||!0===scope.treeOptions.loadingIconOnDisplayDropdown){var dropdown=$(document.body).children("#dropdown-treeview-"+scope.$id);var maxHeight=parseInt(dropdown.css("max-height"));var clientHeight=$(document.body).height();var btnTop=btn.offset().top;var dropDownBottom=clientHeight-btnTop;clientHeight-btnTop-28<maxHeight?dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:"unset",bottom:dropDownBottom,left:btn.offset().left}):dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:btn.offset().top+28,left:btn.offset().left})}}}function docClickHandler(event){var targetTree=$(event.target).closest(".nb-dropdown-tree-directive.treeview-container");var targetId=targetTree.length>0?targetTree[0].id:"dropdown-treeview-XXXXX";var ids=_.map($(".nb-dropdown-tree-directive.treeview-container"),(function(ele3){return ele3.id}));$(event.target).attr("showDropDown")||_.each(ids,(function(id){id!==targetId&&$("#"+id).css({display:"none"})}))}function setDropdownTitle(label,isSelect,isMultiple){isMultiple||(scope.titles=[]);var index=scope.titles.indexOf(label);-1===index&&isSelect?scope.titles.push(label):index>-1&&!isSelect&&scope.titles.splice(index,1);$(ele).find(".tree-select-title").html(scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle);$(ele).find(".tree-select-title").prop("title",scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle)}scope.$on("$destroy",(function(){watchTreeData();watchWidth();scope.treeOptions.needWatchPlaceHolder&&watchTreeDataPlaceHolder()}))},post:function(scope,ele){$(ele).on("click",clickHandler);$("#dropdown-treeview-"+scope.$id).css({width:$(ele).width()>250?$(ele).width():250});null!=scope.treeData&&scope.$on("nbTreeview.nodeSelected",(function(event){event.stopPropagation();scope.setInitTitle(scope.treeData,scope.treeOptions,ele)}));function clickHandler(e){var element;for(element=e.target;element;element=element.parentNode){var classNames=element.className;if("string"==typeof classNames&&(classNames.indexOf("treeview-container")>-1&&scope.treeOptions.enableMultipleSelect)){e.stopPropagation();return}}}scope.$on("$destroy",(function(){$(ele).off("click",clickHandler)}))}}},replace:!0,template:'<div class="btn-group dropdown nb-dropdown-tree-directive"><button class="btn btn-default dropdown-body dropdown-body-custom tree-select-title" ng-disabled="disabled"></button><button class="btn dropdown-toggle" ng-disabled="disabled"><div class="icon-container"><span class="icon_nb_arrow_down"></span></div></button></div>',controller:Controller};Controller.$inject=[];function Controller(){}return directive}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbDropdownTreeInDashboardDirective",DropdownTree);DropdownTree.$inject=["$compile"];function DropdownTree($compile){var directive={scope:{treeOptions:"=",treeData:"="},restrict:"EA",compile:function(){return{pre:function(scope,ele,attr){ele.attr("id","dropdown-treeview-"+scope.$id);var dropdownTemp=$('<div class="dropdown-menu dropdown-menu-custom treeview-container"><div nb-treeview-directive="treeData" options="treeOptions" watch-data></div></div>');var dropdownEle=$compile(dropdownTemp)(scope);$(dropdownEle).on("click",dropdownClickHandler.bind(null,dropdownEle));$(dropdownEle).css({width:$(ele).width()>250?$(ele).width():250});$(ele).find("button").on("click",btnClickHandler.bind(null,dropdownEle));$(document).on("mousedown",docClickHandler.bind(null,dropdownEle,ele));$(document).on("click",docClickHandler.bind(null,dropdownEle,ele));$(ele).append(dropdownEle);scope.$on("$destroy",(function(){$(document).off("mousedown",docClickHandler);$(document).off("click",docClickHandler);$(ele).off("click",btnClickHandler);$(dropdownEle).off("click",dropdownClickHandler);dropdownEle.remove()}));if(void 0!==scope.treeOptions.nodeClickCallback){var userCallback=scope.treeOptions.nodeClickCallback;scope.treeOptions.nodeClickCallback=function(node,trvw){(!node[scope.treeOptions.childrenAttribute]||node[scope.treeOptions.childrenAttribute].length<=0||!scope.treeOptions.enableLabelExpand)&&setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect);userCallback(node,trvw)}}else scope.treeOptions.nodeClickCallback=function(node,trvw){!trvw.isLeaf(node)&&scope.treeOptions.enableLabelExpand||setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect)};var watchTreeData=scope.$watch("treeData",(function(newVal,oldVal,scope2){if(newVal===oldVal);else if(scope2.titles){scope2.titles=[];scope2.setInitTitle(scope2.treeData,scope2.treeOptions,ele)}}));scope.setInitTitle=function(data,options,ele2){var childAttr=options.childrenAttribute||"children";var selAttr=options.selectedAttribute||"selected";var labelAttr=options.labelAttribute||"label";var titleEle=$(ele2).find(".tree-select-title");scope.defaultTitle=angular.isDefined(attr.placeholder)?attr.placeholder:"Select";scope.titles=[];function getTitles(root){if(_.isArray(root[childAttr])&&!root[selAttr])_.forEach(root[childAttr],(function(subRoot){getTitles(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}}_.isArray(data)?_.forEach(data,(function(d){getTitles(d)})):getTitles(data);if(scope.titles.length>0){var fullTitle=scope.titles.join(", ");titleEle.html(fullTitle);titleEle.prop("title",fullTitle)}else{titleEle.html(scope.defaultTitle);titleEle.prop("title",scope.defaultTitle)}};scope.setInitTitle(scope.treeData,scope.treeOptions,ele);function dropdownClickHandler(treeEl,event){event.stopPropagation();var target=$(event.target);var s=angular.element(target).scope();if(s&&s.node){if(s.node.avoidDropdownToggle)return;var children=s.node[scope.treeOptions.childrenAttribute||"children"];(children&&!(children.length<=0)||scope.treeOptions.enableMultipleSelect)&&scope.treeOptions.enableLabelExpand||treeEl.css({display:"none"})}}function btnClickHandler(treeEl){var hasData=Array.isArray(scope.treeData)?scope.treeData.length>0:scope.treeData[scope.treeOptions.childrenAttribute||"children"].length>0;scope.treeData&&hasData&&treeEl.toggle()}function docClickHandler(treeEl,el,event){var targetTree=$(event.target).closest(".nb-dropdown-tree-directive");targetTree.length&&targetTree[0].id===el[0].id||treeEl.hide()}function setDropdownTitle(label,isSelect,isMultiple){isMultiple||(scope.titles=[]);var index=scope.titles.indexOf(label);-1===index&&isSelect?scope.titles.push(label):index>-1&&!isSelect&&scope.titles.splice(index,1);$(ele).find(".tree-select-title").html(scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle);$(ele).find(".tree-select-title").prop("title",scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle)}scope.$on("$destroy",(function(){watchTreeData()}))},post:function(scope,ele){$(ele).on("click",clickHandler);$("#dropdown-treeview-"+scope.$id).css({width:$(ele).width()>250?$(ele).width():250});null!=scope.treeData&&scope.$on("nbTreeview.nodeSelected",(function(event){event.stopPropagation();scope.setInitTitle(scope.treeData,scope.treeOptions,ele)}));function clickHandler(e){var element;for(element=e.target;element;element=element.parentNode){var classNames=element.className;if("string"==typeof classNames&&(classNames.indexOf("treeview-container")>-1&&scope.treeOptions.enableMultipleSelect)){e.stopPropagation();return}}}scope.$on("$destroy",(function(){$(ele).off("click",clickHandler)}))}}},replace:!0,template:'<div class="btn-group dropdown nb-dropdown-tree-directive"><button class="btn btn-default dropdown-body dropdown-body-custom tree-select-title"></button><button class="btn dropdown-toggle"><div class="icon-container"><span class="icon_nb_arrow_down"></span></div></button></div>',controller:Controller};Controller.$inject=[];function Controller(){}return directive}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbDropdownTreeWithTabDirective",DropdownTree);DropdownTree.$inject=["$compile","$q","$timeout"];function DropdownTree($compile,$q,$timeout){var directive={scope:{treeOptions:"=",treeData:"=",disabled:"=",tabArray:"="},restrict:"EA",compile:function(){return{pre:function(scope,ele,attr){scope.treeOptions.enableUnselect=!1;scope.treeOptions.className||(scope.treeOptions.className="");var dropdownTemp='<div id="dropdown-treeview-'+scope.$id+'" class="dropdown-menu dropdown-menu-custom nb-dropdown-tree-directive treeview-container '+scope.treeOptions.className+'"><div ng-if="treeOptions.loadingIconOnDisplayDropdown" ng-show="loadingTree" ng-disabled="true" class="text-center margin data-loading"><div class="background-box"></div><div class="ico-box"><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div><div><a style="padding-right: 36px" ng-repeat="tab in tabArray" ng-click="tab.getTreeData($index)">{{tab.title}}</a></div><div class="tree-view-directive" nb-treeview-directive="treeData" options="treeOptions" watch-data></div></div></div>';var dropdownEle=$compile(dropdownTemp)(scope);$(dropdownEle).on("click",dropdownClickHandler);$(dropdownEle).css({width:$(ele).width()>250?$(ele).width():250});$(ele).find("button").on("click",btnClickHandler);$(document).on("mousedown",docClickHandler);$(document).on("click",docClickHandler);$(document.body).append(dropdownEle);scope.$on("$destroy",(function(){$(document).off("mousedown",docClickHandler);$(document).off("click",docClickHandler);$(ele).off("click",btnClickHandler);$(dropdownEle).off("click",dropdownClickHandler);$(document.body).children("#dropdown-treeview-"+scope.$id).remove()}));if(void 0!==scope.treeOptions.nodeClickCallback){var userCallback=scope.treeOptions.nodeClickCallback;scope.treeOptions.nodeClickCallback=function(node,trvw){(!node[scope.treeOptions.childrenAttribute]||node[scope.treeOptions.childrenAttribute].length<=0||!scope.treeOptions.enableLabelExpand)&&setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect);userCallback(node,trvw)}}else scope.treeOptions.nodeClickCallback=function(node,trvw){!trvw.isLeaf(node)&&scope.treeOptions.enableLabelExpand||setDropdownTitle(node[scope.treeOptions.labelAttribute],node[scope.treeOptions.selectedAttribute],scope.treeOptions.enableMultipleSelect)};var watchTreeData=scope.$watch("treeData",(function(newVal,oldVal,scope2){if(newVal===oldVal);else if(scope2.titles){scope2.titles=[];scope2.setInitTitle(scope2.treeData,scope2.treeOptions,ele)}}));var watchWidth=scope.$watch((function(){return $(ele).width()}),(function(newVal,oldVal){newVal&&oldVal&&newVal!==oldVal&&scope.setDropdownWidth()}));var watchTreeDataPlaceHolder=function(){};scope.treeOptions.needWatchPlaceHolder&&(watchTreeDataPlaceHolder=scope.$watch((function(){return attr.placeholder}),(function(){scope.setInitTitle(scope.treeData,scope.treeOptions,ele)})));scope.setInitTitle=function(data,options,ele2){var childAttr=options.childrenAttribute||"children";var selAttr=options.selectedAttribute||"selected";var labelAttr=options.labelAttribute||"label";var titleEle=$(ele2).find(".tree-select-title");scope.defaultTitle=angular.isDefined(attr.placeholder)?attr.placeholder:"Select";scope.titles=[];var getTitles=options.enableSetNodeTitle?function getTitlesNode(root){if(_.isArray(root[childAttr]))_.forEach(root[childAttr],(function(subRoot){getTitlesNode(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}}:function getTitlesFolder(root){if(_.isArray(root[childAttr])&&!root[selAttr])_.forEach(root[childAttr],(function(subRoot){getTitlesFolder(subRoot)}));else if(root[selAttr]){scope.titles.indexOf(root[labelAttr])<0&&!root.avoidDropdownToggle&&scope.titles.push(root[labelAttr])}};_.isArray(data)?_.forEach(data,(function(d){getTitles(d)})):getTitles(data);if(scope.titles.length>0){var fullTitle=scope.titles.join(", ");titleEle.html(fullTitle);titleEle.prop("title",fullTitle)}else{titleEle.html(scope.defaultTitle);titleEle.prop("title",scope.defaultTitle)}};scope.setDropdownWidth=function(){var dropdownEle2=$("div#dropdown-treeview-"+scope.$id);dropdownEle2&&$(dropdownEle2).css({width:$(ele).width()>250?$(ele).width():250})};scope.setInitTitle(scope.treeData,scope.treeOptions,ele);function dropdownClickHandler(event){var target=$(event.target);var s=angular.element(target).scope();if(s.node){if(s.node.avoidDropdownToggle)return;var children=s.node[scope.treeOptions.childrenAttribute||"children"];var dropdown=$(document.body).children("#dropdown-treeview-"+scope.$id);children&&!(children.length<=0)||scope.treeOptions.enableMultipleSelect||scope.treeOptions.enableLabelExpand||dropdown.css({display:"none"})}}function btnClickHandler(event){event.stopPropagation();if(!0!==scope.loadingTree){scope.loadingTree=!0;scope.treeOptions.loadingIconOnDisplayDropdown&&$(dropdownEle).find(".tree-view-directive").hide();(scope.treeOptions.beforeShowDropdownCallback||$q.resolve)(scope.treeOptions).then((function(){$(dropdownEle).find(".tree-view-directive").show();scope.loadingTree=!1}));var btn=$(event.target).closest(".nb-dropdown-tree-directive");var hasData=Array.isArray(scope.treeData)?scope.treeData.length>0:scope.treeData[scope.treeOptions.childrenAttribute||"children"].length>0;if(scope.treeData&&hasData||!0===scope.treeOptions.loadingIconOnDisplayDropdown){var dropdown=$(document.body).children("#dropdown-treeview-"+scope.$id);var maxHeight=parseInt(dropdown.css("max-height"));var clientHeight=$(document.body).height();var btnTop=btn.offset().top;var dropDownBottom=clientHeight-btnTop;clientHeight-btnTop-28<maxHeight?dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:"unset",bottom:dropDownBottom,left:btn.offset().left}):dropdown.css({display:"block"===dropdown.css("display")?"none":"block",top:btn.offset().top+28,left:btn.offset().left})}}}function docClickHandler(event){var targetTree=$(event.target).closest(".nb-dropdown-tree-directive.treeview-container");var targetId=targetTree.length>0?targetTree[0].id:"dropdown-treeview-XXXXX";var ids=_.map($(".nb-dropdown-tree-directive.treeview-container"),(function(ele3){return ele3.id}));_.each(ids,(function(id){id!==targetId&&$("#"+id).css({display:"none"})}))}function setDropdownTitle(label,isSelect,isMultiple){isMultiple||(scope.titles=[]);var index=scope.titles.indexOf(label);-1===index&&isSelect?scope.titles.push(label):index>-1&&!isSelect&&scope.titles.splice(index,1);$(ele).find(".tree-select-title").html(scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle);$(ele).find(".tree-select-title").prop("title",scope.titles.length>0?scope.titles.join(", "):scope.defaultTitle)}scope.$on("$destroy",(function(){watchTreeData();watchWidth();scope.treeOptions.needWatchPlaceHolder&&watchTreeDataPlaceHolder()}))},post:function(scope,ele){$(ele).on("click",clickHandler);$("#dropdown-treeview-"+scope.$id).css({width:$(ele).width()>250?$(ele).width():250});null!=scope.treeData&&scope.$on("nbTreeview.nodeSelected",(function(event){event.stopPropagation();scope.setInitTitle(scope.treeData,scope.treeOptions,ele)}));function clickHandler(e){var element;for(element=e.target;element;element=element.parentNode){var classNames=element.className;if("string"==typeof classNames&&(classNames.indexOf("treeview-container")>-1&&scope.treeOptions.enableMultipleSelect)){e.stopPropagation();return}}}scope.$on("$destroy",(function(){$(ele).off("click",clickHandler)}))}}},replace:!0,template:'<div class="btn-group dropdown nb-dropdown-tree-directive"><button class="btn btn-default dropdown-body dropdown-body-custom tree-select-title" ng-disabled="disabled"></button><button class="btn dropdown-toggle" ng-disabled="disabled"><div class="icon-container"><span class="icon_nb_arrow_down"></span></div></button></div>',controller:Controller};Controller.$inject=["$scope"];function Controller($scope){$scope.getTreeData=function(index){}}return directive}}(window.NetBrain);!function(){angular.module("nb.common").directive("nbSelect",(function(){return{restrict:"E",transclude:!0,scope:{placeholder:"@",disabled:"=",ngModel:"=",noTimeout:"=",options:"&",change:"=",optionClick:"&?",optionClicked:"=?",enableHover:"@",labelField:"@",valueField:"@",atag:"@"},replace:!0,require:["nbSelect","ngModel"],controllerAs:"nbSelect",controller:["$scope","$element","$attrs","$transclude","$parse","$compile","$sce","$timeout",controllerFn],link:function(scope,element,attrs,ctrls,transclude){scope.enableHover=scope.enableHover||!0;var ngModel=ctrls[1];ctrls=ctrls[0];element.find("ul.dropdown-menu").on("click",">*",(function(e){var li=e.currentTarget;var oldModel=scope.ngModel;scope.ngModel=li.attributes.$$value;ngModel.$setViewValue(li.attributes.$$value);scope.$apply();scope.optionClick&&scope.optionClick();angular.isFunction(scope.optionClicked)&&scope.optionClicked(oldModel,scope.ngModel)}));transclude(ctrls.transcludeFn);ctrls.refresh(element.find("ul.dropdown-menu"))},template:function(tElement,tAttrs){var editable=void 0!==tElement.attr("editable");var atagString=tAttrs.atag?'atag = "'+tAttrs.atag+'"':"";return editable?["<div "+atagString+' class="input-group dropdown">','<input type="text" class="form-control" ng-model="ngModel" placeholder="{{nbDropdownPlaceholder || \' \'}}" ng-disabled="isDisabled">','<div class="input-group-btn">','    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-disabled="isDisabled">','        <div class="icon-container"><span class="icon_nb_arrow_down"></span></div>',"    </button>",'    <ul class="dropdown-menu" uib-dropdown-menu role="menu" ng-transclude>',"    </ul></div></div>"].join(""):["<div "+atagString+' class="btn-group dropdown"  ng-mouseenter="showArr=true" ng-mouseleave="showArr=false">','<button type="button" class="btn btn-default dropdown-body dropdown-body-custom" data-toggle="dropdown" ng-disabled="disabled">','<span ng-if="!selectedLabel" class="dropdown-placeholder" ng-bind-html="placeholder || \'select\'"></span>','<span ng-if="selectedLabel" class="dropdown-selection" data-ng-bind-html="selectedLabel"></span>',"</button>",'<button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false" ng-disabled="disabled">','<div class="icon-container"><span ng-class="{icon_nb_arrow_down: enableHover==true||showArr==true}" ></span></div>','<span class="sr-only">Toggle Dropdown</span>',"</button>",'<ul class="dropdown-menu dropdown-menu-custom" uib-dropdown-menu role="menu">',"</ul>","</div>"].join("")}}}));angular.module("nb.common").directive("nbOption",(function(){return{restrict:"E",transclude:!0,replace:!0,template:"<li><a ng-transclude></a></li>",require:"^?nbSelect",link:function(scope,element,attrs,ctrls,transclude){if(element[0].attributes.$$selected){transclude((function(clone){ctrls.setSelectedLabel(clone.html())}));delete element[0].attributes.$$selected}}}}));function controllerFn($scope,$element,$attrs,$transclude,$parse,$compile,$sce,$timeout){$scope.liTpl='<li><a title="<%='+getLabelField()+'%>"><%-'+getLabelField()+"%></a></li>";var ctrls=this;void 0!==$attrs.options&&($scope.options=$parse($attrs.options)($scope.$parent));function getLabelField(){return $scope.labelField||"label"}this.compileLi=function(tpl,options){var elements=[];angular.forEach(options,(function(item){var tpl2=$scope.liTpl;var el;var model;if(angular.isObject(item))model=item;else{(model={})[getLabelField()]=item;$scope.valueField=getLabelField()}if(/.*{{.*}}.*/.test(tpl2)){var scope=$scope.$new(!1);scope=_.extend(scope,model);(el=$compile($scope.liTpl)(scope)[0]).attributes["ng-value"]?el.attributes.$$value=$parse(el.attributes["ng-value"].value)(scope):$scope.valueField?el.attributes.$$value=model[$scope.valueField]:el.attributes.$$value=item}else(el=$(_.template(tpl2)(model))[0]).attributes["ng-value"]?el.attributes.$$value=model[el.attributes["ng-value"].value]:$scope.valueField?el.attributes.$$value=model[$scope.valueField]:el.attributes.$$value=item;el.attributes.$$item=item;$(el).addClass("nb-select-option");elements.push(el);if(void 0!==$scope.ngModel&&_.isEqual($scope.ngModel,el.attributes.$$value)){$(el).addClass("active");$scope.noTimeout?$scope.selectedLabel=$sce.trustAsHtml(el.innerHTML):$timeout((function(){$scope.selectedLabel=$sce.trustAsHtml(el.innerHTML)}))}}));var ulEle=$element.find(".dropdown-menu");0===elements.length?ulEle.addClass(" dropdown-menu-zero"):ulEle.removeClass(" dropdown-menu-zero");return elements};this.onModelChange=function(li){$element.find("ul.dropdown-menu>*.active").removeClass("active");$(li).addClass("active");this.onChange(li.attributes.$$value,li.attributes.$$item,li);$scope.selectedLabel=$sce.trustAsHtml(li.innerHTML);if(!(void 0!==$element.attr("editable"))){var buttonList=$element.find("button");buttonList&&buttonList.length>0&&(buttonList[0].title=li.innerText)}};this.onChange=function(val,model,li){angular.isFunction($scope.change)&&$scope.change(val,model,li)};this.refresh=function(){$element.find("ul.dropdown-menu>.nb-select-option").remove();$element.find("ul.dropdown-menu").prepend(this.compileLi($scope.liTpl,$scope.options))};this.refreshActive=function(){var val=$scope.ngModel;$scope.selectedLabel=null;$element.find("ul.dropdown-menu>*").each((function(index,el){if(el.attributes&&_.isEqual(el.attributes.$$value,val)){ctrls.onModelChange(el,!1);return!1}return!0}))};this.setSelectedLabel=function(val){$scope.selectedLabel=$sce.trustAsHtml(val)};this.transcludeFn=function(clone,scope){angular.forEach(clone,(function(c){if(c.tagName==="script".toUpperCase())$scope.liTpl=c.innerHTML.trim();else if(c.attributes){c.attributes["ng-value"]?c.attributes.$$value=$parse(c.attributes["ng-value"].value)(scope):c.attributes.value&&(c.attributes.$$value=c.attributes.value.value);if(void 0!==$scope.ngModel&&_.isEqual($scope.ngModel,c.attributes.$$value)){c.attributes.$$selected=!0;$(c).addClass("active")}$element.find("ul.dropdown-menu").append(c)}}))};var watchCollection=$scope.$watch((function(){if(void 0!==$scope.options){var options=$parse($attrs.options)($scope.$parent);_.isEqual(options,$scope.options)||($scope.options=options);return $scope.options}}),(function(newOptions,oldOptions){newOptions!==oldOptions&&ctrls.refresh($element.find("ul.dropdown-menu"))}),!0);var watchModel=$scope.$watch("ngModel",(function(newVal){if(_.isNull(newVal)||_.isUndefined(newVal)){$scope.selectedLabel=null;if(!(void 0!==$element.attr("editable"))){var buttonList=$element.find("button");buttonList&&buttonList.length>0&&$(buttonList[0]).removeAttr("title")}}else ctrls.refreshActive()}),!0);$scope.$on("$destroy",(function(){watchCollection();watchModel()}))}}(NetBrain);angular.module("nb.common").directive("nbInterfacePropertyTreeDirective",["$log","$filter","nb.systemmodel.deviceSchemaMgrSrvc","ivhTreeviewMgr",function($log,$filter,deviceSchemaMgrSrvc,ivhTreeviewMgr){return{replace:!0,restrict:"E",scope:{intfType:"=",targetValueTypes:"=?",isMultiSelect:"=?",isOnlyLeafSelectable:"=?",isDisplayInDataview:"=?",selectedNodes:"=",filterText:"=?",preSelectedIntfSchemaIds:"="},templateUrl:"modules/nbCommon/views/nbInterfacePropertyTreeDirective.html",link:function(scope){!function(){scope.treeOptions={enableTwoWayBinding:!0,labelAttribute:"displayName",idAttribute:"ID",childrenAttribute:"child",expandToDepth:-1,selectedAttribute:"selected",enableMultipleSelect:!!scope.isMultiSelect&&scope.isMultiSelect,labelTemplate:function(node){return"<span>"+$filter("nbHighlight")(node.displayName,scope.filterText)+"</span>"},nodeClickCallback:onSelectNode};scope.treeData=[];var intfSchemaObj=deviceSchemaMgrSrvc.getSchemaObjByKey(scope.intfType);var lsSchemaObjs=getIntfSchemasByType(scope.intfType);var firstTree={ID:intfSchemaObj.getID(),displayName:intfSchemaObj.getDisplayName(),selected:!1,isSchema:!0,isParent:!0,child:[]};firstTree.child=getNodeValueForTree(lsSchemaObjs);firstTree.child&&firstTree.child.length>0&&scope.treeData.push(firstTree);if(intfSchemaObj.isPhantomInterface()){var associateSchemaId=intfSchemaObj.getAssociatedSchema();if(!associateSchemaId){$log.error("Internal Error -- nbInterfacePropertyTreeDirective");return}var associateIntfType=DeviceTableProcessor.getFirstPartBeforeDot(associateSchemaId);var associateIntfSchemaObjs=getIntfSchemasByType(associateIntfType);var associateSchemaObj=deviceSchemaMgrSrvc.getSchemaObjByKey(associateIntfType);var secondTree={ID:associateSchemaObj.getID(),displayName:associateSchemaObj.getDisplayName(),selected:!1,isSchema:!0,isParent:!0,child:[]};secondTree.child=getNodeValueForTree(associateIntfSchemaObjs);scope.treeData.push(secondTree)}scope.treeData_backup=angular.copy(scope.treeData);scope.isDataReady=!0}();function getIntfSchemasByType(strIntfType){return deviceSchemaMgrSrvc.getDisplayedIntfSchemasByIntfTypeAndValueType(strIntfType,scope.targetValueTypes,scope.isDisplayInDataview)}function getNodeValueForTree(lsSchemaObjs){lsSchemaObjs.sort((function(s1,s2){return s1.getDisplayName().localeCompare(s2.getDisplayName())}));return lsSchemaObjs.map((function(schemaObj){return{ID:schemaObj.getID(),displayName:schemaObj.getDisplayName(),type:schemaObj.getType(),isSchema:!0,selected:scope.preSelectedIntfSchemaIds&&scope.preSelectedIntfSchemaIds.indexOf(schemaObj.getID())>-1}}))}function onSelectNode(node){if(scope.isMultiSelect)!function(bExcludeFolder,refLsSelectedNodes){for(;refLsSelectedNodes.length>0;)refLsSelectedNodes.pop();for(var i in scope.treeData)if({}.hasOwnProperty.call(scope.treeData,i)){var subTree=scope.treeData[i];!bExcludeFolder&&subTree.selected&&refLsSelectedNodes.push({ID:subTree.ID,displayName:subTree.displayName});var lsChildNodes=subTree.child;for(var j in lsChildNodes)if({}.hasOwnProperty.call(lsChildNodes,j)){var childNode=lsChildNodes[j];childNode.selected&&refLsSelectedNodes.push(childNode)}}}(scope.isOnlyLeafSelectable,scope.selectedNodes);else{for(;scope.selectedNodes.length>0;)scope.selectedNodes.pop();if(scope.isOnlyLeafSelectable&&node.isParent)return;scope.selectedNodes.push(node)}}scope.$watch("filterText",(function(){scope.refreshData()}),!0);scope.refreshData=function(){scope.filterText&&0!==scope.filterText.length?scope.treeData=function(query){var newTreeData=angular.copy(scope.treeData_backup);for(var i=0;i<newTreeData.length;i++){var children=newTreeData[i].child;if(children&&0!==children.length){for(var j=0;j<children.length;j++)children[j].displayName.toLowerCase().indexOf(query.toLowerCase())<0&&children.splice(j--,1);0===children.length&&newTreeData.splice(i--,1)}}return newTreeData}(scope.filterText):scope.treeData=angular.copy(scope.treeData_backup);ivhTreeviewMgr.validate(scope.treeData,scope.treeOptions)}}}}]);!function(){angular.module("nb.common").directive("nbRichTextEditor",RichTextEditor);RichTextEditor.$inject=[];function RichTextEditor(){return{restrict:"E",scope:{textContent:"=?",placeholder:"=?",isReadMode:"=?",autoSaveFn:"=?",editable:"&?",disableImage:"@?"},require:"ngModel",replace:!0,template:'<div ng-class="{active:isReadMode}" class="nb-rich-editor" ><div class="quill-editor"></div><p class="t-tip" ng-class="{rtip:isReadMode&&editable}">Click to edit.</p></div>',controller:[function(){}],controllerAs:"vm",link:function(scope,elem,attrs,ctrl){var self=scope.vm;if(window.Quill){var fonts=["sans-serif","times","arial","comic","verdana","monospace","open-sans"];var Link2=Quill.import("formats/link");var Font=Quill.import("formats/font");Font.whitelist=fonts;Quill.register(Font,!0);Link2.sanitize=function(url){/^http:\/\/|https:\/\/|\/\//.test(url)||(url="//"+url);return url};var isReadOnly=!0===scope.isReadMode||"true"===scope.isReadMode;var wrapper=elem.find(".quill-editor");wrapper.css({width:"100%",height:"100%"});var options={placeholder:void 0===scope.placeholder?"Please type here...":scope.placeholder,theme:"snow",bounds:elem.parent()[0],modules:{toolbar:[[{size:["small",!1,"large","huge"]}],[{font:fonts}],[{color:[]},{background:[]},"bold","italic","underline","strike","blockquote","link",{list:"ordered"},{list:"bullet"},{align:[]},scope.disableImage?"":"image"]]}};self.editor=new Quill(wrapper[0],options);self.editor.on("text-change",(function(){scope.$evalAsync((function(){ctrl.$setViewValue(JSON.stringify(self.editor.getContents()));attrs.textContent&&(scope.textContent=self.editor.getText())}))}));scope.$watch("isReadMode",(function(val){if(!0===val){elem.find(".ql-toolbar").hide();self.editor.disable()}else{elem.find(".ql-toolbar").show();self.editor.enable();"function"==typeof scope.autoSaveFn&&$(document.body).on("click",clickHandler)}}));var reg=new RegExp("('')|(\"\")","g");var initWatcher=scope.$watch((function(){return ctrl.$viewValue}),(function(val){if(val){val.replace(reg,"")||(val=JSON.stringify({ops:[{insert:val.replace(reg,"")}]}));initWatcher();self.editor.setContents(JSON.parse(val))}else ctrl.$setViewValue(JSON.stringify(""))}));if(isReadOnly){self.editor.disable();elem.find(".ql-toolbar").hide()}}function clickHandler(event){if(!function(child,parent){child=child.parentNode;for(;null!=child&&child!==parent;)child=child.parentNode;return!!child}(event.target,elem[0])){$(document.body).off("click");scope.isReadMode=!0;"function"==typeof scope.autoSaveFn&&scope.autoSaveFn.call(this,ctrl.$viewValue,self.editor.getText())}}}}}}(NetBrain);NetBrain,angular.module("nb.common").directive("nbUpload",(function(){return{restrict:"E",replace:!0,template:'<div style="position:relative;width:100%;height:30px;display:flex; flex-flow: row nowrap;">      <input name="" type="text" ng-value="filepath" style="flex-grow:1;" readonly="readonly" atag="nb:upload:text"/>      <button class="btn btn-primary" style="width:100px;" atag="nb:upload:browseBtn">Browse</button>      <input type="file" nb-input-file file-change="fileChange" accept=".csv" style="width:100%;height:30px;position:absolute;top:0;left:0;opacity:0;cursor:pointer;"/>  </div>',scope:{fileChange:"="},link:function(scope){scope.updateDisplay=function(files,event){scope.filepath=event.target.value}}}}));NetBrain,angular.module("nb.common").directive("nbCheckboxList",["$parse","$compile",function($parse,$compile){function contains(arr,item,comparator){if(angular.isArray(arr))for(var i=arr.length;i--;)if(comparator(arr[i],item))return!0;return!1}function add(arr,item,comparator){contains(arr=angular.isArray(arr)?arr:[],item,comparator)||arr.push(item);return arr}function remove(arr,item,comparator){if(angular.isArray(arr))for(var i=arr.length;i--;)if(comparator(arr[i],item)){arr.splice(i,1);break}return arr}function postLinkFn(scope,elem,attrs){var nbCheckboxList=attrs.nbCheckboxList;attrs.$set("nbCheckboxList",null);$compile(elem)(scope);attrs.$set("nbCheckboxList",nbCheckboxList);var checklistModelGetter=$parse(nbCheckboxList);var checklistChange=$parse(attrs.checklistChange);var checklistBeforeChange=$parse(attrs.checklistBeforeChange);var ngModelGetter=$parse(attrs.ngModel);var comparator=angular.equals;if({}.hasOwnProperty.call(attrs,"checklistComparator"))if("."===attrs.checklistComparator[0]){var comparatorExpression=attrs.checklistComparator.substring(1);comparator=function(a,b){return a[comparatorExpression]===b[comparatorExpression]}}else comparator=$parse(attrs.checklistComparator)(scope.$parent);var unbindModel=scope.$watch(attrs.ngModel,(function(newValue,oldValue){if(newValue!==oldValue)if(checklistBeforeChange&&!1===checklistBeforeChange(scope))ngModelGetter.assign(scope,contains(checklistModelGetter(scope.$parent),getChecklistValue(),comparator));else{setValueInChecklistModel(getChecklistValue(),newValue);checklistChange&&checklistChange(scope)}}));var unbindCheckListValue=scope.$watch(getChecklistValue,(function(newValue,oldValue){if(newValue!==oldValue&&angular.isDefined(oldValue)&&!0===scope[attrs.ngModel]){var current=checklistModelGetter(scope.$parent);checklistModelGetter.assign(scope.$parent,remove(current,oldValue,comparator));checklistModelGetter.assign(scope.$parent,add(current,newValue,comparator))}}),!0);var unbindDestroy=scope.$on("$destroy",(function(){unbindModel();unbindCheckListValue();unbindDestroy()}));function getChecklistValue(){return attrs.checklistValue?$parse(attrs.checklistValue)(scope.$parent):attrs.value}function setValueInChecklistModel(value,checked){var current=checklistModelGetter(scope.$parent);angular.isFunction(checklistModelGetter.assign)&&(!0===checked?checklistModelGetter.assign(scope.$parent,add(current,value,comparator)):checklistModelGetter.assign(scope.$parent,remove(current,value,comparator)))}function setChecked(newArr){checklistBeforeChange&&!1===checklistBeforeChange(scope)?setValueInChecklistModel(getChecklistValue(),ngModelGetter(scope)):ngModelGetter.assign(scope,contains(newArr,getChecklistValue(),comparator))}angular.isFunction(scope.$parent.$watchCollection)?scope.$parent.$watchCollection(nbCheckboxList,setChecked):scope.$parent.$watch(nbCheckboxList,setChecked,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(tElement,tAttrs){if(!tAttrs.checklistValue&&!tAttrs.value)throw new Error("You should provide `value` or `checklist-value`.");tAttrs.ngModel||tAttrs.$set("ngModel","checked");return postLinkFn}}}]);NetBrain,angular.module("nb.common").directive("nbWindowEvent",(function(){return{restrict:"EA",scope:{isClose:"&?",unload:"&?"},link:function(scope){window.addEventListener("beforeunload",(function(e){var canClose=!0;void 0!==scope.isClose&&(canClose=scope.isClose());if(!1===canClose){var dialogText="Are You Sure to Close This Window?";e.returnValue=dialogText;return dialogText}}));window.addEventListener("unload",(function(){scope.unload&&"function"==typeof scope.unload&&scope.unload()}))}}}));NetBrain,angular.module("nb.common").run(["$templateCache",function($templateCache){$templateCache.put("nb/template/datepickerPopup/popup.html",'<ul class="nb-date-picker-popup uib-datepicker-popup dropdown-menu uib-position-measure" dropdown-nested ng-if="isOpen" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n  <li ng-transclude></li>\n  <li ng-if="showButtonBar" class="uib-button-bar">\n    <span class="btn-group pull-left">\n      <button type="button" class="btn btn-sm btn-info uib-datepicker-current" ng-click="select(\'today\', $event)" ng-disabled="isDisabled(\'today\')">{{ getText(\'current\') }}</button>\n      <button type="button" class="btn btn-sm btn-danger uib-clear" ng-click="select(null, $event)">{{ getText(\'clear\') }}</button>\n    </span>\n    <button type="button" class="btn btn-sm btn-success pull-right uib-close" ng-click="close($event)">{{ getText(\'close\') }}</button>\n  </li>\n</ul>\n')}]).directive("nbDatePickerPopup",(function(){return{restrict:"E",require:["ngModel"],scope:{opened:"=isOpen",appendToBody:"="},templateUrl:"modules/nbCommon/views/nbDatePickerPopupDirective.html",controller:["$scope",function($scope){if(angular.element("#recurrence-endDate").find('input[ng-model="dt"]')&&angular.element("#recurrence-endDate").find('input[ng-model="dt"]').length>0){angular.element("#recurrence-endDate").find('input[ng-model="dt"]')[0].disabled=!0;angular.element("#recurrence-endDate").find('button[type="button"].btn.btn-default')[0].disabled=!0}$scope.options={startingDay:0,showWeeks:!1,customClass:function(){return""}};void 0===$scope.appendToBody&&($scope.appendToBody=!0);$scope.today=function(){$scope.dt=new Date};$scope.clear=function(){$scope.dt=null}}],link:function(scope,element,attrs,controllers){var modelCtrl=controllers[0];scope.$on("CLOSE-DATEPICKER-MENU-ON-SCROLL",(function(){scope.$apply((function(){scope.opened=!1;element.find('input[type="text"]').blur()}))}));modelCtrl.$render=function(){scope.dt=modelCtrl.$viewValue};scope.$watch("dt",(function(){var dt=new Date(scope.dt);modelCtrl.$setViewValue(dt)}))}}}));NetBrain,angular.module("nb.common").directive("nbTimepicker",[function(){return{restrict:"E",require:"ngModel",scope:{hourStep:"=?",minuteStep:"=?",secondStep:"=?",showMeridian:"=?",showSecond:"=?",disabled:"=?"},templateUrl:"modules/nbCommon/views/nbTimepickerDirective.html",controller:["$scope",function($scope){$scope.AM="AM";$scope.PM="PM";$scope.meridian=$scope.AM;$scope.$on("CLOSE-TIMEPICKER-MENU-ON-SCROLL",(function(){$scope.$apply((function(){$scope.openHour=!1;$scope.openMinute=!1;$scope.openSecond=!1;$scope.openMeridian=!1}))}));void 0===$scope.disabled&&($scope.disabled=!1);void 0===$scope.showMeridian&&($scope.showMeridian=!0);void 0===$scope.showSecond&&($scope.showSecond=!1);void 0===$scope.hourStep&&($scope.hourStep=1);void 0===$scope.minuteStep&&($scope.minuteStep=1);void 0===$scope.secondStep&&($scope.secondStep=1);$scope.hourList=$scope.showMeridian?getList(1,12,$scope.hourStep):getList(0,23,$scope.hourStep);$scope.minuteList=getList(0,59,$scope.minuteStep);$scope.showSecond&&($scope.secondList=getList(0,59,$scope.secondStep));$scope.showMeridian&&($scope.meridianList=[$scope.AM,$scope.PM]);$scope.setHour=function(h){$scope.hour=parseInt(h);$scope.changeHour=!0};$scope.setMinute=function(m){$scope.minute=parseInt(m);$scope.changeMinute=!0};$scope.setSecond=function(s){$scope.second=parseInt(s);$scope.changeSecond=!0};$scope.setMeridian=function(item){$scope.meridian=item;$scope.changeMeridian=!0}}],link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$formatters.push((function(modelValue){var time={hour:0,minute:0};if(modelValue){time.hour=modelValue.getHours();time.minute=modelValue.getMinutes()}scope.showSecond&&(time.second=modelValue.getSeconds());return time}));ngModelCtrl.$render=function(){scope.hour=ngModelCtrl.$viewValue.hour;if(scope.showMeridian)switch(scope.hour){case 0:scope.hour=12;scope.meridian=scope.AM;break;case 12:scope.meridian=scope.PM;break;default:scope.meridian=scope.hour>12?scope.PM:scope.AM;scope.hour-=scope.hour>12?12:0}scope.minute=ngModelCtrl.$viewValue.minute;scope.showSecond&&(scope.second=ngModelCtrl.$viewValue.second)};scope.$watchGroup(["hour","minute","second","meridian"],(function(){ngModelCtrl.$setViewValue({hour:scope.hour,minute:scope.minute,second:scope.second,meridian:scope.meridian})}));ngModelCtrl.$parsers.push((function(viewValue){var h=viewValue.hour;if(scope.showMeridian){h%=12;h+=viewValue.meridian===scope.PM?12:0}var time=new Date;time.setHours(h);time.setMinutes(viewValue.minute);time.setSeconds(0);scope.showSecond&&time.setSeconds(viewValue.second);return time}))}};function getList(begin,end,step){var list=[];for(var i=begin;i<=end;i+=step){var item=i<10?"0"+i:i;list.push(item)}return list}}]).filter("nbTimepickerPadding",(function(){return function(input){var item=parseInt(input);item<10&&(item="0"+item);return item}}));!function(){angular.module("nb.common").directive("nbAceSearch",nbAceSearchDirective);angular.module("nb.common").controller("nb.common.nbAceSearchController",nbAceSearchController);nbAceSearchDirective.$inject=[];function nbAceSearchDirective(){return{restrict:"A",scope:{searchOptions:"=nbAceSearch",model:"=ngModel"},replace:!0,transclude:!0,compile:function(){return{post:function(){}}},controller:"nb.common.nbAceSearchController"}}nbAceSearchController.$inject=["$scope"];function nbAceSearchController($scope){var markers=[];var searchResults=[];var currentSearchIndex=-1;var editor=function(){return getValueOrFuncValue($scope.searchOptions.editor)};var highlightAll=$scope.searchOptions.highlightAllWhenNext||!1;var clearMarkers=function(){markers.forEach((function(item){editor().session.removeMarker(item)}));markers=[]};var showSearchItem=function(item,isCurrent,index){var marker;marker=isCurrent?editor().session.addMarker(item,"filter-highlight-current position-absolute","text",!1):editor().session.addMarker(item,"filter-highlight position-absolute","text",!1);void 0===index?markers.push(marker):markers[index]=marker};var scrollIntoView=function(item){var pos=editor().renderer.$cursorLayer.getPixelPosition(item.start);pos.top-=editor().renderer.$size.scrollerHeight/2;pos.top<0&&(pos.top=0);pos.left-=editor().renderer.$size.scrollerWidth/2;pos.left<0&&(pos.left=0);editor().renderer.session.setScrollTop(pos.top);editor().renderer.session.setScrollLeft(pos.left)};var showNextSearch=function(next){if(0!==searchResults.length)if(1!==searchResults.length||highlightAll){var lastIndex=currentSearchIndex;if(next){currentSearchIndex++;searchResults.length<=currentSearchIndex&&(currentSearchIndex=0)}else--currentSearchIndex<0&&(currentSearchIndex=searchResults.length-1);var item=searchResults[currentSearchIndex];if(highlightAll){if(lastIndex>=0&&lastIndex<markers.length){editor().session.removeMarker(markers[lastIndex]);showSearchItem(searchResults[lastIndex],!1,lastIndex)}editor().session.removeMarker(markers[currentSearchIndex]);showSearchItem(item,!0,currentSearchIndex)}else{clearMarkers();showSearchItem(item)}scrollIntoView(item)}else scrollIntoView(searchResults[0])};var clearAll=function(){clearMarkers();searchResults=[];currentSearchIndex=-1};var findAll=function(){clearMarkers();currentSearchIndex=-1;var Range=ace.require("ace/range").Range;(searchResults=function(needle,options){(options=options||{}).needle=needle||options.needle||"";if(void 0===options.needle){var range=editor().session.selection.isEmpty()?editor().session.selection.getWordRange():editor().session.selection.getRange();options.needle=editor().session.getTextRange(range)}var search=new(0,ace.require("./search").Search);search.set(options);return search.findAll(editor().session)}(getValueOrFuncValue($scope.searchOptions.filterText),{start:new Range(0,0,-1,-1),wholeWord:getValueOrFuncValue($scope.searchOptions.matchWholeWord)})).forEach((function(item){showSearchItem(item)}));searchResults.length>0&&scrollIntoView(searchResults[0]);$scope.searchOptions.onFilterResult&&$scope.searchOptions.onFilterResult(searchResults)};function getValueOrFuncValue(vorf){return vorf&&"function"==typeof vorf?vorf():vorf}var dewatch=$scope.$parent.$watchGroup([function(){return getValueOrFuncValue($scope.model)},function(){return getValueOrFuncValue($scope.searchOptions.filterText)},function(){return getValueOrFuncValue($scope.searchOptions.matchWholeWord)}],(function(newValues,oldValues){newValues[0]===oldValues[0]&&newValues[1]===oldValues[1]&&newValues[2]===oldValues[2]||(newValues[0]&&newValues[1]?findAll():clearAll())}));$scope.$on("$destroy",(function(){dewatch()}));$scope.searchOptions.onload&&$scope.searchOptions.onload({findAll:findAll,findNext:function(){showNextSearch(!0)},clearAll:clearAll,findPrevious:function(){showNextSearch(!1)}})}}(NetBrain);!function(){angular.module("nb.common").directive("nbAnchorDropdownDirective",AnchorDrowndownSelection);AnchorDrowndownSelection.$inject=["$location","$anchorScroll"];function AnchorDrowndownSelection($location,$anchorScroll){return{restrict:"AE",scope:{listValue:"=?",selectedItems:"=?",filterTitle:"=?",isMultiSelect:"=?",closeOnSelect:"=?",nameField:"=?",onSelect:"&"},templateUrl:"modules/nbCommon/views/nbAnchorDropdownDirective.html",link:function(scope){scope.selectedItems=[];scope.nameField||(scope.nameField="name");scope.$watchCollection("listValue",(function(){scope.sortedList=(rawLists=scope.listValue,sortedList=_.sortBy(rawLists,scope.nameField),_.groupBy(sortedList,(function(item){var firstAlphabet=item[scope.nameField].charAt(0).toUpperCase();return firstAlphabet.match(/[A-Z]/)?firstAlphabet:"#"})));var rawLists,sortedList}));scope.clickCheckbox=function(event,item){__updateSelectedItems(event.currentTarget.checked,item);scope.onSelect()(scope.selectedItems)};scope.selectItem=function(event,item){scope.isMultiSelect||(scope.selectedItems=[]);if(!scope.isMultiSelect){__updateSelectedItems(!0,item);scope.closeOnSelect&&(scope.dropdownIsOpen=!1)}};scope.selectAnchor=function(alpIndex){$location.hash(alpIndex);$anchorScroll()};function __updateSelectedItems(bl,item){var index;scope.selectedItems||(scope.selectedItems=[]);if(bl)scope.selectedItems.push(item);else{index=scope.selectedItems.indexOf(item);scope.selectedItems.splice(index,1)}if(scope.selectedItems){scope.selectedItems=_.sortBy(scope.selectedItems,scope.nameField);scope.selectedItemNames=_.pluck(scope.selectedItems,scope.nameField).join(", ")}}},controller:function(){},controllerAs:"anchorDropdownCtrl"}}}(NetBrain);angular.module("nb.common").provider("datetimepicker",(function(){var default_options={locale:"en"};this.setOptions=function(options){default_options=options};this.$get=function(){return{getOptions:function(){return default_options}}}})).directive("datetimepicker",["$timeout","datetimepicker",function($timeout,datetimepicker){var default_options=datetimepicker.getOptions();return{require:"?ngModel",restrict:"AE",scope:{datetimepickerOptions:"@",closeCallback:"="},link:function($scope,$element,$attrs,ngModelCtrl){var passed_in_options=$scope.$eval($attrs.datetimepickerOptions);var options=jQuery.extend({},default_options,passed_in_options);$element.on("dp.change",(function(e){ngModelCtrl&&$timeout((function(){ngModelCtrl.$setViewValue(e.target.value)}))})).on("dp.hide",(function(e){$scope.closeCallback&&"function"==typeof $scope.closeCallback&&$scope.closeCallback(e.target.value)})).datetimepicker(options);function setPickerValue(){var date=options.defaultDate||null;ngModelCtrl&&ngModelCtrl.$viewValue&&(date=ngModelCtrl.$viewValue);$element.data("DateTimePicker").date(date)}ngModelCtrl&&(ngModelCtrl.$render=function(){setPickerValue()});setPickerValue()}}}]);NetBrain,angular.module("nb.common").directive("scrollEventCb",[function(){return{restrict:"EA",scope:{cb:"="},priority:1e3,link:function(scope,element){element.bind("scroll",(function(){scope.cb&&_.isFunction(scope.cb)&&scope.cb()}))}}}]);angular.module("nb.common").directive("nbSearchAce",[function(){return{restrict:"E",templateUrl:"modules/nbCommon/views/searchAce.html",replace:!0,scope:{searchText:"=",searchAction:"&",prevAction:"&",nextAction:"&"},link:function(scope,ele,attr){scope.onSearch=function(){scope.searchText=scope.userInputSearchText;scope.searchAction&&"function"==typeof scope.searchAction&&scope.searchAction()};scope.onClear=function(){scope.userInputSearchText="";scope.searchText="";scope.searchAction&&"function"==typeof scope.searchAction&&scope.searchAction()}}}}]);!function(){angular.module("nb.common").directive("nbRightClick",NbRightClick);NbRightClick.$inject=["$parse"];function NbRightClick($parse){return function(scope,element,attrs){var fn=$parse(attrs.nbRightClick);element.bind("contextmenu",(function(event){scope.$apply((function(){fn(scope,{$event:event})}))}))}}}(NetBrain);NetBrain,angular.module("nb.common").directive("nbSelectUserEmail",[function(){return{restrict:"E",templateUrl:"modules/nbCommon/views/nbSelectUserEmailDirective.html",scope:{selectedUser:"=",isRequired:"=",disableInput:"=",placeholder:"@?"},link:function(scope,element,attrs){},controller:["$scope","$element","$attrs","$timeout","$document","nb.admin.httpSystemAdminSrvc","nb.ng.userSrvc",function($scope,element,attr,$timeout,$document,httpSystemAdminSrvc,userSrvc){$scope.invalidUser=!1;$scope.dropDownOpendFlagCollaboration=!1;$scope.searchText="";$scope.currentSelectedList=[];var isInitEnd=!1;$("body").click((function(){element.find(".share_map_to_user_list").removeClass("open")}));$scope.isRequired&&element.find(".inputShareEmail").attr("required");$scope.localpersonList=[];$scope.personList=[];$scope.shareUser="";function keyboardSupport(e){if(element.find(".inputShareEmail").parent().hasClass("open")){var filterList=(text=$scope.dropDownOpendFlagCollaboration?$scope.searchText:"",nameEmailList=$scope.dropDownOpendFlagCollaboration?$scope.shareUser:"",""===text?$scope.localpersonList:_.filter($scope.localpersonList,(function(person){return $scope.isUserShow(person,text,nameEmailList)})));var l=filterList.length;switch(e.keyCode){case 38:if(l>0){0===$scope.selectedIndex||1===$scope.selectedIndex?$scope.selectedIndex=l:$scope.selectedIndex--;changeSelect(!0)}break;case 40:if(l>0){$scope.selectedIndex===l?$scope.selectedIndex=1:$scope.selectedIndex++;changeSelect(!1)}break;case 13:if($scope.selectedIndex>0){var p=filterList.splice($scope.selectedIndex-1,1)[0];element.find(".inputShareEmail").parent().hasClass("open")&&selectUser(p);$scope.selectedIndex=0}}}var text,nameEmailList}$scope.selectedIndex=0;function changeSelect(isScrollTop){if(0!==$scope.selectedIndex){clearSelected();!function(ele){ele.addClass("selected");$scope.currentSelectedList.push(ele)}($(".shareDropdown ul li:nth-child("+$scope.selectedIndex+")"));$(".shareDropdown ul li:nth-child("+$scope.selectedIndex+")")[0]&&$(".shareDropdown ul li:nth-child("+$scope.selectedIndex+")")[0].scrollIntoViewIfNeeded(isScrollTop)}}function clearSelected(){_.each($scope.currentSelectedList,(function(p){p.removeClass("selected")}));$scope.currentSelectedList=[]}$scope.eventShareMapStopPropagation=function($event){$event.stopPropagation()};$scope.shareUserClick=function($event,person){selectUser(person);element.find(".inputShareEmail").focus();$event.stopPropagation()};function checkInput(){$timeout((function(){!element.find(".inputShareEmail").val()&&$scope.isRequired?element.find(".inputShareEmail").addClass("ng-invalid-required"):element.find(".inputShareEmail").removeClass("ng-invalid-required")}),300)}function selectUser(person){var personName=person.name;$scope.shareUser&&$scope.shareUser.length>0&&($scope.shareUser.lastIndexOf(";")>=0?$scope.shareUser=$scope.shareUser.substr(0,$scope.shareUser.lastIndexOf(";")+1):$scope.shareUser="");$scope.shareUser?$scope.shareUser=$scope.shareUser+" "+personName+";":$scope.shareUser=personName+";";$scope.selectedUser.push({userId:person.ID,userName:person.name});checkInput()}$scope.$watch("shareUser",(function(newValue,oldValue,scope){$scope.selectedIndex=0;clearSelected();if(newValue){var currentSelectUserList=newValue.split(";");var lastItem=currentSelectUserList[currentSelectUserList.length-1].trim();$scope.searchText=lastItem.toLocaleLowerCase();lastItem&&($scope.dropDownOpendFlagCollaboration=!0)}else $scope.searchText="";isInitEnd&&function(){checkInput();var shareUserStr=$scope.shareUser.trim();var selectedUserNameList=(shareUserStr=shareUserStr.substr(0,shareUserStr.lastIndexOf(";")+1)).split(";");$scope.selectedUser=[];_.each(selectedUserNameList,(function(item){var valiedUser=_.find($scope.personList,(function(person){return person.name===item.trim()}));valiedUser&&$scope.selectedUser.push({userId:valiedUser.ID,userName:valiedUser.name})}))}()}));$scope.isUserShow=function(person,searchText){var searchResult=""===searchText.trim()||person.name.toLocaleLowerCase().indexOf(searchText.trim())>=0||person.email&&person.email.toLocaleLowerCase().indexOf(searchText.trim())>=0;if(0===$scope.selectedUser.length)return searchResult;var existSelected=_.some($scope.selectedUser,(function(ne){return ne.userName.trim().toLowerCase()===person.name.trim().toLowerCase()||person.email&&ne.userName.trim().toLowerCase()===person.email.trim().toLowerCase()}));return searchResult&&!existSelected};$scope.toggleBubbleDropDown=function(){$scope.selectedIndex=0;clearSelected()};$scope.inputShareEmailMouseDown=function(){};$timeout((function(){!function(){httpSystemAdminSrvc.getAllUsers().then((function(objList){httpSystemAdminSrvc.getAllDisplayUsersOnDomain().then((function(obAllUser){for(var l=0;l<objList.length;l++)for(var m=0;m<obAllUser.length;m++)objList[l].ID===obAllUser[m].userId&&objList[l].ID!=userSrvc.getUserID()&&$scope.personList.push(objList[l]);for(var n=0;n<$scope.personList.length;n++){$scope.personList[n].strfilterCol1="";$scope.personList[n].strfilterCol2="";$scope.personList[n].strName1=$scope.personList[n].name;$scope.personList[n].strName2="";$scope.personList[n].strEmail1=$scope.personList[n].email;$scope.personList[n].strEmail2=""}$scope.localpersonList=angular.copy($scope.personList);isInitEnd=!0}))}));$scope.selectedUser=$scope.selectedUser||[];var selectedUserNames=_.pluck($scope.selectedUser,"userName");$scope.shareUser=selectedUserNames.join("; ");$scope.shareUser.trim()&&($scope.shareUser=$scope.shareUser.trim()+";");$scope.$on("$destroy",(function(){$document[0].removeEventListener("keydown",keyboardSupport,!1)}));$document[0].addEventListener("keydown",keyboardSupport,!1)}()}),100)}]}}]);!function(){angular.module("nb.common").controller("nb.common.resourceSelectCtrl",nbController);nbController.$inject=["$scope","$filter","$timeout","$uibModalInstance","nb.common.nbAlertSrvc","resolveData"];function nbController($scope,$filter,$timeout,$uibModalInstance,nbAlertSrvc,resolveData){$scope.dataModel={title:"Select Resource",options:{icon:"icon_nb_file_12"},selId:null,treeMgr:null,search:{str1:"",str2:""},tree:{nodeEditPrefix:nbPLM.nbParserLibCM.getGUID(),browseTree:[],selNode:{},ivhTreeOptions:{defaultSelectedState:!1,validate:!0,expandToDepth:2,idAttribute:"id",childrenAttribute:"child",expandedAttribute:"expended",useCheckboxes:!0,twistieLeafTpl:""},fn:{onSelectNode:function(node,e){_onSelectNode($scope.dataModel,node)},onDblClickNode:function(node,e){_onSelectNode($scope.dataModel,node);node.child||$scope.onOK()},onExpendNode:function(node){node.expended=!node.expended}},refVars:{dm:$scope.dataModel}},zz_last:null};function fnSortNode(node1,node2){return 1==node1.level&&1==node2.level&&node1.data.accessType&&node2.data.accessType?node1.data.accessType>node2.data.accessType?1:-1:node1.child&&node2.child?node1.data.hasOwnProperty("index4Sort")&&node2.data.hasOwnProperty("index4Sort")&&node1.data.index4Sort!=node2.data.index4Sort?node1.data.index4Sort>node2.data.index4Sort?1:-1:node1.data.name.toLowerCase()>node2.data.name.toLowerCase()?1:-1:node1.child&&!node2.child?-1:!node1.child&&node2.child?1:node1.child||node2.child?-1:node1.data.name.toLowerCase()>node2.data.name.toLowerCase()?1:-1}function _onSelectNode(dm,node){dm.tree.selNode=node;var pathNodes=dm.treeMgr.getPath(node.id);pathNodes&&(dm.tree.selNode.data.$path=pathNodes.map((function(ele){return ele.data.name})).join("/"));dm.treeMgr.expend(dm.treeMgr.getParent(node))}function onSearchType(dm){var strSearch=dm.search.str2;var treeManager=dm.treeMgr;var iMaxLevel=0;var expendMap={};if(strSearch){treeManager.tranverse((function(node,arg){node.hide=!0}),dm);treeManager.tree[0].hide=!1;treeManager.tranverse((function(node,arg){if(node.level>=1&&node.data.name.toLowerCase().indexOf(strSearch)>=0){var curNode=node;var iCC=0;for(;iCC<30&&curNode;){curNode.hide=!1;curNode.child&&(curNode.expended=!0);curNode=treeManager.getParent(curNode);iCC++}}node.level<1&&(node.hide=!1)}),dm)}else treeManager.tranverse((function(node,arg){node.hide=!1}),dm);treeManager.tranverse((function(node,arg){if(node.expended&&!node.hide){expendMap[node.id]=!0;node.level>iMaxLevel&&(iMaxLevel=node.level)}}),dm);$timeout((function(){nbPLM.Common.tryNTimes($timeout,iMaxLevel,(function(nTimes){treeManager.tranverse((function(node){node.level==iMaxLevel-nTimes&&(node.expended=expendMap[node.id]||!1)}))}))}))}$scope.onClearSearchType=function(){var dm=$scope.dataModel;dm.search.str1="";if(""!=dm.search.str2){dm.search.str2="";onSearchType(dm)}};$scope.onPressEnterType=function(e){if(13===e.keyCode){var dm=$scope.dataModel;var sss=dm.search.str1.trim().toLowerCase();if(dm.search.str2!=sss){dm.search.str2=sss;onSearchType(dm)}}};$scope.onCancel=function(arg){$uibModalInstance.dismiss({button:arg,result:null})};$scope.onOK=function(arg){var dm=$scope.dataModel;try{!function(dm){if(!dm.tree.selNode)throw new Error("Please select a node.");if(dm.tree.selNode.child)throw new Error("Cannot select a folder.")}(dm);resolveData.onValidate&&resolveData.onValidate(dm.tree.selNode.data,dm.tree.selNode,dm.treeMgr);$uibModalInstance.close({button:arg,result:dm.tree.selNode.data})}catch(ex){nbAlertSrvc.warning(ex)}};!function(){var dm=$scope.dataModel;resolveData.title&&(dm.title=resolveData.title);resolveData.options&&(dm.options=resolveData.options);!function(dm){if(resolveData.data){dm.treeMgr=new window.nbPLM.TreeManager(resolveData.data,resolveData.conf?resolveData.conf:{idName:"id",pidName:"parentId",childName:"child",isArray:!0});dm.tree.browseTree=dm.treeMgr.tree;dm.tree.selNode={};dm.treeMgr.tranverse((function(node,arg){!function(dm,node){node.fn=dm.tree.fn;node.refVars=dm.tree.refVars;node.refVars.dm=dm;node.tree=dm.tree}(arg,node)}),dm);(treeMgr=dm.treeMgr).tranverse((function(node){!function(treeMgr,node){treeMgr.sortChild(node,fnSortNode)}(treeMgr,node)}));var pNode=dm.selId&&dm.treeMgr.getNodeByFn((function(eleNode){return eleNode.data.id===dm.selId}))||null;if(pNode){_onSelectNode(dm,pNode);var nodeArr=dm.treeMgr.getPath(pNode.id);var iMaxLevel=nodeArr.length;nbPLM.Common.tryNTimes($timeout,iMaxLevel,(function(nTimes){nodeArr.length>=2&&(nodeArr.shift().expended=!0)}))}else _onSelectNode(dm,dm.treeMgr.tree[0])}var treeMgr}(dm)}()}}();!function(netbrain){angular.module("nb.common").controller("nb.common.nbResourceImportCtrl",nbController);nbController.$inject=["$scope","$filter","$uibModalInstance","nb.common.nbResourceImportSrvc","nb.common.nbResourceIOSrvc","resolveData","$timeout"];function nbController($scope,$filter,$uibModalInstance,nbResourceImportSrvc,nbResourceIOSrvc,resolveData,$timeout){$scope.enableUpload=!0;$scope.dataModel={type:resolveData.type,typeModel:nbResourceIOSrvc.getTypeModel(resolveData.type),importTo:resolveData.importTo,options:resolveData.options,fileSelect:{gidSelect:window.nbPLM.nbParserLibCM.getGUID(),opts:{accept:resolveData.options&&resolveData.options.accept||"*",uploadSettings:""}},fileArray:[],tblDef:{gid:window.nbPLM.nbParserLibCM.getGUID(),data:[],columnDefs:[{field:"name",displayName:"Name",width:"28%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.name}}">{{row.entity.name}}</div>'},{field:"size",displayName:"Size",width:"10%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.size|nbResourceIOFileSize}}">{{row.entity.size|nbResourceIOFileSize}}</div>'},{field:"status",displayName:"Status",width:"20%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{grid.appScope.displayStatusTip(row.entity)}}" style="{{grid.appScope.displayStatus(row.entity) | nbResourceIOTextColor}}">{{grid.appScope.displayStatusText(row.entity)}}</div>'},{field:"overwritable",displayName:"Overwrite",width:"12%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents ui-grid-cell-contents-ck"><div class="rii-item"><input class="rii-item-ck" type="checkbox" ng-model="row.entity.overwritable" ng-disabled="!row.entity.isExists || row.entity.isAfterUploading" /></div></div>'},{field:"related",displayName:"Related Resources",width:"25%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents rii-item-related" ng-class="{\'rii-item-disabled\': !row.entity.overwritable && row.entity.isExists}" title="{{row.entity.related}}"><a ng-disabled="!row.entity.overwritable && row.entity.isExists" ng-click="grid.appScope.onOpenRelated(row.entity)">{{row.entity.related}}<a></div>'},{field:"delete",displayName:"",width:"5%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents ui-grid-cell-contents-ck"><div class="rii-item"><em ng-if="row.entity.status < 4 && !row.entity.isAfterUploading" class="icon icon_nb_delete rii-item-op" ng-click="grid.appScope.onItemDelete(row.entity)"></em></div></div>'}],enableColumnResize:!1,multiSelect:!1,enableFullRowSelection:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableColumnMenus:!1,rowTemplate:'<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div>',onReady:function(event){event.api.sizeColumnsToFit()},onRegisterApi:function(gridApi){this.gridApi=gridApi},gridApi:null}};$scope.displayStatus=function(fileInfo){return 1==fileInfo.status?"":2==fileInfo.status?fileInfo.isExists?nbResourceImportSrvc.Const.FileStatus2[202]:nbResourceImportSrvc.Const.FileStatus2[201]:3==fileInfo.status?nbResourceImportSrvc.Const.FileStatus2[fileInfo.status2]||nbResourceImportSrvc.Const.FileStatus[fileInfo.status]:4==fileInfo.status?nbResourceImportSrvc.Const.FileStatus[fileInfo.status]:5==fileInfo.status?nbResourceImportSrvc.Const.FileStatus[fileInfo.status]:6==fileInfo.status?nbResourceImportSrvc.Const.FileStatus[fileInfo.status2]||nbResourceImportSrvc.Const.FileStatus[fileInfo.status]:""};$scope.displayStatusText=function(fileInfo){if(6==fileInfo.status&&fileInfo.result&&fileInfo.result.errorCode&&fileInfo.result.errorMsg)switch(fileInfo.result.errorCode){case 403007:return fileInfo.result.errorMsg}return $scope.displayStatus(fileInfo)};$scope.displayStatusTip=function(fileInfo){return 6==fileInfo.status&&fileInfo.result&&(fileInfo.result.errorCode||fileInfo.result.ResultCode)?fileInfo.result.errorMsg||fileInfo.result.ResultDesc:$scope.displayStatus(fileInfo)};$scope.onSelectFile=function(){$scope.isAfterUploading()||$("#"+$scope.dataModel.fileSelect.gidSelect).click()};$scope.onFileSelect=function($files,$event){nbResourceImportSrvc.onFileSelect($scope.dataModel,$files,$event.target.id)};$scope.onItemDelete=function(fileInfo){$scope.enableUpload=!1;nbResourceImportSrvc.onItemDelete($scope.dataModel,fileInfo);$timeout((function(){$scope.enableUpload=!0}))};$scope.beforeUploading=function(){return $scope.dataModel.fileArray.every((function(eleFileInfo){return 4!=eleFileInfo.status&&5!=eleFileInfo.status&&6!=eleFileInfo.status}))};$scope.isReady=function(){var dm=$scope.dataModel;var checkedNumber=0;return dm.fileArray.every((function(eleFileInfo){if(!eleFileInfo.checked||!eleFileInfo.overwritable&&eleFileInfo.isExists)return!0;2==eleFileInfo.status&&checkedNumber++;return 2==eleFileInfo.status||3==eleFileInfo.status}))&&checkedNumber>0};$scope.isUploading=function(){return $scope.dataModel.fileArray.some((function(eleFileInfo){return 4==eleFileInfo.status}))};$scope.isAfterUploading=function(){var dm=$scope.dataModel;var ret=dm.fileArray.some((function(eleFileInfo){return 4==eleFileInfo.status||5==eleFileInfo.status||6==eleFileInfo.status}));dm.fileArray.forEach((function(eleFileInfo){return eleFileInfo.isAfterUploading=ret}));return ret};$scope.isComplete=function(){var dm=$scope.dataModel;var checkedNumber=0;return dm.fileArray.every((function(eleFileInfo){if(3==eleFileInfo.status)return!0;if(!eleFileInfo.overwritable&&eleFileInfo.isExists)return!0;if(eleFileInfo.checked){checkedNumber++;return 5==eleFileInfo.status||6==eleFileInfo.status}return!0}))&&checkedNumber};$scope.onOpenRelated=function(fileInfo){nbResourceImportSrvc.onOpenRelated($scope.dataModel,fileInfo)};$scope.onCancel=function(button){$uibModalInstance.dismiss({button:"cancel",result:null})};$scope.onClose=function(button){if($scope.isComplete()){var results=$scope.dataModel.fileArray.filter((function(ele){return ele.result})).map((function(ele){return ele.result}));$uibModalInstance.close(results)}};$scope.onUpload=function(button){nbResourceImportSrvc.onUpload($scope.dataModel)};nbResourceImportSrvc.onInit($scope.dataModel)}}(NetBrain);!function(netbrain){angular.module("nb.common").service("nb.common.nbResourceImportSrvc",nbService);nbService.$inject=["$uibModal","$q","$rootScope","$timeout","nb.ng.utilitySrvc","nb.ng.httpAuthSrvc","nb.common.nbResourceIOSrvc"];function nbService($uibModal,$q,$rootScope,$timeout,utilitySrvc,httpAuthSrvc,nbResourceIOSrvc){var me=this;this.Const={FileStatus:{0:"",1:"",2:"Ready",3:"Validate failed",4:"Uploading...",5:"Succeeded",6:"Failed"},FileStatus2:{201:"Ready",202:"Already in current category",301:"Invalid file type",302:"Invalid file type",303:"Invalid file type",304:"Invalid file type",305:"Invalid file type",310:"Invalid file type",351:"Invalid file type",352:"Invalid file type",601:"xxxxxx"},MaxValidate:3,MaxUpload:3};this.onInit=function(dm){if(!dm.options.isVisibleRelatedResource){dm.tblDef.columnDefs[0].width="40%";dm.tblDef.columnDefs[1].width="10%";dm.tblDef.columnDefs[2].width="33%";dm.tblDef.columnDefs[3].width="12%";dm.tblDef.columnDefs[4].width="25%";dm.tblDef.columnDefs[5].width="5%";dm.tblDef.columnDefs.splice(4,1)}var typeModel=dm.typeModel;typeModel.packageFileSuffix&&dm.fileSelect.opts.accept.indexOf(typeModel.packageFileSuffix)<0&&("*"===dm.fileSelect.opts.accept?dm.fileSelect.opts.accept=typeModel.packageFileSuffix:dm.fileSelect.opts.accept+=","+typeModel.packageFileSuffix);nbResourceIOSrvc.getSettings().then((function(data){if(data){data.maxConcurrencyForInventory>0&&(me.Const.MaxValidate=Math.ceil(data.maxConcurrencyForInventory));data.maxConcurrencyForImport>0&&(me.Const.MaxUpload=Math.ceil(data.maxConcurrencyForImport))}}))};this.onFileSelect=function(dm,files,gidSelect){if(files.length){var fileMap={};for(var i=0;i<files.length;i++){var file=files[i];var fileInfo={file:file,checked:!0,gidSelect:gidSelect,name:file.name,size:file.size,status:0,status2:0,isExists:!1,overwritable:!0,related:"",structure:{version:0,size1:0,size2:0,size3:0,sliceByteArray:void 0,gidTask:window.nbPLM.nbParserLibCM.getGUID(),inventory:void 0}};var fileKey=fileInfo.file.name+fileInfo.file.lastModified+fileInfo.size;if(!fileMap[fileKey]){fileMap[fileKey]=1;fileInfo.checked=!0;dm.fileArray.push(fileInfo)}}dm.tblDef.data=dm.fileArray.filter((function(ele){return ele.checked}));this.validateFiles(dm)}};this.onItemDelete=function(dm,fileInfo){fileInfo.checked=!1;dm.tblDef.data=dm.fileArray.filter((function(ele){return ele.checked}))};this.onOpenRelated=function(dm,fileInfo){!fileInfo.overwritable&&fileInfo.isExists||$uibModal.open({templateUrl:"modules/nbCommon/resourceIO/views/nbResourceImportRelated.html",controller:"nb.common.nbResourceImportRelatedCtrl",windowClass:"resource-io-import-related",backdrop:"static",resolve:{resolveData:{fileInfo:fileInfo,options:dm.options}}})};this.validateOne=function(dm,eleFileInfo,fnCallback){var defer=$q.defer();if(eleFileInfo.checked&&0==eleFileInfo.status){eleFileInfo.status=1;if(eleFileInfo.size<16){eleFileInfo.status=3;eleFileInfo.status2=304;defer.resolve(!0)}else nbResourceIOSrvc.readFile(eleFileInfo,{progress:function(e){me.onProgress(e,dm,eleFileInfo)},load:function(e){me.onComplete(e,dm,eleFileInfo,fnCallback,(function(){defer.resolve(!0)}))},abort:function(e){me.onComplete(e,dm,eleFileInfo,fnCallback,(function(){defer.resolve(!0)}))},error:function(e){me.onComplete(e,dm,eleFileInfo,fnCallback,(function(){defer.resolve(!0)}))}})}else defer.resolve(!0);return defer.promise};this.validateOneWrapper=function(dm,eleFileInfo,fnCallback){if(!(dm.validateNumber>me.Const.MaxValidate)){dm.validateNumber++;me.validateOne(dm,eleFileInfo,fnCallback).then((function(){dm.validateNumber>0&&dm.validateNumber--;var newFileInfo=null;dm.fileArray.some((function(ele){if(ele.checked&&0==ele.status){newFileInfo=ele;return!0}return!1}));newFileInfo&&me.validateOneWrapper(dm,newFileInfo,fnCallback)}))}};this.validateFiles=function(dm,fnCallback){null==dm.validateNumber&&(dm.validateNumber=0);dm.fileArray.forEach((function(eleFileInfo){me.validateOneWrapper(dm,eleFileInfo,fnCallback)}))};this.onProgress=function(e,dm,eleFileInfo){this.onReadFile(e,dm,eleFileInfo)};this.onReadFile=function(e,dm,eleFileInfo,bNoAbort){var objTarget=e.currentTarget||e.target;if(objTarget&&objTarget.result){if(objTarget.result.byteLength>=16){var uint32Array=new Uint32Array(objTarget.result.slice(0,16));eleFileInfo.structure.version=uint32Array[0];eleFileInfo.structure.size1=uint32Array[1];eleFileInfo.structure.size2=uint32Array[2];eleFileInfo.structure.size3=uint32Array[3];if(eleFileInfo.structure.size1+eleFileInfo.structure.size2+eleFileInfo.structure.size3+16!=eleFileInfo.size){eleFileInfo.status=3;eleFileInfo.status2=301}else if(eleFileInfo.structure.size1+eleFileInfo.structure.size2>5242880){eleFileInfo.status=3;eleFileInfo.status2=302}else if(0==eleFileInfo.structure.size1){eleFileInfo.status=3;eleFileInfo.status2=303}}if(3!=eleFileInfo.status){if(objTarget.result.byteLength>=eleFileInfo.structure.size1+eleFileInfo.structure.size2+16){eleFileInfo.structure.sliceByteArray=objTarget.result.slice(0,eleFileInfo.structure.size1+eleFileInfo.structure.size2+16);!bNoAbort&&e.target.abort()}}else!bNoAbort&&e.target.abort()}};this.bToa=function(arrayByf){var uInt8Arr=new Uint8Array(arrayByf);var ret="";for(var i=0;i<uInt8Arr.length;){if(i+300>=uInt8Arr.length){ret+=btoa(String.fromCharCode.apply(null,uInt8Arr.slice(i,uInt8Arr.length)));break}ret+=btoa(String.fromCharCode.apply(null,uInt8Arr.slice(i,i+300)));i+=300}return ret};this.onComplete=function(e,dm,eleFileInfo,fnCallback,fnGetResult){eleFileInfo.structure.sliceByteArray||3==eleFileInfo.status||this.onReadFile(e,dm,eleFileInfo,!0);$timeout((function(){if(!eleFileInfo.structure.sliceByteArray&&3!=eleFileInfo.status){eleFileInfo.status=3;eleFileInfo.status2=310}if(1==eleFileInfo.status)nbResourceIOSrvc.getInventory({packageVersion:eleFileInfo.structure.version,summaryDataLength:eleFileInfo.structure.size1,listDataLength:eleFileInfo.structure.size2,packageFileName:eleFileInfo.name,base64Data:me.bToa(eleFileInfo.structure.sliceByteArray),expectedImportLocation:{space:dm.options&&dm.options.space||8,location:dm.options&&dm.options.location||"/"},options:{dependencyType:dm.options&&dm.options.dependencyType||1,locationType:dm.options&&dm.options.locationType||1}}).then((function(data){if(data){eleFileInfo.status=2;eleFileInfo.inventory=data;if(eleFileInfo.inventory&&eleFileInfo.inventory.resources&&eleFileInfo.inventory.resources.length){var curResource=eleFileInfo.inventory.resources[0];if(curResource.type!=dm.type){eleFileInfo.status=3;eleFileInfo.status2=352}else{eleFileInfo.isExists=curResource.isExists;curResource.dependencies&&curResource.dependencies.forEach((function(eleDpd){eleDpd.overwritable=!0;eleDpd.check=!0;eleDpd.ignoreImport=!1;1==eleDpd.space&&eleDpd.isExists&&(eleDpd.overwritable=!1);eleDpd.path=nbResourceIOSrvc.converToPath(eleDpd.type,eleDpd.space,eleDpd.location)}));curResource.counts&&curResource.counts.length&&(eleFileInfo.related=curResource.counts.filter((function(ele){return"VariableMapping"!=ele.type})).map((function(ele){var xxType=nbResourceIOSrvc.getTypeModel(ele.type);return ele.count+" "+(xxType&&xxType.displayName||ele.type)+"s"})).join("; "))}}else{eleFileInfo.status=3;eleFileInfo.status2=352}}else{eleFileInfo.status=3;eleFileInfo.status2=351}}),(function(error){eleFileInfo.status=3;eleFileInfo.status2=351})).then((function(){fnGetResult&&fnGetResult();fnCallback&&dm.fileArray.every((function(eleFileInfo2){return 2==eleFileInfo2.status||3==eleFileInfo2.status}))&&fnCallback(dm)}));else if(fnCallback&&dm.fileArray.every((function(eleFileInfo2){return 2==eleFileInfo2.status||3==eleFileInfo2.status}))){fnGetResult&&fnGetResult();fnCallback(dm)}else fnGetResult&&fnGetResult()}));console.warn("complete")};this.onError=function(e,dm,eleFileInfo){$timeout((function(){eleFileInfo.status=3;eleFileInfo.status2=310}));console.warn("error")};this.onUploadOne=function(dm,eleFileInfo,token){var defer=$q.defer();var dataSrc=httpAuthSrvc.getDataSrc(utilitySrvc);if(eleFileInfo.checked&&2==eleFileInfo.status)if(!eleFileInfo.isExists||eleFileInfo.overwritable){eleFileInfo.status=4;if(eleFileInfo.inventory&&eleFileInfo.inventory.resources&&eleFileInfo.inventory.resources.length){var curResource=eleFileInfo.inventory.resources[0];curResource.dependencies&&curResource.dependencies.forEach((function(eleDpd){eleDpd.ignoreImport=!eleDpd.check}))}nbResourceIOSrvc.uploadFile({token:token,headers:{TenantGuid:dataSrc.TenantGuid,DomainGuid:dataSrc.DomainGuid},data:{json:{expectedImportLocation:{space:dm.options&&dm.options.space||8,location:dm.options&&dm.options.location||"/"},resources:eleFileInfo.inventory&&eleFileInfo.inventory.resources||[],options:{jobId:eleFileInfo.structure.gidTask,attachedParameter:dm.options&&dm.options.attachedParameter||void 0}}},fileInfo:eleFileInfo},{success:function(data){if(data&&data.data){3==data.data.status?eleFileInfo.status=5:eleFileInfo.status=6;eleFileInfo.result=data.data}else{eleFileInfo.status=6;data.operationResult&&(eleFileInfo.result=data.operationResult)}return defer.resolve(!0)},error:function(err){eleFileInfo.result=err;eleFileInfo.status=6;return defer.resolve(!0)}})}else defer.resolve(!0);else defer.resolve(!0);return defer.promise};this.uploadWrapper=function(dm,eleFileInfo,token){me.onUploadOne(dm,eleFileInfo,token).then((function(){var newFileInfo=null;dm.fileArray.some((function(ele){if(ele.checked&&2==ele.status&&(!ele.isExists||ele.overwritable)){newFileInfo=ele;return!0}return!1}));newFileInfo&&me.uploadWrapper(dm,newFileInfo,token)}))};this.onUpload=function(dm){var count=dm.fileArray.filter((function(eleFileInfo){return!(eleFileInfo.checked&&2==eleFileInfo.status&&!eleFileInfo.overwritable&&eleFileInfo.isExists)})).length;nbResourceIOSrvc.getUploadToken(count).then((function(token){dm.fileArray.forEach((function(eleFileInfo,index){index<me.Const.MaxUpload&&me.uploadWrapper(dm,eleFileInfo,token)}))}),(function(err){var nbAlertSrvc=nbResourceIOSrvc.getService("nb.common.nbAlertSrvc");nbAlertSrvc&&nbAlertSrvc.warning(err&&err.ResultDesc)}))};this.compareFiles=function(fileInfo1,fileInfo2){var ret=0;if(fileInfo1.file.lastModified==fileInfo2.file.lastModified&&fileInfo1.file.name==fileInfo2.file.name&&fileInfo1.file.size==fileInfo2.file.size){ret=1;fileInfo1.gidSelect==fileInfo2.gidSelect&&(ret=2)}return ret}}angular.module("nb.common").filter("nbResourceIOFileSize",(function(){return function(size){if(!size)return"";var iSize=0;var tSize="B";if(size>=1073741824){iSize=size/1073741824;tSize="G"}else if(size>=1048576){iSize=size/1048576;tSize="M"}else if(size>=1024){iSize=size/1024;tSize="K"}else iSize=size;return Math.floor(100*iSize)/100+tSize}})).filter("nbResourceIOExists",(function(){return function(isExists){return isExists?"Already in current category":"Ready"}})).filter("nbResourceIOTextColor",(function(){return function(text){return"color:"+({"Already in current category":"#dfa722",Ready:"#0f0;",Succeeded:"#0f0",Failed:"#f00","":"unset","Uploading...":"unset"}[text]||"#f00")}}))}(NetBrain);!function(netbrain){angular.module("nb.common").controller("nb.common.nbResourceImportRelatedCtrl",nbController);nbController.$inject=["$scope","$filter","$uibModalInstance","nb.common.nbResourceImportRelatedSrvc","nb.common.nbResourceIOSrvc","resolveData"];function nbController($scope,$filter,$uibModalInstance,nbResourceImportRelatedSrvc,nbResourceIOSrvc,resolveData){$scope.dataModel={fileInfo:void 0,curResource:void 0,options:resolveData.options,dependentGroups:[],tblTmpl:{allCheck:!0,data:[],columnDefs:[{field:"check",displayName:"",width:"5%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents ui-grid-cell-contents-ck"><div class="rii-item"><input class="rii-item-ck" type="checkbox" ng-model="row.entity.check" ng-change="grid.appScope.onItemCheck(row.entity, grid.appScope)" /></div></div>'},{field:"name",displayName:"Name",width:"29%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.name}}">{{row.entity.name}}</div>'},{field:"path",displayName:"Import Path",width:"30%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.path}}">{{row.entity.path}}</div>'},{field:"status",displayName:"Status",width:"23%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.isExists | nbResourceIOExists}}" style="{{row.entity.isExists | nbResourceIOExists | nbResourceIOTextColor}}">{{row.entity.isExists | nbResourceIOExists}}</div>'},{field:"overwritable",displayName:"Overwrite",width:"13%",enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents ui-grid-cell-contents-ck"><div class="rii-item"><input class="rii-item-ck" type="checkbox" ng-model="row.entity.overwritable" ng-disabled="!row.entity.isExists" /></div></div>'}],enableColumnResize:!1,multiSelect:!1,enableFullRowSelection:!1,enableRowHeaderSelection:!1,modifierKeysToMultiSelect:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableColumnMenus:!1,rowTemplate:'<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell></div>',onReady:function(event){event.api.sizeColumnsToFit()},onRegisterApi:function(gridApi){this.gridApi=gridApi},gridApi:null}};$scope.onAllCheck=function(eleDG){nbResourceImportRelatedSrvc.onAllCheck($scope.dataModel,eleDG)};$scope.onItemCheck=function(entity,appScope){nbResourceImportRelatedSrvc.onItemCheck(appScope.dataModel,appScope.eleDG,entity)};$scope.onCancel=function(button){$uibModalInstance.dismiss({button:"cancel",result:null})};$scope.onOK=function(button){var dm=$scope.dataModel;angular.merge(dm.fileInfo.inventory.resources[0],dm.curResource);$uibModalInstance.close({button:"ok",result:$scope.dataModel})};!function(){var dm=$scope.dataModel;var resourceTypeMap={};dm.fileInfo=resolveData.fileInfo;dm.curResource=angular.copy(resolveData.fileInfo.inventory.resources[0]);resolveData.fileInfo.inventory.resourceTypes.forEach((function(eleType,index){resourceTypeMap[eleType.name]=index}));dm.curResource.dependencies.forEach((function(ele){if(!dm.dependentGroups.some((function(eleDG){if(eleDG.type==ele.type){eleDG.data.push(ele);return!0}}))){var xxType=nbResourceIOSrvc.getTypeModel(ele.type);var newDG={type:ele.type,dispType:"Import "+(xxType&&xxType.displayName||ele.type)+"s:",data:[ele],bHide:!1,tblDef:angular.copy(dm.tblTmpl)};newDG.tblDef.data=newDG.data;newDG.tblDef.gidCK=window.nbPLM.nbParserLibCM.getGUID();if("VariableMapping"==newDG.type){newDG.hide=!0;newDG.tblDef.columnDefs=newDG.tblDef.columnDefs.filter((function(eleCol){return["check","name"].indexOf(eleCol.field)>=0}));newDG.tblDef.columnDefs.some((function(eleCol){if("name"==eleCol.field){eleCol.width="95%";return!0}}))}dm.dependentGroups.push(newDG)}}));dm.dependentGroups.forEach((function(eleDG){eleDG.data.length>1e3?eleDG.height=30030:eleDG.height=30*(eleDG.data.length+1)+2;nbResourceImportRelatedSrvc.initAllCheck($scope.dataModel,eleDG)}));dm.dependentGroups.sort((function(ele1,ele2){return resourceTypeMap[ele1.type]>resourceTypeMap[ele2.type]?1:-1}))}()}}(NetBrain);!function(netbrain){angular.module("nb.common").service("nb.common.nbResourceImportRelatedSrvc",nbService);nbService.$inject=["$q","$rootScope","$timeout","nb.common.nbResourceIOSrvc"];function nbService($q,$rootScope,$timeout,nbResourceIOSrvc){this.Const={};this.initAllCheck=function(dm,eleDG){var me=this;window.nbPLM.Common.delayRun((function(arg){if(document.getElementById(arg.name)){me.setCheck(eleDG);return!0}return!1}),{name:eleDG.tblDef.gidCK},20,20)};this.onAllCheck=function(dm,eleDG){eleDG.tblDef.indeterminate=!1;eleDG.tblDef.allCheck?eleDG.tblDef.data&&eleDG.tblDef.data.forEach((function(ele){ele.check=!0})):eleDG.tblDef.data&&eleDG.tblDef.data.forEach((function(ele){ele.check=!1}));$("#"+eleDG.tblDef.gidCK).prop("indeterminate",eleDG.tblDef.indeterminate)};this.onItemCheck=function(dm,eleDG,entity){this.setCheck(eleDG)};this.setCheck=function(eleDG){eleDG.tblDef.indeterminate=!1;if(eleDG.tblDef.data){var allCheck=eleDG.tblDef.data.every((function(ele){return ele.check}));var indeterminate=eleDG.tblDef.data.some((function(ele){return ele.check}));eleDG.tblDef.allCheck=allCheck;eleDG.tblDef.indeterminate=!allCheck&&indeterminate}$("#"+eleDG.tblDef.gidCK).prop("indeterminate",eleDG.tblDef.indeterminate)}}}(NetBrain);!function(netbrain){angular.module("nb.common").service("nb.common.nbResourceIOSrvc",nbService);nbService.$inject=["$uibModal","$q","$rootScope","$timeout","$upload","nb.ng.httpDownloadingSrvc"];function nbService($uibModal,$q,$rootScope,$timeout,$upload,httpDownloadingSrvc){var me=this;this.getService=function(serviceFullName){return angular.element(document).injector().get(serviceFullName)};this.Const={AlwaysTrue:!0,AlwaysFalse:!1,fileReaderEvents:["loadstart","progress","load","abort","error","loadend"],resourceTypeMap:{Parser:{name:"Parser",displayName:"Parser",description:""},Qapp:{name:"Qapp",displayName:"Qapp",description:""},QappGroup:{name:"QappGroup",displayName:"Gapp",description:""},Runbook:{name:"Runbook",displayName:"Runbook",description:""},VariableMapping:{name:"VariableMapping",displayName:"Variable Mapping",description:""},DataViewTemplate:{name:"DataViewTemplate",displayName:"Data View Template",description:""},Plugin:{name:"Plugin",displayName:"Plugin",nameMapping:{1:"Built-in Plugins",32:"My Plugins"}}}};this.taskModel={businessId:"",ResourceExportCallbackToken:void 0,ResourceImportCallbackToken:void 0,exportJobs:[],importJobs:[]};this.getTypeModel=function(type){return this.Const.resourceTypeMap[type]||""};this.converToPath=function(type,space,location){var typeModel=this.Const.resourceTypeMap[type];return typeModel?typeModel.nameMapping&&typeModel.nameMapping[space]?typeModel.nameMapping[space]+location:1==space?"Built-in "+this.getDisplayName(typeModel,space)+"s"+location:2==space?"Shared "+this.getDisplayName(typeModel,space)+"s in Company"+location:4==space?"Shared "+this.getDisplayName(typeModel,space)+"s in Tenant"+location:8==space?"My "+this.getDisplayName(typeModel,space)+"s"+location:32==space?"Shared "+this.getDisplayName(typeModel,space)+"s in Domain"+location:"":""};this.getDisplayName=function(typeModel,space){return typeModel.name&&"DataViewTemplate"===typeModel.name?["Data View Template","Template","Template","Template"][Math.log2(space)]:typeModel.displayName};this.openPopup=function(type,importTo,options){return $uibModal.open({templateUrl:"modules/nbCommon/resourceIO/views/nbResourceImport.html",controller:"nb.common.nbResourceImportCtrl",windowClass:"resource-io-import",backdrop:"static",resolve:{resolveData:{type:type,importTo:importTo,options:options}}}).result};this.readFile=function(fileInfo,fnCallBackMap){var reader=new FileReader;me.Const.fileReaderEvents.forEach((function(eventName){reader["on"+eventName]=function(e){fnCallBackMap[eventName]&&fnCallBackMap[eventName](e,fileInfo)}}));reader.readAsArrayBuffer(fileInfo.file)};this.getInventory=function(arg){return me.Const.AlwaysFalse?$q.when({packageInfo:{exportDate:"2018-01-26T12:40:50Z",exportUser:"admin",packageSize:1e3},resources:[{key:"...",type:"QappGroup",name:"runbook1",size:1e3,space:4,location:"/shared1/",isExists:!1,dependencies:[{key:"...",type:"QappGroup",name:"OSPF",space:4,location:"/QappGroup1/",isExists:!1},{key:"...",type:"Qapp",name:"OSPF",space:1,location:"/Qapp1/",isExists:!1},{key:"...",type:"Qapp",name:"OSPF",space:2,location:"/Qapp2/",isExists:!1},{key:"...",type:"Qapp",name:"OSPF",space:4,location:"/Qapp3/",isExists:!1},{key:"...",type:"Qapp",name:"OSPF",space:8,location:"/Qapp4/",isExists:!1},{key:"...",type:"Qapp",name:"OSPF",space:4,location:"/Qapp5/",isExists:!1},{key:"...",type:"Parser",name:"OSPF",space:4,location:"/Parser1/",isExists:!1},{key:"...",type:"Parser",name:"OSPF",space:1,location:"/Parser2/",isExists:!1},{key:"...",type:"VariableMapping",name:"VariableMappingXXX001"}],counts:[{type:"QappGroup",count:5},{type:"Qapp",count:10},{type:"Parser",count:20},{type:"VariableMapping",count:50}]}],resourceTypes:[{name:"QappGroup",displayName:"Gapp",description:""}]}):this.getService("nb.ng.nbHttp").post("resourceIO/inventory",arg)};this.getSettings=function(){return this.getService("nb.ng.nbHttp").get("resourceIO/settings")};this.uploadFile=function(arg,callbackMap,callbaclArg){arg&&arg.bAsync?this.importAsync(arg,callbackMap,callbaclArg):this.importSync(arg,callbackMap,callbaclArg)};this.preAddTask=function(){if(me.taskModel.ResourceExportCallbackToken){ngHub.getInstance().unRegisterEvent("ResourceExport",me.taskModel.ResourceExportCallbackToken);me.taskModel.ResourceExportCallbackToken=void 0}if(me.taskModel.ResourceImportCallbackToken){ngHub.getInstance().unRegisterEvent("ResourceImport",me.taskModel.ResourceImportCallbackToken);me.taskModel.ResourceImportCallbackToken=void 0}me.taskModel.ResourceExportCallbackToken=ngHub.getInstance().registerEvent("ResourceExport",(function(data){me.onExport(data)}));me.taskModel.ResourceImportCallbackToken=ngHub.getInstance().registerEvent("ResourceImport",(function(data){me.onImport(data)}))};this.addExportTask=function(task){me.taskModel.exportJobs.some((function(ele){return ele.jobId==task.jobId}))||me.taskModel.exportJobs.push({jobId:task.jobId,businessId:me.taskModel.businessId,jobInfo:task})};this.addImportTask=function(task){me.taskModel.importJobs.some((function(ele){return ele.jobId==task.jobId}))||me.taskModel.importJobs.push({jobId:task.jobId,businessId:me.taskModel.businessId,jobInfo:task})};this.onExport=function(data){var nbAlertSrvc=this.getService("nb.common.nbAlertSrvc");if(data){var curJobIndex=null;me.taskModel.exportJobs.some((function(ele,index){if(ele.jobId==data.jobId){curJobIndex=index;return!0}}));if(curJobIndex>=0){var curJob=me.taskModel.exportJobs[curJobIndex];curJob.jobInfo=data;if(3==curJob.jobInfo.status){me.taskModel.exportJobs.splice(curJobIndex,1);me.download(curJob,{defer:curJob.defer})}else if(4==curJob.jobInfo.status||5==curJob.jobInfo.status){me.taskModel.exportJobs.splice(curJobIndex,1);nbAlertSrvc.error(curJob.jobInfo.errorMsg);curJob.jobInfo.defer&&curJob.jobInfo.defer.reject(curJob.jobInfo.status)}}}};this.onImport=function(data){if(data){var curJobIndex=null;me.taskModel.importJobs.some((function(ele,index){if(ele.jobId==data.jobId){curJobIndex=index;return!0}}));if(curJobIndex>=0){var curJob=me.taskModel.importJobs[curJobIndex];curJob.jobInfo=data;if(3==curJob.jobInfo.status){me.taskModel.importJobs.splice(curJobIndex,1);curJob.fnCallbackMap&&curJob.fnCallbackMap.success&&curJob.fnCallbackMap.success(curJob.jobInfo,curJob.callbackArg)}else if(4==curJob.jobInfo.status){me.taskModel.importJobs.splice(curJobIndex,1);curJob.fnCallbackMap&&curJob.fnCallbackMap.error&&curJob.fnCallbackMap.error(curJob.jobInfo,curJob.callbackArg)}else if(5==curJob.jobInfo.status){me.taskModel.importJobs.splice(curJobIndex,1);curJob.fnCallbackMap&&curJob.fnCallbackMap.abort&&curJob.fnCallbackMap.abort(curJob.jobInfo,curJob.callbackArg)}}}};this.import=function(type,space,location,options){var opt=options||{};opt.space=space;opt.location=location;this.preAddTask();return this.getAllTypes().then((function(){return me.openPopup(type,me.converToPath(type,space,location),opt)}),(function(){return me.openPopup(type,me.converToPath(type,space,location),opt)}))};this.getUploadToken=function(count){return this.getService("nb.ng.nbHttp").get("FileUploadRestriction/token/"+count)};this.importAsync=function(arg,fnCallbackMap,callbackArg){$upload.upload({url:NetBrain.NG.ConfigSettings.API_ROOT+"resourceIO/import?uploadToken="+arg.token,method:"POST",headers:arg.headers,data:arg.data,file:arg.fileInfo.file,fileName:arg.fileInfo.file.name});this.addImportTask({jobId:arg.fileInfo.structure.gidTask,status:1,fnCallbackMap:fnCallbackMap,callbackArg:callbackArg})};this.importSync=function(arg,fnCallbackMap,callbackArg){$upload.upload({url:NetBrain.NG.ConfigSettings.API_ROOT+"resourceIO/import?uploadToken="+arg.token,method:"POST",headers:arg.headers,data:arg.data,file:arg.fileInfo.file,fileName:arg.fileInfo.file.name}).progress((function(){})).success((function(data){fnCallbackMap&&fnCallbackMap.success&&fnCallbackMap.success(data,callbackArg)})).error((function(err){fnCallbackMap&&fnCallbackMap.error&&fnCallbackMap.error(err,callbackArg)}))};this.export=function(arg){var defer=$q.defer();arg.defer=defer;this.preAddTask();arg&&arg.options&&arg.options.bAsync?this.exportAsync(arg):this.exportSync(arg);return defer.promise};this.exportAsync=function(arg){var nbHttp=me.getService("nb.ng.nbHttp");var nbAlertSrvc=this.getService("nb.common.nbAlertSrvc");return nbHttp.post("resourceIO/export?async=1",arg).then((function(data){if(data&&[1,2,3].indexOf(data.status)>=0){data.defer=arg.defer;me.addExportTask(data)}else{console.warn("download failed.");nbAlertSrvc.error(me.replaceErrorMsg(data));arg.defer&&arg.defer.reject(data)}}),(function(err){console.warn("download failed.");nbAlertSrvc.error(err.errorMsg);arg.defer&&arg.defer.reject(err)}))};this.replaceErrorMsg=function(data){var errMsg=data?data.errorMsg:"";data&&400009==data.errorCode&&data.errorData&&data.errorData.path&&(errMsg=(errMsg=nbPLM.Common.sprintf("Failed to export: referenced {0} cannot be found.<br />Location: {1}",data.errorData.type||"",data.errorData.path)).replace(/\?userId\=[0-9a-zA-Z]{8}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{12}/,""));return errMsg};this.exportSync=function(arg){var nbHttp=me.getService("nb.ng.nbHttp");var nbAlertSrvc=this.getService("nb.common.nbAlertSrvc");return nbHttp.post("resourceIO/export",arg).then((function(data){if(data&&3==data.status)me.download(data,arg);else{console.warn("download failed.");nbAlertSrvc.error(me.replaceErrorMsg(data));arg.defer&&arg.defer.reject(data)}}),(function(err){console.warn("download failed.");nbAlertSrvc.error(err.errorMsg);arg.defer&&arg.defer.reject(err)}))};this.getAllTypes=function(){return me.getService("nb.ng.nbHttp").get("resourceIO/allType").then((function(data){data&&data.forEach((function(eleType){me.Const.resourceTypeMap[eleType.name]?nbPLM.Common.merge(me.Const.resourceTypeMap[eleType.name],eleType):me.Const.resourceTypeMap[eleType.name]=eleType}));return!0}),(function(err){return!1}))};this.download=function(task,arg){httpDownloadingSrvc.getTicket().then((function(ticketData){me.startDownloading(ticketData,task,arg)}),(function(err){alert("failed to get downloading ticket...")}))};this.startDownloading=function(ticket,task,arg){var httpAuthSrvc=me.getService("nb.ng.httpAuthSrvc");var utilitySrvc=me.getService("nb.ng.utilitySrvc");var dataSrc=httpAuthSrvc.getDataSrc(utilitySrvc);var url=NetBrain.NG.ConfigSettings.API_ROOT+"resourceIO/package/"+task.jobId+"?tenantGuid="+dataSrc.TenantGuid+"&domainGuid="+dataSrc.DomainGuid;url+="&dl_ticket="+ticket;arg.defer&&arg.defer.resolve(task);httpDownloadingSrvc.downloadFile(url)};this.exportOne=function(resourceKey,options){return this.export({resourceKeys:[resourceKey],options:angular.merge({jobId:window.nbPLM.nbParserLibCM.getGUID(),bAsync:!1},options||{})})};this.exportMulti=function(resourceKeys,options){return this.export({resourceKeys:resourceKeys,options:angular.merge({jobId:window.nbPLM.nbParserLibCM.getGUID(),bAsync:!1},options||{})})};this.openImportDialog=function(resourceTypeName,options){var curOptions={accept:"*",isVisibleRelatedResource:!0,mainDialogSize:{width:760,height:374},relatedDialogSize:{width:668,height:342}};angular.merge(curOptions,options);curOptions.accept=curOptions.allowedPackageFileSuffix&&curOptions.allowedPackageFileSuffix.join(",")||"*";return this.import(resourceTypeName,curOptions.expectedImportLocation.space,curOptions.expectedImportLocation.location,curOptions)};this.openSelectResource=function(data,conf,options,fnOnValidate){return $uibModal.open({templateUrl:"modules/nbCommon/resourceIO/views/resourceSelect.html",controller:"nb.common.resourceSelectCtrl",windowClass:"common-resource-select",backdrop:"static",resolve:{resolveData:{data:data,conf:conf,title:options.title,options:options,onValidate:fnOnValidate}}}).result}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.nbKCNotificationCtrl",NbKCNotificationCtrl);NbKCNotificationCtrl.$inject=["$scope","$uibModal","$uibModalInstance","nb.ticket.ticketDialogSrvc","nb.ticket.consts"];function NbKCNotificationCtrl($scope,$uibModal,$uibModalInstance,ticketDialogSrvc,consts){$scope.noMoreNotificationChecked=!1;$scope.openSubmitTicketModal=function(){ticketDialogSrvc.submitTicketModal(consts.EnumTicketType.GenericIssue,"")};$scope.closeDialog=function(){$uibModalInstance.close($scope.noMoreNotificationChecked)}}}(NetBrain);!function(){angular.module("nb.common").controller("nb.common.nbKCVerificationCtrl",NbKCVerificationCtrl);NbKCVerificationCtrl.$inject=["$scope","$uibModal","$uibModalInstance","nb.common.nbKnowledgeCloudSrvc","nb.ticket.ticketDialogSrvc","nb.ticket.consts"];function NbKCVerificationCtrl($scope,$uibModal,$uibModalInstance,nbKnowledgeCloudSrvc,ticketDialogSrvc,consts){$scope.showErrorMsg=!1;$scope.errorMsg="Your User Name or Password is incorrect. Please try again.";$scope.verification={username:"",password:""};$scope.openSubmitTicketModal=function(){ticketDialogSrvc.submitTicketModal(consts.EnumTicketType.GenericIssue,"")};$scope.onVerify=function(){nbKnowledgeCloudSrvc.verifyUser(angular.copy($scope.verification)).then((function(verified){verified?$uibModalInstance.close(!0):$scope.showErrorMsg=!0}),(function(err){err&&err.ResultDesc&&!err.ResultDesc.includes("(401) Unauthorized")&&($scope.errorMsg=err.ResultDesc);$scope.showErrorMsg=!0}))};$scope.onCancel=function(){$uibModalInstance.dismiss("You have to be verified to be able to perform this action.")}}}(NetBrain);!function(netBrain){angular.module("nb.common").directive("nbCommonFloatTipDirective",nbDirective);nbDirective.$inject=["$compile","$log","$document","$timeout","$sce","$rootScope"];function nbDirective($compile,$log,$document,$timeout,$sce,$rootScope){return{restrict:"EA",scope:{eventName:"=eventName"},replace:!0,templateUrl:"modules/nbCommon/views/nbCommonFloatTipDirective.html",link:function($scope){$scope.dataModel={saveBoard:{msg:""},gEventName:$scope.eventName,zz_last:null};$scope.showSaveSuccessMsg=function(msg){var dm=$scope.dataModel;$scope.releaseTimer();dm.saveBoard.msg=msg;dm.saveBoard.timer=$timeout((function(){dm&&dm.saveBoard&&(dm.saveBoard.msg="")}),3e3)};$scope.releaseTimer=function(){var dm=$scope.dataModel;if(dm.saveBoard.timer){$timeout.cancel(dm.saveBoard.timer);dm.saveBoard.timer=null}};var varGEvent_ShowMessage=null;$scope.dataModel.gEventName&&(varGEvent_ShowMessage=$rootScope.$on($scope.dataModel.gEventName,(function(event,msg){msg&&$scope.showSaveSuccessMsg(msg)})));$scope.$on("$destroy",(function(){$scope.releaseTimer();varGEvent_ShowMessage&&varGEvent_ShowMessage()}))}}}}(NetBrain);!function(){angular.module("nb.common").factory("nb.common.nbKnowledgeCloudSrvc",NbKnowledgeCloudSrvc);NbKnowledgeCloudSrvc.$inject=["nb.ng.nbHttp","$timeout","$uibModal","$q"];function NbKnowledgeCloudSrvc(nbHttp,$timeout,$uibModal,$q){var KC_NOTIFICATION="KCNotification";var KC_VERIFICATION="KCVerification";return{handleNotificationSetting:function(){return nbHttp.get(KC_NOTIFICATION).then((function(previousSetting){return previousSetting?"skip notification":$uibModal.open({templateUrl:"modules/nbCommon/knowledgeCloud/views/nbKCNotification.html",controller:"nb.common.nbKCNotificationCtrl",backdrop:"static",keyboard:!1,windowClass:"",resolve:{}}).result.then((function(currSetting){currSetting&&(data={noMoreNotification:currSetting},nbHttp.post(KC_NOTIFICATION,data));var data}))}))},handleVerificationStatus:function(onBeforeShowVerificationModal){return _getVerificationStatus().then((function(isValid){if(!isValid){onBeforeShowVerificationModal&&onBeforeShowVerificationModal();return $uibModal.open({templateUrl:"modules/nbCommon/knowledgeCloud/views/nbKCVerification.html",controller:"nb.common.nbKCVerificationCtrl",backdrop:"static",keyboard:!1,windowClass:"",resolve:{}}).result}return"skip verification"}))},verifyUser:function(userInfo){var deferred=$q.defer();nbHttp.post("admin/getPublicKey",{},{}).then((function(data){var pwdRtn=userInfo.password?userInfo.password:"";if(""!==pwdRtn&&data&&data.length>=2){setMaxDigits(129);var key=new RSAKeyPair(data[0],"",data[1]);pwdRtn=encryptedString(key,pwdRtn)}userInfo.password=pwdRtn;return nbHttp.post(KC_VERIFICATION+"/verifyUser",userInfo).then((function(result){deferred.resolve(result)}),(function(reason){deferred.reject(reason)}))}));return deferred.promise},getVerificationStatus:_getVerificationStatus,getDebugSettings:function(){return nbHttp.get(KC_VERIFICATION+"/debugsettings")},setDebugSettings:function(payload){return nbHttp.post(KC_VERIFICATION+"/debugsettings",payload)}};function _getVerificationStatus(){return nbHttp.get(KC_VERIFICATION)}}}(NetBrain);!function(netBrain){angular.module("nb.common").directive("nbFloatButton",nbFloatButton);nbFloatButton.$inject=["$document","$uibModal"];function nbFloatButton($document,$uibModal){var directive={restrict:"EA",templateUrl:"controls/nb-float-button/nb-float-button.tpl.html",controller:controller,replace:!0,scope:{type:"=",data:"=",buttonPosition:"="},link:{pre:function(scope,element,attrs){var container=element[0];scope.position=scope.buttonPosition||"right";if("right"==scope.position){if(4==scope.type){container.style.top="35px";container.style.right="5px"}if(3==scope.type){container.style.bottom="20px";container.style.right="12px"}}element.find(".float-button-title")[0]},post:function(scope,element,attrs){}}};controller.$inject=["$scope","$rootScope","$sce","$element","$q","nb.qmap.mapManagerSrvc","nb.ticket.ticketDialogSrvc","nb.common.nbAlertSrvc","nb.qmap.httpMapSrvc","nb.ticket.consts","nb.ng.permissionSrvc","nb.ng.userSrvc","nb.runbook.actionTaskSrvc"];function controller($scope,$rootScope,$sce,$element,$q,mapManagerSrvc,ticketDialogSrvc,nbAlertSrvc,mapSrvc,ticketConsts,permissionSrvc,userSrvc,actionTaskSrvc){$scope.showRight=!0;$scope.liveAccessPermission=permissionSrvc.hasDomainPermission(NetBrain.NG.Permissions.accessToLiveNetwork);$scope.onClick=function(afterSaveMap){var realRun=function(){if($scope.type==ticketConsts.EnumTicketType.Discover||$scope.type==ticketConsts.EnumTicketType.Benchmark||$scope.type==ticketConsts.EnumTicketType.Map||$scope.type==ticketConsts.EnumTicketType.Path){if($scope.type==ticketConsts.EnumTicketType.Path){if(angular.isUndefined(NetBrain.Map.currentActiveMap)||null==NetBrain.Map.currentActiveMap){nbAlertSrvc.warning("Please map this path and save it before submitting ticket.");return}var map=mapManagerSrvc.getActiveMap();var pathIds=[];map&&map._docList&&map._docList.forEach((function(doc){var getPaths=doc.getNetmapOperator().getAllPaths();getPaths&&getPaths.forEach((function(path){path&&path.hasOwnProperty("taskId")&&pathIds.push(path.taskId)}))}));var mapN=NetBrain.Map.currentActiveMap.getTitle();if(!pathIds.includes($scope.data.pathId)){var msgP=StringUtil.format('Map "{mapname}" is not mapped from current path.<br><br> Please map the path and save the map.',{mapname:mapN});nbAlertSrvc.warning(msgP);return}if(NetBrain.Map.currentActiveMap&&NetBrain.Map.currentActiveMap.isModify()){nbAlertSrvc.confirm("The map has not been saved, do you want to save the map first and continue?").then((function(){saveMap()}),(function(){}));return}}if($scope.type==ticketConsts.EnumTicketType.Map&&NetBrain.Map.currentActiveMap&&NetBrain.Map.currentActiveMap.isModify()){nbAlertSrvc.confirm("The map has not been saved, do you want to save the map first and continue?").then((function(){saveMap()}),(function(){}));return}NetBrain.Map.currentActiveMap?mapSrvc.getMapThumbnails(NetBrain.Map.currentActiveMap.qmapJsWrapper.qmapdata.ID).then((function(data){$scope.data.Thumbnail=data;ticketDialogSrvc.submitTicketModal($scope.type,$scope.data)})):ticketDialogSrvc.submitTicketModal($scope.type,$scope.data)}else ticketDialogSrvc.submitTicketModal($scope.type,$scope.data)};afterSaveMap?realRun():actionTaskSrvc.getGlobalDAPStatus().then((function(){realRun()}))};var saveMap=function(){if(function(){var activeMap=mapManagerSrvc.getActiveMap();if(null==activeMap)return!1;var result=!1;var editor=activeMap.getEditRight();userSrvc.getUserName()===editor.editorName&&(result=!0);return result}())mapManagerSrvc.saveMap().then((function(){$scope.onClick(!0)}));else{var obj={title:"Confirmation",iconType:NB_ICON_QUESTION,message:"You can’t save this map unless you get the editing rights. Do you want to save it as a new map?"};nbAlertSrvc.confirm(obj).then((function(){mapManagerSrvc.saveMapAs().then((function(){$scope.onClick(!0)}))}),(function(){}))}};var hideRightFloatButton=$rootScope.$on("nb-float-button-left",(function(){"right"==$scope.position&&($scope.showRight=!1)}));var showRightFloatButton=$rootScope.$on("close-path-panel",(function(){"right"==$scope.position&&($scope.showRight=!0)}));var rightFloatButton=$rootScope.$on("close-left-float-button",(function(){"right"==$scope.position&&($scope.showRight=!0)}));$scope.$on("$destroy",(function(){hideRightFloatButton();showRightFloatButton();rightFloatButton()}))}return directive}}(NetBrain);!function(netbrain){angular.module("nb.common").service("nb.common.nbRuleParserSrvc",nbService);nbService.$inject=["$uibModal","$q","$rootScope","$timeout"];function nbService($uibModal,$q,$rootScope,$timeout){var me=this;this.Const={ace:{maxLength:38},zz_last:null};this.$nextWord=function(strJson,index,config){var arrSpace=config.arrSpace;var arrSign=config.arrSign;var arrKeyword=config.arrKeyword;var ret={type:"finish",start:index,end:index};if(strJson.length<=index)return ret;var cFirst=strJson[index];var bEscape=!1;if(arrSpace.indexOf(cFirst)>=0)ret.type="space";else if(arrSign.indexOf(cFirst)>=0)ret.type="sign";else if('"'==cFirst){ret.type="unstring";ret.end=strJson.length-1}else{ret.type="unknown";ret.end=strJson.length-1}for(var i=index+1;i<strJson.length&&"sign"!=ret.type;i++)if("space"!=ret.type)if("unstring"!=ret.type){if("unknown"!=ret.type);else if(arrSpace.indexOf(strJson[i])>=0||arrSign.indexOf(strJson[i])>=0||'"'==strJson[i]){ret.end=i-1;break}}else if('"'==strJson[i]){if(!bEscape){ret.type="string";ret.end=i;break}bEscape=!1}else"\\"==strJson[i]&&(bEscape=!bEscape);else{if(!(arrSpace.indexOf(strJson[i])>=0))break;ret.end=i}if("unknown"==ret.type){var strSub=strJson.substr(index,ret.end-ret.start+1);arrKeyword.indexOf(strSub)>=0?ret.type="keyword":(/^-?([0-9]\d*)$/.test(strSub)||/^-?([0-9]\d*)\.\d*$/.test(strSub))&&(ret.type="number")}return ret};this.$nextJsonWord=function(strJson,index){return me.$nextWord(strJson,index,{arrSpace:[" ","\t","\r","\n"],arrSign:[",",":","{","}","[","]"],arrKeyword:["true","false","null","undefined"]})};this.parseJson=function(strJson){function JsonError(msg,_index,level,type){this.message=msg;this.index=_index;this.level=level;this.type=type}JsonError.prototype=Error;function getJsonEle(pNode){return{type:"",child:void 0,iNStart:-1,iNEnd:-1,iColon:-1,iBStart:-1,iBEnd:-1,iNext:-1,$_p:pNode}}var keywordMap={false:"bool",true:"true",null:"null",undefined:"undefined"};var rootEle=getJsonEle();rootEle.type="root";rootEle.iNStart=0;rootEle.iNEnd=0;rootEle.iColon=0;rootEle.iNext=0;var index=0;var curEle=rootEle;var sign;for(;;){var nextWord=me.$nextJsonWord(strJson,index);if("finish"==nextWord.type)break;if("unstring"==nextWord.type||"unknown"==nextWord.type)throw new JsonError(nbPLM.Common.sprintf("Unexpected string: '{0}'...",strJson.substr(nextWord.start,nextWord.end-nextWord.start>20?21:nextWord.end-nextWord.start)),nextWord.start,"error");if(-1!=curEle.iNStart)if(-1!=curEle.iColon)if(-1!=curEle.iBStart)if(-1!=curEle.iNext){if("space"!=nextWord.type)throw new JsonError(nbPLM.Common.sprintf("Syntax error."),nextWord.start,"error")}else{if("space"==nextWord.type);else if("sign"==nextWord.type){if(","==(sign=strJson.substr(nextWord.start,nextWord.end-nextWord.start+1)))curEle.iNext=nextWord.start;else if("}"==sign){curEle.iNext=nextWord.start;if("object"!=curEle.$_p.type)throw new JsonError(nbPLM.Common.sprintf("Unexpected '{0}'.",sign),nextWord.start,"error")}else{if("]"!=sign)throw new JsonError(nbPLM.Common.sprintf("Unexpected '{0}'.",sign),nextWord.start,"error");curEle.iNext=nextWord.start;if("array"!=curEle.$_p.type)throw new JsonError(nbPLM.Common.sprintf("Unexpected '{0}'.",sign),nextWord.start,"error")}if(!curEle.$_p)throw new JsonError(nbPLM.Common.sprintf("Syntax error."),nextWord.start,"error");if("object"==curEle.$_p.type){curEle.$_p.child||(curEle.$_p.child={});var name=strJson.substr(curEle.iNStart+1,curEle.iNEnd-curEle.iNStart-1);if(curEle.$_p.child.hasOwnProperty(name))throw new JsonError(nbPLM.Common.sprintf("Duplicate key '{0}'.",name),nextWord.start,"error");curEle.$_p.child[name]=curEle}else{if("array"!=curEle.$_p.type)throw new JsonError(nbPLM.Common.sprintf("Syntax error."),nextWord.start,"error");curEle.$_p.child||(curEle.$_p.child=[]);curEle.$_p.child.push(curEle)}if(","==sign){if("array"==(curEle=getJsonEle(curEle.$_p)).$_p.type){curEle.iNStart=0;curEle.iNEnd=0;curEle.iColon=0}}else curEle=curEle.$_p}index=nextWord.end+1}else{if("space"==nextWord.type);else if("string"==nextWord.type||"number"==nextWord.type||"keyword"==nextWord.type){curEle.iBStart=nextWord.start;curEle.iBEnd=nextWord.end;curEle.type=nextWord.type;if("keyword"==nextWord.type){var _keyword=strJson.substr(nextWord.start,nextWord.end-nextWord.start+1);curEle.type=keywordMap[_keyword]||nextWord.type}}else if("sign"==nextWord.type)if("{"==(sign=strJson.substr(nextWord.start,nextWord.end-nextWord.start+1))){curEle.iBStart=nextWord.start;curEle.type="object";curEle=getJsonEle(curEle)}else if("["==sign){curEle.iBStart=nextWord.start;curEle.type="array";(curEle=getJsonEle(curEle)).iNStart=0;curEle.iNEnd=0;curEle.iColon=0}else{if("]"!=sign||!curEle.$_p||"array"!=curEle.$_p.type)throw new JsonError(nbPLM.Common.sprintf("Unexpected '{0}'.",sign),nextWord.start,"error");(curEle=curEle.$_p).iBEnd=nextWord.start}index=nextWord.end+1}else{if("space"==nextWord.type);else{if("sign"!=nextWord.type||":"!=strJson.substr(nextWord.start,nextWord.end-nextWord.start+1))throw new JsonError(nbPLM.Common.sprintf("Need a colon."),nextWord.start,"error");curEle.iColon=nextWord.start}index=nextWord.end+1}else{if("space"==nextWord.type);else if("string"==nextWord.type){curEle.iNStart=nextWord.start;curEle.iNEnd=nextWord.end;curEle.name=strJson.substr(curEle.iNStart+1,curEle.iNEnd-curEle.iNStart-1)}else{if("sign"!=nextWord.type)throw new JsonError(nbPLM.Common.sprintf("Need a string as a name"),nextWord.start,"error");if("}"!=(sign=strJson.substr(nextWord.start,nextWord.end-nextWord.start+1))||!curEle.$_p||"object"!=curEle.$_p.type)throw new JsonError(nbPLM.Common.sprintf("Need a string as a name"),nextWord.start,"error");(curEle=curEle.$_p).iBEnd=nextWord.start}index=nextWord.end+1}}return rootEle};this.getJsonPosByPaths=function(strJson,arrPath){var ret=[];var rootEle=me.parseJson(strJson);arrPath.forEach((function(elePath){var arrNames=[];elePath.split(".").forEach((function(eleWord){!function getWordName(eleWord,arr){var mat=eleWord.match(/\[(\d+)\]$/);if(mat&&2==mat.length){var preName=eleWord.substr(0,eleWord.length-mat[0].length);preName&&getWordName(preName,arr);arr.push(mat[1])}else arr.push(eleWord)}(eleWord,arrNames)}));var curEle=rootEle;for(var i=0;i<arrNames.length&&(curEle.child&&curEle.child[arrNames[i]]);i++)curEle=curEle.child[arrNames[i]];var pos=nbPLM.OpBaseRule.getPosByIndex(strJson,curEle.iNStart==curEle.iNEnd?curEle.iBStart:curEle.iNStart);ret.push({path:elePath,index:curEle.iNStart,row:pos.row,column:pos.column})}));return ret};this.getFirstNonSpaceIndex=function(text){var ret=-1;if(nbPLM.Common.isString(text)){var mat=text.match(/\s*(\S)/);mat&&mat.length&&(ret=mat[0].length-1)}return ret};this.processTips=function(wordList,bAddThis){if(nbPLM.Common.isArray(wordList)){bAddThis&&wordList.push({caption:"$this",value:"$this",score:1,meta:"variable"});var wordMap={};for(var i=0;i<wordList.length;i++){var curWord=wordList[i];if(wordMap[curWord.caption])if(curWord.dupTimes>=1&&curWord.dupTimes<=2){curWord.caption+=" ";curWord.dupTimes-=1;i--}else{wordList.splice(i,1);i--}else wordMap[curWord.caption]=1}wordList.sort((function(ele1,ele2){return ele1.score!=ele2.score?ele1.score-ele2.score:ele1.meta!=ele2.meta?ele1.meta.toLowerCase()>ele2.meta.toLowerCase()?1:-1:ele1.caption!=ele2.caption&&ele1.caption.toLowerCase()>ele2.caption.toLowerCase()?1:-1}))}};this.calcAceCaption=function(caption,meta){var maxLength=me.Const.ace.maxLength;var sCap=caption||"";var sMeta=meta||"";return sCap&&sCap.length+sMeta.length>maxLength?maxLength-sMeta.length-3>0?sCap.substr(0,maxLength-sMeta.length-3)+"��":maxLength-sMeta.length-2>0?sCap.substr(0,maxLength-sMeta.length-2):sCap.substr(0,maxLength-2)+"��":sCap}}}(NetBrain);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})};__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});Object.defineProperty(exports,"__esModule",{value:!0})};__webpack_require__.t=function(value,mode){1&mode&&(value=__webpack_require__(value));if(8&mode)return value;if(4&mode&&"object"===_typeof(value)&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:!0,value:value});if(2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";__webpack_require__(__webpack_require__.s="./app/modules/nbCommon/path.es6.js")}({"./app/modules/nbCommon/directives/nbEditableTextDirective.es6.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return EditableText}));function EditableText(){return{restrict:"E",template:'<div ng-dblclick="setEditable($event)"><input type="text" ng-if="editable" ng-blur="onBlur($event)" ng-keypress="onKeyPress($event)" ng-model="displayName" class="text-center"></input><span ng-if="!editable" class="text-center">{{displayName}}</span></div>',scope:{editable:"=",displayName:"=",onEdited:"&?"},controller:function($scope,$element){$scope.onKeyPress=function(e){"Enter"===e.key&&e.currentTarget.blur()};$scope.setEditable=function(){$scope.editable=!0};$scope.onBlur=function(e){if($scope.onEdited)$scope.onEdited()(e);else{$scope.editable=!1;$scope.displayName=e.target.value}};$scope.$watch("editable",(function(value){!0===value&&setTimeout((function(){var input=$element[0].querySelector("input");input.focus();input.select()}))}))}}}},"./app/modules/nbCommon/path.es6.js":function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _directives_nbEditableTextDirective_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./app/modules/nbCommon/directives/nbEditableTextDirective.es6.js");angular.module("nb.common").directive("nbEditableText",_directives_nbEditableTextDirective_es6_js__WEBPACK_IMPORTED_MODULE_0__.default)}});
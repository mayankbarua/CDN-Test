NetBrain.ns("LayoutTools");!function(netBrain){var consts=NetBrain.ns("LayoutTools.Const");consts.Wording={InnerError:{UnknownCreateStrategy:"check: is sample map createStrategy in sampleMapCreateStrategy"}};consts.TemplateStyleScaleMap={1:1.2,2:1,3:.8}}();!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={checkArgumentsTypes:function(args,types,ticket){}}}(mod_exports);global.argumentsChecker=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;"value"in descriptor&&(descriptor.writable=!0);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==_typeof(call)&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={commonNodeSize:150,nodeDistance:30}}(mod_exports);global.layoutBaseConfig=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={margin:100,padding:150,horizontal:10,vertical:10,width:150,height:100,levelDistance:200,nodeDistance:5,direction:"down",levelSize:12,base:1.07,scale:.17,tries:3,forceNodeDistance:10,forceTries:3,forceK:120,forceGravitationFactor:30,forceGravitationBase:120,forceRepulsionFactor:405600,forceRepulsionBase:90,repulsionRange:4,repulsionRangeMin:1,p2pFactor:1.7,minForce:40,forceLimitFactor:.13,decayA:77,decayB:67,symmetricTries:300,epsilon:1e-6,T:20,hv:.75,circleTreeRadius:60,pathL2HSpace:300,pathL2WSpace:300,pathL3HSpace:300,pathL3WSpace:200,pathL2LineHSpace:260,pathL2LineWSpace:195,pathL3LineHSpace:200,pathL3LineWSpace:150}}(mod_exports);global.defaultOptions=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var Point=function(){function Point(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,Point);this.x=x;this.y=y}_createClass(Point,[{key:"toString",value:function(){return[this.x,this.y].join(",")}},{key:"getCopy",value:function(){return new Point(this.x,this.y)}},{key:"convertToLocation",value:function(){return Math.floor(this.x)+" "+Math.floor(this.y)}},{key:"distance",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"zoom",value:function(scale){this.x*=scale;this.y*=scale;return this}},{key:"rotate",value:function(pt,angle){var rad=(angle%=360)*Math.PI/180;var diffX=this.x-pt.x;var diffY=this.y-pt.y;var sinRad=Math.sin(rad);var cosRad=Math.cos(rad);var x=diffX*cosRad-diffY*sinRad+pt.x;var y=diffX*sinRad+diffY*cosRad+pt.y;this.x=x;this.y=y;return this}},{key:"flip",value:function(pt,isHorizontal){var x=this.x;var y=this.y;!0===isHorizontal?x=2*pt.x-x:y=2*pt.y-y;this.x=x;this.y=y;return this}}],[{key:"parseFromLocation",value:function(location){location=(location=location||" ").split(" ");var x=parseFloat(location[0]);var y=parseFloat(location[1]);isNaN(x)&&(x=0);isNaN(y)&&(y=0);return new Point(x,y)}}]);return Point}();exports.default=Point}(mod_exports);global.point=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_point){Object.defineProperty(exports,"__esModule",{value:!0});var _point2=_interopRequireDefault(_point);var Position=function(_Point){_inherits(Position,_Point);function Position(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,Position);return _possibleConstructorReturn(this,(Position.__proto__||Object.getPrototypeOf(Position)).call(this,x,y))}_createClass(Position,[{key:"getCopy",value:function(){return new Position(this.x,this.y)}},{key:"offset",value:function(_offset){this.x+=_offset.x;this.y+=_offset.y;return this}},{key:"getOffsetFrom",value:function(spot){return new Position(this.x-spot.x,this.y-spot.y)}},{key:"getOffsetTo",value:function(spot){return new Position(spot.x-this.x,spot.y-this.y)}},{key:"moveTo",value:function(point){this.x=point.x;this.y=point.y;return this}},{key:"getCounterforce",value:function(){return new Position(-this.x,-this.y)}}],[{key:"parseFromLocation",value:function(location){var point=_point2.default.parseFromLocation(location);return new Position(point.x,point.y)}}]);return Position}(_point2.default);exports.default=Position}(mod_exports,global.point);global.position=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Size(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var height=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,Size);this.width=width;this.height=height}}(mod_exports);global.size=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_point){Object.defineProperty(exports,"__esModule",{value:!0});var _point2=_interopRequireDefault(_point);var Rect=function(){function Rect(rect){_classCallCheck(this,Rect);this.left=rect.left||0;this.top=rect.top||0;this.right=rect.right||0;this.bottom=rect.bottom||0;var centerX=(this.left+this.right)/2;var centerY=(this.top+this.bottom)/2;this.center=new _point2.default(centerX,centerY);this.width=this.right-this.left;this.height=this.bottom-this.top}_createClass(Rect,[{key:"containsPoint",value:function(pt){return this.left<=pt.x&&this.right>=pt.x&&this.top<=pt.y&&this.bottom>=pt.y}}]);return Rect}();exports.default=Rect}(mod_exports,global.point);global.rect=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_rect,_point){Object.defineProperty(exports,"__esModule",{value:!0});var _rect2=_interopRequireDefault(_rect);var _point2=_interopRequireDefault(_point);var Bounds=function(_Rect){_inherits(Bounds,_Rect);function Bounds(bd,spot){_classCallCheck(this,Bounds);var _this=_possibleConstructorReturn(this,(Bounds.__proto__||Object.getPrototypeOf(Bounds)).call(this,bd));var x=0,y=0;if(spot){x=spot.x;y=spot.y}else{x=_this.center.x;y=_this.center.y}_this.spot=new _point2.default(x,y);return _this}_createClass(Bounds,[{key:"getCurrentBounds",value:function(pt){if(!pt)return this;var left,top,right,bottom;var spotX=this.spot.x;var spotY=this.spot.y;left=pt.x-(spotX-this.left);top=pt.y-(spotY-this.top);right=pt.x+(this.right-spotX);bottom=pt.y+(this.bottom-spotY);return Bounds.parseFrom({left:left,top:top,right:right,bottom:bottom},pt)}}],[{key:"parseFrom",value:function(bd,spot){return new Bounds(bd,spot)}}]);return Bounds}(_rect2.default);exports.default=Bounds}(mod_exports,global.rect,global.point);global.bounds=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});var _position2=_interopRequireDefault(_position);var Pi=Math.PI;var piAngle=180;exports.default={getAngle:function(from,to){return convertRadianToAngle(getRadian(from,to))},getRadian:getRadian,getVerticalByRadian:function(radian){return(radian+Pi/2)%Pi},getVerticalByAngle:function(angle){return(angle+90)%180},convertAngleToRadian:function(angle){return angle/piAngle*Pi},convertRadianToAngle:convertRadianToAngle,rotateAngle:function(angle,target,dot){angle%=2*Math.PI;var cos=Math.cos(angle),sin=Math.sin(angle);return rotate(cos,sin,target,dot)},rotateDown:function(target){return target},rotateUp:rotateSpecialAngle(Pi),rotateLeft:rotateSpecialAngle(Pi/2),rotateRight:rotateSpecialAngle(-Pi/2)};function getRadian(from,to){return Math.atan2(to.y-from.y,to.x-from.x)}function convertRadianToAngle(radian){return radian/Pi*piAngle}function rotateSpecialAngle(angle){var cos=Math.cos(angle),sin=Math.sin(angle);return function(target,dot){return rotate(cos,sin,target,dot)}}function rotate(cos,sin,target,dot){var x=target.x,y=target.y,sx=dot.x,sy=dot.y;var nx=(x-sx)*cos-(y-sy)*sin+sx,ny=(x-sx)*sin+(y-sy)*cos+sy;return new _position2.default(nx,ny)}}(mod_exports,global.position);global.angle=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={createEmptyDic:function(){return Object.create(null)},keys:function(obj){return Object.getOwnPropertyNames(obj)},breadthFirstTraversal:function(tree){return{eachNode:function(nodeOperator){var seeds=[tree];var nextSeeds=[];var perNode=function(node){nodeOperator(node);nextSeeds=nextSeeds.concat([].concat(_toConsumableArray(node.subTrees.values())))};for(;seeds.length;){_.each(seeds,perNode);seeds=nextSeeds;nextSeeds=[]}}}}}}(mod_exports);global.common=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position,_size){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(island){var padding=island.options.padding;var left=0;var top=0;var right=0;var bottom=0;if(0===island.nodes.size)left=top=right=bottom=0;else{left=1/0;top=1/0;right=-1/0;bottom=-1/0}var nodes=island.nodes.values();var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=nodes[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var offset=_step.value.offset;left=Math.min(left,offset.x);top=Math.min(top,offset.y);right=Math.max(right,offset.x);bottom=Math.max(bottom,offset.y)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return{spot:new _position2.default(left,top),size:new _size2.default(right-left+padding,bottom-top+padding)}};var _position2=_interopRequireDefault(_position);var _size2=_interopRequireDefault(_size)}(mod_exports,global.position,global.size);global.getIslandArea=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(island,from,to){var offset=(to=to||new _position2.default(0,0)).getOffsetFrom(from);!function(island,offset){var nodes=island.nodes.values();var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=nodes[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var node=_step.value;node.offset=node.offset.offset(offset)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}(island,offset)};var _position2=_interopRequireDefault(_position)}(mod_exports,global.position);global.moveIslandSpot=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_point,_angle){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(island,direction){if(function(direction){return"down"!==direction}(direction)){var rotater=function(island,direction){var size=island.getArea().size;var dot=new _point2.default(size.width/2,size.height/2);var rotater=rotaters[direction];return function(position){return rotater(position,dot)}}(island,direction);var subTrees=island.nodes.values();var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=subTrees[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var subTree=_step.value;subTree.offset=rotater(subTree.offset)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}};var _point2=_interopRequireDefault(_point);var _angle2=_interopRequireDefault(_angle);var rotaters={up:_angle2.default.rotateUp,down:_angle2.default.rotateDown,left:_angle2.default.rotateLeft,right:_angle2.default.rotateRight}}(mod_exports,global.point,global.angle);global.rotateIsland=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_point){Object.defineProperty(exports,"__esModule",{value:!0});var _point2=_interopRequireDefault(_point);var roatateTool={};roatateTool.rotate=function(nodes,destPt,angle){var result=[];destPt=new _point2.default(destPt.x,destPt.y);nodes.forEach((function(node){var pt=_point2.default.parseFromLocation(node.location);pt.rotate(destPt,angle);result.push({key:node.key,location:pt.convertToLocation()})}));return result};exports.default=roatateTool}(mod_exports,global.point);global.rotateTool=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_point){Object.defineProperty(exports,"__esModule",{value:!0});var _point2=_interopRequireDefault(_point);var flipTool={};flipTool.flip=function(nodes,destPt,isHorizontal){var result=[];destPt=new _point2.default(destPt.x,destPt.y);nodes.forEach((function(node){var pt=_point2.default.parseFromLocation(node.location);pt.flip(destPt,isHorizontal);result.push({key:node.key,location:pt.convertToLocation()})}));return result};flipTool.flipHorizontal=function(nodes,destPt){return flipTool.flip(nodes,destPt,!0)};flipTool.flipVertical=function(nodes,destPt){return flipTool.flip(nodes,destPt,!1)};exports.default=flipTool}(mod_exports,global.point);global.flipTool=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_bounds){Object.defineProperty(exports,"__esModule",{value:!0});var _bounds2=_interopRequireDefault(_bounds);var boundsTool={};boundsTool.calcBounds=function(nodes){var left,top,right,bottom;nodes.forEach((function(node){var bounds=node.bounds;bounds=bounds.getCurrentBounds(node.offset);if(_.isUndefined(left)){left=bounds.left;top=bounds.top;right=bounds.right;bottom=bounds.bottom}else{left=Math.min(left,bounds.left);top=Math.min(top,bounds.top);right=Math.max(right,bounds.right);bottom=Math.max(bottom,bounds.bottom)}}));return new _bounds2.default({left:left,top:top,right:right,bottom:bottom})};exports.default=boundsTool}(mod_exports,global.bounds);global.boundsTool=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var lockTool={};lockTool.lockNodes=function(nodes){nodes.forEach((function(node){node.locked=!0}))};exports.default=lockTool}(mod_exports);global.lockTool=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var Position=internalGlobal.position.default;var boundsTool=internalGlobal.boundsTool.default;function getRandomNumber(){return Math.random()*(Math.random()>.5?1:-1)}internalGlobal.moveSomeNodesNearOtherNodesTool={default:function(nodes,destNodes){var bounds=boundsTool.calcBounds(_.filter(Array.from(destNodes.values()),(function(node){return node.canMove()})));var centerX=bounds.center.x;var centerY=bounds.center.y;var r=bounds.right-centerX;nodes.forEach((function(node){var x=getRandomNumber()*r+centerX;var y=getRandomNumber()*r+centerY;node.canMove()&&node.offset.moveTo(new Position(x,y))}))}}}();!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function Link(originalLink){_classCallCheck(this,Link);this.from=originalLink.from;this.to=originalLink.to;this.originalLink=originalLink}}(mod_exports);global.link=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position,_bounds){Object.defineProperty(exports,"__esModule",{value:!0});var _position2=_interopRequireDefault(_position);var _bounds2=_interopRequireDefault(_bounds);var Node=function(){function Node(originalNode,locked){_classCallCheck(this,Node);this.id=originalNode.key;this.pinned=!!originalNode.pinned;this.locked=locked;this.bounds=_bounds2.default.parseFrom(originalNode.bounds||{});this._offset=_position2.default.parseFromLocation(originalNode.location);this.originalNode=originalNode;this.fromLinks=new Set;this.toLinks=new Set;this.allLinks=new Set;this.fromNeighbors=new Map;this.toNeighbors=new Map;this.allNeighbors=new Map;this.width=originalNode.bounds.right-originalNode.bounds.left}_createClass(Node,[{key:"addFromLink",value:function(link){this.fromLinks.add(link);this.allLinks.add(link)}},{key:"addToLink",value:function(link){this.toLinks.add(link);this.allLinks.add(link)}},{key:"addFromNeighbor",value:function(neighbor){this.fromNeighbors.set(neighbor.id,neighbor);this.allNeighbors.set(neighbor.id,neighbor)}},{key:"addToNeighbor",value:function(neighbor){this.toNeighbors.set(neighbor.id,neighbor);this.allNeighbors.set(neighbor.id,neighbor)}},{key:"canMove",value:function(){return!this.pinned&&!this.locked}},{key:"updatePositionByIslandPosition",value:function(islandPosition){var position=new _position2.default(islandPosition.x,islandPosition.y);position.offset(this.offset);this.offset=position}},{key:"toLocJson",value:function(){return{key:this.id,location:this.offset.convertToLocation(),position:this.offset.getCopy()}}},{key:"offset",get:function(){return this._offset},set:function(offset){this._offset=offset}},{key:"fixed",get:function(){return!this.canMove()}}]);return Node}();exports.default=Node}(mod_exports,global.position,global.bounds);global.node=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_node){Object.defineProperty(exports,"__esModule",{value:!0});var TreeNode=function(_Node){_inherits(TreeNode,_Node);function TreeNode(originalNode,locked,options){_classCallCheck(this,TreeNode);var _this=_possibleConstructorReturn(this,(TreeNode.__proto__||Object.getPrototypeOf(TreeNode)).call(this,originalNode,locked));_this.options=options;return _this}return TreeNode}(_interopRequireDefault(_node).default);exports.default=TreeNode}(mod_exports,global.node);global.treeNode=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});var _position2=_interopRequireDefault(_position);var Tree=function(){function Tree(node,parentTree){_classCallCheck(this,Tree);this.id=node.id;this.options=node.options;this.node=node;this.parentTree=parentTree;this.rootTree=parentTree&&parentTree.rootTree||this;this.subTrees=new Map;this.allSubTrees=new Map;this.elseNeighbors=new Map;this.hasSetElseOffset=!1;this._elseOffsets=[];this._elseOffset=NaN;this._options=null;this.resetCacheInfo();parentTree?parentTree.addSubTree(this):this.addToAllSubTrees(this)}_createClass(Tree,[{key:"resetCacheInfo",value:function(){this._height=NaN;this._width=NaN;this._radianWidthRate=NaN;this._radianWidth=NaN;this._radianStep=NaN;this._level=NaN;this._maxLevel=NaN}},{key:"addSubTree",value:function(subTree){this.resetCacheInfo();this.subTrees.set(subTree.id,subTree);subTree.parentTree=this;this.addToAllSubTrees(subTree)}},{key:"removeSubTree",value:function(subTree){this.resetCacheInfo();this.subTrees.delete(subTree.id);subTree.parentTree=null;this.removeFromAllSubTree(subTree)}},{key:"addToAllSubTrees",value:function(subTree){this.resetCacheInfo();this.allSubTrees.set(subTree.id,subTree);this.parentTree&&this.parentTree.addToAllSubTrees(subTree)}},{key:"removeFromAllSubTree",value:function(subTree){this.resetCacheInfo();this.allSubTrees.delete(subTree.id);this.parentTree&&this.parentTree.removeFromAllSubTree(subTree)}},{key:"getHighestSubTree",value:function(){var subTrees=this.subTrees.values();var maxHeightSubTree=subTrees.next().value;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=subTrees[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var child=_step.value;child.height>maxHeightSubTree.height&&(maxHeightSubTree=child)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return maxHeightSubTree}},{key:"resetElseOffset",value:function(){this.clearElseOffsetCache();this._elseOffsets=[];this.hasSetElseOffset=!1}},{key:"clearElseOffsetCache",value:function(){this._elseOffset=NaN;this.parentTree&&this.parentTree.clearElseOffsetCache()}},{key:"horizontalMove",value:function(xOffset){!function(tree,offset){tree.offset=tree.offset.offset(offset);var allSubTrees=tree.allSubTrees.values();var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=allSubTrees[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var subTree=_step2.value;subTree.offset=subTree.offset.offset(offset)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}(this,new _position2.default(xOffset,0))}},{key:"width",get:function(){isNaN(this._width)&&(this._width=0===(tree=this).subTrees.size?tree.options.width:tree.options.nodeDistance*(tree.subTrees.size-1)+function(subTrees){var sum2=0;var trees=subTrees.values();var _iteratorNormalCompletion6=!0;var _didIteratorError6=!1;var _iteratorError6=null;var _iterator6=trees[Symbol.iterator]();try{for(var _step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var tree=_step6.value;sum2+=tree.width}}catch(err){_didIteratorError6=!0;_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}return sum2}(tree.subTrees));var tree;return this._width}},{key:"radianWidthRate",get:function(){isNaN(this._radianWidthRate)&&(this._radianWidthRate=(divisor=(tree=this).level-1,thisWidth=divisor?1/divisor:divisor,0===tree.subTrees.size?thisWidth:Math.max(thisWidth,function(subTrees){var sum2=0;var trees=subTrees.values();var _iteratorNormalCompletion4=!0;var _didIteratorError4=!1;var _iteratorError4=null;var _iterator4=trees[Symbol.iterator]();try{for(var _step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var tree=_step4.value;sum2+=tree.radianWidthRate}}catch(err){_didIteratorError4=!0;_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return sum2}(tree.subTrees))));var tree,divisor,thisWidth;return this._radianWidthRate}},{key:"radianWidth",get:function(){isNaN(this._radianWidth)&&(this._radianWidth=(divisor=(tree=this).rootTree.radianWidthRate||1,tree.radianWidthRate/divisor*2*Math.PI));var tree,divisor;this.node.originalNode.radianWidth=this._radianWidth.toFixed(3);return this._radianWidth}},{key:"radianStep",get:function(){isNaN(this._radianStep)&&(this._radianStep=(divisor=(tree=this).subTrees.size+(tree.isRootTree?0:1),2*Math.PI/(divisor||1)));var tree,divisor;return this._radianStep}},{key:"level",get:function(){isNaN(this._level)&&(this._level=(tree=this).parentTree?tree.parentTree.level+1:1);var tree;return this._level}},{key:"maxLevel",get:function(){isNaN(this._maxLevel)&&(this._maxLevel=function(tree){var maxLevel=1;if(0===tree.subTrees.size)return maxLevel;var _iteratorNormalCompletion5=!0;var _didIteratorError5=!1;var _iteratorError5=null;var _iterator5=tree.subTrees.values()[Symbol.iterator]();try{for(var _step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var subTree=_step5.value;subTree.maxLevel>=maxLevel&&(maxLevel=subTree.maxLevel+1)}}catch(err){_didIteratorError5=!0;_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}return maxLevel}(this));return this._maxLevel}},{key:"isRootTree",get:function(){return this===this.rootTree}},{key:"height",get:function(){isNaN(this._height)&&(this._height=0===(tree=this).subTrees.size?tree.options.height:tree.options.levelDistance+tree.getHighestSubTree().height);var tree;return this._height}},{key:"offset",get:function(){return this.node.offset},set:function(value){this.node.offset=value}},{key:"elseOffset",get:function(){if(isNaN(this._elseOffset)){var elseOffset=(offsets=this._elseOffsets,function(arr){var total=0;arr.forEach((function(n){return total+=n}));return total}(arr=offsets)/(arr.length||1));elseOffset=function(currentElseOffset,subTrees){var maxElseOffset=currentElseOffset;var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=subTrees[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var subElseOffset=_step3.value.elseOffset;Math.abs(subElseOffset)>Math.abs(maxElseOffset)&&(maxElseOffset=subElseOffset)}}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return maxElseOffset}(elseOffset,this.subTrees.values());this._elseOffset=elseOffset}var offsets,arr;return this._elseOffset},set:function(value){this.clearElseOffsetCache();this.hasSetElseOffset||this._elseOffsets.push(value)}}]);return Tree}();exports.default=Tree}(mod_exports,global.position);global.tree=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_defaultOptions){Object.defineProperty(exports,"__esModule",{value:!0});_interopRequireDefault(_defaultOptions);exports.default=function TopoData(options){_classCallCheck(this,TopoData);this.options=Object.assign({},options);this.nodes=new Map;this.links=new Set}}(mod_exports,global.defaultOptions);global.topoData=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position,_getIslandArea,_moveIslandSpot,_rotateIsland){Object.defineProperty(exports,"__esModule",{value:!0});var _position2=_interopRequireDefault(_position);var _getIslandArea2=_interopRequireDefault(_getIslandArea);var _moveIslandSpot2=_interopRequireDefault(_moveIslandSpot);var _rotateIsland2=_interopRequireDefault(_rotateIsland);var Island=function(){function Island(options){_classCallCheck(this,Island);this.options=options;this.fixedNodes=new Map;this.nodes=new Map;this.links=new Set;this._position=new _position2.default;this._watchNodes()}_createClass(Island,[{key:"rotateDirection",value:function(direction){(0,_rotateIsland2.default)(this,direction)}},{key:"moveSpot",value:function(){this.isAbsolute||(0,_moveIslandSpot2.default)(this,this.getSpot())}},{key:"annexAnotherSingleIsland",value:function(anotherIsland){this._annexNodes(anotherIsland)}},{key:"annexAnotherAbsolutIsland",value:function(anotherIsland){var link={from:this.getAnyFixedNode().id,to:anotherIsland.getAnyFixedNode().id};this._addVirtualLink(link,anotherIsland);this._annexNodes(anotherIsland);this._annexLinks(anotherIsland)}},{key:"_addVirtualLink",value:function(link,anotherIsland){var fromNode=this.nodes.get(link.from);var toNode=anotherIsland.nodes.get(link.to);fromNode.addToNeighbor(toNode);toNode.addFromNeighbor(fromNode)}},{key:"_annexNodes",value:function(anotherIsland){var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=anotherIsland.nodes.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var node=_step.value;this.nodes.set(node.id,node)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"_annexLinks",value:function(anotherIsland){var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=anotherIsland.links[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var link=_step2.value;this.links.add(link)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"getArea",value:function(){return(0,_getIslandArea2.default)(this)}},{key:"getSpot",value:function(){return this.getArea().spot}},{key:"getSize",value:function(){return this.getArea().size}},{key:"getAnyFixedNode",value:function(){return this.fixedNodes.values().next().value||null}},{key:"_watchNodes",value:function(){var fixedNodes=this.fixedNodes;var nodes=this.nodes;var set=nodes.set;nodes.set=function(key,node){node.fixed&&fixedNodes.set(node.id,node);set.apply(nodes,arguments)}}},{key:"position",get:function(){return this._position},set:function(value){this._position=value;!function(nodes,position){var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=nodes[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)_step3.value.updatePositionByIslandPosition(position)}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}(this.nodes.values(),value)}},{key:"isAbsolute",get:function(){return null!==this.getAnyFixedNode()}},{key:"isSingleNodeIsland",get:function(){return 1===this.nodes.size}}]);return Island}();exports.default=Island}(mod_exports,global.position,global.getIslandArea,global.moveIslandSpot,global.rotateIsland);global.island=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var IslandGroup=function(){function IslandGroup(options){_classCallCheck(this,IslandGroup);this.options=options;this.absoluteIsland=null;this.sanderIsland=null;this.islands=new Set;this._watchIslands()}_createClass(IslandGroup,[{key:"getAbsoluteIsland",value:function(){return this.absoluteIsland}},{key:"getSanderIsland",value:function(){return this.sanderIsland}},{key:"getCommonIslands",value:function(){return[].concat(_toConsumableArray(this.islands))}},{key:"getAllIslands",value:function(){var islands=[this.absoluteIsland,this.sanderIsland,[].concat(_toConsumableArray(this.islands))];return _.flatten(islands,!0).filter((function(i){return i}))}},{key:"_watchIslands",value:function(){var group=this;var islands=this.islands;var add=islands.add;islands.add=function(island){island.isAbsolute?group.absoluteIsland?group.absoluteIsland.annexAnotherAbsolutIsland(island):group.absoluteIsland=island:island.isSingleNodeIsland?group.sanderIsland?group.sanderIsland.annexAnotherSingleIsland(island):group.sanderIsland=island:add.apply(islands,arguments)}}}]);return IslandGroup}();exports.default=IslandGroup}(mod_exports);global.islandGroup=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_node){Object.defineProperty(exports,"__esModule",{value:!0});var _node2=_interopRequireDefault(_node);var BaseLayout=function(){function BaseLayout(){_classCallCheck(this,BaseLayout);this.layoutName="BaseLayout";this.nodeType=_node2.default}_createClass(BaseLayout,[{key:"layout",value:function(){throw new Error(this.layoutName+" should be override")}},{key:"getLayoutName",value:function(){return this.layoutName}},{key:"getNodeType",value:function(){return this.nodeType}},{key:"generateResult",value:function(nodes){var result=[];nodes.forEach((function(node){result.push(node.toLocJson())}));return result}}]);return BaseLayout}();exports.default=BaseLayout}(mod_exports,global.node);global.baseLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(topoData){var nodes=topoData.nodes;var links=topoData.links;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=links[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var link=_step.value;var fromNode=nodes.get(link.from);var toNode=nodes.get(link.to);link.fromNode=fromNode;link.toNode=toNode;fromNode&&fromNode.addFromLink(link);toNode&&toNode.addToLink(link);if(fromNode&&toNode){fromNode.addToNeighbor(toNode);toNode.addFromNeighbor(fromNode)}}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}(mod_exports);global.setTopoDataRelations=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_link,_topoData,_setTopoDataRelations){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(originalData,NodeType,options){var topoData=new _topoData2.default(options);!function(originalData,topoData,NodeType,options){var lockedNodes=new Set;_.each(originalData.lockedNodes,(function(id){return lockedNodes.add(id)}));var nodes=topoData.nodes;originalData.nodeDataArray.forEach((function(originalNode){var locked=lockedNodes.has(originalNode.key);var node=new NodeType(originalNode,locked,options);nodes.set(node.id,node)}))}(originalData,topoData,NodeType,topoData.options);!function(originalData,topoData){var nodes=topoData.nodes;var links=topoData.links;originalData.linkDataArray.forEach((function(originalLink){var link=new _link2.default(originalLink);nodes.has(link.from)&&nodes.has(link.to)&&links.add(link)}))}(originalData,topoData);(0,_setTopoDataRelations2.default)(topoData);return topoData};var _link2=_interopRequireDefault(_link);var _topoData2=_interopRequireDefault(_topoData);var _setTopoDataRelations2=_interopRequireDefault(_setTopoDataRelations)}(mod_exports,global.link,global.topoData,global.setTopoDataRelations);global.convert=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_island,_islandGroup){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=split;var _island2=_interopRequireDefault(_island);var _islandGroup2=_interopRequireDefault(_islandGroup);split._getFirstNodeAsSeeds=getFirstNodeAsSeeds;function split(topoData){var islandGroup=new _islandGroup2.default(topoData.options);for(;topoData.nodes.size>0;)islandGroup.islands.add(pickIsland(topoData));return islandGroup}function pickIsland(topoData){var island=new _island2.default(topoData.options);var seeds=getFirstNodeAsSeeds(topoData);for(;seeds.size>0;)seeds=addSeedsToIsland(topoData,seeds,island);return island}function addSeedsToIsland(topoData,seeds,island){var newSeeds=new Set;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=seeds[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var node=_step.value;var nodeId=node.id;island.nodes.set(nodeId,node);topoData.nodes.delete(nodeId);addAllLinksToIsland(node,island);pickSeedsInAllNeighbors(node,island.nodes,newSeeds)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return newSeeds}function addAllLinksToIsland(node,island){!function(node,island){addLinksToIsland(node.fromLinks,island)}(node,island);!function(node,island){addLinksToIsland(node.toLinks,island)}(node,island)}function addLinksToIsland(links,island){var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=links[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var link=_step2.value;island.links.add(link)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}function pickSeedsInAllNeighbors(node,passedNodes,newSeeds){!function(node,passedNodes,newSeeds){pickSeedsInNeighbors(node.fromNeighbors,passedNodes,newSeeds)}(node,passedNodes,newSeeds);!function(node,passedNodes,newSeeds){pickSeedsInNeighbors(node.toNeighbors,passedNodes,newSeeds)}(node,passedNodes,newSeeds)}function pickSeedsInNeighbors(neighbors,passedNodes,newSeeds){var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=neighbors.values()[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var node=_step3.value;passedNodes.has(node.id)||newSeeds.add(node)}}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}function getFirstNodeAsSeeds(topoData){var firstNode=function(topoData){var nodes=topoData.nodes;var firstNodeId=nodes.keys().next().value;return nodes.get(firstNodeId)}(topoData);return new Set([firstNode])}}(mod_exports,global.island,global.islandGroup);global.split=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_defaultOptions,_position,_baseLayout){Object.defineProperty(exports,"__esModule",{value:!0});_interopRequireDefault(_defaultOptions);var _position2=_interopRequireDefault(_position);var horizontalDistance;var verticalDistance;var SanderIslandLayout=function(_BaseLayout){_inherits(SanderIslandLayout,_BaseLayout);function SanderIslandLayout(props){_classCallCheck(this,SanderIslandLayout);return _possibleConstructorReturn(this,(SanderIslandLayout.__proto__||Object.getPrototypeOf(SanderIslandLayout)).call(this,props))}_createClass(SanderIslandLayout,[{key:"layout",value:function(island){horizontalDistance=island.options.horizontal+island.options.width;verticalDistance=island.options.vertical+island.options.height;var width=Math.sqrt(island.nodes.size)*horizontalDistance;var startX=0;var startY=0;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=island.nodes.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){_step.value.offset=new _position2.default(startX,startY);if((startX+=horizontalDistance)>width){startX=0;startY+=verticalDistance}}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return this.generateResult(island.nodes)}}]);return SanderIslandLayout}(_interopRequireDefault(_baseLayout).default);exports.default=SanderIslandLayout}(mod_exports,global.defaultOptions,global.position,global.baseLayout);global.sanderIslandLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_baseLayout,_position,_sanderIslandLayout){Object.defineProperty(exports,"__esModule",{value:!0});var _baseLayout2=_interopRequireDefault(_baseLayout);var _position2=_interopRequireDefault(_position);var _sanderIslandLayout2=_interopRequireDefault(_sanderIslandLayout);var IslandGroupLayout=function(_BaseLayout){_inherits(IslandGroupLayout,_BaseLayout);function IslandGroupLayout(props){_classCallCheck(this,IslandGroupLayout);return _possibleConstructorReturn(this,(IslandGroupLayout.__proto__||Object.getPrototypeOf(IslandGroupLayout)).call(this,props))}_createClass(IslandGroupLayout,[{key:"layout",value:function(islandGroup,layouter){!function(islandGroup,layouter){var island=islandGroup.getAbsoluteIsland();island&&layouter.layout(island)}(islandGroup,layouter);!function(islandGroup){var island=islandGroup.getSanderIsland();island&&(new _sanderIslandLayout2.default).layout(island)}(islandGroup);!function(islandGroup,layouter){var islands=islandGroup.islands;var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=islands[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var island=_step2.value;layouter.layout(island)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}(islandGroup,layouter);!function(islandGroup){var options=islandGroup.options;var viewportStart=(islandGroup.options.viewportStart||new _position2.default).getCopy();var leftStart=viewportStart.x;var topStart=viewportStart.y;var maxHeight=0;var sideLength=function(islandGroup){var islands=islandGroup.islands;if(islandGroup.options.viewportWidth)return islandGroup.options.viewportWidth;var sumWidth=0;var sumHeight=0;var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=islands[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var island=_step3.value;var options=island.options;var size=island.getSize();sumWidth+=size.width+options.margin;sumHeight+=size.height+options.margin}}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return Math.sqrt(sumWidth*sumHeight)}(islandGroup);var maxX=leftStart+sideLength;var absoluteIsland=islandGroup.getAbsoluteIsland();if(absoluteIsland){var area=absoluteIsland.getArea();absoluteIsland.position=new _position2.default;leftStart=area.spot.x+area.size.width+options.margin;topStart=area.spot.y;maxHeight=area.size.height}var islandsArr=islandGroup.getCommonIslands();islandsArr=function(islandsArr){return islandsArr.sort((function(islandA,islandB){return islandA.nodes.size>islandB.nodes.size}))}(islandsArr);var sanderIsland=islandGroup.getSanderIsland();sanderIsland&&islandsArr.unshift(sanderIsland);islandsArr.forEach((function(island){island.moveSpot();var size=island.getSize();if(leftStart+size.width>maxX&&leftStart!==viewportStart.x){leftStart=viewportStart.x;topStart+=maxHeight+options.margin;maxHeight=0}island.position=new _position2.default(leftStart,topStart);leftStart+=size.width+options.margin;size.height>maxHeight&&(maxHeight=size.height)}))}(islandGroup);return this.generateResult(islandGroup)}},{key:"generateResult",value:function(islandGroup){var nodeLocations=[];var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=islandGroup.getAllIslands()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var island=_step.value;nodeLocations.push(_get(IslandGroupLayout.prototype.__proto__||Object.getPrototypeOf(IslandGroupLayout.prototype),"generateResult",this).call(this,island.nodes))}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return _.flatten(nodeLocations,!0)}}]);return IslandGroupLayout}(_baseLayout2.default);exports.default=IslandGroupLayout}(mod_exports,global.baseLayout,global.position,global.sanderIslandLayout);global.islandGroupLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_baseLayout){Object.defineProperty(exports,"__esModule",{value:!0});var GeometryLayout=function(_BaseLayout){_inherits(GeometryLayout,_BaseLayout);function GeometryLayout(props){_classCallCheck(this,GeometryLayout);var _this=_possibleConstructorReturn(this,(GeometryLayout.__proto__||Object.getPrototypeOf(GeometryLayout)).call(this,props));_this.layoutName="GeometryLayout";return _this}return GeometryLayout}(_interopRequireDefault(_baseLayout).default);exports.default=GeometryLayout}(mod_exports,global.baseLayout);global.geometryLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_tree){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(node,parentTree){var tree=new _tree2.default(node,parentTree);var trees=[tree];for(;trees.length;)trees=addNextLevelTree(trees);return tree};var _tree2=_interopRequireDefault(_tree);function addNextLevelTree(trees){var newTrees=[];trees.sort((function(treeA,treeB){return treeA.node.allNeighbors.size-treeB.node.allNeighbors.size}));trees.forEach((function(tree){var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=tree.node.allNeighbors.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var newTree=addNeighborToTree(_step.value,tree);newTree&&newTrees.push(newTree)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}));return newTrees}function addNeighborToTree(node,tree){var rootTree=tree.rootTree;if(!rootTree.allSubTrees.has(node.id))return new _tree2.default(node,tree);if(node.id!==tree.parentTree.id){var elseTree=rootTree.allSubTrees.get(node.id);tree.elseNeighbors.set(elseTree.id,elseTree)}return null}}(mod_exports,global.tree);global.buildTree=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_buildTree){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(island){if(island.options.rootNodeId)return island.nodes.get(island.options.rootNodeId);var nodes=island.nodes;var roots=function(nodesMap,options){var root=null;var roots=[];var nodes=nodesMap.values();var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=nodes[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var node=_step.value;node.priority||(node.priority=options.getTreeRootPriority(node.originalNode));null===root&&(roots=[root=node]);node.priority===root.priority&&node.allLinks.size===root.allLinks.size?roots.push(root):(node.priority<root.priority||node.priority===root.priority&&node.allLinks.size<root.allLinks.size)&&(roots=[root=node])}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return roots}(nodes,island.options);return nodes.size>200&&roots.length>10?roots[0]:function(roots){var minLevel=1/0;var goodRoots=[];roots.forEach((function(root){var tree=(0,_buildTree2.default)(root);if(tree.maxLevel<minLevel){minLevel=tree.maxLevel;goodRoots=[root]}else tree.maxLevel===minLevel&&goodRoots.push(root)}));var randomIndex=Math.floor(Math.random()*goodRoots.length);return goodRoots[randomIndex]}(roots)};var _buildTree2=_interopRequireDefault(_buildTree)}(mod_exports,global.buildTree);global.findRoot=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_common,_defaultOptions){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(tree){_common2.default.breadthFirstTraversal(tree).eachNode(splitIfNeed)};var _common2=_interopRequireDefault(_common);_interopRequireDefault(_defaultOptions);function splitIfNeed(tree){var levelSize=tree.options.levelSize;if(tree.subTrees.size>levelSize){var subTrees=[].concat(_toConsumableArray(tree.subTrees.values()));var targetParent=(subTrees=_.sortBy(subTrees,getOrder))[levelSize-1];targetParent.isVirtualRoot=!0;var subTreesToMoveDown=subTrees.slice(levelSize);_.each(subTreesToMoveDown,(function(subTreeToMoveDown){tree.removeSubTree(subTreeToMoveDown);targetParent.addSubTree(subTreeToMoveDown)}))}}function getOrder(tree){return tree.subTrees.size}}(mod_exports,global.common,global.defaultOptions);global.splitBigLevel=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});var _position2=_interopRequireDefault(_position);var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[];var _n=!0;var _d=!1;var _e=null;var _i=arr[Symbol.iterator]();try{for(var _s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")};exports.default={bySubTreesCounter:function(tree){doSetRelativePosition(tree,sortSubTreesBySubTreesCounter)},byOffset:function(tree){doSetRelativePosition(tree,sortSubTreesByOffset)}};function doSetRelativePosition(tree,sorter){var leftStart=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var left=leftStart+(tree.width-tree.options.width)/2;var top=(tree.level-1)*tree.options.levelDistance;tree.offset=new _position2.default(left,top);var childStart=leftStart;var subTrees=[].concat(_toConsumableArray(tree.subTrees.values()));sorter(subTrees).forEach((function(subTree){doSetRelativePosition(subTree,sorter,childStart);childStart+=subTree.width+tree.options.nodeDistance}))}function sortSubTreesBySubTreesCounter(subTrees){var _$partition=_.partition(subTrees,(function(subTree){return subTree.isVirtualRoot})),_$partition2=_slicedToArray(_$partition,2),virtualRoot=_$partition2[0],otherSubTrees=_$partition2[1];var sortedSubTrees=virtualRoot;var flag=!0;var subTree=(otherSubTrees=otherSubTrees.sort((function(treeA,treeB){return treeA.maxLevel!==treeB.maxLevel?treeA.maxLevel-treeB.maxLevel:treeA.allSubTrees.size!==treeB.allSubTrees.size?treeA.allSubTrees.size-treeB.allSubTrees.size:treeA.subTrees.size-treeB.subTrees.size}))).shift();for(;subTree;){flag?sortedSubTrees.push(subTree):sortedSubTrees.unshift(subTree);flag=!flag;subTree=otherSubTrees.shift()}return sortedSubTrees}function sortSubTreesByOffset(subTrees){return subTrees=subTrees.sort((function(treeA,treeB){return treeA.offset.x-treeB.offset.x}))}}(mod_exports,global.position);global.setRelativePosition=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_setRelativePosition){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(rootTree){var options=rootTree.options;scale=options.scale;base=options.base;tries=options.tries;for(var i=0;i<tries;i++)beautifySubTree(rootTree)};var _setRelativePosition2=_interopRequireDefault(_setRelativePosition);var scale=0;var base=0;var tries=0;function beautifySubTree(rootTree){var subTrees=function(rootTree){var subTrees=new Map;var allSubTrees=rootTree.allSubTrees.values();var _iteratorNormalCompletion5=!0;var _didIteratorError5=!1;var _iteratorError5=null;var _iterator5=allSubTrees[Symbol.iterator]();try{for(var _step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var subTree=_step5.value;subTree.level>1&&subTrees.set(subTree.id,subTree)}}catch(err){_didIteratorError5=!0;_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}return subTrees}(rootTree);!function(subTrees){var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=subTrees.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)_step.value.resetElseOffset()}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}(subTrees);!function(subTrees){var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=subTrees.values()[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)updateSubTreeElseOffset(_step3.value)}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}(subTrees);!function(subTrees){var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=subTrees.values()[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var subTree=_step2.value;var offset=subTree.offset;offset.x+=subTree.elseOffset;subTree.offset=offset}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}(subTrees);_setRelativePosition2.default.byOffset(rootTree)}function updateSubTreeElseOffset(subTree){var _iteratorNormalCompletion4=!0;var _didIteratorError4=!1;var _iteratorError4=null;var _iterator4=subTree.elseNeighbors.values()[Symbol.iterator]();try{for(var _step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var elseNeighbor=_step4.value;var currentOffset=(elseNeighbor.offset.x-subTree.offset.x-subTree.options.nodeDistance-subTree.options.width/2-elseNeighbor.options.width/2)/2;var random=Math.random()*scale;subTree.elseOffset=currentOffset+(subTree.options.nodeDistance+subTree.options.width)*(base+random);elseNeighbor.elseOffset=-(currentOffset+elseNeighbor.options.width*(base+scale-random))}}catch(err){_didIteratorError4=!0;_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}subTree.hasSetElseOffset=!0}}(mod_exports,global.setRelativePosition);global.reduceCross=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_common,_defaultOptions){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(tree){tree.options.levelSize%2!=1&&_common2.default.breadthFirstTraversal(tree).eachNode(correctSubTreeIfNeed)};var _common2=_interopRequireDefault(_common);_interopRequireDefault(_defaultOptions);function correctSubTreeIfNeed(tree){if(tree.isVirtualRoot){var offsetX=(tree.options.width+tree.options.nodeDistance)/2;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=tree.subTrees.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)_step.value.horizontalMove(offsetX)}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}}(mod_exports,global.common,global.defaultOptions);global.correctVirtualRootOffset=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(rootTree){var allLeafTrees=function(rootTree){return function(rootTree,predicate){var leaves=new Map;var _iteratorNormalCompletion4=!0;var _didIteratorError4=!1;var _iteratorError4=null;var _iterator4=rootTree.allSubTrees.values()[Symbol.iterator]();try{for(var _step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var subTree=_step4.value;predicate(subTree)&&leaves.set(subTree.id,subTree)}}catch(err){_didIteratorError4=!0;_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return leaves}(rootTree,(function(tree){return function(tree){return 1===tree.maxLevel}(tree)&&function(tree){return tree.elseNeighbors.size>0}(tree)}))}(rootTree);var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=allLeafTrees.values()[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)middleLeafNode(_step.value)}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}};function middleLeafNode(leafTree){var x=leafTree.parentTree.offset.x;var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=leafTree.elseNeighbors.values()[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var neighbor=_step2.value;if(leafTree.parentTree.subTrees.size>1&&!isLowerThanNeighbor(leafTree,neighbor))return;x+=neighbor.offset.x}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var offsetX=x/(leafTree.elseNeighbors.size+1);(function(offsetX,leafTree,allSubTrees){var level=leafTree.level;var nodeFullWidth=leafTree.options.width+leafTree.options.nodeDistance-2;var start=offsetX-nodeFullWidth;var end=offsetX+nodeFullWidth;var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=allSubTrees.values()[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var tree=_step3.value;if(tree.level===level&&tree!==leafTree){var offset=tree.offset;if(start<offset.x&&offset.x<end)return!0}}}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return!1})(offsetX,leafTree,leafTree.rootTree.allSubTrees)||(leafTree.offset.x=offsetX)}function isLowerThanNeighbor(leafTree,neighbor){return leafTree.level>neighbor.level}}(mod_exports);global.middleLeafNodes=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_common,_defaultOptions){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=shrink;var _common2=_interopRequireDefault(_common);_interopRequireDefault(_defaultOptions);var minDistance;function shrink(tree){minDistance=function(tree){return tree.options.width+tree.options.nodeDistance}(tree);var deepNode=function(tree){var maxLevel=tree.level+tree.maxLevel-1;var _iteratorNormalCompletion6=!0;var _didIteratorError6=!1;var _iteratorError6=null;var _iterator6=tree.allSubTrees.values()[Symbol.iterator]();try{for(var _step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var subTree=_step6.value;if(subTree.level===maxLevel)return subTree}}catch(err){_didIteratorError6=!0;_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}return tree}(tree);var shrinkInfo={left:_common2.default.createEmptyDic(),right:_common2.default.createEmptyDic()};var currentLevelTree=deepNode||tree;do{shrinkLevel(currentLevelTree,shrinkInfo);currentLevelTree=currentLevelTree.parentTree}while(currentLevelTree!==tree.parentTree);return shrinkInfo}function shrinkLevel(currentTree,shrinkInfo){var subTrees=[].concat(_toConsumableArray(currentTree.subTrees.values())).sort((function(a,b){return a.offset.x-b.offset.x}));var mainIndex=subTrees.indexOf(shrinkInfo.currentTree);if(-1!==mainIndex){var leftTrees=subTrees.slice(0,mainIndex);var rightTrees=subTrees.slice(mainIndex+1);!function(leftTrees,shrinkInfo){if(!(leftTrees.length<1)){var leftTree=leftTrees.pop();for(;leftTree;){shrinkLeftTree(leftTree,shrinkInfo);leftTree=leftTrees.pop()}}}(leftTrees,shrinkInfo);!function(rightTrees,shrinkInfo){if(!(rightTrees.length<1)){var rightTree=rightTrees.shift();for(;rightTree;){shrinkRightTree(rightTree,shrinkInfo);rightTree=rightTrees.shift()}}}(rightTrees,shrinkInfo);!function(tree,subTrees){var offset=tree.offset;offset.x=(left=(trees=subTrees)[0].offset.x,right=trees[trees.length-1].offset.x,(left+right)/2);var trees,left,right;tree.offset=offset}(currentTree,subTrees);currentTree.resetCacheInfo()}!function(currentTree,shrinkInfo){shrinkInfo.currentTree=currentTree;var level=currentTree.level;shrinkInfo.left[level]=shrinkInfo.right[level]=currentTree.offset.x}(currentTree,shrinkInfo)}function shrinkLeftTree(leftTree,shrinkInfo){var leftShrinkInfo=shrink(leftTree);var xOffset=function(shrinkInfo,leftShrinkInfo){var distance=1/0;var levels=_common2.default.keys(leftShrinkInfo.right);var _iteratorNormalCompletion2=!0;var _didIteratorError2=!1;var _iteratorError2=null;var _iterator2=levels[Symbol.iterator]();try{for(var _step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var level=_step2.value;var currentDistance=shrinkInfo.left[level]-leftShrinkInfo.right[level];currentDistance<distance&&(distance=currentDistance)}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return distance}(shrinkInfo,leftShrinkInfo)-minDistance;if(xOffset>0){leftTree.horizontalMove(xOffset);moveShrinkInfo(leftShrinkInfo,xOffset)}!function(shrinkInfo,leftShrinkInfo){var levels=_common2.default.keys(leftShrinkInfo.left);var left=shrinkInfo.left;var leftLeft=leftShrinkInfo.left;var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=null;var _iterator=levels[Symbol.iterator]();try{for(var _step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var level=_step.value;left[level]=leftLeft[level]}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}(shrinkInfo,leftShrinkInfo)}function shrinkRightTree(rightTree,shrinkInfo){var rightShrinkInfo=shrink(rightTree);var xOffset=function(shrinkInfo,rightShrinkInfo){var distance=1/0;var levels=_common2.default.keys(rightShrinkInfo.right);var _iteratorNormalCompletion4=!0;var _didIteratorError4=!1;var _iteratorError4=null;var _iterator4=levels[Symbol.iterator]();try{for(var _step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var level=_step4.value;var currentDistance=rightShrinkInfo.left[level]-shrinkInfo.right[level];currentDistance<distance&&(distance=currentDistance)}}catch(err){_didIteratorError4=!0;_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return distance}(shrinkInfo,rightShrinkInfo)-minDistance;if(xOffset>0){rightTree.horizontalMove(-xOffset);moveShrinkInfo(rightShrinkInfo,-xOffset)}!function(shrinkInfo,rightShrinkInfo){var levels=_common2.default.keys(rightShrinkInfo.right);var right=shrinkInfo.right;var rightRight=rightShrinkInfo.right;var _iteratorNormalCompletion3=!0;var _didIteratorError3=!1;var _iteratorError3=null;var _iterator3=levels[Symbol.iterator]();try{for(var _step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var level=_step3.value;right[level]=rightRight[level]}}catch(err){_didIteratorError3=!0;_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}(shrinkInfo,rightShrinkInfo)}function moveShrinkInfo(shrinkInfo,xOffset){var levels=_common2.default.keys(shrinkInfo.left);var left=shrinkInfo.left;var right=shrinkInfo.right;var _iteratorNormalCompletion5=!0;var _didIteratorError5=!1;var _iteratorError5=null;var _iterator5=levels[Symbol.iterator]();try{for(var _step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var level=_step5.value;left[level]+=xOffset;right[level]+=xOffset}}catch(err){_didIteratorError5=!0;_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}}}(mod_exports,global.common,global.defaultOptions);global.shrink=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_treeNode,_geometryLayout,_findRoot,_buildTree,_splitBigLevel,_setRelativePosition,_reduceCross,_correctVirtualRootOffset,_middleLeafNodes,_shrink){Object.defineProperty(exports,"__esModule",{value:!0});var _treeNode2=_interopRequireDefault(_treeNode);var _geometryLayout2=_interopRequireDefault(_geometryLayout);var _findRoot2=_interopRequireDefault(_findRoot);var _buildTree2=_interopRequireDefault(_buildTree);var _splitBigLevel2=_interopRequireDefault(_splitBigLevel);var _setRelativePosition2=_interopRequireDefault(_setRelativePosition);var _reduceCross2=_interopRequireDefault(_reduceCross);var _correctVirtualRootOffset2=_interopRequireDefault(_correctVirtualRootOffset);var _middleLeafNodes2=_interopRequireDefault(_middleLeafNodes);var _shrink2=_interopRequireDefault(_shrink);var TreeLayout=function(_GeometryLayout){_inherits(TreeLayout,_GeometryLayout);function TreeLayout(props){_classCallCheck(this,TreeLayout);var _this=_possibleConstructorReturn(this,(TreeLayout.__proto__||Object.getPrototypeOf(TreeLayout)).call(this,props));_this.layoutName="TreeLayout";_this.nodeType=_treeNode2.default;return _this}_createClass(TreeLayout,[{key:"layout",value:function(island){var direction=TreeLayout.doTreeLayout(island).options.direction;island.rotateDirection(direction);return this.generateResult(island.nodes)}},{key:"getLayoutName",value:function(){return this.layoutName}},{key:"getNodeType",value:function(){return this.nodeType}}],[{key:"doTreeLayout",value:function(island){!function(island){var options=island.options;var getAverageWidth=options.getAverageWidth;if(getAverageWidth){var nodes=function(mapValues){var arr=[];var _iteratorNormalCompletion=!0;var _didIteratorError=!1;var _iteratorError=void 0;try{for(var _step,_iterator=mapValues[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var val=_step.value;arr.push(val)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return arr}(island.nodes.values());options.width=getAverageWidth(nodes,options.width)}}(island);var root=(0,_findRoot2.default)(island);var tree=(0,_buildTree2.default)(root);(0,_splitBigLevel2.default)(tree);_setRelativePosition2.default.bySubTreesCounter(tree);(0,_reduceCross2.default)(tree);(0,_shrink2.default)(tree);(0,_correctVirtualRootOffset2.default)(tree);(0,_middleLeafNodes2.default)(tree);return tree}}]);return TreeLayout}(_geometryLayout2.default);exports.default=TreeLayout}(mod_exports,global.treeNode,global.geometryLayout,global.findRoot,global.buildTree,global.splitBigLevel,global.setRelativePosition,global.reduceCross,global.correctVirtualRootOffset,global.middleLeafNodes,global.shrink);global.treeLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(netBrain){var qmap=netBrain.ns("Map");var defaultDistance=140;var defaultMaxEjectDistance=600;var disDict=function(customConfig){var dict={};for(var i=0,len=customConfig.length;i<len;i++){var config=customConfig[i];var key=config[0]+"-"+config[1];var value=config[2];dict[key]=value;dict[key=config[0]+"-"+config[1]]=value}return dict}([["DEVICE","DEVICE",{dis:210}],["DEVICE","SITE",{dis:250,maxEjectDis:1e3}],["DEVICE","DMVPN",{dis:210}],["DEVICE","WAN",{dis:210}],["DEVICE","MPLS",{dis:250,maxEjectDis:1e3}],["SITE","MPLS",{dis:300,maxEjectDis:1500}],["SITE","SITE",{dis:300,maxEjectDis:1500}]]);function getDeviceType(node){var type="";if(netBrain.Map.CategoryMgr.isDeviceCategory(node.category)){var devType=node.devType;type=1024===devType?"MPLS":"DEVICE"}else type=netBrain.Map.CategoryMgr.isMedia(node.category)?(devType=node.devType)||"MEDIA":netBrain.Map.CategoryMgr.isSite(node.category)?"SITE":"DEVICE";return type}var symmetricLayoutHelper={getExpectDis:function(node1,node2){var key=getDeviceType(node1)+"-"+getDeviceType(node2);key=key.toUpperCase();var obj=disDict[key];return obj&&obj.dis||defaultDistance},getMaxEjectDistance:function(node1,node2){var key=getDeviceType(node1)+"-"+getDeviceType(node2);key=key.toUpperCase();var obj=disDict[key];return obj&&obj.maxEjectDis||defaultMaxEjectDistance}};qmap.symmetricLayoutHelper=symmetricLayoutHelper}(NetBrain);!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={symmetricTries:300,epsilon:1e-6,T:20,expectDistance:200,maxEjectDistance:600}}(mod_exports);global.symmetricLayoutConfig=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_geometryLayout,_position,_symmetricLayoutConfig){Object.defineProperty(exports,"__esModule",{value:!0});var _geometryLayout2=_interopRequireDefault(_geometryLayout);var _position2=_interopRequireDefault(_position);var _symmetricLayoutConfig2=_interopRequireDefault(_symmetricLayoutConfig);var SymmetricLayout=function(_GeometryLayout){_inherits(SymmetricLayout,_GeometryLayout);function SymmetricLayout(props){_classCallCheck(this,SymmetricLayout);var _this=_possibleConstructorReturn(this,(SymmetricLayout.__proto__||Object.getPrototypeOf(SymmetricLayout)).call(this,props));_this.offsetXObject={};_this.offsetYObject={};_this.lastOffsetObj={};_this.last2OffsetObj={};_this.layoutName="SymmetricLayout";return _this}_createClass(SymmetricLayout,[{key:"layout",value:function(nodes,links,options){this.layoutWithOutResult(nodes,links,options);return this.generateResult(nodes)}},{key:"layoutWithOutResult",value:function(nodes,links,options){options=this.options=Object.assign(SymmetricLayout.getDefaultConfig(),options);this.lastOffsetObj={};this.last2OffsetObj={};var tries=function(options){return options.symmetricTries||100}(options);!function(nodes){var nodeArr=Array.from(nodes.values());var parts=_.partition(nodeArr,(function(node){return!node.canMove()}));var locationsDic={x:{},y:{}};_.each(parts[0],(function(node){var offset=node.offset;locationsDic.x[offset.x]=!0;locationsDic.y[offset.y]=!0}));_.each(parts[1],(function(node){return function(node,locationsDic){var offset=node.offset;if(!_.isNumber(offset.x)||!_.isNumber(offset.y))throw new Error("offset x and y must be Number.");for(;locationsDic.x[offset.x];)offset.offset(new _position2.default(Math.random(),0));locationsDic.x[offset.x]=!0;for(;locationsDic.y[offset.y];)offset.offset(new _position2.default(0,Math.random()));locationsDic.y[offset.y]=!0}(node,locationsDic)}))}(nodes);var nodeArray=Array.from(nodes);var i=0;for(;i<tries&&!this.symmetric(nodes,links,options,nodeArray);)i++}},{key:"symmetric",value:function(nodes,links,options,nodeArray){this.offsetXObject={};this.offsetYObject={};this.calcEjectBetweenNodes(nodeArray);this.calcCondenseWithLinks(links);return this.offsetNodes(nodes)}},{key:"calcEjectBetweenNodes",value:function(nodes){var options=this.options;var epsilon=options.epsilon;var offsetXObject=this.offsetXObject;var offsetYObject=this.offsetYObject;nodes.forEach((function(arr){var key=arr[0];offsetXObject[key]=0;offsetYObject[key]=0}));for(var i=0,iLen=nodes.length;i<iLen;i++){var node1=nodes[i][1];var key1=nodes[i][0];var point1=node1.offset;var node1Locked=!node1.canMove();for(var j=i+1,jLen=nodes.length;j<jLen;j++){var node2=nodes[j][1];var key2=nodes[j][0];var node2Locked=!node2.canMove();if(!(node1Locked&&node2Locked||key1===key2)){var point2=node2.offset;var diffX=point1.x-point2.x;var diffY=point1.y-point2.y;var dis=Math.max(epsilon,Math.sqrt(diffX*diffX+diffY*diffY));var maxEjectDistance=getMaxEjectDistance(node1,node2,options);if(dis>0&&dis<maxEjectDistance){var k=getK(node1,node2,options);var force=k*k/dis;var offsetX=diffX/dis*force;var offsetY=diffY/dis*force;if(node1Locked){offsetXObject[key2]-=offsetX;offsetYObject[key2]-=offsetY}else{offsetXObject[key1]+=offsetX;offsetYObject[key1]+=offsetY}if(node2Locked){offsetXObject[key1]+=offsetX;offsetYObject[key1]+=offsetY}else{offsetXObject[key2]-=offsetX;offsetYObject[key2]-=offsetY}}}}}}},{key:"calcCondenseWithLinks",value:function(links){var options=this.options;var epsilon=options.epsilon;var offsetXObject=this.offsetXObject;var offsetYObject=this.offsetYObject;var map=new Map;links.forEach((function(link){var fromId=link.from;var toId=link.to;var key=[fromId,toId].sort().join("<->");if(!map.get(key)){map.set(key,!0);var fromNode=link.fromNode;var toNode=link.toNode;if(fromNode&&toNode){var fromPoint=fromNode.offset;var toPoint=toNode.offset;var diffX=fromPoint.x-toPoint.x;var diffY=fromPoint.y-toPoint.y;var dis=Math.max(epsilon,Math.sqrt(diffX*diffX+diffY*diffY));var force=dis*dis/getK(fromNode,toNode,options);var offsetX=diffX/dis*force;var offsetY=diffY/dis*force;var fromNodeIsLocked=!fromNode.canMove();var toNodeIsLocked=!toNode.canMove();if(fromNodeIsLocked){if(!toNodeIsLocked){offsetXObject[toId]+=offsetX;offsetYObject[toId]+=offsetY}}else{offsetXObject[fromId]-=offsetX;offsetYObject[fromId]-=offsetY}if(toNodeIsLocked){if(!fromNodeIsLocked){offsetXObject[fromId]-=offsetX;offsetYObject[fromId]-=offsetY}}else{offsetXObject[toId]+=offsetX;offsetYObject[toId]+=offsetY}}}}))}},{key:"offsetNodes",value:function(nodes){var options=this.options;var epsilon=options.epsilon;var T=options.T;var offsetXObject=this.offsetXObject;var offsetYObject=this.offsetYObject;var offsetMaxX=T;var offsetMaxY=T;var offsetMinX=-T;var offsetMinY=-T;var limitOffset=options.limitOffset;nodes.forEach((function(node,key){if(node.canMove()){var offsetX=offsetXObject[key];var offsetY=offsetYObject[key];var dis=Math.max(epsilon,Math.sqrt(offsetX*offsetX+offsetY*offsetY));offsetMaxX=Math.max(offsetX,offsetMaxX);offsetMaxY=Math.max(offsetY,offsetMaxY);offsetMinX=Math.min(offsetX,offsetMinX);offsetMinY=Math.min(offsetY,offsetMinY);var temp=T;var xDisp=offsetX/dis*Math.min(dis,temp);var yDisp=offsetY/dis*Math.min(dis,temp);if(isNaN(xDisp))throw new Error;var newOffset=new _position2.default(xDisp,yDisp);_.isFunction(limitOffset)&&(newOffset=limitOffset(key,newOffset));node.offset.offset(newOffset)}}));return!1}}],[{key:"getDefaultConfig",value:function(){return Object.assign({},_symmetricLayoutConfig2.default)}}]);return SymmetricLayout}(_geometryLayout2.default);function getK(node1,node2,options){var kObj1=node1.kObj;kObj1||(node1.kObj=kObj1={});var value=kObj1[node2.id];if(value)return value;var result=options.expectDistance;_.isFunction(result)&&(result=result(node1.originalNode,node2.originalNode));kObj1[node2.id]=result;var kObj2=node2.kObj;kObj2||(node2.kObj=kObj2={});kObj2[node1.id]=result;return result}function getMaxEjectDistance(node1,node2,options){var maxEjectDisObj1=node1.maxEjectDisObj;maxEjectDisObj1||(node1.maxEjectDisObj=maxEjectDisObj1={});var value=maxEjectDisObj1[node2.id];if(value)return value;var result=options.maxEjectDistance;_.isFunction(result)&&(result=result(node1.originalNode,node2.originalNode));maxEjectDisObj1[node2.id]=result;var maxEjectDisObj2=node2.maxEjectDisObj;maxEjectDisObj2||(node2.maxEjectDisObj=maxEjectDisObj2={});maxEjectDisObj2[node1.id]=result;return result}exports.default=SymmetricLayout}(mod_exports,global.geometryLayout,global.position,global.symmetricLayoutConfig);global.symmetricLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_symmetricLayout){Object.defineProperty(exports,"__esModule",{value:!0});var SymmetricLayoutForIsland=function(_SymmetricLayout){_inherits(SymmetricLayoutForIsland,_SymmetricLayout);function SymmetricLayoutForIsland(props){_classCallCheck(this,SymmetricLayoutForIsland);var _this=_possibleConstructorReturn(this,(SymmetricLayoutForIsland.__proto__||Object.getPrototypeOf(SymmetricLayoutForIsland)).call(this,props));_this.layoutName="SymmetricLayoutForIsland";return _this}_createClass(SymmetricLayoutForIsland,[{key:"layout",value:function(island){return _get(SymmetricLayoutForIsland.prototype.__proto__||Object.getPrototypeOf(SymmetricLayoutForIsland.prototype),"layout",this).call(this,island.nodes,island.links,island.options)}},{key:"getLayoutName",value:function(){return this.layoutName}}]);return SymmetricLayoutForIsland}(_interopRequireDefault(_symmetricLayout).default);exports.default=SymmetricLayoutForIsland}(mod_exports,global.symmetricLayout);global.symmetricLayoutForIsland=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var layeredTool={};layeredTool.layered=function(nodes,styleInfo){var result={originalStyle:styleInfo};var tagInfo=function(layers){var tagInfo={};_.each(layers,(function(layer,i){var associateTags=layer.associateTags;var layerIndex=i;_.each(associateTags,(function(tag){tagInfo[tag.toUpperCase()]=layerIndex}))}));return tagInfo}(styleInfo.layers);var layerArr=[];_.each(styleInfo.layers,(function(tmpLayer){var obj={tags:[],originalLayer:tmpLayer};_.each(tmpLayer.associateTags,(function(tag){obj.tags.push({name:tag,devices:[]})}));layerArr.push(obj)}));var unAssignedDevices=[];var assignLength=0;nodes.forEach((function(node){if(_.isArray(node.tags)&&0!==node.tags.length){var layerInfo=function(tagInfo,node){var result={index:-1,tag:null};var tags=node.tags;for(var i=tags.length-1;i>=0;i--){var tag=tags[i];var tmpIndex=tagInfo[tag.toUpperCase()];if(_.isNumber(tmpIndex)){result={index:tmpIndex,tag:tag};break}}return result}(tagInfo,node);var layerIndex=layerInfo.index;if(-1!=layerIndex){var layer=layerArr[layerIndex];if(!layer)return;!function(node,layer,tag){var currTagInfo=_.find(layer.tags,(function(obj){return obj.name.toUpperCase()===tag.toUpperCase()}));if(!currTagInfo){currTagInfo={name:tag,devices:[]};layer.tags.push(currTagInfo)}currTagInfo.devices.push(node)}(node,layer,layerInfo.tag);assignLength++}else unAssignedDevices.push(node)}else unAssignedDevices.push(node)}));result.layers=layerArr;result.unAssignedDevices=unAssignedDevices;result.matchedCount=assignLength;result.unAssignedCount=unAssignedDevices.length;return result};exports.default=layeredTool}(mod_exports);global.layeredTool=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_node){Object.defineProperty(exports,"__esModule",{value:!0});var LayerNode=function(_Node){_inherits(LayerNode,_Node);function LayerNode(originalNode,locked){_classCallCheck(this,LayerNode);var _this=_possibleConstructorReturn(this,(LayerNode.__proto__||Object.getPrototypeOf(LayerNode)).call(this,originalNode,locked));_this.tags=originalNode.tags;return _this}return LayerNode}(_interopRequireDefault(_node).default);exports.default=LayerNode}(mod_exports,global.node);global.layerNode=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var Layer=function(){function Layer(layerInfo){_classCallCheck(this,Layer);this.level=layerInfo.level;this.maxNodeCount=layerInfo.maxNodeCount||1e3;this.scale=layerInfo.scale;this.tags=new Set;this.nodes=new Map;this.fixedNodes=new Map}_createClass(Layer,[{key:"add",value:function(node){this.nodes.set(node.id,node);node.layer=this;node.fixed&&this.fixedNodes.set(node.id,node)}},{key:"addTag",value:function(tag){this.tags.add(tag)}},{key:"getNodeById",value:function(id){return this.nodes.get(id)}},{key:"actualSize",get:function(){return Math.min(this.maxNodeCount||1/0,this.nodes.size)}},{key:"getNodesCount",value:function(){return this.nodes.size}},{key:"clone",value:function(){return new Layer({level:this.level,maxNodeCount:this.maxNodeCount,scale:this.scale})}},{key:"sortBy",value:function(fn){var nodeArray=Array.from(this.nodes.values());nodeArray.sort(fn);var nodeMap=this.nodes;nodeMap.clear();nodeArray.forEach((function(node){nodeMap.set(node.id,node)}))}}]);return Layer}();exports.default=Layer}(mod_exports);global.layer=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var LayerGroup=function(){function LayerGroup(groupInfo){_classCallCheck(this,LayerGroup);this.id=groupInfo.id;this.name=groupInfo.name;this.orientation=groupInfo.orientation;this.layers=new Set;this.links=new Set;this.assignNodes=new Map;this.unassignNodes=new Map;this.allNodes=new Map}_createClass(LayerGroup,[{key:"add",value:function(layer){var _this=this;this.layers.add(layer);layer.nodes.forEach((function(node){_this.addAssignNode(node)}))}},{key:"addLink",value:function(link){this.links.add(link);var fromNode=this.allNodes.get(link.from);var toNode=this.allNodes.get(link.to);if(fromNode){link.fromNode=fromNode;fromNode.addFromLink(link);toNode&&fromNode.addToNeighbor(toNode)}if(toNode){link.toNode=toNode;toNode.addToLink(link);fromNode&&toNode.addToNeighbor(fromNode)}}},{key:"addAssignNode",value:function(node){this.assignNodes.set(node.id,node);this.allNodes.set(node.id,node)}},{key:"addUnassignNode",value:function(node){this.unassignNodes.set(node.id,node);this.allNodes.set(node.id,node)}},{key:"getAllNodes",value:function(){return[].concat(_toConsumableArray(this.allNodes.values()))}},{key:"getFixedNodes",value:function(){return this.getAllNodes().filter((function(node){return node.fixed}))}},{key:"getLayerByLevel",value:function(level){return Array.from(this.layers)[level]}},{key:"clone",value:function(){return new LayerGroup({id:this.id,name:this.name,orientation:this.orientation})}}]);return LayerGroup}();exports.default=LayerGroup}(mod_exports);global.layerGroup=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_baseLayout,_layerGroup,_layer,_layerNode,_link,_position,_boundsTool,_lockTool,_symmetricLayout){Object.defineProperty(exports,"__esModule",{value:!0});var _baseLayout2=_interopRequireDefault(_baseLayout);var _layerGroup2=_interopRequireDefault(_layerGroup);var _layer2=_interopRequireDefault(_layer);var _layerNode2=_interopRequireDefault(_layerNode);var _link2=_interopRequireDefault(_link);var _position2=_interopRequireDefault(_position);_interopRequireDefault(_boundsTool);var _lockTool2=_interopRequireDefault(_lockTool);var _symmetricLayout2=_interopRequireDefault(_symmetricLayout);var TemplateStyleLayout=function(_BaseLayout){_inherits(TemplateStyleLayout,_BaseLayout);function TemplateStyleLayout(props){_classCallCheck(this,TemplateStyleLayout);var _this=_possibleConstructorReturn(this,(TemplateStyleLayout.__proto__||Object.getPrototypeOf(TemplateStyleLayout)).call(this,props));_this.layerGroup=null;_this.layoutName="TemplateStyleLayout";_this.nodeType=_layerNode2.default;return _this}_createClass(TemplateStyleLayout,[{key:"convert",value:function(layerGroupInfo,linkInfos){var _this2=this;linkInfos=linkInfos||[];var layerGroup=this.convertLayerGroup(layerGroupInfo);_.each(layerGroupInfo.layers,(function(layerInfo,i){layerInfo.level=i;var layer=_this2.convertLayer(layerInfo);_.each(layerInfo.tags,(function(tagInfo){layer.addTag(tagInfo.name);_.each(tagInfo.devices,(function(deviceInfo){var node=_this2.converLayerNode(deviceInfo);layer.add(node)}))}));layerGroup.add(layer)}));_.each(layerGroupInfo.unAssignedDevices,(function(deviceInfo){var node=_this2.converLayerNode(deviceInfo);layerGroup.addUnassignNode(node)}));linkInfos.forEach((function(linkInfo){var link=_this2.convertLink(linkInfo);layerGroup.addLink(link)}));this.layerGroup=layerGroup;return layerGroup}},{key:"convertLayerGroup",value:function(groupInfo){return new _layerGroup2.default({id:groupInfo.id,name:groupInfo.name,orientation:groupInfo.orientation})}},{key:"convertLayer",value:function(layerInfo){return new _layer2.default({level:layerInfo.level,maxNodeCount:layerInfo.maxNodeCount,scale:layerInfo.scale})}},{key:"converLayerNode",value:function(nodeInfo){return new _layerNode2.default(nodeInfo,nodeInfo.locked)}},{key:"convertLink",value:function(linkInfo){return new _link2.default(linkInfo)}},{key:"getBestStartPos",value:function(){return new _position2.default}},{key:"layoutUnassignNodes",value:function(){var layerGroup=this.layerGroup;layerGroup.unassignNodes.forEach((function(node){node.offset=new _position2.default(200*Math.random(),200*Math.random())}));var assignNodes=layerGroup.assignNodes;_lockTool2.default.lockNodes(assignNodes);var nodes=new Map;assignNodes.forEach((function(node){nodes.set(node.id,node)}));layerGroup.unassignNodes.forEach((function(node){nodes.set(node.id,node)}));(new _symmetricLayout2.default).layoutWithOutResult(nodes,layerGroup.links)}},{key:"generateResult",value:function(){var layerGroup=this.layerGroup;var result=[];layerGroup.assignNodes.forEach((function(node){result.push(node.toLocJson())}));layerGroup.unassignNodes.forEach((function(node){result.push(node.toLocJson())}));return result}}]);return TemplateStyleLayout}(_baseLayout2.default);exports.default=TemplateStyleLayout}(mod_exports,global.baseLayout,global.layerGroup,global.layer,global.layerNode,global.link,global.position,global.boundsTool,global.lockTool,global.symmetricLayout);global.templateStyleLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default={layerSpace:200,nodeHSpace:200,nodeVSpace:100,layerMaxLine:1e3,align:"left"}}(mod_exports);global.parallelStyleLayoutConfig=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(goalLocations,goodLocations,layerGroup){layerGroup.layers.forEach((function(layer){!function(goalLocations,goodLocations,assignNodes){goalLocations=_.filter(goalLocations,(function(item){return assignNodes.has(item.key)}));goodLocations=_.filter(goodLocations,(function(item){return assignNodes.has(item.key)}));prepareBaseInfo(goalLocations);prepareBaseInfo(goodLocations);(function(goalLocations,goodLocations){var join=[];goalLocations.forEach((function(goal){goodLocations.forEach((function(good){join.push({goal:goal.key,good:good.key,diff:(rate1=goal.rate,rate2=good.rate,diff=Math.abs(rate1-rate2),diff<pi?diff:pi2-diff),position:goal.position});var rate1,rate2,diff}))}));join=_.sortBy(join,"diff");var result=[];var _loop=function(){var current=join.shift();result.push({key:current.good,location:current.position.convertToLocation(),position:current.position});join=_.filter(join,(function(item){return item.goal!==current.goal&&item.good!==current.good}))};for(;join.length>0;)_loop();return result})(goalLocations,goodLocations).forEach((function(item){assignNodes.get(item.key).offset=item.position}))}(goalLocations,goodLocations,layer.nodes);layer.sortBy((function(n1,n2){var n1x=n1.offset.x;var n1y=n1.offset.y;var n2x=n2.offset.x;var n2y=n2.offset.y;return n1x===n2x?n1y-n2y:n1x-n2x}))}))};var _position2=_interopRequireDefault(_position);var pi=Math.PI;var pi2=2*pi;function prepareBaseInfo(locations){var center=function(locations){var counter=locations.length;var xSum=0;var ySum=0;locations.forEach((function(node){var position=node.position;xSum+=position.x;ySum+=position.y}));return new _position2.default(xSum/counter,ySum/counter)}(locations);locations.forEach((function(node){var vector=node.position.getOffsetFrom(center);node.vector=vector;node.rate=Math.atan2(vector.y,vector.x)}));locations.center=center}}(mod_exports,global.position);global.parallelSortNodes=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");function loop(parallelLayout){var layerGroup=parallelLayout.layerGroup;var rows=function(layerGroup,options){var layerMaxLine=options.layerMaxLine;var rows=[];layerGroup.layers.forEach((function(layer){var maxNodeCount=layer.maxNodeCount;var nodes=Array.from(layer.nodes.values());var line=Math.min(nodes.length/maxNodeCount,layerMaxLine);for(var i=0;i<line;i++){var startIndex=i*maxNodeCount;var endIndex=startIndex+(i===line-1?nodes.length-i*maxNodeCount:maxNodeCount);var row=new Row(nodes.slice(startIndex,endIndex));rows.push(row)}}));return rows}(layerGroup,parallelLayout.options);var diffObj={};_.each(rows,(function(row,i){!function(rows,currRow,index,diffObj){var leRows=rows.slice(0,index+1);currRow.nodes.forEach((function(node){var nodeScore=currRow.getScore(node.id);node.allNeighbors.forEach((function(nbr){var rowIndex=function(node,rows){return _.findIndex(rows,(function(row){return row.hasNode(node.id)}))}(nbr,leRows);if(-1!==rowIndex){var nbrScore=rows[rowIndex].getScore(nbr.id);diffObj[node.id]?diffObj[node.id]+=(nbrScore-nodeScore)/3:diffObj[node.id]=(nbrScore-nodeScore)/3}}))}))}(rows,row,i,diffObj)}));_.each(rows,(function(row){for(var key in diffObj)if(row.hasNode(key)){var currScore=row.getScore(key);row.setScore(key,currScore+diffObj[key])}}));for(var key in diffObj){layerGroup.allNodes.get(key).offset.offset({x:diffObj[key],y:0})}!function(layerGroup){layerGroup.layers.forEach((function(layer){layer.sortBy((function(n1,n2){return n1.offset.x-n2.offset.x}))}))}(layerGroup)}function Row(nodes){var nodeMap=new Map;var scoreMap=new Map;_.each(nodes,(function(node){nodeMap.set(node.id,node);scoreMap.set(node.id,node.offset.x)}));this.nodes=nodeMap;this.scoreMap=scoreMap}Row.prototype.setScore=function(id,score){this.scoreMap.set(id,score)};Row.prototype.getScore=function(id){return this.scoreMap.get(id)||0};Row.prototype.hasNode=function(id){return!!this.nodes.get(id)};internalGlobal.parallelReduceCrossTool={default:function(parallelLayout){var tries=parallelLayout.options.reduceCrossTries||30;for(var i=0;i<tries;i++)loop(parallelLayout)}}}();!function(netBrain){!function(global,factory){var mod_exports={};!function(exports,_templateStyleLayout,_symmetricLayout,_parallelStyleLayoutConfig,_position,_point,_boundsTool,_parallelSortNodes){Object.defineProperty(exports,"__esModule",{value:!0});var _templateStyleLayout2=_interopRequireDefault(_templateStyleLayout);var _symmetricLayout2=_interopRequireDefault(_symmetricLayout);var _parallelStyleLayoutConfig2=_interopRequireDefault(_parallelStyleLayoutConfig);var _position2=_interopRequireDefault(_position);_interopRequireDefault(_point);var _boundsTool2=_interopRequireDefault(_boundsTool);_interopRequireDefault(_parallelSortNodes);var internalGlobal=netBrain.ns("LayoutTools.internalGlobal");var moveSomeNodesNearOtherNodesTool=internalGlobal.moveSomeNodesNearOtherNodesTool.default;internalGlobal.parallelReduceCrossTool.default;var ParallelStyleLayout=function(_TemplateStyleLayout){_inherits(ParallelStyleLayout,_TemplateStyleLayout);function ParallelStyleLayout(props){_classCallCheck(this,ParallelStyleLayout);var _this=_possibleConstructorReturn(this,(ParallelStyleLayout.__proto__||Object.getPrototypeOf(ParallelStyleLayout)).call(this,props));_this.layoutName="ParallelStyleLayout";return _this}_createClass(ParallelStyleLayout,[{key:"layout",value:function(layerGroupInfo,linkInfos,customOptions){this.options=Object.assign(ParallelStyleLayout.getDefaultConfig(),customOptions);this.convert(layerGroupInfo,linkInfos);var startPos=this.getBestStartPos();this.layoutLayers(startPos);var layerGroup=this.layerGroup;moveSomeNodesNearOtherNodesTool(layerGroup.unassignNodes,layerGroup.assignNodes);return this.generateResult()}},{key:"layoutLayers",value:function(startPos){var _this2=this;var layerGroup=this.layerGroup;var layers=layerGroup.layers;var layerBoundsMap=new Map;var layerSpace=this.options.layerSpace;layers.forEach((function(layer){_this2.layoutLayer(layer,startPos);var bounds=_boundsTool2.default.calcBounds([].concat(_toConsumableArray(layer.nodes.values())).filter((function(node){return node.canMove()})));layerBoundsMap.set(layer.level,bounds);startPos.offset(new _position2.default(0,bounds.height+layerSpace))}));"center"===this.options.align&&this.alignCenter();(new _symmetricLayout2.default).layout(layerGroup.allNodes,layerGroup.links,{limitOffset:function(nodeId,offset){return layerGroup.unassignNodes.get(nodeId)?offset:new _position2.default(0,0)}})}},{key:"alignCenter",value:function(){var layers=[].concat(_toConsumableArray(this.layerGroup.layers.values()));var rowsChain=_.chain(layers).pluck("rows").flatten().filter(_.identity).sortBy("maxX").reverse();var maxRow=rowsChain.first().value();if(maxRow){var maxX=maxRow.maxX;rowsChain.each((function(row){if(row.maxX<maxX){var offsetX=(maxX-row.maxX)/2;_.each(row.nodes,(function(node){node.offset.offset(new _position2.default(offsetX,0))}))}}))}}},{key:"update",value:function(){var _this3=this;var startPos=new _position2.default;var layerSpace=this.options.layerSpace;var layerBoundsMap=this.layerBoundsMap;this.layerGroup.layers.forEach((function(layer){var bounds=layerBoundsMap.get(layer.level);_this3.layoutLayer(layer,startPos);var offsetY=bounds.height;0!==offsetY&&(offsetY+=layerSpace);startPos.offset(new _position2.default(0,offsetY))}));return this.generateResult()}},{key:"layoutLayer",value:function(layer,startPos){var maxNodeCount=layer.maxNodeCount;var options=this.options;var nodeVSpace=options.nodeVSpace;var nodeHSpace=options.nodeHSpace;var layerMaxLine=options.layerMaxLine;options.align;var startX=startPos.x;var startY=startPos.y;var i=0;var rows=layer.rows=[];(nodesMap=layer.nodes,nodes=[].concat(_toConsumableArray(nodesMap.values())),_.sortBy(nodes,(function(node){return node.originalNode.hostName}))).forEach((function(node){var x=0,y=0;var line=Math.floor(i/maxNodeCount)+1;var row=rows[line]||(rows[line]={nodes:[],maxX:x});if(line<=layerMaxLine){x=startX+i%maxNodeCount*nodeHSpace;y=startY+(line-1)*nodeVSpace}else{var tmpIndex=i-(layerMaxLine-1)*maxNodeCount;x=startX+tmpIndex*nodeHSpace;y=startY+(layerMaxLine-1)*nodeVSpace}if(node.canMove()){node.offset=new _position2.default(x,y);row.nodes.push(node);row.maxX=x}i++}));var nodesMap,nodes}}],[{key:"getDefaultConfig",value:function(){return Object.assign({},_parallelStyleLayoutConfig2.default)}}]);return ParallelStyleLayout}(_templateStyleLayout2.default);exports.default=ParallelStyleLayout}(mod_exports,global.templateStyleLayout,global.symmetricLayout,global.parallelStyleLayoutConfig,global.position,global.point,global.boundsTool,global.parallelSortNodes);global.parallelStyleLayout=mod_exports}(netBrain.ns("LayoutTools.internalGlobal"))}(NetBrain);!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var SPLIT_SEPARATOR="<->";internalGlobal.symmetryStyleSplitTool={default:function(layerGroup,itemArr){var layers=layerGroup.layers;var totalObj={};layers.forEach((function(layer){var layerLevel=layer.level;if(!(layerLevel<1)){var value=function(itemArr,layerLevel){var totalObj={};_.each(itemArr,(function(item,i){var nodes=item.values.get(layerLevel);if(nodes){var itemIndex=item.itemIndex;var otherItem=itemArr.slice(i+1);nodes.forEach((function(node){var result=function(node,otherItem,layerLevel){var result={};_.each(otherItem,(function(item){result[item.itemIndex]=0;var nodes=item.values.get(layerLevel);nodes&&nodes.forEach((function(tmpNode){(function(node1,node2){var flag=!1;node1.allNeighbors.forEach((function(nbr){flag||(node2===nbr||node2.allNeighbors.has(nbr.id))&&(flag=!0)}));return flag})(node,tmpNode)&&result[item.itemIndex]++}))}));return result}(node,otherItem,layerLevel);_.isEmpty(result)||_.each(result,(function(value,tmpItemIndex){var tmpKey=[itemIndex,tmpItemIndex].sort().join(SPLIT_SEPARATOR);totalObj[tmpKey]||(totalObj[tmpKey]=0);totalObj[tmpKey]+=value}))}))}}));return totalObj}(itemArr,layerLevel);totalObj[layerLevel]=value}}));return function(itemArr,totalObj){var tmpObj;_.each(totalObj,(function(layerTotal){tmpObj?_.each(layerTotal,(function(value,key){tmpObj[key]+=value})):tmpObj=layerTotal}));var weightArr=[];_.each(tmpObj,(function(value,key){weightArr.push({weight:value,itemIndexes:key.split(SPLIT_SEPARATOR)})}));weightArr.sort((function(a,b){return b.weight-a.weight}));return function makeTwoWergihtArr(weightArr){var newWeightArr=weightArr.splice(1);var oldWeightObj=weightArr[0]||[];var otherWeightArr=[];var relevanceFlag=!1;_.each(newWeightArr,(function(tmpWeightObj){if(tmpWeightObj.weight>0&&function(oldWeightObj,tmpWeightObj){return!!_.intersection(oldWeightObj.itemIndexes,tmpWeightObj.itemIndexes).length}(oldWeightObj,tmpWeightObj)){oldWeightObj.itemIndexes=_.union(oldWeightObj.itemIndexes,tmpWeightObj.itemIndexes);oldWeightObj.weight+=tmpWeightObj.weight;relevanceFlag=!0}else otherWeightArr.push(tmpWeightObj)}));var result;var otherLen=otherWeightArr.lenght;if(relevanceFlag&&otherLen>1)result=makeTwoWergihtArr([oldWeightObj,_.flatten(otherWeightArr,!0)]);else{var tmpObj={itemIndexes:0,weight:0};_.each(otherWeightArr,(function(tmpWeightObj){tmpObj.itemIndexes=_.union(tmpObj.itemIndexes,tmpWeightObj.itemIndexes);tmpObj.weight+=tmpWeightObj.weight}));tmpObj.itemIndexes=_.difference(tmpObj.itemIndexes,oldWeightObj.itemIndexes);result=[oldWeightObj,tmpObj]}return result}(weightArr)}(0,totalObj)}}}();NetBrain.ns("LayoutTools.internalGlobal").symmetryStyleLayoutConfig={default:{layerSpace:200,nodeHSpace:200,nodeVSpace:100,layerMaxLine:1e3,align:"left"}};!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var ParallelStyleLayout=internalGlobal.parallelStyleLayout.default;var symmetryStyleLayoutConfig=internalGlobal.symmetryStyleLayoutConfig.default;internalGlobal.moveSomeNodesNearOtherNodesTool.default;var symmetryStyleSplitTool=internalGlobal.symmetryStyleSplitTool.default;function SymmetryStyleLayout(){ParallelStyleLayout.apply(this,arguments);this.layoutName="SymmetryStyleLayout"}NgUtil.inherit(SymmetryStyleLayout,ParallelStyleLayout);SymmetryStyleLayout.getDefaultConfig=function(){return symmetryStyleLayoutConfig};SymmetryStyleLayout.prototype.layout=function(layerGroupInfo,linkInfos,customOptions){var options=_.extend(SymmetryStyleLayout.getDefaultConfig(),customOptions);return ParallelStyleLayout.prototype.layout.apply(this,[layerGroupInfo,linkInfos,options])};SymmetryStyleLayout.prototype.layoutLayers=function(startPos){var _this=this;if(this.layerGroup.layers.size>1){var layerItemArr=_this.grouping();var two=symmetryStyleSplitTool(this.layerGroup,layerItemArr);this.updateLayerGroup(two,layerItemArr)}ParallelStyleLayout.prototype.layoutLayers.apply(this,arguments)};SymmetryStyleLayout.prototype.grouping=function(){var _this=this;var layerGroup=this.layerGroup;var tmpMap=new Map;var result=[];var index=0;layerGroup.layers.forEach((function(layer){var layerLevel=layer.level;layerLevel<1||layer.nodes.forEach((function(node){if(!tmpMap.has(node.id)){var obj={values:new Map,itemIndex:index++};addNodeToTempObj(node,layerLevel,obj);_this.getNbrLowerLayerLevel(node,layerLevel,obj);result.push(obj);obj.values.forEach((function(value){value.forEach((function(tmpNode){tmpMap.set(tmpNode.id,tmpNode)}))}))}}))}));return result};SymmetryStyleLayout.prototype.getNbrLowerLayerLevel=function(node,nodeLevel,obj,checkedNodeObj){var _this=this;(checkedNodeObj=checkedNodeObj||{})[node.id]=node;node.allNeighbors.forEach((function(nbr){var nbrLayer=nbr.layer;if(nbrLayer){if(nbrLayer.level>nodeLevel){addNodeToTempObj(nbr,nbrLayer.level,obj);checkedNodeObj[nbr.id]||_this.getNbrLowerLayerLevel(nbr,nbrLayer.level,obj,checkedNodeObj)}}else checkedNodeObj[nbr.id]||_this.getNbrLowerLayerLevel(nbr,nodeLevel,obj,checkedNodeObj)}))};SymmetryStyleLayout.prototype.updateLayerGroup=function(two,itemArr){var layerGroup=this.layerGroup;var newLayerGroup=layerGroup.clone();var one=two[0];var another=two[1];var oneLayers=buildLayers(layerGroup,one,itemArr);var anotherLayers=buildLayers(layerGroup,another,itemArr);oneLayers.sort((function(a,b){return b.level-a.level}));oneLayers.forEach((function(layer){newLayerGroup.add(layer)}));newLayerGroup.add(layerGroup.getLayerByLevel(0));anotherLayers.forEach((function(layer){newLayerGroup.add(layer)}));var level=0;newLayerGroup.layers.forEach((function(layer){layer.level=level++}));newLayerGroup.links=layerGroup.links;newLayerGroup.unassignNodes=layerGroup.unassignNodes;this.layerGroup=newLayerGroup};function buildLayers(layerGroup,one,itemArr){var itemIndexes=one.itemIndexes;var layerObj={};_.each(itemIndexes,(function(index){itemArr[index].values.forEach((function(nodes,level){var newLayer=layerObj[level];if(!newLayer){var layer=layerGroup.getLayerByLevel(level);if(!layer)return;(newLayer=layer.clone()).tags=layer.tags}nodes.forEach((function(node){newLayer.add(node)}));layerObj[level]=newLayer}))}));var layerArr=[];_.each(layerObj,(function(layer){layerArr.push(layer)}));return layerArr}function addNodeToTempObj(node,layerLevel,tempObj){var map=tempObj.values.get(layerLevel);if(!map){map=new Map;tempObj.values.set(layerLevel,map)}map.set(node.id,node)}internalGlobal.symmetryStyleLayout={default:SymmetryStyleLayout}}();!function(global,factory){var mod_exports={};!function(exports,_argumentsChecker){Object.defineProperty(exports,"__esModule",{value:!0});exports.calculateJaccardCoefficient=exports.getJaccardCoefficient=void 0;var _argumentsChecker2=_interopRequireDefault(_argumentsChecker);exports.getJaccardCoefficient=function(arrA,arrB){if(2!==arguments.length)throw new Error("getJaccardCoefficient called must two params: arrA, arrB");_argumentsChecker2.default.checkArgumentsTypes(arguments,["Array","Array"]);var intersect=_.intersection(arrA,arrB).length;var union=_.union(arrA,arrB).length;return calculateJaccardCoefficient(intersect,union)};exports.calculateJaccardCoefficient=calculateJaccardCoefficient;function calculateJaccardCoefficient(intersect,union){return 0===union?0:intersect/union}}(mod_exports,global.argumentsChecker);global.jaccard=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_jaccard){Object.defineProperty(exports,"__esModule",{value:!0});exports.calculateSimilarityCoefficient=exports.getSimilarityCoefficient=void 0;exports.getSimilarityCoefficient=function(arrA,arrB){return(0,_jaccard.getJaccardCoefficient)(arrA,arrB)};exports.calculateSimilarityCoefficient=function(intersect,union){return(0,_jaccard.calculateJaccardCoefficient)(intersect,union)}}(mod_exports,global.jaccard);global.calculator=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));NetBrain.ns("LayoutTools.internalGlobal").advancedCalculatorConfig={templateStyleWeights:{device:.25,tag:.25,layer:.25,deviceInLayer:.25}};!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var jaccard=internalGlobal.jaccard;internalGlobal.advancedCalculatorConfig.templateStyleWeights;internalGlobal.advancedCalculator={calculateSimilarityCoefficient:function(fullMatchInfo){return calculateDevice(fullMatchInfo.device)*calculateLayer(fullMatchInfo.layers)},forTest:{calculateDevice:calculateDevice,calculateTag:calculateTag,calculateLayer:calculateLayer,calculateDeviceInLayer:calculateDeviceInLayer}};function calculateDeviceInLayer(layers){var sums=_.chain(layers).reduce((function(memo,layer){memo.size+=layer.size;memo.devices+=layer.devices;return memo}),{size:0,devices:0}).value();return 0===sums.size||0===sums.devices?0:1-_.chain(layers).reduce((function(memo,layer){return memo+Math.abs(layer.size/sums.size-layer.devices/sums.devices)}),0).value()/2}function calculateLayer(layers){var matched=_.filter(layers,(function(layer){return layer.devices>0})).length;return jaccard.calculateJaccardCoefficient(matched,layers.length)}function calculateTag(tag){return jaccard.getJaccardCoefficient(tag.map,tag.style)}function calculateDevice(device){return jaccard.calculateJaccardCoefficient(device.matched,device.total)}}();!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});var Level=function(){function Level(){var levelIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,Level);this.levelIndex=levelIndex;this.subLevels=[];this.allLocations=[]}_createClass(Level,[{key:"addSubLevel",value:function(subLevel){this.subLevels.push(subLevel)}},{key:"addLocation",value:function(location){this.allLocations.push(location)}}]);return Level}();var SubLevel=function(){function SubLevel(parent){var subLevelIndex=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,SubLevel);this.parent=parent;this.subLevelIndex=subLevelIndex;this.locations=[]}_createClass(SubLevel,[{key:"addLocation",value:function(location){this.locations.push(location);this.parent.addLocation(location)}}]);return SubLevel}();exports.Level=Level;exports.SubLevel=SubLevel;exports.Location=function Location(parent){_classCallCheck(this,Location);this.id=_.uniqueId();this.parent=parent}}(mod_exports);global.level=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var assignNodes=context.layerGroup.assignNodes;var center=new _position2.default;assignNodes.forEach((function(node){return center.offset(node.offset)}));center.x/=assignNodes.size;center.y/=assignNodes.size;context.layoutInfo.center=center};var _position2=_interopRequireDefault(_position)}(mod_exports,global.position);global.seekTheCenter=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var unassignNodes=context.layerGroup.unassignNodes;var center=context.layoutInfo.center;unassignNodes.forEach((function(node){return node.offset=center.getCopy()}))}}(mod_exports);global.moveUnassignNodesToCenter=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_symmetricLayout){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var links=context.links;var layerGroup=context.layerGroup;var assignNodes=layerGroup.assignNodes;var allNodes=layerGroup.allNodes;assignNodes.forEach((function(node){return node.locked=!0}));(new _symmetricLayout2.default).layout(allNodes,links)};var _symmetricLayout2=_interopRequireDefault(_symmetricLayout)}(mod_exports,global.symmetricLayout);global.symmetricLayoutUnassignNodes=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.getNodeSpace=getNodeSpace;exports.getLevelSplitSpace=function(context){return getNodeSpace(context)*context.options.splitSize};function getNodeSpace(context){var options=context.options;return options.commonNodeSize+options.nodeDistance}}(mod_exports);global.spaceHelper=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_symmetricLayout,_symmetricLayoutForIsland,_islandGroupLayoutFromLayerGroup){Object.defineProperty(exports,"__esModule",{value:!0});exports.prepareBySymmetricLayoutByIsland=exports.prepareBySymmetricLayout=void 0;var _symmetricLayout2=_interopRequireDefault(_symmetricLayout);var _symmetricLayoutForIsland2=_interopRequireDefault(_symmetricLayoutForIsland);exports.prepareBySymmetricLayout=function(context){(new _symmetricLayout2.default).layout(context.allNodesMap,context.links)};exports.prepareBySymmetricLayoutByIsland=function(context){var islandGroupLayoutFromLayerGroup=new _islandGroupLayoutFromLayerGroup.IslandGroupLayoutFromLayerGroupByIsland;var symmetricLayouter=new _symmetricLayoutForIsland2.default;context.tempLocations=islandGroupLayoutFromLayerGroup.layout(context.layerGroup,symmetricLayouter,context.options)}}(mod_exports,global.symmetricLayout,global.symmetricLayoutForIsland,global.islandGroupLayoutFromLayerGroup);global.prepareBySymmetricLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var layers=[].concat(_toConsumableArray(context.layerGroup.layers));var levels=context.levelInfos;_.each(layers,(function(layer,index){!function(nodesMap,goalLocations){var goodLocations=[].concat(_toConsumableArray(nodesMap.values())).map((function(node){return{id:node.id,position:node.offset.getCopy()}}));prepareBaseInfo(goalLocations);prepareBaseInfo(goodLocations);(function(goalLocations,goodLocations){var join=[];goalLocations.forEach((function(goal){goodLocations.forEach((function(good){join.push({goal:goal.id,good:good.id,diff:(rate1=goal.rate,rate2=good.rate,diff=Math.abs(rate1-rate2),diff<pi?diff:pi2-diff),position:goal.position});var rate1,rate2,diff}))}));join=_.sortBy(join,"diff");var result=[];var _loop=function(){var current=join.shift();result.push({id:current.good,position:current.position});join=_.filter(join,(function(item){return item.goal!==current.goal&&item.good!==current.good}))};for(;join.length>0;)_loop();return result})(goalLocations,goodLocations).forEach((function(item){nodesMap.get(item.id).offset=item.position.getCopy()}))}(layer.nodes,levels[index].allLocations)}))};var _position2=_interopRequireDefault(_position);var pi=Math.PI;var pi2=2*pi;function prepareBaseInfo(locations){var center=function(locations){var counter=locations.length;var xSum=0;var ySum=0;locations.forEach((function(node){var position=node.position;xSum+=position.x;ySum+=position.y}));return new _position2.default(xSum/counter,ySum/counter)}(locations);locations.forEach((function(node){var vector=node.position.getOffsetFrom(center);node.vector=vector;node.rate=Math.atan2(vector.y,vector.x)}));locations.center=center}}(mod_exports,global.position);global.reduceCross=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_layoutBaseConfig){Object.defineProperty(exports,"__esModule",{value:!0});var _layoutBaseConfig2=_interopRequireDefault(_layoutBaseConfig);exports.default=_.extend({},_layoutBaseConfig2.default,{startAt:-Math.PI/2,direction:1,splitSize:3,useDeviation:!1})}(mod_exports,global.layoutBaseConfig);global.defaultPetalLayoutConfig=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var levels=context.levelInfos;var counter=_.chain(levels).map((function(level){return level.actualSize*level.scale})).reduce((function(memo,num){return memo+num}),0).value();levels.length>1&&(counter+=levels.length*context.options.splitSize);counter=counter||1;context.layoutInfo.randianUnit=pi2/counter};var pi2=2*Math.PI}(mod_exports);global.calculateRadianUnit=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_spaceHelper){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){context.layoutInfo.radius=(0,_spaceHelper.getNodeSpace)(context)/context.layoutInfo.randianUnit/2}}(mod_exports,global.spaceHelper);global.calculateRadius=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position,_level,_calculateRadianUnit,_calculateRadius,_spaceHelper){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var layers=[].concat(_toConsumableArray(context.layerGroup.layers));var levelInfos=_.map(layers,createBlankLevel);levelInfos=_.sortBy(levelInfos,"levelIndex");context.levelInfos=levelInfos;(0,_calculateRadianUnit2.default)(context);(0,_calculateRadius2.default)(context);!function(context){var options=context.options;var randianUnit=context.layoutInfo.randianUnit;var lastLevel=null;_.each(context.levelInfos,(function(levelInfo){var startAt=0===levelInfo.levelIndex?options.startAt:lastLevel.endAt+options.direction*options.splitSize*randianUnit;levelInfo.startAt=startAt;levelInfo.endAt=startAt+options.direction*levelInfo.actualSize*randianUnit*levelInfo.scale;lastLevel=levelInfo}))}(context);!function(context){_.each(context.levelInfos,(function(levelInfo){var lastSubLevel=function(parent,context){var subLevel=new _level.SubLevel(parent,0);subLevel.radius=context.layoutInfo.radius;subLevel.size=parent.actualSize;calculateSubLevelStartAndEnd(subLevel,context);calculateSubLevelRandianUnit(subLevel,context);subLevel.fromIndex=0;subLevel.toIndex=subLevel.size-1;addLocations(subLevel,context);return subLevel}(levelInfo,context);levelInfo.addSubLevel(lastSubLevel);for(;lastSubLevel.toIndex<levelInfo.layer.nodes.size-1;){lastSubLevel=createSubLevel(levelInfo,lastSubLevel,context);levelInfo.addSubLevel(lastSubLevel)}}))}(context);!function(context){_.each(context.levelInfos,(function(levelInfo){_.each(levelInfo.subLevels,(function(subLevel){if(1===subLevel.locations.length){var angle=(subLevel.startAt+subLevel.endAt)/2;updateLocationPosition(subLevel.locations[0],angle,subLevel.radius,context)}}))}))}(context)};var _position2=_interopRequireDefault(_position);var _calculateRadianUnit2=_interopRequireDefault(_calculateRadianUnit);var _calculateRadius2=_interopRequireDefault(_calculateRadius);function createSubLevel(parent,lastSubLevel,context){var subLevel=new _level.SubLevel(parent,lastSubLevel.subLevelIndex+1);subLevel.radius=lastSubLevel.radius+(0,_spaceHelper.getNodeSpace)(context);calculateSubLevelStartAndEnd(subLevel,context);subLevel.size=Math.floor(subLevel.radius/context.layoutInfo.radius*parent.actualSize);subLevel.fromIndex=lastSubLevel.toIndex+1;subLevel.size=Math.min(subLevel.size,parent.layer.nodes.size-subLevel.fromIndex);subLevel.toIndex=subLevel.fromIndex+subLevel.size-1;calculateSubLevelRandianUnit(subLevel,context);addLocations(subLevel,context);return subLevel}function calculateSubLevelRandianUnit(subLevel,context){var space=subLevel.endAt-subLevel.startAt;var size=subLevel.size-1||1;subLevel.randianUnit=space*context.options.direction/size}function calculateSubLevelStartAndEnd(subLevel,context){var options=context.options;var currentLevelDeviation=options.useDeviation&&context.levelInfos.length>1?function(currentRadius,context){var splitSize=context.options.splitSize;var deviation=Math.asin(splitSize*(0,_spaceHelper.getNodeSpace)(context)/2/currentRadius);return splitSize*context.layoutInfo.randianUnit/2-deviation}(subLevel.radius,context):0;currentLevelDeviation*=options.direction;var parent=subLevel.parent;subLevel.startAt=parent.startAt-currentLevelDeviation;subLevel.endAt=parent.endAt+currentLevelDeviation}function addLocations(subLevel,context){for(;subLevel.locations.length<subLevel.size;){var location=createLocation(subLevel,context);subLevel.addLocation(location)}}function createLocation(subLevel,context){var location=new _level.Location(subLevel);location.x=subLevel.locations.length;location.y=subLevel.subLevelIndex;var options=context.options;var radius=subLevel.radius;updateLocationPosition(location,subLevel.startAt+options.direction*(location.x*subLevel.randianUnit),radius,context);return location}function updateLocationPosition(location,angle,radius,context){var x=Math.cos(angle)*radius;var y=Math.sin(angle)*radius;var offset=new _position2.default(x,y);location.position=context.layoutInfo.center.getCopy().offset(offset)}function createBlankLevel(layer){var level=new _level.Level(layer.level);level.actualSize=Math.min(layer.nodes.size,layer.maxNodeCount);level.scale=layer.scale;level.layer=layer;return level}}(mod_exports,global.position,global.level,global.calculateRadianUnit,global.calculateRadius,global.spaceHelper);global.distributePetalLevelInfo=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_templateStyleLayout,_defaultPetalLayoutConfig,_prepareBySymmetricLayout,_seekTheCenter,_distributePetalLevelInfo,_moveUnassignNodesToCenter,_symmetricLayoutUnassignNodes,_reduceCross){Object.defineProperty(exports,"__esModule",{value:!0});var _templateStyleLayout2=_interopRequireDefault(_templateStyleLayout);var _defaultPetalLayoutConfig2=_interopRequireDefault(_defaultPetalLayoutConfig);var _seekTheCenter2=_interopRequireDefault(_seekTheCenter);var _distributePetalLevelInfo2=_interopRequireDefault(_distributePetalLevelInfo);var _moveUnassignNodesToCenter2=_interopRequireDefault(_moveUnassignNodesToCenter);_interopRequireDefault(_symmetricLayoutUnassignNodes);var _reduceCross2=_interopRequireDefault(_reduceCross);var PetalLayout=function(_TemplateStyleLayout){_inherits(PetalLayout,_TemplateStyleLayout);function PetalLayout(props){_classCallCheck(this,PetalLayout);var _this=_possibleConstructorReturn(this,(PetalLayout.__proto__||Object.getPrototypeOf(PetalLayout)).call(this,props));_this.layoutName="PetalLayout";return _this}_createClass(PetalLayout,[{key:"getLayoutName",value:function(){return this.layoutName}},{key:"layout",value:function(layerGroupInfo,links,customizeOptions){var options=_.extend({},_defaultPetalLayoutConfig2.default,customizeOptions);this.convert(layerGroupInfo,links);var layerGroup=this.layerGroup;var allNodes=layerGroup.getAllNodes();var allNodesMap=layerGroup.allNodes;var context={options:options,layerGroup:layerGroup,links:[].concat(_toConsumableArray(layerGroup.links)),allNodes:allNodes,allNodesMap:allNodesMap,layoutInfo:{},currentLayerInfo:{}};this.context=context;(0,_prepareBySymmetricLayout.prepareBySymmetricLayout)(context);(0,_seekTheCenter2.default)(context);(0,_distributePetalLevelInfo2.default)(context);(0,_reduceCross2.default)(context);(0,_moveUnassignNodesToCenter2.default)(context);return this.getLocations()}},{key:"getLocations",value:function(){var allNodes=this.layerGroup.getAllNodes();return this.generateResult(allNodes)}}]);return PetalLayout}(_templateStyleLayout2.default);exports.default=PetalLayout}(mod_exports,global.templateStyleLayout,global.defaultPetalLayoutConfig,global.prepareBySymmetricLayout,global.seekTheCenter,global.distributePetalLevelInfo,global.moveUnassignNodesToCenter,global.symmetricLayoutUnassignNodes,global.reduceCross);global.petalLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_petalLayout,_moveUnassignNodesToCenter,_symmetricLayoutUnassignNodes){Object.defineProperty(exports,"__esModule",{value:!0});var _petalLayout2=_interopRequireDefault(_petalLayout);var _moveUnassignNodesToCenter2=_interopRequireDefault(_moveUnassignNodesToCenter);var _symmetricLayoutUnassignNodes2=_interopRequireDefault(_symmetricLayoutUnassignNodes);var PetalLayoutAutoUnassignNodes=function(_PetalLayout){_inherits(PetalLayoutAutoUnassignNodes,_PetalLayout);function PetalLayoutAutoUnassignNodes(props){_classCallCheck(this,PetalLayoutAutoUnassignNodes);var _this=_possibleConstructorReturn(this,(PetalLayoutAutoUnassignNodes.__proto__||Object.getPrototypeOf(PetalLayoutAutoUnassignNodes)).call(this,props));_this.layoutName="PetalLayout";return _this}_createClass(PetalLayoutAutoUnassignNodes,[{key:"getLayoutName",value:function(){return this.layoutName}},{key:"layout",value:function(layerGroupInfo,links,customizeOptions){_get(PetalLayoutAutoUnassignNodes.prototype.__proto__||Object.getPrototypeOf(PetalLayoutAutoUnassignNodes.prototype),"layout",this).call(this,layerGroupInfo,links,customizeOptions);(0,_moveUnassignNodesToCenter2.default)(this.context);(0,_symmetricLayoutUnassignNodes2.default)(this.context);return this.getLocations()}}]);return PetalLayoutAutoUnassignNodes}(_petalLayout2.default);exports.default=PetalLayoutAutoUnassignNodes}(mod_exports,global.petalLayout,global.moveUnassignNodesToCenter,global.symmetricLayoutUnassignNodes);global.petalLayoutAutoUnassignNodes=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_layoutBaseConfig){Object.defineProperty(exports,"__esModule",{value:!0});var _layoutBaseConfig2=_interopRequireDefault(_layoutBaseConfig);exports.default=_.extend({},_layoutBaseConfig2.default,{startAt:Math.PI/2,direction:-1,splitSize:1})}(mod_exports,global.layoutBaseConfig);global.defaultRingLayoutConfig=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_position,_level,_spaceHelper){Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(context){var levelInfos=[];var layers=[].concat(_toConsumableArray(context.layerGroup.layers));var nodeSpace=(0,_spaceHelper.getNodeSpace)(context);var lastLevelInfo=null;_.each(layers,(function(layer){(lastLevelInfo=function(layer,lastLevelInfo,context){var matLevel=lastLevelInfo||function(){var matLevel=new _level.Level(-1);matLevel.startRadius=0;matLevel.endRadius=0;return matLevel}();var levelSplitSpace=(0,_spaceHelper.getLevelSplitSpace)(context);var currentLevel=new _level.Level(matLevel.levelIndex+1);currentLevel.startRadius=matLevel.endRadius+levelSplitSpace;var lastSubLevel=getMatSubLevelInfo();for(;lastSubLevel.toIndex<layer.nodes.size-1;){lastSubLevel=createSubLevels(currentLevel,lastSubLevel,layer,context);currentLevel.addSubLevel(lastSubLevel)}return currentLevel}(layer,lastLevelInfo,context)).endRadius=lastLevelInfo.startRadius+lastLevelInfo.subLevels.length*nodeSpace;levelInfos.push(lastLevelInfo)}));context.levelInfos=levelInfos};var _position2=_interopRequireDefault(_position);var pi2=2*Math.PI;function createSubLevels(parentLevel,lastSubLevel,layer,context){var matSubLevel=lastSubLevel||getMatSubLevelInfo();var currentSubLevel=new _level.SubLevel(parentLevel,matSubLevel.subLevelIndex+1);var subLevelBaseInfo=function(parentLevel,lastSubLevel,currentSubLevel,layer,context){if(0===currentSubLevel.subLevelIndex)return function(parentLevel,layer,context){var size=Math.min(layer.maxNodeCount,layer.nodes.size);var randianUnit=pi2/(size||1);var radius=(0,_spaceHelper.getNodeSpace)(context)/randianUnit/2;radius=Math.max(radius,parentLevel.startRadius);return{size:size,randianUnit:randianUnit,radius:radius,fromIndex:0,toIndex:size}}(parentLevel,layer,context);var fromIndex=lastSubLevel.toIndex;var nodeSpace=(0,_spaceHelper.getNodeSpace)(context);var radius=lastSubLevel.radius+nodeSpace;var size=Math.min(Math.floor(pi2*radius/nodeSpace),layer.nodes.size-fromIndex);return{size:size,randianUnit:pi2/(size||1),radius:radius,fromIndex:fromIndex,toIndex:fromIndex+size}}(parentLevel,lastSubLevel,currentSubLevel,layer,context);_.extend(currentSubLevel,subLevelBaseInfo);!function(subLevel,context){for(;subLevel.locations.length<subLevel.size;){var location=createLocation(subLevel,context);subLevel.addLocation(location)}}(currentSubLevel,context);return currentSubLevel}function createLocation(subLevel,context){var location=new _level.Location(subLevel);location.x=subLevel.locations.length;location.y=subLevel.subLevelIndex;var options=context.options;var radius=subLevel.radius;var angle=options.startAt+options.direction*(location.x*subLevel.randianUnit);var x=Math.cos(angle)*radius;var y=Math.sin(angle)*radius;var offset=new _position2.default(x,y);location.position=context.layoutInfo.center.getCopy().offset(offset);return location}function getMatSubLevelInfo(){var matSubLevel=new _level.SubLevel(null,-1);_.extend(matSubLevel,{size:0,fromIndex:0,toIndex:-1});return matSubLevel}}(mod_exports,global.position,global.level,global.spaceHelper);global.distributeRingLevelInfo=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(global,factory){var mod_exports={};!function(exports,_templateStyleLayout,_defaultRingLayoutConfig,_prepareBySymmetricLayout,_seekTheCenter,_distributeRingLevelInfo,_moveUnassignNodesToCenter,_symmetricLayoutUnassignNodes,_reduceCross){Object.defineProperty(exports,"__esModule",{value:!0});var _templateStyleLayout2=_interopRequireDefault(_templateStyleLayout);var _defaultRingLayoutConfig2=_interopRequireDefault(_defaultRingLayoutConfig);var _seekTheCenter2=_interopRequireDefault(_seekTheCenter);var _distributeRingLevelInfo2=_interopRequireDefault(_distributeRingLevelInfo);var _moveUnassignNodesToCenter2=_interopRequireDefault(_moveUnassignNodesToCenter);var _reduceCross2=_interopRequireDefault(_reduceCross);var RingLayout=function(_TemplateStyleLayout){_inherits(RingLayout,_TemplateStyleLayout);function RingLayout(props){_classCallCheck(this,RingLayout);var _this=_possibleConstructorReturn(this,(RingLayout.__proto__||Object.getPrototypeOf(RingLayout)).call(this,props));_this.layoutName="RingLayout";return _this}_createClass(RingLayout,[{key:"getLayoutName",value:function(){return this.layoutName}},{key:"layout",value:function(layerGroupInfo,links,customizeOptions){var options=_.extend({},_defaultRingLayoutConfig2.default,customizeOptions);this.convert(layerGroupInfo,links);var layerGroup=this.layerGroup;var allNodes=layerGroup.getAllNodes();var allNodesMap=layerGroup.allNodes;var context={options:options,layerGroup:layerGroup,links:[].concat(_toConsumableArray(layerGroup.links)),allNodes:allNodes,allNodesMap:allNodesMap,layoutInfo:{},currentLayerInfo:{}};this.context=context;(0,_prepareBySymmetricLayout.prepareBySymmetricLayout)(context);(0,_seekTheCenter2.default)(context);(0,_distributeRingLevelInfo2.default)(context);(0,_reduceCross2.default)(context);(0,_moveUnassignNodesToCenter2.default)(context);return this.getLocations()}},{key:"getLocations",value:function(){var allNodes=this.layerGroup.getAllNodes();return this.generateResult(allNodes)}}]);return RingLayout}(_templateStyleLayout2.default);exports.default=RingLayout}(mod_exports,global.templateStyleLayout,global.defaultRingLayoutConfig,global.prepareBySymmetricLayout,global.seekTheCenter,global.distributeRingLevelInfo,global.moveUnassignNodesToCenter,global.symmetricLayoutUnassignNodes,global.reduceCross);global.ringLayout=mod_exports}(NetBrain.ns("LayoutTools.internalGlobal"));!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var Link=internalGlobal.link.default;function MapInfo(){this.nodes=new Map;this.links=new Set}MapInfo.prototype.fromData=function(data,Node){this.nodes.clear();this.links.clear();this.convertNodes(data.nodeDataArray,Node);this.convertLinks(data.linkDataArray)};MapInfo.prototype.convertNodes=function(nodeDataArray,Node){var nodes=this.nodes;_.each(nodeDataArray,(function(nodeInfo){var node=new Node(nodeInfo);nodes.set(node.id,node)}))};MapInfo.prototype.convertLinks=function(linkDataArray){var nodes=this.nodes;var links=this.links;_.each(linkDataArray,(function(linkInfo){var link=new Link(linkInfo);links.add(link);var fromNode=nodes.get(link.from);var toNode=nodes.get(link.to);if(fromNode){link.fromNode=fromNode;fromNode.addFromLink(link);fromNode.addToNeighbor(toNode)}if(toNode){link.toNode=toNode;toNode.addToLink(link);toNode.addToNeighbor(fromNode)}}))};internalGlobal.mapInfo={default:MapInfo}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var BaseLayout=internalGlobal.baseLayout.default;var MapInfo=internalGlobal.mapInfo.default;function SampleMapLayout(){BaseLayout.apply(this,arguments);this.layoutName="SampleMapLayout";this.currMapInfo=new MapInfo;this.originMapInfo=new MapInfo;this.matchedNodes=new Map;this.unmatchedNodes=new Map}NgUtil.inherit(SampleMapLayout,BaseLayout);SampleMapLayout.prototype.convert=function(currMapData,originMapData){this.currMapInfo.fromData(currMapData,this.nodeType);this.originMapInfo.fromData(originMapData,this.nodeType)};SampleMapLayout.prototype.getLocations=function(){var matchedLocations=this.generateResult(this.matchedNodes);var unmatchedLocations=this.generateResult(this.unmatchedNodes);return matchedLocations.concat(unmatchedLocations)};internalGlobal.sampleMapLayout={default:SampleMapLayout}}();!function(netBrain){var config={getDeviceKey:function(node){var hostName=node.hostName;_.isArray(hostName)&&(hostName=hostName.join("\n"));return hostName||""}};NetBrain.ns("LayoutTools.internalGlobal").sampleMapByDeviceConfig={default:config}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var Node=internalGlobal.node.default;function SampleMapByDeviceNode(originNode){Node.apply(this,arguments);this.hostName=originNode.hostName}NgUtil.inherit(SampleMapByDeviceNode,Node);internalGlobal.sampleMapByDeviceNode={default:SampleMapByDeviceNode}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var SampleMapLayout=internalGlobal.sampleMapLayout.default;var SampleMapByDeviceNode=internalGlobal.sampleMapByDeviceNode.default;var SampleMapByDeviceConfig=internalGlobal.sampleMapByDeviceConfig.default;var moveSomeNodesNearOtherNodesTool=internalGlobal.moveSomeNodesNearOtherNodesTool.default;function SampleMapByDeviceLayout(){SampleMapLayout.apply(this,arguments);this.layoutName="SampleMapByDeviceLayout";this.nodeType=SampleMapByDeviceNode}NgUtil.inherit(SampleMapByDeviceLayout,SampleMapLayout);SampleMapByDeviceLayout.prototype.layout=function(currMapData,originMapData,customOptions){this.options=_.extend(SampleMapByDeviceConfig,customOptions);this.convert(currMapData,originMapData);this.diff();moveSomeNodesNearOtherNodesTool(this.unmatchedNodes,this.matchedNodes);return this.getLocations()};SampleMapByDeviceLayout.prototype.diff=function(){var currNodes=this.currMapInfo.nodes;var originNodes=this.originMapInfo.nodes;var matchedNodes=this.matchedNodes;var unmatchedNodes=this.unmatchedNodes;var getDeviceKey=this.options.getDeviceKey;var originHostNameMap=new Map;originNodes.forEach((function(node){var key=getDeviceKey(node);key&&originHostNameMap.set(key,node)}));currNodes.forEach((function(node){var key=getDeviceKey(node);if(key){var originNode=originHostNameMap.get(key);if(originNode){node.offset.moveTo(originNode.offset);matchedNodes.set(node.id,node)}else unmatchedNodes.set(node.id,node)}}))};internalGlobal.sampleMapByDeviceLayout={default:SampleMapByDeviceLayout}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var SampleMapByDeviceLayout=internalGlobal.sampleMapByDeviceLayout.default;function matchFun(currMapData,originMapData){var deviceLayout=new SampleMapByDeviceLayout;deviceLayout.layout(currMapData,originMapData);var matchedNodes=deviceLayout.matchedNodes;var unmatchedNodes=deviceLayout.unmatchedNodes;var results={matchedNodes:[],unmatchedNodes:[]};matchedNodes.forEach((function(node){results.matchedNodes.push(node.originalNode)}));unmatchedNodes.forEach((function(node){results.unmatchedNodes.push(node.originalNode)}));return results}internalGlobal.sampleMapByDeviceMatchResultsTool={default:matchFun}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var BaseNode=internalGlobal.node.default;function TagNode(originalNode,locked){BaseNode.apply(this,arguments);this.tags=originalNode.tags}NgUtil.inherit(TagNode,BaseNode);internalGlobal.tagNode={default:TagNode}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var Position=internalGlobal.position.default;function TagInfo(){this.tagMap=new Map;this.nodes=new Map}TagInfo.prototype.fromData=function(data,Node){var tagMap=this.tagMap;var allNodes=this.nodes;_.each(data,(function(info){var tagName=info.tag;var devices=info.devices;var mapNodes=new Map;_.each(devices,(function(device){var node=new Node(device);mapNodes.set(node.id,node);allNodes.set(node.id,node)}));tagMap.set(formatTagName(tagName),mapNodes)}))};TagInfo.prototype.getNodeSetByTagName=function(tagName){return this.tagMap.get(tagName)};TagInfo.prototype.getPositionsByTagName=function(tagName){var positions=new Set;this.tagMap.get(tagName).forEach((function(node){var pos=node.offset;positions.add(new Position(pos.x,pos.y))}));return positions};TagInfo.prototype.fromMatchedNodes=function(matched){this.clear();var tagMap=this.tagMap;var allNodes=this.nodes;_.each(matched,(function(obj){var tagName=obj.tag;var mapNodes=new Map;_.each(obj.nodes,(function(node){mapNodes.set(node.id,node);allNodes.set(node.id,node)}));tagMap.set(formatTagName(tagName),mapNodes)}))};TagInfo.prototype.clear=function(){this.tagMap.clear()};function formatTagName(tagName){return tagName.toUpperCase()}internalGlobal.tagInfo={default:TagInfo}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var Position=internalGlobal.position.default;function prepareBaseInfo(locations){var center=function(locations){var counter=locations.length;var xSum=0;var ySum=0;locations.forEach((function(node){var position=node.offset;xSum+=position.x;ySum+=position.y}));return new Position(xSum/counter,ySum/counter)}(locations);locations.forEach((function(node){var vector=node.offset.getOffsetFrom(center);node.vector=vector;node.rate=Math.atan2(vector.y,vector.x)}));locations.center=center}internalGlobal.sampleMapByTagSortNodesTool={default:function(currLocs,originLocs){return function(goalLocations,goodLocations){prepareBaseInfo(goalLocations);prepareBaseInfo(goodLocations);var matchResult=function(goalLocations,goodLocations){var join=[];goalLocations.forEach((function(goal){goodLocations.forEach((function(good){join.push({goal:goal.id,good:good.id,diff:(rate1=goal.rate,rate2=good.rate,pi=Math.PI,pi2=2*pi,diff=Math.abs(rate1-rate2),diff<pi?diff:pi2-diff),position:good.offset});var rate1,rate2,pi,pi2,diff}))}));join=_.sortBy(join,"diff");var result=[];for(;join.length>0;){var current=join.shift();result.push({key:current.good,goalKey:current.goal,location:current.position.convertToLocation(),position:current.position});join=_.filter(join,(function(item){return item.goal!==current.goal&&item.good!==current.good}))}return result}(goalLocations,goodLocations);matchResult=matchResult.slice(0,goodLocations.length);var result=[];_.each(matchResult,(function(item){result.push({id:item.goalKey,position:item.position})}));return result}(currLocs,originLocs)}}}();NetBrain.ns("LayoutTools.internalGlobal").sampleMapByTagMatchNodeTool={default:function(nodes,originMapData){var tagInfo=function(originMapData){var tagInfo={};_.each(originMapData,(function(tagObj){var tagName=tagObj.tag;tagInfo[tagName.toUpperCase()]={tag:tagName,count:tagObj.devices.length,nodes:[]}}));return tagInfo}(originMapData);var unmatchedNodes=[];nodes.forEach((function(node){var nodeTags=node.tags;if(_.isArray(nodeTags)){var matchFlag=!1;for(var i=nodeTags.length-1;i>=0;i--){var tmpTag=nodeTags[i].toUpperCase();var tagObj=tagInfo[tmpTag];if(tagObj){tagObj.nodes.push(node);matchFlag=!0;break}}matchFlag||unmatchedNodes.push(node)}}));return{matched:tagInfo,unmatched:unmatchedNodes}}};!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var sampleMapByTagMatchNodeTool=internalGlobal.sampleMapByTagMatchNodeTool.default;var MapInfo=internalGlobal.mapInfo.default;var TagNode=internalGlobal.tagNode.default;function matchFun(currMapData,originMapData){var result={matchedNodes:[],unmatchedNodes:[],realMatchedCount:0};var mapInfo=new MapInfo;mapInfo.fromData(currMapData,TagNode);var matchInfo=sampleMapByTagMatchNodeTool(mapInfo.nodes,originMapData);_.each(matchInfo.matched,(function(obj){_.each(obj.nodes,(function(node){result.matchedNodes.push(node.originalNode)}))}));_.each(matchInfo.unmatched,(function(node){result.unmatchedNodes.push(node.originalNode)}));_.each(matchInfo.matched,(function(obj){result.realMatchedCount+=Math.min(obj.count,obj.nodes.length)}));return result}internalGlobal.sampleMapByTagMatchResultsTool={default:matchFun}}();!function(netBrain){var internalGlobal=NetBrain.ns("LayoutTools.internalGlobal");var SampleMapLayout=internalGlobal.sampleMapLayout.default;var SymmetricLayout=internalGlobal.symmetricLayout.default;var TagNode=internalGlobal.tagNode.default;var TagInfo=internalGlobal.tagInfo.default;var MapInfo=internalGlobal.mapInfo.default;var sampleMapByTagMatchNodeTool=internalGlobal.sampleMapByTagMatchNodeTool.default;var sampleMapByTagSortNodesTool=internalGlobal.sampleMapByTagSortNodesTool.default;var moveSomeNodesNearOtherNodesTool=internalGlobal.moveSomeNodesNearOtherNodesTool.default;function SampleMapByTagLayout(){SampleMapLayout.apply(this,arguments);this.layoutName="SampleMapByTagLayout";this.nodeType=TagNode;this.currMapInfo=new MapInfo;this.currTagInfo=new TagInfo;this.originTagInfo=new TagInfo;this.matchedNodes=new Map;this.unmatchedNodes=new Map}NgUtil.inherit(SampleMapByTagLayout,SampleMapLayout);SampleMapByTagLayout.prototype.layout=function(currMapData,originMapData){this.convert(currMapData,originMapData);(new SymmetricLayout).layout(this.currMapInfo.nodes,this.currMapInfo.links);this.updateNodesLocations();moveSomeNodesNearOtherNodesTool(this.unmatchedNodes,this.matchedNodes);return this.getLocations()};SampleMapByTagLayout.prototype.convert=function(currMapData,originMapData){this.currMapInfo.fromData(currMapData,this.nodeType);this.originTagInfo.fromData(originMapData,this.nodeType);var matchInfo=sampleMapByTagMatchNodeTool(this.currMapInfo.nodes,originMapData);this.currTagInfo.fromMatchedNodes(matchInfo.matched);this.diff()};SampleMapByTagLayout.prototype.diff=function(){var matchedNodes=this.matchedNodes;var unmatchedNodes=this.unmatchedNodes;this.currTagInfo.nodes.forEach((function(node){matchedNodes.set(node.id,node)}));this.currMapInfo.nodes.forEach((function(node){matchedNodes.has(node.id)||unmatchedNodes.set(node.id,node)}))};SampleMapByTagLayout.prototype.updateNodesLocations=function(){var currTagInfo=this.currTagInfo;var originTagInfo=this.originTagInfo;var noMoveNodes=new Map;currTagInfo.tagMap.forEach((function(tagNodeMap,tagName){var originTagNodeSet=originTagInfo.getNodeSetByTagName(tagName);var currTagNodeArr=Array.from(tagNodeMap.values());var originTagNodeArr=Array.from(originTagNodeSet.values());var newLocations=sampleMapByTagSortNodesTool(currTagNodeArr,originTagNodeArr);var tempTagNodeMap=new Map;tagNodeMap.forEach((function(node){tempTagNodeMap.set(node.id,node)}));_.each(newLocations,(function(item){var id=item.id;var node=tempTagNodeMap.get(id);if(node){node.offset.moveTo(item.position);tempTagNodeMap.delete(id)}}));tempTagNodeMap.forEach((function(node){noMoveNodes.set(node.id,node)}))}));this.moveNodesToUnmatchedNodes(noMoveNodes)};SampleMapByTagLayout.prototype.moveNodesToUnmatchedNodes=function(noMoveNodes){var matchedNodes=this.matchedNodes;var unmatchedNodes=this.unmatchedNodes;noMoveNodes.forEach((function(node){matchedNodes.delete(node.id);unmatchedNodes.set(node.id,node)}))};internalGlobal.sampleMapByTagLayout={default:SampleMapByTagLayout}}();!function(netBrain){var LayoutTools=netBrain.ns("LayoutTools");!function(api){var internal=LayoutTools.internalGlobal;api.options={defaultOptions:internal.defaultOptions.default};api.Models={Position:internal.position.default,Node:internal.node.default,Link:internal.link.default};api.Layouts={SymmetricLayout:internal.symmetricLayout.default,SymmetricLayoutForIsland:internal.symmetricLayoutForIsland.default,TreeLayout:internal.treeLayout.default,IslandGroupLayout:internal.islandGroupLayout.default,ParallelStyleLayout:internal.parallelStyleLayout.default,SymmetryStyleLayout:internal.symmetryStyleLayout.default,PetalLayout:internal.petalLayout.default,RingLayout:internal.ringLayout.default,SampleMapByDeviceLayout:internal.sampleMapByDeviceLayout.default,SampleMapByTagLayout:internal.sampleMapByTagLayout.default};api.Utils={convert:internal.convert.default,split:internal.split.default};api.Tools={angle:internal.angle.default,rotateTool:internal.rotateTool.default,flipTool:internal.flipTool.default,layeredTool:internal.layeredTool.default,sampleMapByDeviceMatchResultsTool:internal.sampleMapByDeviceMatchResultsTool.default,sampleMapByTagMatchResultsTool:internal.sampleMapByTagMatchResultsTool.default};api.Similarity={calculateSimilarityCoefficient:internal.calculator.calculateSimilarityCoefficient,calculateSimilarityCoefficientAdvanced:internal.advancedCalculator.calculateSimilarityCoefficient}}(netBrain.ns("LayoutTools.PublicApi"))}(NetBrain);